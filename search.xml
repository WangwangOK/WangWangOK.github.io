<?xml version="1.0" encoding="utf-8"?>
<search>
  
    
    <entry>
      <title><![CDATA[ç®€å•äº†è§£2-3æ ‘ã€2-3-4æ ‘å’Œçº¢é»‘æ ‘]]></title>
      <url>%2F2020%2F01%2F11%2Ftwo_three_four_red_black_tree%2F</url>
      <content type="text"><![CDATA[åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸»è¦æ˜¯å°†æ•°æ®ç»“æž„ä¸­çš„2-3æ ‘ã€2-3-4æ ‘ã€çº¢é»‘æ ‘è¿›è¡Œäº†æ•´ç†ã€‚ç”±äºŽæœ¬ç¯‡å­—æ•°ã€å›¾ç‰‡ä»¥åŠä»£ç è¾ƒå¤šï¼Œå¯é€‰æ‹©è‡ªå·±æ¯”è¾ƒåœ¨äºŽçš„éƒ¨åˆ†é˜…è¯»ï¼Œä½†æˆ‘å»ºè®®æ˜¯ä»Žä¸Šå¾€ä¸‹ä¾æ¬¡é˜…è¯»ã€‚ æ¯•ç«Ÿå¤§éƒ¨åˆ†äººå¯èƒ½æ¯”è¾ƒå…³å¿ƒçº¢é»‘æ ‘ã€‚ä½†æ˜¯æ€Žä¹ˆæ˜¯ä»Ž2-3åˆ°çº¢é»‘æ ‘çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆå€¼å¾—äº†è§£çš„ã€‚è€Œåœ¨æ–‡ç« çš„æœ€åŽï¼Œæˆ‘ä¹Ÿå¤§è‡´æ‰‹æ’¸äº†ä¸€å¥—2-3æ ‘ç›¸å…³æ“ä½œçš„ä»£ç ã€‚ ä¸€ã€2-3æ ‘ ä¸€é¢—2-3æ ‘ä¸­çš„æ¯ä¸ªç»“ç‚¹çš„åº¦ä¸º2ï¼Œæˆ–è€…3ï¼›å…¶ä¸­åº¦ä¸º2çš„ç§°ä¸º2èŠ‚ç‚¹ï¼Œåº¦ä¸º3çš„ç§°ä¸º3èŠ‚ç‚¹ã€‚ è¯¥æ ‘æˆ–è€…ä¸ºç©ºï¼Œæˆ–è€…æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹å¯ä»¥æ˜¯2èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª3èŠ‚ç‚¹ã€‚2èŠ‚ç‚¹å­˜æ”¾ä¸€ä¸ªå…ƒç´ ï¼Œ3èŠ‚ç‚¹å­˜æ”¾ä¸¤ä¸ªå…ƒç´  ï¼› 2èŠ‚ç‚¹ ï¼šçš„ä¸¤ä¸ªå­èŠ‚ç‚¹åˆ†åˆ«æ˜¯ï¼šleft_child, middle_childï¼›è¯¥èŠ‚ç‚¹çš„å­˜æ”¾å…ƒç´ ä¸ºdata_lï¼Œè¯¥å…ƒç´ çš„å…³é”®å­—ä¸ºdata_l.keyã€‚ä»¥left_childä¸ºæ ¹çš„å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å…³é”®å­—ï¼ˆdata_l.keyï¼‰éƒ½å°äºŽè¯¥èŠ‚ç‚¹çš„data_l.keyï¼›ä»¥middle_childä¸ºæ ¹çš„å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å…³é”®å­—éƒ½å¤§äºŽè¯¥èŠ‚ç‚¹çš„data_l.keyï¼› 3èŠ‚ç‚¹ ï¼šçš„ä¸‰ä¸ªå­èŠ‚ç‚¹åˆ†åˆ«æ˜¯ï¼šleft_child, middle_child, right_childï¼›è¯¥èŠ‚ç‚¹å­˜æ”¾çš„ä¸¤ä¸ªå…ƒç´ åˆ†åˆ«ä¸ºdata_l, data_rã€‚å®ƒä»¬å¯¹åº”çš„å…ƒç´ å…³é”®å­—ä¸ºdata_l.keyï¼Œdata_r.keyã€‚ä»¥left_childä¸ºæ ¹çš„å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹å…³é”®å­—(data_l.key)éƒ½å°äºŽdata_l.keyï¼›ä»¥middle_childä¸ºæ ¹çš„å­æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤§äºŽdata_l.keyï¼Œå°äºŽdata_r.keyï¼›ä»¥right_childä¸ºæ ¹çš„å­æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤§äºŽdata_r.keyï¼› 4ã€æ‰€æœ‰çš„å¤–éƒ¨èŠ‚ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ ï¼ˆnullèŠ‚ç‚¹ï¼‰ã€‚ æŸ¥æ‰¾1ï¼‰ã€é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹æ˜¯2èŠ‚ç‚¹ï¼Œè¿˜æ˜¯3èŠ‚ç‚¹ã€‚é€šè¿‡æŸ¥çœ‹data_ræ˜¯å¦ä¸ºINT_MAXï¼ˆç”±äºŽ0å¯èƒ½æ˜¯æ­£å¸¸å­˜å‚¨çš„å…ƒç´ ï¼Œå› æ­¤è¿™é‡Œå–çš„æ˜¯INT_MAXï¼‰æ¥ç¡®å®šï¼Œå¦‚æžœä¸ºINT_MAXåˆ™ä¸º2èŠ‚ç‚¹ï¼› 2ï¼‰ã€å¦‚æžœæ˜¯2èŠ‚ç‚¹ï¼šå°äºŽåˆ™æ²¿ç€left_childæŸ¥æ‰¾ï¼Œå¤§äºŽåˆ™æ²¿ç€middle_childæŸ¥æ‰¾ï¼›ç›¸ç­‰åˆ™æŸ¥æ‰¾æˆåŠŸï¼› 3ï¼‰ã€å¦‚æžœæ˜¯3èŠ‚ç‚¹ï¼šå°äºŽdata_låˆ™æ²¿ç€left_childï¼Œå¤§äºŽdata_lä¸”å°äºŽdata_råˆ™æ²¿ç€middle_childï¼Œå¤§äºŽdata_råˆ™æ²¿ç€right_childï¼›å¦‚æžœç›¸ç­‰åˆ™æŸ¥æ‰¾æˆåŠŸ æ’å…¥æ“ä½œå½“å¾…æŸ¥å…³é”®å­—ä¸åœ¨2-3æ ‘ä¸­æ—¶ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ä¸­å°†é‡åˆ°å”¯ä¸€çš„å¶èŠ‚ç‚¹ï¼ˆç©ºèŠ‚ç‚¹ï¼‰ã€‚å¦‚æžœèŠ‚ç‚¹åªåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥èŠ‚ç‚¹ä¸­ã€‚ä»¥æž„æˆ3èŠ‚ç‚¹ï¼› æ’å…¥æ“ä½œç›¸å¯¹æ¥è¯´è¦å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯ç†è§£é€å½»äº†ä¹Ÿå¹¶ä¸å¤æ‚ã€‚ä¸‹é¢æ¥ä»”ç»†çœ‹ä¸€ä¸‹æ’å…¥è¿‡ç¨‹ï¼Œè¿™é‡Œä»¥æ’å…¥æ•°å­—30ä¸ºä¾‹ï¼› 1ï¼‰ã€é¦–å…ˆæˆ‘ä»¬çš„åˆå§‹2-3æ ‘å¦‚ä¸‹ï¼š 2ï¼‰ã€çŽ°åœ¨æˆ‘ä»¬æ’å…¥æ•°å­—30ï¼Œå®ƒå¤§äºŽ20ï¼Œå› æ­¤å®ƒåº”è¯¥å¤„äºŽ3èŠ‚ç‚¹ï¼ˆBï¼‰çš„right_childé‡Œé¢ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹çœ‹ä¸Šé¢2-3æ ‘çš„æ€§è´¨4ï¼šæ‰€æœ‰çš„å¤–éƒ¨èŠ‚ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ï¼Œæ‰€ä»¥çŽ°åœ¨æˆ‘å°†30æ”¾å…¥èŠ‚ç‚¹Bè¿™ä¸€å±‚ï¼š 3ï¼‰ã€ä½†è¿™æ˜Žæ˜¾ä¸æ˜¯2-3æ ‘ï¼Œå®ƒå­˜åœ¨äº†æ—¢ä¸æ˜¯2èŠ‚ç‚¹ï¼Œä¹Ÿä¸æ˜¯ä¸‰èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ”¹é€ å®ƒã€‚æ”¹é€ çš„æ–¹æ³•å°±æ˜¯å°†20å‘ä¸Šæï¼š 4ï¼‰ã€æ²¡åŠžæ³•ï¼Œè¿™åˆä¸ç¬¦åˆé¢„æœŸã€‚å®ƒä¾ç„¶è¿åäº†æ€§è´¨4ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æ”¹åŠ¨ã€‚ç»§ç»­æ20ï¼š åˆ°è¿™é‡Œæˆ‘ä»¬å¤§è‡´ä¸Šå®Œæˆäº†2-3æ ‘ä¸­æ’å…¥30çš„æ“ä½œã€‚ä¸»è¦å°±æ˜¯å…ˆæ‰¾åˆ°æœ€ç›´è§‚çš„æ’å…¥åœ°å€ï¼Œç„¶åŽä¸€æ­¥ä¸€æ­¥çš„åŽ»æ›´æ–°è¯¥æ ‘ï¼Œä»¥ç¬¦åˆ2-3æ ‘çš„æ€§è´¨ã€‚ å¯ä»¥ç®€å•çš„ç†è§£2-3æ ‘çš„æ’å…¥æ“ä½œæ˜¯ä»Žå¶å­èŠ‚ç‚¹å‘ä¸Šç”Ÿé•¿çš„è¿‡ç¨‹ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´åŠ å¤æ‚çš„æ’å…¥ä¾‹å­ã€‚ä¸ºäº†ç”»å›¾ç®€å•èµ·è§ï¼Œ2-3èŠ‚ç‚¹ä¸­çš„2èŠ‚ç‚¹çš„å¦ä¸€ä¸ªdata_rï¼Œä»¥åŠæ¯ä¸ªä¸ºç©ºçš„å¶å­èŠ‚ç‚¹å°±ä¸ç”»å‡ºäº†ï¼Œå› æ­¤ä¸‹å›¾ä¸­åªæœ‰ä¸€ä¸ªæ•°æ®åŸŸçš„ä¸º2èŠ‚ç‚¹ï¼Œæœ‰ä¸¤ä¸ªæ•°æ®åŸŸçš„ä¸º3èŠ‚ç‚¹ã€‚ä¸‹é¢ä»¥æ’å…¥æ•°å­—50ä¸ºä¾‹ï¼š è¿™æ˜¯ç±»ä¼¼çš„ï¼Œå°±æ˜¯èŠ‚ç‚¹å‘ä¸Šç§»åŠ¨çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å¤§è‡´çœ‹äº†ä¸€ä¸‹æ’å…¥æ“ä½œï¼Œå°±æ˜¯ä¸æ–­åŽ»æ»¡è¶³2-3æ ‘çš„æ€§è´¨çš„åŒæ—¶åŽ»åšèŠ‚ç‚¹ä¸Šç§»çš„äº‹å„¿ã€‚ ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹2-3æ ‘çš„åˆ é™¤æ“ä½œã€‚ åˆ é™¤æ“ä½œï¼ˆæ—‹è½¬å’Œåˆå¹¶ï¼‰åŽé¢çš„åˆ é™¤éƒ½ä»¥ä¸‹é¢è¿™æ£µæ ‘ä¸ºåŸºç¡€è¿›è¡Œï¼š éžå¶èŠ‚ç‚¹åˆ é™¤é¦–å…ˆï¼Œå¦‚æžœè¦åˆ é™¤çš„å…ƒç´ ä¸åœ¨å¶èŠ‚ç‚¹ä¸­ï¼Œåˆ™å¯ä»¥ç”¨ä¸€ä¸ªå¶èŠ‚ç‚¹ä¸­çš„é€‚å½“å…ƒç´ ä¸Žå¾…åˆ é™¤å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œä»Žè€Œå°†è¯¥åˆ é™¤æ“ä½œè½¬åŒ–ä¸ºåœ¨å¶èŠ‚ç‚¹ä¸Šçš„åˆ é™¤æ“ä½œã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¢«åˆ é™¤å…ƒç´ çš„å·¦å­æ ‘ä¸­å…³é”®å­—æœ€å¤§çš„å…ƒç´ ï¼Œæˆ–è€…å³å­æ ‘ä¸­å…³é”®å­—æœ€å°çš„å…ƒç´ ä¸Žè¯¥å…ƒç´ äº¤æ¢ã€‚ æ€»çš„æ¥è¯´å°±æ˜¯æŠŠéžå¶èŠ‚ç‚¹çš„åˆ é™¤è½¬æ¢ä¸ºå¶èŠ‚ç‚¹çš„åˆ é™¤æ“ä½œï¼Œè€Œå¶èŠ‚ç‚¹çš„åˆ é™¤æ“ä½œåˆåˆ†ä¸º2èŠ‚ç‚¹å’Œ3èŠ‚ç‚¹åˆ é™¤æ“ä½œã€‚ 3å¶èŠ‚ç‚¹åˆ é™¤3èŠ‚ç‚¹çš„åˆ é™¤æ“ä½œç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œå¤§è‡´çš„è§„åˆ™å¦‚ä¸‹ï¼š 1ï¼‰ã€å¦‚æžœè¦åˆ é™¤3èŠ‚ç‚¹çš„data_læ—¶ï¼Œå½“åˆ é™¤ä¹‹åŽéœ€è¦å°†data_rçš„å…³é”®å­—ç§»åŠ¨åˆ°data_lå¤„ã€‚å¹¶ä¸”å°†data_ræ¸…é›¶æˆ–è€…ç½®ä¸ºä¸€ä¸ªæœ€å¤§å€¼å³å¯ï¼› è¿™æ˜¯ä»¥ä¸Šé¢åŸºç¡€2-3æ ‘åˆ é™¤3èŠ‚ç‚¹ä¸­çš„data_lï¼ˆ10ï¼‰åŸŸä¹‹åŽçš„ç»“æžœã€‚ 2ï¼‰ã€å¦‚æžœè¦åˆ é™¤3èŠ‚ç‚¹çš„data_ræ—¶ï¼Œç›´æŽ¥å°†å…¶æ¸…é›¶æˆ–è€…ç½®ä¸ºä¸€ä¸ªæœ€å¤§å€¼å³å¯ï¼› è¿™é‡Œæ˜¯å°†åŸºç¡€2-3æ ‘åˆ é™¤3èŠ‚ç‚¹ä¸­data_rï¼ˆ70ï¼‰åŸŸä¹‹åŽçš„ç»“æžœã€‚ 2å¶èŠ‚ç‚¹åˆ é™¤å¯¹äºŽ2èŠ‚ç‚¹çš„åˆ é™¤æ“ä½œç›¸å¯¹æ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œå®ƒå¹¶ä¸èƒ½åƒ3èŠ‚ç‚¹é‚£æ ·ç®€å•çš„åˆ é™¤å°±è¡Œäº†ã€‚å› ä¸º2èŠ‚ç‚¹ç›´æŽ¥åˆ é™¤å¯¹åº”çš„data_låŸŸçš„è¯ï¼Œå°†ä¼šå¯¼è‡´æ•´ä¸ªèŠ‚ç‚¹å˜ä¸ºç©ºã€‚å› æ­¤éœ€è¦åˆ†å¤šç§æƒ…å†µæ¥è®¨è®ºï¼š æ—‹è½¬å¾…åˆ é™¤èŠ‚ç‚¹ä¸º2èŠ‚ç‚¹ï¼Œä¸”è¯¥èŠ‚ç‚¹çš„ç›¸é‚»å…„å¼Ÿå­æ ‘æœ‰ä¸€ä¸ªæ˜¯3èŠ‚ç‚¹æ—¶æˆ‘ä»¬ä½¿ç”¨æ—‹è½¬çš„æ“ä½œã€‚ 1ï¼‰ã€å¾…åˆ é™¤å…ƒç´ ä¸ºå·¦å„¿å­ï¼Œå¹¶ä¸”å…¶ä¸­å³è¾¹çš„å…„å¼Ÿå­æ ‘ï¼ˆåªçœ‹ç›¸é‚»å…„å¼Ÿå­æ ‘ï¼‰ä¸º3èŠ‚ç‚¹ï¼› å…¶ä¸­xä¸ºå¾…åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ ã€‚ 2ï¼‰ã€å¾…åˆ é™¤å…ƒç´ ä¸ºä¸­å„¿å­ï¼Œå¹¶ä¸”å…¶å·¦å…„å¼Ÿæˆ–è€…å³å…„å¼Ÿä¸º3èŠ‚ç‚¹ï¼› å…¶ä¸­xä¸ºå¾…åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ ã€‚ 3ï¼‰ã€å¾…åˆ é™¤å…ƒç´ ä¸ºå³å„¿å­ï¼Œå¹¶ä¸”å…¶ä¸­å·¦è¾¹å…„å¼Ÿå­æ ‘ï¼ˆåªçœ‹ç›¸é‚»å…„å¼Ÿå­æ ‘ï¼‰ä¸º3èŠ‚ç‚¹ï¼› æ—‹è½¬æ“ä½œä¸åˆ é™¤èŠ‚ç‚¹ï¼ï¼ï¼ åˆå¹¶æ—‹è½¬è§£å†³äº†å½“è¢«åˆ é™¤å…ƒç´ ä¸º2èŠ‚ç‚¹ï¼Œå¹¶ä¸”å…¶å·¦å³ä¸¤è¾¹çš„å…„å¼Ÿå­æ ‘å­˜åœ¨3èŠ‚ç‚¹çš„æƒ…å†µã€‚é‚£å¦‚æžœè¢«åˆ é™¤èŠ‚ç‚¹å·¦å³ä¸¤è¾¹éƒ½ä¸å­˜åœ¨3èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦æ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°åˆå¹¶æ“ä½œã€‚ åˆå¹¶æ“ä½œç”¨äºŽ2èŠ‚ç‚¹åˆ é™¤æ—¶ï¼Œå…¶å·¦å³å…„å¼ŸåŒæ ·ä¸º2èŠ‚ç‚¹æ—¶ï¼åˆå¹¶æ“ä½œä¼šåˆ é™¤èŠ‚ç‚¹ï¼ï¼ï¼ å’Œæ—‹è½¬ç±»ä¼¼ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦çœ‹è¢«åˆ é™¤å…ƒç´ æ‰€åœ¨èŠ‚ç‚¹çš„ä½ç½®ã€‚ç”±äºŽå¾…åˆ é™¤èŠ‚ç‚¹å·¦å³å…„å¼Ÿå­æ ‘å­˜åœ¨3èŠ‚ç‚¹æ—¶éƒ½å¯ä»¥ä½¿ç”¨æ—‹è½¬çš„æ“ä½œï¼Œæ‰€ä»¥ä»¥ä¸‹æ‰€æœ‰çš„æƒ…å½¢ä¸­æ‰€æœ‰å¾…åˆ é™¤å…ƒç´ çš„ç›¸é‚»å­æ ‘ä¸­éƒ½ä¸ä¼šä¸ä¼šå­˜åœ¨3èŠ‚ç‚¹ã€‚ ä¸‹é¢å…·ä½“çš„åˆå¹¶åˆ†ç±»ï¼š 1ï¼‰ã€å¾…åˆ é™¤èŠ‚ç‚¹ä¸ºå·¦å„¿å­ï¼› è¿™é‡Œå½“çˆ¶èŠ‚ç‚¹æœª3èŠ‚ç‚¹æ—¶ï¼Œå˜æ¢çš„ç¬¬äºŒæ­¥æ—¶å¦‚æžœå…¶å³å­æ ‘ä¸º2èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥å°†bä¸‹é™åˆ°å³å­æ ‘ä¸­ï¼Œè€Œaä¿æŒä¸å˜ã€‚ 2ï¼‰ã€å¾…åˆ é™¤èŠ‚ç‚¹ä¸ºä¸­å„¿å­ï¼› è¿‡æ¸¡æ€ä¸­ï¼šc&lt;a&lt;b&lt;dï¼Œç»“æžœçš„åˆå¹¶åŸºäºŽè¯¥å¤§å°å…³ç³»ã€‚ 3ï¼‰ã€å¾…åˆ é™¤èŠ‚ç‚¹ä¸ºå³å„¿å­ï¼› è¿‡æ¸¡æ€ä¸­ï¼šc&lt;a&lt;d&lt;bï¼Œç»“æžœçš„åˆå¹¶åŸºäºŽè¯¥å¤§å°å…³ç³»ã€‚ åˆ é™¤æ“ä½œæ€»ç»“1ï¼‰ã€éžå¶å­èŠ‚ç‚¹ï¼Œå…ˆå°†å…¶è½¬æ¢ä¸ºå¶å­èŠ‚ç‚¹ä¹‹åŽæ“ä½œï¼› 2ï¼‰ã€3èŠ‚ç‚¹åˆ é™¤ç›´æŽ¥åˆ é™¤å³å¯ï¼Œåªä¸è¿‡éœ€è¦æ³¨æ„å‰©ä¸‹å…ƒç´ å¿…é¡»åœ¨data_lä¸­ï¼› 3ï¼‰ã€2èŠ‚ç‚¹çš„åˆ é™¤ä¸€å®šè¦ç‰¢è®°2-3æ ‘çš„å››æ¡æ€§è´¨æ¥è¿›è¡Œæ—‹è½¬å’Œåˆå¹¶æ“ä½œï¼› 4ï¼‰ã€èŠ‚ç‚¹å˜åŒ–çš„åŸºç¡€æ˜¯æˆ‘ä»¬åœ¨å®šä¹‰2-3æ ‘æ—¶ï¼Œå·¦å„¿å­ã€ä¸­å„¿å­ã€å³å„¿å­ï¼Œä»¥åŠèŠ‚ç‚¹çš„å·¦å³æ•°æ®åŸŸçš„å¤§å°å…³ç³»ã€‚ å¾ˆæ˜¾ç„¶ï¼Œæ‰§è¡Œä¸€æ¬¡æ—‹è½¬å’Œæ‰§è¡Œä¸€æ¬¡åˆå¹¶æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚å¦‚æžœæ‰§è¡Œçš„æ˜¯ï¼ˆåˆ é™¤ä¸­çš„ï¼‰æ—‹è½¬æ“ä½œï¼Œé‚£ä¹ˆä¸€æ¬¡æ—‹è½¬å®ŒæˆåŽåˆ é™¤å°±ä¼šç»“æŸï¼› åœ¨åˆ é™¤è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œçš„åˆå¹¶æ“ä½œæ¬¡æ•°ä¸ä¼šè¶…è¿‡2-3æ ‘çš„é«˜åº¦ã€‚å› æ­¤å¯¹äºŽåŒ…å«nä¸ªèŠ‚ç‚¹çš„2-3æ ‘ï¼Œå…¶åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼› äºŒã€2-3-4æ ‘2-3-4æ ‘æ˜¯å¯¹2-3æ ‘çš„æ‰©å±•ï¼Œå…¶ä¸­å…è®¸4èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤šæœ‰4ä¸ªå„¿å­ï¼‰ã€‚å®ƒæ»¡è¶³çš„æ€§è´¨å’Œ2-3æ ‘æ˜¯ç±»ä¼¼çš„ï¼Œä¸»è¦è¿˜æ˜¯åœ¨ä»–ä»¬çš„å¤§å°å…³ç³»ä¸Šã€‚ä¸‹å›¾ä¸»è¦æ˜¯æè¿°çš„4èŠ‚ç‚¹çš„ç»“æž„ï¼Œ2èŠ‚ç‚¹å’Œ3èŠ‚ç‚¹ä»Žå·¦åˆ°å³ä¾æ¬¡ä¸ºä¸€ä¸ªå…ƒç´ ï¼ˆdata_lï¼‰å’Œä¸¤ä¸ªå…ƒç´ ï¼ˆdata_l, data_mï¼‰å·²ç»å¯¹åº”çš„å­èŠ‚ç‚¹ï¼š å¤§å°å…³ç³»å¦‚ä¸‹ï¼š 1ï¼‰ã€left_child.data_l.key &lt; lef_child.data_m.key &lt; left_child.data_r.key &lt; root.data_l.key; 2ï¼‰ã€root.data_l.key &lt; left_mid_child.data_l.key &lt; ... &lt; root.data_m.key; 3ï¼‰ã€root.data_m.key &lt; right_mid_child.data_l.key &lt; ... &lt; root.data_r.key; 4ï¼‰ã€root.data_r.key &lt; right_child.data_l.key &lt; ... &lt; right_child.data_r.key; 2-3-4æ ‘ä¹Ÿè¦æ»¡è¶³æ‰€æœ‰çš„å¤–éƒ¨èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ä¸Šï¼› å¦‚æžœä¸€é¢—é«˜åº¦ä¸ºhçš„2-3-4æ ‘ä¸­åªåŒ…å«2èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥æ ‘å…±æœ‰(2^h) - 1ä¸ªå…ƒç´ ï¼ˆå…ƒç´ ä¸ªæ•°ï¼Œä¸æ˜¯èŠ‚ç‚¹ä¸ªæ•°ï¼‰ï¼›å¦‚æžœåªåŒ…å«4èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥æ ‘å…±æœ‰(4^h) - 1ä¸ªå…ƒç´ ã€‚å› æ­¤ä¸€é¢—2-3-4æ ‘çš„å…ƒç´ ä¸ªæ•°ä¸º2^h - 1 åˆ° 4^h - 1ä¸ªå…ƒç´ ã€‚åŒæ ·æ¥è¯´åŒ…å«nä¸ªå…ƒç´ çš„2-3-4æ ‘ï¼Œå…¶é«˜åº¦èŒƒå›´log4(n+1)åˆ°log2(n+1)ä¹‹é—´ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ª2-3-4æ ‘çš„å…·ä½“ä¾‹å­ï¼š æ’å…¥æ“ä½œï¼ˆæ‹†åˆ†4èŠ‚ç‚¹ã€å‘ä¸Šç§»åŠ¨ï¼‰æ’å…¥æ“ä½œæˆ‘ä»¬å¯ä»¥å’Œ2-3æ ‘åšä¸€æ ·çš„æ“ä½œï¼Œå³å…ˆä»Žæ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹å‘ä¸‹æ‰§è¡Œï¼Œç„¶åŽä»Žå¶èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„å‘ä¸Šæ‰«æï¼Œå¹¶é€çº§è°ƒæ•´ä»¥æ»¡è¶³2-3-4æ ‘çš„æ€§è´¨ã€‚ ä½†æ˜¯å¯¹äºŽ2-3-4æ ‘å­˜åœ¨æ›´åŠ é«˜æ•ˆçš„æ–¹å¼ï¼š æˆ‘ä»¬ä»Žæ ¹èŠ‚ç‚¹å¼€å§‹æ‰«æï¼Œå½“æ‰«æåˆ°4èŠ‚ç‚¹æ—¶å°±å¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œæ‹†åˆ†æ“ä½œï¼Œä¸»è¦æ˜¯çœ‹å½“å‰4èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹æ¥è¿›è¡Œé€‚å½“çš„æ‹†åˆ†æ“ä½œã€‚ä¾æ¬¡å¾ªçŽ¯ä¸‹åŽ»ï¼Œé‚£ä¹ˆåˆ°å¶å­èŠ‚ç‚¹æ—¶å°±èƒ½ä¿è¯å¶å­èŠ‚ç‚¹ä¸º2èŠ‚ç‚¹æˆ–è€…3èŠ‚ç‚¹ã€‚ å¯¹äºŽä¸€ä¸ª4èŠ‚ç‚¹ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸‰ç§ä¸åŒçš„æƒ…å†µï¼š 1ï¼‰ã€4èŠ‚ç‚¹æ˜¯2-3-4æ ‘çš„æ ¹èŠ‚ç‚¹ï¼› æ ¹èŠ‚ç‚¹çš„æ‹†åˆ†ä¼šä½¿å¾—2-3-4æ ‘çš„é«˜åº¦å¢žåŠ 1ã€‚å¹¶ä¸”æ‹†åˆ†ä¹‹åŽå¾—åˆ°çš„ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ 2èŠ‚ç‚¹ ï¼› 2ï¼‰ã€4èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯ä¸€ä¸ª2èŠ‚ç‚¹ï¼› ä¸ŠåŠéƒ¨åˆ†ä¸­4èŠ‚ç‚¹ä½œä¸º2èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œä¸‹åŠéƒ¨åˆ†ä¸º4èŠ‚ç‚¹ä½œä¸º2èŠ‚ç‚¹çš„å³å­æ ‘ã€‚æ‹†åˆ†ä¹‹åŽå¾—åˆ°çš„ä¸¤ä¸ªèŠ‚ç‚¹åŒæ ·éƒ½æ˜¯ 2èŠ‚ç‚¹ ï¼› 3ï¼‰ã€4èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯ä¸€ä¸ª3èŠ‚ç‚¹ï¼› æ‹†åˆ†ä¹‹åŽå¾—åˆ°çš„ä¸¤ä¸ªèŠ‚ç‚¹åŒæ ·éƒ½æ˜¯ 2èŠ‚ç‚¹ ï¼› åˆ°è¿™å„¿æˆ‘ä»¬å°±èƒ½å¤§è‡´çœ‹å‡ºè§„å¾‹äº†ï¼š 4èŠ‚ç‚¹çš„data_må‘ä¸Šæï¼Œdata_lå’Œdata_rè‡ªæˆä¸€ä¸ª2èŠ‚ç‚¹ï¼› 2-3-4æ ‘æ’å…¥å®žä¾‹ä»¥ä¸‹å›¾ä¸ºåŽŸ2-3-4æ ‘æ‰§è¡Œæ’å…¥æ“ä½œï¼š 1ã€é¦–å…ˆæˆ‘ä»¬æ’å…¥å…ƒç´ 5ï¼šä»Žæ ¹èŠ‚ç‚¹å¼€å§‹æ‰«æï¼Œå‘çŽ°æ ¹èŠ‚ç‚¹ä¸º4èŠ‚ç‚¹ã€‚å› æ­¤ä½¿ç”¨ç¬¬ä¸€ç‚¹ä¸­çš„æ‹†åˆ†è¿‡ç¨‹ï¼Œå°†4èŠ‚ç‚¹çš„ä¸­data_må‘ä¸Šæï¼Œç‹¬ç«‹æˆä¸€ä¸ª2èŠ‚ç‚¹ã€‚æ­¤æ—¶ä¼šä½¿å¾—æ ‘çš„æ€»ä½“é«˜åº¦å¢žåŠ 1ã€‚ç„¶åŽä¾æ¬¡å¯»æ‰¾5æ‰€åœ¨çš„ä½ç½®ï¼Œå‘çŽ°ç›®æ ‡å¶å­èŠ‚ç‚¹ä¸ºä¸€ä¸ª3èŠ‚ç‚¹ï¼Œç¬¦åˆæ’å…¥è¦æ±‚ï¼Œç›´æŽ¥æ’å…¥å³å¯ã€‚ 2ã€æ’å…¥å…ƒç´ 14ï¼šä»Žæ ¹èŠ‚ç‚¹å¼€å§‹æ‰«æï¼Œå‘çŽ°åŒ…å«å…ƒç´ ã€5ï¼Œ12ï¼Œ15ã€‘çš„èŠ‚ç‚¹ä¸º4èŠ‚ç‚¹ï¼Œè€Œè¯¥èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹ä¸º2èŠ‚ç‚¹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢ç¬¬äºŒç‚¹â€œ4èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹æ˜¯ä¸€ä¸ª2èŠ‚ç‚¹â€çš„æ‹†åˆ†æ–¹æ³•ã€‚æ‹†åˆ†å®ŒæˆåŽç»§ç»­å¯»æ‰¾å…ƒç´ 14çš„æ’å…¥ç‚¹ï¼Œå‘çŽ°èŠ‚ç‚¹ã€15ã€‘ä¸º2èŠ‚ç‚¹ç›´æŽ¥æ’å…¥ã€‚ æ¯”å¦‚è¿™é‡Œæ’å…¥ä¸€ä¸ªå…ƒç´ 77å’Œè¿™ä¸ªä¾‹å­å¾ˆç±»ä¼¼ã€‚å‘çŽ°èŠ‚ç‚¹ã€72ï¼Œ80ï¼Œ90ã€‘ä¸º4èŠ‚ç‚¹ï¼ŒæŠŠå…ƒç´ 80å‘ä¸Šæï¼Œæž„æˆæ–°çš„èŠ‚ç‚¹ã€70ï¼Œ80ï¼Œ99ã€‘ã€‚ç„¶åŽæŠŠå…ƒç´ 77æ’å…¥åˆ°èŠ‚ç‚¹ã€72ã€‘çš„å³å­èŠ‚ç‚¹ä¸­å³å¯ã€‚ å› æ­¤2-3-4æ ‘çš„æ’å…¥æ“ä½œå¯¹äºŽ2-3æ ‘æ’å…¥æ“ä½œçš„ä¼˜åŠ¿åœ¨äºŽï¼Œåªéœ€è‡ªé¡¶å‘ä¸‹å•æ¬¡æ‰«æå°±å¯ä»¥å®Œæˆï¼›è€Œ2-3æ ‘éœ€å‘ä¸‹æ‰«æä¹‹åŽï¼Œè¿˜æœ‰å…ƒç´ å‘ä¸Šæçš„è¿‡ç¨‹ã€‚ åˆ é™¤æ“ä½œï¼ˆåˆå¹¶4èŠ‚ç‚¹ã€å‘ä¸‹ç§»åŠ¨ï¼‰æ’å…¥æ“ä½œè™½ç„¶å’Œ2-3æ ‘ç±»ä¼¼ï¼Œä½†æ˜¯éœ€è¦æœ‰æ•ˆçŽ‡ä¸Šçš„æ”¹è¿›ã€‚å¦‚æžœæ²¡æœ‰ä¼˜åŠ¿çš„è¯ï¼Œé‚£è¯¥æŸ¥æ‰¾æ ‘å­˜åœ¨ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ åˆ é™¤ä»»ä½•å…ƒç´ éƒ½å¯ä»¥åŒ–ç®€ä¸ºåˆ é™¤æŸä¸ªå¶å­èŠ‚ç‚¹ä¸­çš„å…ƒç´ ã€‚ å¦‚æžœ åˆ é™¤å…ƒç´ æ‰€åœ¨çš„å¶èŠ‚ç‚¹æ˜¯3èŠ‚ç‚¹æˆ–è€…4èŠ‚ç‚¹ ï¼Œç›´æŽ¥åˆ é™¤å³å¯ã€‚ç»“æžœåˆ†åˆ«å˜æˆ2èŠ‚ç‚¹å’Œ3èŠ‚ç‚¹ ï¼› æˆ‘ä»¬å¯ä»¥ä»Žæ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„å‘ä¸‹æ‰«æè¿‡ç¨‹ä¸­å¯¹2-3-4æ ‘è¿›è¡Œæ›´æ–°ï¼Œä»¥è¾¾åˆ°åˆ é™¤å…ƒç´ æ—¶ï¼Œå…ƒç´ æ‰€åœ¨å¶èŠ‚ç‚¹ä¸º3èŠ‚ç‚¹æˆ–è€…4èŠ‚ç‚¹ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¿å…åœ¨ç±»ä¼¼2-3æ ‘åˆ é™¤æ“ä½œï¼ˆä»Žå¶èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹å‘ä¸Šï¼‰å‡ºçŽ°çš„é‡å»ºæ­¥éª¤ã€‚ å‘ä¸‹æ‰«æ2-3-4æ ‘å¹¶è¿›è¡Œæ›´æ–°æ—¶è¦æ±‚ï¼šæ¯å½“æŸ¥æ‰¾ç§»å‘ä¸‹ä¸€å±‚èŠ‚ç‚¹æ—¶ï¼Œè¯¥èŠ‚ç‚¹å¿…é¡»æ˜¯3èŠ‚ç‚¹æˆ–è€…4èŠ‚ç‚¹ã€‚ ä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œè¿™é‡Œå‡è®¾å½“å‰èŠ‚ç‚¹ä¸ºpï¼Œè€Œå°†è¦ç§»åˆ°çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºqï¼Œä¹Ÿå°±æ˜¯è¯´qæ˜¯pçš„å­èŠ‚ç‚¹ã€‚rèŠ‚ç‚¹ä¸ºqèŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå½“qæ˜¯pçš„left_childæ—¶ï¼ŒrèŠ‚ç‚¹ä¸ºpçš„left_mid_childï¼›å¦åˆ™qæœ€è¿‘çš„å…„å¼ŸèŠ‚ç‚¹rå°±æ˜¯å…¶å·¦è¾¹çš„å…„å¼ŸèŠ‚ç‚¹ã€‚å¦‚æžœçœ‹èµ·æ¥æœ‰ç‚¹ä¸é¡ºå£ï¼Œç›´æŽ¥å¯¹åº”ä¸‹é¢å›¾å°±è¡Œäº†ã€‚ä¸‹é¢åˆ—å‡º5ç§æƒ…å†µï¼š 1ï¼‰ã€p(çˆ¶èŠ‚ç‚¹)æ˜¯å¶å­èŠ‚ç‚¹ ï¼šæ­¤æ—¶å¾…åˆ é™¤å…ƒç´ è¦ä¹ˆåœ¨èŠ‚ç‚¹pä¸­ï¼Œè¦ä¹ˆä¸å­˜åœ¨ï¼› 2ï¼‰ã€qä¸æ˜¯2èŠ‚ç‚¹ï¼šé‚£å°±æ˜¯3èŠ‚ç‚¹æˆ–è€…4èŠ‚ç‚¹ï¼Œä¸éœ€è¦æ›´æ–°ã€‚ç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼› 3ï¼‰ã€qæ˜¯2èŠ‚ç‚¹ä¸”å…¶å…„å¼ŸèŠ‚ç‚¹rä¸º2èŠ‚ç‚¹ï¼šå°†pã€qã€råˆå¹¶æˆä¸€ä¸ª4èŠ‚ç‚¹ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®žå°±æ˜¯2-3-4æ ‘æ’å…¥è¿‡ç¨‹çš„é€†è¿‡ç¨‹ï¼ˆä¹Ÿå°±æ˜¯æ’å…¥é‡Œé¢çš„ä¸‰ç§æƒ…å†µï¼‰ã€‚å…¶ä¸­pèŠ‚ç‚¹åˆ†ä¸º2èŠ‚ç‚¹ã€3èŠ‚ç‚¹ã€4èŠ‚ç‚¹ï¼› 4ï¼‰ã€qæ˜¯2èŠ‚ç‚¹ä¸”å…¶å…„å¼ŸèŠ‚ç‚¹ä¸º3èŠ‚ç‚¹ï¼š è¿™é‡Œæœ‰ä¸ªé”™è¯¯ï¼Œä¸‹åŠéƒ¨åˆ†çš„åº”è¯¥æ˜¯yä¸Šç§»åŠ¨. 5ï¼‰ã€qæ˜¯2èŠ‚ç‚¹ä¸”å…¶å…„å¼ŸèŠ‚ç‚¹ä¸º4èŠ‚ç‚¹ï¼š ç¬¬å››ç§å’Œç¬¬äº”ç§éžå¸¸ç±»ä¼¼ã€‚ 2-3-4æ ‘åˆ é™¤å®žä¾‹ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª2-3-4æ ‘åˆ é™¤å…ƒç´ çš„å®žä¾‹ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬åˆ é™¤å…ƒç´ 74ï¼š ä¸‰ã€çº¢é»‘æ ‘ä»Ž2-3-4æ ‘åˆ°çº¢é»‘æ ‘çº¢é»‘æ ‘ç›¸å¯¹äºŽ2-3-4æ ‘èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºå¯¹äºŽ2-3-4æ ‘è€Œè¨€ï¼Œå®ƒå¦‚æžœå­˜åœ¨2èŠ‚ç‚¹æˆ–è€…3èŠ‚ç‚¹æ˜¯å­˜åœ¨data_læˆ–è€…data_mæ˜¯æ²¡æœ‰ä½¿ç”¨è€Œæµªè´¹äº†ã€‚åœ¨çº¢é»‘æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å„¿å­æŒ‡é’ˆåˆ†ä¸ºï¼šçº¢è‰²å’Œé»‘è‰²ä¸¤ç§ã€‚åœ¨æœ¬æ–‡ä¸­ï¼š 1ï¼‰ã€çº¢è‰²æŒ‡é’ˆï¼šçº¢è‰²èŠ‚ç‚¹è¡¨ç¤ºä»Žçˆ¶èŠ‚ç‚¹æŒ‡å‘è¯¥èŠ‚ç‚¹çš„æŒ‡é’ˆä¸ºçº¢è‰²æŒ‡é’ˆã€‚çº¢è‰²æŒ‡é’ˆç”¨è™šçº¿è¡¨ç¤ºï¼› 2ï¼‰ã€é»‘è‰²æŒ‡é’ˆï¼šé»‘è‰²èŠ‚ç‚¹è¡¨ç¤ºä»Žçˆ¶èŠ‚ç‚¹æŒ‡å‘è¯¥èŠ‚ç‚¹çš„æŒ‡é’ˆä¸ºé»‘è‰²æŒ‡é’ˆã€‚é»‘è‰²æŒ‡é’ˆç”¨å®žçº¿è¡¨ç¤ºï¼› çº¢é»‘æ ‘æ˜¯2-3-4æ ‘çš„äºŒå‰æ ‘è¡¨ç¤ºï¼Œå› æ­¤æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹2-3-4æ ‘åˆ°çº¢é»‘æ ‘çš„è½¬å˜è¿‡ç¨‹ï¼š 2-3-4æ ‘ç§çš„2èŠ‚ç‚¹ï¼šæŠŠä¸€ä¸ª2èŠ‚ç‚¹pè¡¨ç¤ºä¸ºä¸€ä¸ªçº¢é»‘æ ‘èŠ‚ç‚¹qã€‚çº¢é»‘æ ‘è¯¥èŠ‚ç‚¹å·¦å³å­èŠ‚ç‚¹å‡ä¸ºé»‘è‰²ï¼› 123q.data = p.data_l;q-&gt;left_child = p-&gt;left_child;q-&gt;right_child = p-&gt;left_mid_child; 2-3-4æ ‘ç§çš„3èŠ‚ç‚¹ï¼šæŠŠä¸€ä¸ª3èŠ‚ç‚¹è¡¨ç¤ºä¸º2ä¸ªçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚å¹¶ä¸”å­èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼› 2-3-4æ ‘ç§çš„4èŠ‚ç‚¹ï¼šæŠŠä¸€ä¸ª4èŠ‚ç‚¹è¡¨ç¤ºä¸º3ä¸ªçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå…¶ä¸­data_mæ‰€åœ¨èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œå·¦å³å­èŠ‚ç‚¹ç”¨çº¢è‰²è¡¨ç¤ºï¼› ä¸‹é¢æ˜¯å°†ä¸Šé¢2-3-4æ ‘è½¬æ¢æˆçº¢é»‘æ ‘çš„ä¾‹å­ï¼š çº¢é»‘æ ‘æ€§è´¨æˆ‘ä»¬ä»Žä¸Šé¢ä¸€èŠ‚å¾—å‡ºçš„çº¢é»‘æ ‘ï¼Œå¯ä»¥çŸ¥é“çº¢é»‘æ ‘å…·æœ‰å¦‚ä¸‹æ€§è´¨ï¼š 1ï¼‰ã€çº¢é»‘æ ‘æ˜¯ä¸€é¢—äºŒå‰æŸ¥æ‰¾æ ‘ï¼› 2ï¼‰ã€æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²èŠ‚ç‚¹ï¼› 3ï¼‰ã€æ‰€æœ‰æ ¹èŠ‚ç‚¹åˆ°å¤–éƒ¨èŠ‚ç‚¹çš„è·¯å¾„ä¸Šé»‘è‰²æŒ‡é’ˆä¸ªæ•°ç›¸åŒï¼ˆåŒæ ·çš„é»‘è‰²èŠ‚ç‚¹ä¹Ÿç›¸åŒï¼‰ã€‚è¿™æ˜¯å› ä¸ºåœ¨2-3-4æ ‘ä¸­æ‰€æœ‰å¤–éƒ¨èŠ‚ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ï¼Œè€Œåœ¨è¯¥æ ‘ç§æŒ‡é’ˆéƒ½æ˜¯é»‘è‰²æŒ‡é’ˆï¼› 4ï¼‰ã€ä»»ä½•ä»Žæ ¹èŠ‚ç‚¹åˆ°å¤–éƒ¨èŠ‚ç‚¹çš„è·¯å¾„ä¸Šéƒ½ä¸å­˜åœ¨ä¸¤ä¸ªè¿žç»­çš„çº¢è‰²æŒ‡é’ˆï¼› ä¸‹é¢æ˜¯çº¢é»‘æ ‘å¤§è‡´çš„ç»“æž„ï¼š 12345678910typedef struct red_black_tree* red_black_ptr;typedef struct red_black_tree &#123; element data; /// å·¦å³å„¿å­ red_black_ptr left_child; red_black_ptr right_child; /// ä¸¤ä¸ªé¢œè‰²åŸŸ color left_color; color right_color;&#125;red_black; çº¢é»‘æ ‘çš„æ’å…¥çº¢é»‘æ ‘çš„æ’å…¥å¯ä»¥æŒ‰ç…§ä¸¤ç§æ–¹å¼ï¼šè‡ªé¡¶å‘ä¸‹ï¼ˆTop-To-Downï¼‰ï¼Œè‡ªåº•å‘ä¸Šï¼ˆDown-To-Topï¼‰ã€‚è‡ªé¡¶å‘ä¸‹åªéœ€ä»Žæ ¹åˆ°å¶èŠ‚ç‚¹ä¸€æ¬¡æ‰«æå³å¯ï¼›è€Œè‡ªåº•å‘ä¸Šéœ€è¦ä»Žæ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æ‰«æä¹‹åŽï¼Œè¿˜éœ€è¦ç»§ç»­ä»Žå¶èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹æ‰«æä¸€æ¬¡ã€‚ ðŸ‘»ðŸ„ðŸ‘»è‡ªé¡¶å‘ä¸‹çš„æ’å…¥é€šè¿‡è§‚å¯Ÿå½“å‰èŠ‚ç‚¹çš„ä¸¤ä¸ªé¢œè‰²åŸŸæ˜¯å¦éƒ½ä¸ºçº¢è‰²ã€‚å¦‚æžœéƒ½ä¸ºçº¢è‰²ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å¯¹åº”2-3-4æ ‘ä¸­çš„4èŠ‚ç‚¹ï¼ˆè¯¦ç»†å¯ä»¥çœ‹ä¸Šé¢2-3-4æ ‘åˆ°çº¢é»‘æ ‘çš„è½¬æ¢è¿‡ç¨‹ï¼‰ã€‚å½“å‘çŽ°4èŠ‚ç‚¹æ—¶ï¼š ç¬¬ä¸€æ­¥ã€å°†è¯¥èŠ‚ç‚¹çš„ä¸¤ä¸ªé¢œè‰²åŸŸéƒ½å˜ä¸ºé»‘è‰²ï¼ˆç”±çº¢å˜é»‘ï¼‰ï¼› ç¬¬äºŒæ­¥ã€å¦‚æžœè¯¥èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦å„¿å­ã€æˆ–è€…å³å„¿å­ï¼Œåˆ™å°†å…¶çˆ¶èŠ‚ç‚¹çš„å·¦é¢œè‰²åŸŸã€æˆ–è€…å³é¢œè‰²åŸŸå˜ä¸ºçº¢è‰²ï¼› ç¬¬ä¸‰æ­¥ã€å¦‚æžœæ­¤æ—¶æ ‘ä¸­å‡ºçŽ°ä¸¤ä¸ªè¿žç»­çš„çº¢è‰²æŒ‡é’ˆæ—¶ï¼Œåˆ™éœ€è¦ç±»ä¼¼AVLæ ‘çš„LLã€LRã€RLã€RRæ—‹è½¬æ“ä½œï¼› ç”±äºŽå‰é¢æœ‰äº†2-3-4æ ‘çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬ä»¥2-3-4æ ‘çš„2èŠ‚ç‚¹ã€3èŠ‚ç‚¹ã€4èŠ‚ç‚¹ï¼Œæ¥æ€»ç»“çº¢é»‘æ ‘æ’å…¥æ—¶æ—‹è½¬å’Œå˜è‰²çš„è§„å¾‹ï¼š æ¯æ’å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬è‡ªé¡¶å‘ä¸‹éåŽ†æ¯ä¸€ä¸ªèŠ‚ç‚¹: 1ï¼‰ã€å¦‚æžœæ˜¯2èŠ‚ç‚¹ã€æˆ–è€…3èŠ‚ç‚¹ï¼Œåˆ™ä¿æŒå®ƒä»¬æ€§è´¨ä¸å‘ç”Ÿæ”¹å˜ï¼ˆè‡³äºŽæ€Žä¹ˆåˆ¤æ–­çº¢é»‘æ ‘ä¸­å½“å‰èŠ‚ç‚¹æ˜¯2èŠ‚ç‚¹ï¼Œè¿˜æ˜¯3èŠ‚ç‚¹ã€‚è¯·çœ‹â€œä»Ž2-3-4æ ‘åˆ°çº¢é»‘æ ‘â€ä¸€èŠ‚ï¼‰ï¼› å˜è‰² 2ï¼‰ã€å¦‚æžœå½“å‰èŠ‚ç‚¹æ˜¯4èŠ‚ç‚¹æ—¶ï¼ˆçº¢é»‘æ ‘ä¸­å…¶å·¦å³æŒ‡é’ˆå¿…å®šæŒ‡å‘çº¢è‰²èŠ‚ç‚¹ï¼‰ï¼Œåˆ™å°†å…¶å·¦å³æŒ‡é’ˆå’Œå·¦å³å­èŠ‚ç‚¹å˜ä¸ºé»‘è‰²ã€‚è¿™é‡Œæ˜¯å°†å½“å‰4èŠ‚ç‚¹ä½œä¸ºçˆ¶èŠ‚ç‚¹è€Œè¨€çš„ï¼› 3ï¼‰ã€å¦‚æžœå½“å‰èŠ‚ç‚¹æ˜¯4èŠ‚ç‚¹æ—¶ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹ä½œä¸ºå…¶çˆ¶èŠ‚ç‚¹å·¦å­èŠ‚ç‚¹ã€æˆ–è€…å³å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°†å…¶çˆ¶èŠ‚ç‚¹å¯¹åº”çš„å·¦æŒ‡é’ˆæˆ–è€…å³æŒ‡é’ˆå˜ä¸ºçº¢è‰²ï¼Œå¹¶ä¸”å½“å‰èŠ‚ç‚¹ä¹Ÿå˜ä¸ºçº¢è‰²ï¼›è¿™é‡Œæ˜¯å°†è¯¥èŠ‚ç‚¹ä½œä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å­ç»“ç‚¹è€Œè¨€çš„ã€‚ æ—‹è½¬ 4ï¼‰ã€å¦‚æžœå‡ºçŽ°è¿žç»­ä¸¤ä¸ªçº¢è‰²æŒ‡é’ˆæ—¶ï¼Œå°±éœ€è¦åšå¯¹åº”çš„æ—‹è½¬æ“ä½œï¼› çº¢é»‘æ ‘æ’å…¥å®žä¾‹ä¾‹ä¸€ï¼šä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¸€æ¬¡å°†1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8 æ’å…¥åˆ°çº¢é»‘æ ‘ä¸­ï¼š è‡ªé¡¶å‘ä¸‹çš„æ’å…¥è¿‡ç¨‹ï¼Œæ˜¯åœ¨ä»Žæ ¹èŠ‚ç‚¹åˆ°éœ€è¦æ’å…¥çš„ç›®çš„èŠ‚ç‚¹å¼€å§‹è¿›è¡ŒéåŽ†ï¼Œå¹¶ä¸”åœ¨éåŽ†è¿‡ç¨‹ä¸­å¯¹çº¢é»‘æ ‘è¿›è¡Œå˜è‰²å’Œæ—‹è½¬ã€‚ è‡ªåº•å‘ä¸Šæ’å…¥è‡ªåº•å‘ä¸Šçš„æ’å…¥ï¼Œé¦–å…ˆéœ€è¦æŸ¥æ‰¾å…³é”®å­—åœ¨çº¢é»‘æ ‘çš„æ’å…¥ä½ç½®ã€‚æ˜¾ç„¶è¿™ä¸ªæ’å…¥æ“ä½œæ˜¯ä¸æˆåŠŸçš„æŸ¥æ‰¾ï¼Œä¸”åœ¨è¯¥ å‘ä¸‹æŸ¥æ‰¾è¿‡ç¨‹ä¸­ä¸éœ€è¦è¿›è¡Œæ—‹è½¬å˜æ¢ï¼Œåªéœ€è¦å°†å¾…æ’å…ƒç´ ä½œä¸ºæœ€åŽé‡åˆ°çš„èŠ‚ç‚¹çš„æŸä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶ç”¨çº¢è‰²æŒ‡é’ˆå°†å…¶ä¸Žå®ƒçˆ¶èŠ‚ç‚¹è¿žæŽ¥ ã€‚ ç”±äºŽæ¯æ¬¡ä»¥çº¢è‰²æŒ‡é’ˆæ’å…¥ï¼Œæ‰€ä»¥æ­¤æ—¶æ‰€æœ‰æ ¹èŠ‚ç‚¹åˆ°å¤–éƒ¨èŠ‚ç‚¹è·¯å¾„ä¸Šé»‘è‰²èŠ‚ç‚¹çš„æ•°é‡ç›¸åŒï¼Œä½†æœ‰å¯èƒ½å­˜åœ¨ä¸¤ä¸ªè¿žç»­çº¢è‰²æŒ‡é’ˆã€‚ å‡ºçŽ°ä¸¤ä¸ªè¿žç»­çš„çº¢è‰²æŒ‡é’ˆæ—¶å‡è®¾è¿žç»­å‡ºçŽ°çš„ä¸¤ä¸ªçº¢è‰²æŒ‡é’ˆåˆ†åˆ«ä¸º å’Œ ã€‚ è¿™è¡¨ç¤ºqä½œä¸ºpçš„å­èŠ‚ç‚¹ï¼Œrä½œä¸ºqçš„å­èŠ‚ç‚¹ï¼š p â€”&gt; q â€”&gt; rï¼›å› æ­¤pã€qã€rä¹‹é—´å­˜åœ¨å››ç§æƒ…å†µï¼š 1ï¼‰ã€LL: qä½œä¸ºpçš„å·¦å­èŠ‚ç‚¹ï¼Œrä½œä¸ºqçš„å·¦å­èŠ‚ç‚¹ï¼› 2ï¼‰ã€LR: qä½œä¸ºpçš„å·¦å­èŠ‚ç‚¹ï¼Œrä½œä¸ºqçš„å³å­èŠ‚ç‚¹ï¼› 3ï¼‰ã€RL: qä½œä¸ºpçš„å³å­èŠ‚ç‚¹ï¼Œrä½œä¸ºqçš„å·¦å­èŠ‚ç‚¹ï¼› 4ï¼‰ã€RR: qä½œä¸ºpçš„å³å­èŠ‚ç‚¹ï¼Œrä½œä¸ºqçš„å³å­èŠ‚ç‚¹ï¼› çŽ°åœ¨å‡è®¾sä½œä¸ºqçš„å…„å¼Ÿï¼ˆå¦‚æžœsä¸ä¸ºç©ºï¼Œå³å­˜åœ¨å…„å¼ŸèŠ‚ç‚¹ï¼‰ï¼Œ å˜è‰²å½“sèŠ‚ç‚¹ï¼ˆqçš„å…„å¼ŸèŠ‚ç‚¹ï¼‰ä¸ºçº¢è‰²èŠ‚ç‚¹æ—¶éœ€è¦åšå˜è‰²æ“ä½œï¼š èŠ‚ç‚¹på˜ä¸ºçº¢è‰²èŠ‚ç‚¹ï¼›èŠ‚ç‚¹qï¼Œså˜ä¸ºé»‘è‰²èŠ‚ç‚¹ï¼›èŠ‚ç‚¹rä¸å˜ã€‚è¿™æ ·åšå˜è‰²æ“ä½œå¯èƒ½ä¼šå¯¼è‡´çº¢è‰²æŒ‡é’ˆå†²çªæ²¿ç€æ ‘å‘ä¸Šä¼ æ’­ï¼Œæ‰€ä»¥é¢œè‰²è°ƒæ•´è¿‡ç¨‹éœ€è¦å¤šæ¬¡é‡å¤ã€‚ é¢œè‰²è°ƒæ•´ä¸ä¼šå½±å“ä»Žæ ¹èŠ‚ç‚¹åˆ°å¤–éƒ¨èŠ‚ç‚¹è·¯å¾„ä¸Šé»‘è‰²æŒ‡é’ˆçš„ä¸ªæ•°ï¼› æ—‹è½¬å½“å‡ºçŽ°è¿žç»­ä¸¤ä¸ªçº¢è‰²æŒ‡é’ˆï¼Œå¹¶ä¸”èŠ‚ç‚¹sä¸ºé»‘è‰²èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶éœ€è¦åšæ—‹è½¬æ“ä½œã€‚ æ—‹è½¬æ“ä½œä¸ä¼šå¼•èµ·çº¢è‰²æŒ‡é’ˆå†²çªçš„ä¼ æ’­ï¼Œå› æ­¤æœ€å¤šåªéœ€è¦æ‰§è¡Œä¸€æ¬¡æ—‹è½¬æ“ä½œï¼› çº¢é»‘æ ‘æ’å…¥å®žä¾‹ä¾‹äºŒï¼šçŽ°åœ¨ä½¿ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹å¼æŒ‰é¡ºåºæ’å…¥å…ƒç´ 10ï¼Œ9ï¼Œ8ï¼Œ7ï¼Œ6ï¼Œ5ï¼Œ4ï¼Œ3ï¼š 1ï¼‰ã€æ’å…¥èŠ‚ç‚¹é¢œè‰²ä¸ºçº¢è‰²ï¼› 2ï¼‰ã€èŠ‚ç‚¹sä¸ºçº¢è‰²æ—¶ï¼Œå¹¶ä¸”qå’Œrä¸ºä¸¤ä¸ªè¿žç»­çš„çº¢è‰²èŠ‚ç‚¹ï¼Œæ­¤æ—¶åˆ™éœ€è¦å˜è‰²ï¼› 3ï¼‰ã€å¦‚æžœèŠ‚ç‚¹sä¸ºé»‘è‰²ï¼Œæˆ–è€…ä¸ºç©ºã€‚å½“qå’Œrä¸ºä¸¤ä¸ªè¿žç»­çº¢è‰²èŠ‚ç‚¹æ—¶ï¼Œæ­¤æ—¶åªéœ€è¦æ—‹è½¬å³å¯ï¼› è‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸Šçš„æ€»ç»“1ï¼‰ã€å¯¹äºŽè‡ªé¡¶å‘ä¸‹çš„æ’å…¥æ–¹æ³•ï¼Œéœ€è¦æ‰§è¡ŒO(logN)æ¬¡æ—‹è½¬æ“ä½œï¼›è€Œè‡ªåº•å‘ä¸Šçš„æ’å…¥æ–¹æ³•åªéœ€è¦æ‰§è¡Œä¸€æ¬¡æ—‹è½¬æ“ä½œï¼› 2ï¼‰ã€ä¸¤ç§æ–¹å¼éƒ½éœ€è¦æ‰§è¡ŒO(logN)é¢œè‰²è°ƒæ•´æ“ä½œï¼› ä½¿ç”¨è‡ªåº•å‘ä¸Šçš„æ’å…¥æ–¹å¼å°±å’Œç½‘ä¸Šå¤§éƒ¨åˆ†æåˆ°çš„çº¢é»‘æ ‘æ“ä½œæ–¹å¼ä¸€æ ·ã€‚ä½†æˆ‘ä»¬è¿˜æ˜¯éœ€è¦çŸ¥é“è‡ªé¡¶å‘ä¸‹çš„æ“ä½œæ–¹å¼ã€‚ çº¢é»‘æ ‘çš„åˆ é™¤å…¶å®žè®²åˆ°è¿™é‡Œï¼Œçº¢é»‘æ ‘å·²ç»æ²¡æœ‰ä»€ä¹ˆè®²çš„å¿…è¦äº†ã€‚åªéœ€è¦å¥—ç”¨2-3-4æ ‘çš„åˆ é™¤èŠ‚ç‚¹ç­–ç•¥å³å¯ã€‚æœ€ä¸»è¦çš„æ˜¯åœ¨è‡ªé¡¶å‘ä¸‹æ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œæ˜Žç¡®å½“å‰çº¢é»‘æ ‘èŠ‚ç‚¹å¤„äºŽå¯¹åº”2-3-4æ ‘èŠ‚ç‚¹çš„ç±»åž‹ã€‚ æ‰«æè¿‡ç¨‹ï¼š 1ï¼‰ã€å°šæœªå‘½ä¸­å¾…åˆ é™¤å…ƒç´ æ—¶ï¼Œåˆ™ä»¥äºŒå‰æ ‘å¤§å°å…³ç³»ï¼ŒåŽ»å¯»æ‰¾åˆé€‚çš„å·¦å³å­æ ‘ï¼› 2ï¼‰ã€å‘½ä¸­å¾…åˆ é™¤å…ƒç´ æ—¶ï¼Œå¦‚æžœå…ƒç´ æ‰€å¤„èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ã€‚é‚£ä¹ˆç›´æŽ¥åˆ é™¤å³å¯ï¼› 3ï¼‰ã€å‘½ä¸­å¾…åˆ é™¤å…ƒç´ æ—¶ï¼Œå¦‚æžœå…ƒç´ æ‰€å¤„èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åƒ2-3æ ‘/2-3-4æ ‘çš„è§„åˆ™ç»§ç»­å‘ä¸‹å¯»æ‰¾å¶å­èŠ‚ç‚¹ã€‚å¯»æ‰¾çš„ç›®æ ‡å¯ä»¥æ˜¯å‘½ä¸­èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­æœ€å¤§å­èŠ‚ç‚¹ï¼Œæˆ–è€…å³å­æ ‘ä¸­æœ€å°å­èŠ‚ç‚¹ï¼› æ˜Žç¡®èŠ‚ç‚¹ç±»åž‹ï¼š 1ï¼‰ã€å¦‚æžœå½“å‰èŠ‚ç‚¹æ˜¯çº¢è‰²èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¸€å®šå¯¹åº”äºŽ2-3-4æ ‘ä¸­çš„3èŠ‚ç‚¹ã€æˆ–è€…4èŠ‚ç‚¹ï¼›ç”±äºŽ2-3-4æ ‘ä¸­ï¼Œ3èŠ‚ç‚¹å’Œ4èŠ‚ç‚¹æ— éœ€å˜æ¢ç›´æŽ¥å‘ä¸‹ç»§ç»­éåŽ†å³å¯ï¼› 2ï¼‰ã€å¦‚æžœå½“å‰èŠ‚ç‚¹æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå†åŽ»æŸ¥çœ‹è¯¥èŠ‚ç‚¹å·¦å³å­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨çº¢è‰²èŠ‚ç‚¹ã€‚å¦‚æžœæ²¡æœ‰çº¢è‰²èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å³å¯¹åº”2-3-4æ ‘ä¸­çš„2èŠ‚ç‚¹ã€‚æ­¤æ—¶åˆ™éœ€è¦çœ‹è¯¥èŠ‚ç‚¹ç›¸é‚»å­æ ‘çš„æƒ…å†µï¼Œè¿›è¡Œå¯¹åº”2èŠ‚ç‚¹åˆ°4èŠ‚ç‚¹çš„å˜æ¢ï¼ˆå…·ä½“å˜æ¢è¿‡ç¨‹è§2-3-4æ ‘çš„åˆ é™¤ä¸€èŠ‚ï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘å°†è¦åˆ é™¤å…ƒç´ 80ï¼š æºä»£ç ç”±äºŽéœ€è¦å†™çš„ä»£ç å¤ªå¤šäº†ï¼Œè€Œä¸”æˆ‘åˆæ¯”è¾ƒæ‡’ã€‚æ‰€ä»¥æˆ‘å°±å†™äº†ä¸€ä¸‹2-3æ ‘çš„å¢žåŠ ã€åˆ é™¤ç­‰ç›¸å…³æ“ä½œï¼Œæˆ‘å°†ä»£ç å…¨éƒ¨è´´åœ¨è¿™é‡Œï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941#include &lt;iostream&gt;#include &lt;stdio.h&gt;#include &lt;list&gt;#include &lt;stdlib.h&gt;#include &lt;cstdlib&gt;#include &lt;algorithm&gt;#include &lt;ctime&gt;#include &lt;set&gt;#include &lt;vector&gt;using namespace std;/// è¿™é‡Œå‡è®¾å¯¹äºŽelementæ¥è¯´ï¼Œå¦‚æžœè¯¥åŸŸå€¼ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä½¿å¾—elementçš„valueéƒ¨åˆ†è®¾ç½®ä¸ºINT_MAXclass element &#123;private: int value;public: element(int val) :value(val) &#123;&#125; element() &#123; value = INT_MAX; &#125; void setValue(int val) &#123;value = val;&#125; int getValue() const &#123; return value; &#125; static inline element invalid() &#123; return element(INT_MAX); &#125;&#125;;bool operator == (const element&amp; lhs,const element&amp; rhs) &#123; return lhs.getValue() == rhs.getValue();&#125;bool operator != (const element&amp; lhs,const element&amp; rhs) &#123; return !(lhs.getValue() == rhs.getValue());&#125;class two_three_tree_node &#123;public: element data_l; element data_r; two_three_tree_node* left_child; two_three_tree_node* middle_child; two_three_tree_node* right_child;public: two_three_tree_node() &#123; data_l = element::invalid(); data_r = element::invalid(); left_child = NULL; middle_child = NULL; right_child = NULL; &#125; virtual ~two_three_tree_node() &#123; data_l = element::invalid(); data_r = element::invalid(); if (left_child != nullptr) &#123; delete left_child; &#125; if (middle_child != nullptr) &#123; delete middle_child; &#125; if (right_child != nullptr) &#123; delete right_child; &#125; &#125;&#125;;class node_strategy &#123;protected: const two_three_tree_node* node; element value;public: node_strategy():node(NULL),value(element::invalid()) &#123; &#125; virtual void setValue(const element&amp; ele) = 0; virtual void setNode(const two_three_tree_node* nd) = 0; virtual two_three_tree_node* next() = 0; virtual ~node_strategy() &#123; &#125;&#125;;class left_child_strategy:public node_strategy &#123; two_three_tree_node* next() &#123; element data_left = node-&gt;data_l; if (value.getValue() &lt; data_left.getValue()) &#123; return node-&gt;left_child; &#125; return nullptr; &#125; void setValue(const element&amp; ele) &#123; value = ele; &#125; void setNode(const two_three_tree_node* nd) &#123; node = nd; &#125;&#125;;class middle_child_strategy :public node_strategy &#123; two_three_tree_node* next() &#123; element data_left = node-&gt;data_l; element data_right = node-&gt;data_r; if (value.getValue() &gt; data_left.getValue() &amp;&amp; value.getValue() &lt; data_right.getValue()) &#123; return node-&gt;middle_child; &#125; return nullptr; &#125; void setValue(const element&amp; ele) &#123; value = ele; &#125; void setNode(const two_three_tree_node* nd) &#123; node = nd; &#125;&#125;;class right_child_strategy :public node_strategy &#123; two_three_tree_node* next() &#123; element data_right = node-&gt;data_r; if (value.getValue() &gt; data_right.getValue()) &#123; return node-&gt;right_child; &#125; return nullptr; &#125; void setValue(const element&amp; ele) &#123; value = ele; &#125; void setNode(const two_three_tree_node* nd) &#123; node = nd; &#125;&#125;;///#######################################################################################################################///#######################################################################################################################/// #### æŸ¥æ‰¾///#######################################################################################################################///#######################################################################################################################class search_strategy &#123; two_three_tree_node* root;public: search_strategy(two_three_tree_node* rt) &#123; root = rt; &#125; two_three_tree_node* search(element&amp; ele) &#123; two_three_tree_node* node = root; node_strategy *left = new left_child_strategy(); node_strategy *middle = new middle_child_strategy(); node_strategy *right = new right_child_strategy(); while (node) &#123; if (node-&gt;data_l == ele) &#123; return node; &#125; if (node-&gt;data_r == ele) &#123; return node; &#125; left-&gt;setNode(node); left-&gt;setValue(ele); if (two_three_tree_node *temp = left-&gt;next()) &#123; node = temp; continue; &#125; middle-&gt;setNode(node); middle-&gt;setValue(ele); if (two_three_tree_node * temp = middle-&gt;next()) &#123; node = temp; continue; &#125; right-&gt;setNode(node); right-&gt;setValue(ele); if (two_three_tree_node * temp = right-&gt;next()) &#123; node = temp; continue; &#125; node = nullptr; &#125; delete left; delete middle; delete right; return nullptr; &#125;&#125;;///#######################################################################################################################///#######################################################################################################################/// #### æ’å…¥///#######################################################################################################################///#######################################################################################################################class insert_strategy &#123;private: /// åˆ›å»ºä¸€ä¸ªæ ˆç»“æž„ï¼Œå°†ä»Žå¶èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹è·¯å¾„ä¸Šå·¦å³çš„èŠ‚ç‚¹ä¿å­˜ä¸‹æ¥ struct find_stack &#123; struct find_stack_node &#123; two_three_tree_node* tree_node; find_stack_node* next; &#125;; void push(const two_three_tree_node* tree_node) &#123; if (!tree_node) &#123; return; &#125; find_stack_node* node = new find_stack_node(); node-&gt;tree_node = const_cast&lt;two_three_tree_node*&gt;(tree_node); node-&gt;next = top; top = node; &#125; two_three_tree_node* pop() &#123; find_stack_node* node = top; top = top-&gt;next; two_three_tree_node* tree_node = node-&gt;tree_node; node-&gt;next = nullptr; node-&gt;tree_node = nullptr; delete node; return tree_node; &#125; find_stack_node* stack_top() &#123; return top; &#125; ~find_stack() &#123; while (top) &#123; pop(); &#125; &#125; private: find_stack_node* top; &#125;;///#######################################################################################################################///#######################################################################################################################///#####å¯»æ‰¾èŠ‚ç‚¹///#######################################################################################################################///####################################################################################################################### class find_element &#123; private: two_three_tree_node* root; element value; find_stack* stack; public: find_element(const two_three_tree_node* rt, element val) &#123; root = const_cast&lt;two_three_tree_node*&gt;(rt); value = val; stack = new find_stack(); &#125; void set_value(element val) &#123; value = val; &#125; /// ä¿®æ”¹ç‰ˆæŸ¥æ‰¾ï¼šæ ¹æ®æ ¹èŠ‚ç‚¹å’ŒæŒ‡å®šå…ƒç´ ï¼šå¦‚æžœæŸ¥æ‰¾åˆ°æŒ‡å®šå…ƒç´ ï¼Œåˆ™è®¤ä¸ºæŸ¥æ‰¾æˆåŠŸï¼Œè¿”å›žnullï¼›å¦åˆ™è¿”å›žæŸ¥æ‰¾è¿‡ç¨‹ä¸­é‡åˆ°çš„å¶å­èŠ‚ç‚¹ï¼› two_three_tree_node* node() &#123; two_three_tree_node* node = root; node_strategy* left = new left_child_strategy(); node_strategy* middle = new middle_child_strategy(); node_strategy* right = new right_child_strategy(); two_three_tree_node* result = nullptr; while (node) &#123; stack-&gt;push(node); if (node-&gt;data_l == value) &#123; goto release; &#125; if (node-&gt;data_r == value) &#123; goto release; &#125; left-&gt;setNode(node); left-&gt;setValue(value); if (two_three_tree_node * temp = left-&gt;next()) &#123; node = temp; continue; &#125; middle-&gt;setNode(node); middle-&gt;setValue(value); if (two_three_tree_node * temp = middle-&gt;next()) &#123; node = temp; continue; &#125; right-&gt;setNode(node); right-&gt;setValue(value); if (two_three_tree_node * temp = right-&gt;next()) &#123; node = temp; continue; &#125; node = nullptr; &#125; if (stack-&gt;stack_top()) &#123; result = stack-&gt;stack_top()-&gt;tree_node; &#125; release: delete left; delete middle; delete right; return result; &#125; find_stack* get_stack() &#123; return stack; &#125; ~find_element() &#123; root = nullptr; delete stack; stack = nullptr; &#125; &#125;; //// æ‹¼æŽ¥ class split_element &#123; private: find_stack* stack; element ele; public: split_element(const find_stack* steck,const element&amp; val) &#123; stack = const_cast&lt;find_stack *&gt;(steck); ele = val; &#125; two_three_tree_node* split(bool (*two_node_insert_handle)(two_three_tree_node* node,const two_three_tree_node* insert_node))&#123; find_stack::find_stack_node* top = stack-&gt;stack_top(); two_three_tree_node* be_insert_node = new two_three_tree_node(); be_insert_node-&gt;data_l = ele; int breakpoint = ele.getValue(); while(be_insert_node-&gt;data_l != element::invalid() &amp;&amp; top)&#123; two_three_tree_node* current = top-&gt;tree_node; if (two_node_insert_handle(current, be_insert_node)) &#123; return nullptr; &#125; /// current å­˜æ”¾ä¸‰ä¸ªå…ƒç´ é‡Œé¢æœ€å°çš„ä¸€ä¸ª /// max å­˜æ”¾ä¸‰ä¸ªå…ƒç´ é‡Œé¢æœ€å¤§çš„ä¸€ä¸ª two_three_tree_node* max_item = new two_three_tree_node(); if (be_insert_node-&gt;data_l.getValue() &lt; current-&gt;data_l.getValue()) &#123; max_item-&gt;data_l = current-&gt;data_r; max_item-&gt;data_r = element::invalid(); max_item-&gt;left_child = current-&gt;middle_child; max_item-&gt;middle_child = current-&gt;right_child; element temp = current-&gt;data_l; current-&gt;data_l = be_insert_node-&gt;data_l; current-&gt;data_r = element::invalid(); current-&gt;left_child = be_insert_node-&gt;left_child; current-&gt;middle_child = be_insert_node-&gt;middle_child; current-&gt;right_child = nullptr; be_insert_node-&gt;data_l = temp; be_insert_node-&gt;data_r = element::invalid(); be_insert_node-&gt;left_child = current; be_insert_node-&gt;middle_child = max_item; top = top-&gt;next; continue; &#125; if (be_insert_node-&gt;data_l.getValue() &gt; current-&gt;data_r.getValue()) &#123; max_item-&gt;data_l = be_insert_node-&gt;data_l; max_item-&gt;data_r = element::invalid(); max_item-&gt;left_child = be_insert_node-&gt;left_child; max_item-&gt;middle_child = be_insert_node-&gt;middle_child; current-&gt;right_child = nullptr; element temp = current-&gt;data_r; current-&gt;data_r = element::invalid(); be_insert_node-&gt;data_l = temp; be_insert_node-&gt;left_child = current; be_insert_node-&gt;middle_child = max_item; be_insert_node-&gt;data_r = element::invalid(); top = top-&gt;next; continue; &#125; if (be_insert_node-&gt;data_l.getValue() &lt; current-&gt;data_r.getValue() &amp;&amp; be_insert_node-&gt;data_l.getValue() &gt; current-&gt;data_l.getValue()) &#123; max_item-&gt;data_l = current-&gt;data_r; max_item-&gt;left_child = be_insert_node-&gt;middle_child; max_item-&gt;middle_child = current-&gt;right_child; max_item-&gt;data_r = element::invalid(); current-&gt;middle_child = be_insert_node-&gt;left_child; current-&gt;data_r = element::invalid(); current-&gt;right_child = nullptr; be_insert_node-&gt;left_child = current; be_insert_node-&gt;middle_child = max_item; be_insert_node-&gt;right_child = nullptr; be_insert_node-&gt;data_r = element::invalid(); top = top-&gt;next; continue; &#125; &#125; return be_insert_node; &#125; &#125;; static bool two_node_insert(two_three_tree_node* node, const two_three_tree_node* insert_node) &#123; if (node-&gt;data_r != element::invalid()) &#123; return false; &#125; if (node-&gt;data_l.getValue() &lt; const_cast&lt;two_three_tree_node*&gt;(insert_node)-&gt;data_l.getValue()) &#123; node-&gt;data_r = insert_node-&gt;data_l; node-&gt;middle_child = insert_node-&gt;left_child; node-&gt;right_child = insert_node-&gt;middle_child; &#125; else &#123; element temp = node-&gt;data_l; node-&gt;data_l = insert_node-&gt;data_l; node-&gt;data_r = temp; node-&gt;right_child = node-&gt;middle_child; node-&gt;left_child = insert_node-&gt;left_child; node-&gt;middle_child = insert_node-&gt;middle_child; &#125; return true; &#125;public: two_three_tree_node* insert(two_three_tree_node* root ,const element &amp;ele) &#123; find_element* fele = new find_element(root,ele); two_three_tree_node* leaf = fele-&gt;node(); if (nullptr == leaf) &#123;/// å¾…æ’å…¥å…ƒç´ å·²å­˜åœ¨äºŽæ ‘ä¸­ delete fele; return root; &#125; split_element* se = new split_element(fele-&gt;get_stack(), ele); two_three_tree_node* root_node = se-&gt;split(two_node_insert); if (root_node == nullptr) &#123;/// 2èŠ‚ç‚¹ delete fele; return root; &#125; /// 3èŠ‚ç‚¹ delete fele; return root_node; &#125;&#125;;///#######################################################################################################################///#######################################################################################################################/// #### åˆ é™¤///#######################################################################################################################///#######################################################################################################################class delete_strategy &#123; two_three_tree_node* root; element ele;private: /// èŽ·å–å…„å¼ŸèŠ‚ç‚¹; two_three_tree_node* get_bro_node(two_three_tree_node * const node, two_three_tree_node * const parent) &#123; if (node == parent-&gt;left_child) &#123; return parent-&gt;middle_child; &#125; if (node == parent-&gt;middle_child) &#123; if (is_three_node(parent-&gt;right_child)) &#123; return parent-&gt;right_child; &#125; return parent-&gt;left_child; &#125; if (node == parent-&gt;right_child) &#123; return parent-&gt;middle_child; &#125; return nullptr; &#125;protected: static inline bool is_three_node(two_three_tree_node* node) &#123; if (nullptr == node) &#123; return false; &#125; if (node-&gt;data_l != element::invalid() &amp;&amp; node-&gt;data_r != element::invalid()) &#123; return true; &#125; return false; &#125; static bool remove_element(two_three_tree_node* node, element ele) &#123; if (node-&gt;data_r == ele) &#123; node-&gt;data_r = element::invalid(); return true; &#125; if (node-&gt;data_l == ele) &#123; node-&gt;data_l = node-&gt;data_r; node-&gt;data_r = element::invalid(); return true; &#125; return false; &#125; class delete_ttt_node &#123; public: two_three_tree_node* node; element* isptr; delete_ttt_node(const two_three_tree_node* rt, const element* is) &#123; node = const_cast&lt;two_three_tree_node*&gt;(rt); isptr = const_cast&lt;element*&gt;(is); &#125; &#125;; /// å¶èŠ‚ç‚¹è½¬ç§» class leaf_swap &#123; delete_ttt_node* ttt_node; element ele; /// è¿”å›žå€¼ä¸ºç›®æ ‡èŠ‚ç‚¹ /// leafä¸ºå¶èŠ‚ç‚¹ private: two_three_tree_node* leaf_node; two_three_tree_node* leaf_parent_node; public: leaf_swap(const two_three_tree_node* rt, element&amp; el) &#123; ttt_node = new delete_ttt_node(rt, nullptr); ele = el; leaf_node = nullptr; leaf_parent_node = nullptr; &#125; leaf_swap() &#123; ttt_node = new delete_ttt_node(nullptr, nullptr); ele = element::invalid(); leaf_node = nullptr; leaf_parent_node = nullptr; &#125; ~leaf_swap() &#123; delete ttt_node; &#125; two_three_tree_node* get_leaf_node() &#123; return leaf_node; &#125; two_three_tree_node* get_leaf_parent_node() &#123; return leaf_parent_node; &#125; delete_ttt_node* get_swap_info(two_three_tree_node** leaf) &#123; two_three_tree_node* node = ttt_node-&gt;node; delete_ttt_node* des_node = new delete_ttt_node(ttt_node-&gt;node, nullptr); node_strategy* left = new left_child_strategy(); node_strategy* middle = new middle_child_strategy(); node_strategy* right = new right_child_strategy(); /// å‘½ä¸­å¾…åˆ é™¤å…ƒç´  while (node) &#123; if (node-&gt;data_l == ele) &#123; des_node-&gt;node = node; des_node-&gt;isptr = &amp;(node-&gt;data_l); break; &#125; if (node-&gt;data_r == ele) &#123; des_node-&gt;node = node; des_node-&gt;isptr = &amp;(node-&gt;data_r); break; &#125; left-&gt;setNode(node); left-&gt;setValue(ele); if (two_three_tree_node * temp = left-&gt;next()) &#123; leaf_parent_node = node; node = temp; continue; &#125; middle-&gt;setNode(node); middle-&gt;setValue(ele); if (two_three_tree_node * temp = middle-&gt;next()) &#123; leaf_parent_node = node; node = temp; continue; &#125; right-&gt;setNode(node); right-&gt;setValue(ele); if (two_three_tree_node * temp = right-&gt;next()) &#123; leaf_parent_node = node; node = temp; continue; &#125; node = nullptr; &#125; delete left; delete middle; delete right; /// å¯»æ‰¾å¶å­èŠ‚ç‚¹ /// å·¦å­æ ‘çš„æœ€å¤§å­èŠ‚ç‚¹ï¼›æˆ–è€…å³å­æ ‘çš„æœ€å°å­èŠ‚ç‚¹ï¼› /// è¿™é‡Œæˆ‘é€‰æ‹©å·¦å­æ ‘çš„æœ€å¤§å­èŠ‚ç‚¹ï¼› if (des_node == nullptr) &#123; leaf_parent_node = nullptr; return des_node; &#125; *leaf = des_node-&gt;node; for (node = (des_node-&gt;isptr-&gt;getValue() == des_node-&gt;node-&gt;data_r.getValue()) ? des_node-&gt;node-&gt;middle_child : des_node-&gt;node-&gt;left_child; node; node = node-&gt;middle_child) &#123; /// éžå¶èŠ‚ç‚¹ leaf_parent_node = *leaf; *leaf = node; &#125; return des_node; &#125; bool swap() &#123;/// ä»…ä»…äº¤æ¢ä¸¤ä¸ªæŒ‡é’ˆçš„æ•°æ®åŸŸçš„å€¼ï¼ŒæŒ‡é’ˆåŸŸä¸åšæ”¹å˜ two_three_tree_node* leaf = nullptr; delete_ttt_node* des_node = get_swap_info(&amp;leaf); leaf_node = leaf; if (nullptr == des_node || nullptr == leaf) &#123; return false; &#125; if (des_node-&gt;node == leaf) &#123;/// å¶èŠ‚ç‚¹ï¼Œä¸åšäº¤æ¢ return true; &#125; if (leaf-&gt;data_r != element::invalid()) &#123; element r_temp = leaf-&gt;data_r; leaf-&gt;data_r = *(des_node-&gt;isptr); *(des_node-&gt;isptr) = r_temp; &#125; else &#123; element l_temp = leaf-&gt;data_l; leaf-&gt;data_l = *(des_node-&gt;isptr); *(des_node-&gt;isptr) = l_temp; &#125; delete des_node; return true; &#125; &#125;; class two_node_delete_interface &#123; protected: two_three_tree_node* leaf; two_three_tree_node* bro; two_three_tree_node* parent; two_node_delete_interface(two_three_tree_node* lf, two_three_tree_node* bo, two_three_tree_node* pt) :leaf(lf), bro(bo), parent(pt) &#123;&#125; virtual ~two_node_delete_interface()&#123;&#125; &#125;; /// æ—‹è½¬ class rotate : public two_node_delete_interface &#123;/// å…„å¼ŸèŠ‚ç‚¹ä¸º3èŠ‚ç‚¹æ—¶ï¼Œæ—‹è½¬ private: bool left_leaf_rotate() &#123; leaf-&gt;data_l = parent-&gt;data_l; leaf-&gt;data_r = element::invalid(); parent-&gt;data_l = bro-&gt;data_l; bro-&gt;data_l = bro-&gt;data_r; bro-&gt;data_r = element::invalid(); leaf-&gt;middle_child = bro-&gt;left_child; bro-&gt;left_child = bro-&gt;middle_child; bro-&gt;middle_child = bro-&gt;right_child; return true; &#125; bool right_leaf_rorate() &#123; leaf-&gt;data_l = parent-&gt;data_l; parent-&gt;data_l = bro-&gt;data_r; leaf-&gt;left_child = bro-&gt;right_child; return true; &#125; bool middle_leaf_rorate() &#123; if (bro == parent-&gt;right_child) &#123; leaf-&gt;data_l = parent-&gt;data_r; leaf-&gt;data_r = element::invalid(); parent-&gt;data_r = bro-&gt;data_l; bro-&gt;data_l = bro-&gt;data_r; bro-&gt;data_r = element::invalid(); leaf-&gt;middle_child = bro-&gt;left_child; bro-&gt;left_child = bro-&gt;middle_child; bro-&gt;middle_child = bro-&gt;right_child; return true; &#125; leaf-&gt;data_l = parent-&gt;data_l; parent-&gt;data_l = bro-&gt;data_r; leaf-&gt;left_child = bro-&gt;right_child; return true; &#125; public: rotate(two_three_tree_node* lf, two_three_tree_node* bo, two_three_tree_node* pt):two_node_delete_interface(lf, bo, pt) &#123;&#125; bool execute() &#123; if (nullptr == leaf || nullptr == parent || nullptr == bro) &#123; return false; &#125; if (leaf == parent-&gt;left_child) &#123; return left_leaf_rotate(); &#125; else if (leaf == parent-&gt;middle_child) &#123; return middle_leaf_rorate(); &#125; else &#123; return right_leaf_rorate(); &#125; &#125; &#125;; /// åˆå¹¶ class combine : public two_node_delete_interface &#123; protected: bool left_leaf_combine() &#123; if (nullptr == leaf || nullptr == parent || nullptr == bro) &#123; return false; &#125; bool parent_is_three_node = is_three_node(parent); if (false == parent_is_three_node) &#123; parent-&gt;data_r = bro-&gt;data_l; parent-&gt;left_child = leaf-&gt;left_child; parent-&gt;middle_child = bro-&gt;left_child; parent-&gt;right_child = bro-&gt;right_child; delete bro; delete leaf; bro = nullptr; leaf = nullptr; return true; &#125; bro-&gt;data_r = bro-&gt;data_l; bro-&gt;data_l = parent-&gt;data_l; parent-&gt;data_l = parent-&gt;data_r; parent-&gt;data_r = element::invalid(); parent-&gt;left_child = parent-&gt;middle_child; parent-&gt;middle_child = parent-&gt;right_child; parent-&gt;right_child = nullptr; bro-&gt;right_child = bro-&gt;middle_child; bro-&gt;middle_child = bro-&gt;left_child; bro-&gt;left_child = leaf-&gt;left_child; delete leaf; leaf = nullptr; return true; &#125; bool middle_leaf_combine() &#123; if (nullptr == leaf || nullptr == parent || nullptr == bro) &#123; return false; &#125; bool parent_is_three_node = is_three_node(parent); if (false == parent_is_three_node) &#123; parent-&gt;data_r = parent-&gt;data_l; parent-&gt;data_l = bro-&gt;data_l; parent-&gt;left_child = nullptr; parent-&gt;middle_child = nullptr; delete leaf; delete bro; leaf = nullptr; bro = nullptr; return true; &#125; bro-&gt;data_r = parent-&gt;data_l; parent-&gt;data_l = parent-&gt;data_r; parent-&gt;data_r = element::invalid(); parent-&gt;middle_child = parent-&gt;right_child; parent-&gt;right_child = nullptr; bro-&gt;middle_child = leaf-&gt;left_child; bro-&gt;right_child = leaf-&gt;middle_child; delete leaf; leaf = nullptr; return true; &#125; bool right_leaf_combine() &#123; if (nullptr == leaf || nullptr == parent || nullptr == bro) &#123; return false; &#125; bro-&gt;data_r = parent-&gt;data_r; parent-&gt;data_r = element::invalid(); parent-&gt;right_child = nullptr; bro-&gt;middle_child = leaf-&gt;left_child; bro-&gt;right_child = leaf-&gt;middle_child; delete leaf; leaf = nullptr; return true; &#125; public: combine(two_three_tree_node* lf, two_three_tree_node* bo, two_three_tree_node* pt) :two_node_delete_interface(lf, bo, pt) &#123;&#125; bool execute() &#123; if (nullptr == leaf || nullptr == parent || nullptr == bro) &#123; return false; &#125; if (leaf == parent-&gt;left_child) &#123; return left_leaf_combine(); &#125; else if(leaf == parent-&gt;middle_child) &#123; return middle_leaf_combine(); &#125; else &#123; return right_leaf_combine(); &#125; &#125; &#125;; class two_node_delete : public two_node_delete_interface &#123; public: two_node_delete(two_three_tree_node* lf, two_three_tree_node* bo, two_three_tree_node* pt):two_node_delete_interface(lf, bo, pt) &#123;&#125; bool execute() &#123; if (nullptr == leaf || nullptr == parent || nullptr == bro) &#123; return false; &#125; /// æŸ¥çœ‹å…„å¼ŸèŠ‚ç‚¹ä¸º2èŠ‚ç‚¹ï¼Œè¿˜æ˜¯3èŠ‚ç‚¹ï¼› bool three_node = is_three_node(bro); if (true == three_node) /// å…„å¼ŸèŠ‚ç‚¹ä¸º3èŠ‚ç‚¹ï¼Œæ—‹è½¬ &#123; rotate* rtt = new rotate(leaf, bro, parent); return rtt-&gt;execute(); &#125; else /// å…„å¼ŸèŠ‚ç‚¹ä¸º2èŠ‚ç‚¹ï¼Œåˆå¹¶ &#123; combine* cbn = new combine(leaf, bro, parent); return cbn-&gt;execute(); &#125; return false; &#125; &#125;;public: delete_strategy(const two_three_tree_node*rt, element&amp; el) &#123; root = const_cast&lt;two_three_tree_node*&gt;(rt); ele = el; &#125; bool execute() &#123; leaf_swap* ls = new leaf_swap(root, ele); bool result = ls-&gt;swap(); if (false == result) &#123; return false; &#125; two_three_tree_node* leaf = ls-&gt;get_leaf_node(); if (nullptr == leaf) &#123; return false; &#125; two_three_tree_node* leaf_parent = ls-&gt;get_leaf_parent_node(); /// 3èŠ‚ç‚¹ if (is_three_node(leaf)) &#123; remove_element(leaf, ele); return true; &#125; /// 2èŠ‚ç‚¹ two_three_tree_node* bro = get_bro_node(leaf, leaf_parent); if (nullptr == bro) &#123; return false; &#125; two_node_delete* tnd = new two_node_delete(leaf, bro, leaf_parent); tnd-&gt;execute(); return result; &#125;&#125;;int main()&#123; vector&lt;int&gt; randoms; /// æ’å…¥ //cout &lt;&lt; &quot;input root node value: &quot; &lt;&lt; endl; int rootvalue = 50; //cin &gt;&gt; rootvalue; two_three_tree_node* root = new two_three_tree_node(); root-&gt;data_l = element(rootvalue); /* è‡ªè¡Œå®šåˆ¶è¾“å…¥æ•°å­— int inputvalue = 0; while (cout &lt;&lt; &quot;input node (-1 exit): &quot;, cin &gt;&gt; inputvalue,inputvalue != -1) &#123; randoms.push_back(inputvalue); &#125; */ randoms = &#123; 33 ,85 ,68 ,80 ,62 ,15 ,97 ,10 &#125;; insert_strategy* ins = new insert_strategy(); for (vector&lt;int&gt;::iterator itr = randoms.begin(); itr != randoms.end(); itr++) &#123; root = ins-&gt;insert(root, element(*itr)); &#125; /// æŸ¥æ‰¾ search_strategy* search = new search_strategy(root); element search_item(12); bool search_result = search-&gt;search(search_item); /// åˆ é™¤ int val; while (cout&lt;&lt;&quot;input delete item: &quot;&lt;&lt;endl,cin&gt;&gt;val,val!=-1) &#123; element be_deleted(val); delete_strategy* delete_s = new delete_strategy(root, be_deleted); delete_s-&gt;execute(); &#125; return 0;&#125; æ–‡ç« å†…å®¹è¾ƒé•¿ï¼Œåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šç®—æ˜¯æŠŠ2-3æ ‘ã€2-3-4æ ‘ã€ä»¥åŠçº¢é»‘æ ‘éƒ½æ‹äº†ä¸€éã€‚å¦‚æžœå­˜åœ¨é”™è¯¯ï¼Œéº»çƒ¦å¸®å¿™æŒ‡å‡ºï¼ˆå¯ä»¥å¾®åšè”ç³»æˆ‘ï¼‰ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è¯­æ³•åˆ†æžâ€”â€”æ–‡æ³•çš„åŸºç¡€æ¦‚å¿µ]]></title>
      <url>%2F2019%2F10%2F28%2FSyntaxParser_context_free_grammar%2F</url>
      <content type="text"><![CDATA[å‰è¨€åœ¨è¯­æ³•åˆ†æžä¸€ç« ä¸­ä¼šå‡ºçŽ°å¾ˆå¤šçš„ä¸“ä¸šæœ¯è¯­ï¼Œæˆ‘ä¼šåœ¨è¿™ä¸€èŠ‚å°†è¯­æ³•åˆ†æžæ¶‰åŠåˆ°çš„æœ¯è¯­éƒ½å¤§è‡´æ‹ä¸€éã€‚è¿™äº›ä¸“ä¸šæœ¯è¯­æ˜¯å­¦ä¹ è¯­æ³•åˆ†æžçš„å¿…å¤‡æŠ€èƒ½ï¼ŒåŠ¡å¿…è®°ä½å¹¶ç†è§£ï¼Œä¸‹é¢æˆ‘ä»¬è¿›å…¥æ­£é¢˜ã€‚ ä»‹ç»è¯­æ³•åˆ†æžé€šå¸¸ç”¨äºŽç¼–è¯‘å™¨ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ç¼–è¯‘å™¨æ¨¡åž‹ä¸­ï¼Œè¯­æ³•åˆ†æžå™¨ä»Žè¯æ³•åˆ†æžå™¨èŽ·å¾—ä¸€ä¸ªè¯æ³•å•å…ƒç»„æˆçš„ä¸²ï¼Œå¹¶éªŒè¯è¿™ä¸ªä¸²å¯ä»¥ç”±æºè¯­è¨€çš„æ–‡æ³•ï¼ˆæ¯”å¦‚ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼Œåœ¨åŽé¢ä¼šè¯¦ç»†è§£é‡Šï¼‰ç”Ÿæˆã€‚ å¤„ç†æ–‡æ³•çš„è¯­æ³•åˆ†æžå™¨å¤§ä½“ä¸Šå¯ä»¥åˆ†åˆ†ä¸ºä¸‰ç§ç±»åž‹ï¼šé€šç”¨çš„ã€è‡ªé¡¶å‘ä¸‹çš„å’Œè‡ªåº•å‘ä¸Šçš„ã€‚è€Œç¼–è¯‘å™¨ä¸­å¸¸ç”¨çš„çš„æ–¹æ³•åˆ†ä¸ºè‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸Šã€‚é¡¾åæ€ä¹‰ï¼š 1ï¼‰ã€è‡ªé¡¶å‘ä¸‹çš„æ–¹æ³•ä»Žè¯­æ³•åˆ†æžæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹å‘åº•éƒ¨æž„é€ è¯­æ³•åˆ†æžæ ‘ï¼› 2ï¼‰ã€è‡ªåº•å‘ä¸Šåˆ™ä»Žå¶å­ç»“ç‚¹å¼€å§‹ï¼Œé€æ¸å‘æ ¹èŠ‚ç‚¹æ–¹å‘æž„é€ ã€‚ è¿™ä¸¤ç§åˆ†æžæ–¹æ³•ä¸­ï¼Œè¯­æ³•åˆ†æžå™¨çš„è¾“å…¥æ€»æ˜¯æŒ‰ç…§ä»Žå·¦å‘å³çš„æ–¹å¼è¢«æ‰«æï¼Œæ¯æ¬¡æ‰«æä¸€ä¸ªç¬¦å·ã€‚ æœ€é«˜æ•ˆçš„è‡ªé¡¶å‘ä¸‹æ–¹æ³•å’Œè‡ªåº•å‘ä¸Šæ–¹æ³•åªèƒ½å¤„ç†æŸäº›æ–‡æ³•å­ç±»ï¼Œä½†å…¶ä¸­çš„å­ç±»ï¼Œç‰¹åˆ«æ˜¯ LLã€LR å®ƒä»¬çš„è¡¨è¾¾èƒ½åŠ›å·²ç»è¶³ä»¥æè¿°çŽ°ä»£ç¨‹åºè®¾è®¡è¯­è¨€å¤§éƒ¨åˆ†çš„è¯­æ³•æž„é€ äº†ã€‚ æ‰‹å·¥å®žçŽ°çš„è¯­æ³•åˆ†æžé€šå¸¸ä½¿ç”¨LLæ–‡æ³•ã€‚å¤„ç†è¾ƒå¤§çš„LRæ–‡æ³•ç±»çš„è¯­æ³•åˆ†æžå™¨é€šå¸¸æ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æž„é€ å¾—åˆ°ã€‚ è¿™é‡Œçš„ç¬¬ä¸€ä¸ªLè¡¨ç¤ºä»Žå·¦å‘å³æ‰«æï¼Œç¬¬äºŒä¸ªçš„Lå’ŒRåˆ†åˆ«è¡¨ç¤ºæœ€å·¦æŽ¨å¯¼å’Œæœ€å³æŽ¨å¯¼ã€‚æœ‰å…³äºŽæŽ¨å¯¼çš„æ¦‚å¿µä¸‹é¢å°±ä¼šå±•å¼€æ¥è¯´ï¼Œåœ¨å‰é¢æˆ‘ä»¬æåˆ°äº†æ–‡æ³•ï¼Œæ‰€ä»¥çŽ°åœ¨è¿˜æ˜¯å…ˆçœ‹çœ‹ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ã€‚ ä¸€ã€ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆContext-Free-Grammarï¼‰æ–‡æ³•è‡ªç„¶åœ°æè¿°äº†å¤§å¤šæ•°ç¨‹åºè®¾è®¡è¯­è¨€æž„é€ çš„å±‚æ¬¡åŒ–è¯­æ³•ç»“æž„ï¼Œæ¯”å¦‚if-elseä¹‹ç±»çš„ã€‚ä¸€ä¸ªä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ç”±å››ä¸ªå…ƒç´ ç»„æˆï¼š ç»ˆç»“ç¬¦å·ï¼šä¹Ÿç§°ä¸ºè¯æ³•å•å…ƒã€‚è¯æ³•å•å…ƒç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šåå­—å’Œå±žæ€§å€¼ã€‚æˆ‘ä»¬å¸¸å¸¸æŠŠè¿™äº›è¯æ³•å•å…ƒåå­—ç§°ä¸ºç»ˆç»“ç¬¦å·ã€‚å› æ­¤æˆ‘ä»¬åœ¨è¯­æ³•åˆ†æžä¸­ï¼Œé€šå¸¸å°†è¯æ³•å•å…ƒå’Œç»ˆç»“ç¬¦å½“åšä¸€ä¸ªæ„æ€ï¼› éžç»ˆç»“ç¬¦å·ï¼šä¹Ÿç§°ä¸ºè¯­æ³•å˜é‡ï¼Œæ¯ä¸ªéžç»ˆç»“ç¬¦å·è¡¨ç¤ºä¸€ä¸ªç»ˆç»“ç¬¦å·ä¸²çš„é›†åˆï¼› äº§ç”Ÿå¼ï¼šåŒ…æ‹¬äº§ç”Ÿå¼å¤´ã€ä¸€ä¸ªç®­å¤´ï¼Œå’Œä¸€ä¸ªäº§ç”Ÿå¼ä½“ï¼› å¼€å§‹ç¬¦å·ï¼šæŒ‡å®šä¸€ä¸ªéžç»ˆç»“ç¬¦å·ä¸ºå¼€å§‹ç¬¦å·ï¼› å¦‚ä¸‹å›¾çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼š å¯¹æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›çº¦å®šæ¥è¡¨ç¤ºä¸åŒçš„ç¬¦å·ï¼Œä»¥ä¾¿åŽç»­è¡Œæ–‡æ–¹ä¾¿ï¼š ç»ˆç»“ç¬¦å·ï¼š â… ï¼‰ã€å°å†™å­—æ¯ï¼Œaã€bã€cç­‰ç­‰ï¼› â…¡ï¼‰ã€è¿ç®—ç¬¦å·ï¼Œæ¯”å¦‚ + ã€‚ - ï¼Œ * ï¼Œ/ ä¹‹ç±»çš„ï¼› â…¢ï¼‰ã€æ ‡ç‚¹ç¬¦å·ï¼Œæ¯”å¦‚æ‹¬å·ã€é€—å·ç­‰ç­‰ï¼› â…£ï¼‰ã€æ•°å­—ï¼› â…¤ï¼‰ã€é»‘ä½“å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ idï¼Œifã€‚æ¯ä¸ªè¿™æ ·çš„å­—ç¬¦ä¸²è¡¨ç¤ºä¸€ä¸ªç»ˆç»“ç¬¦å·ï¼› éžç»ˆç»“ç¬¦ï¼š â… ï¼‰ã€å¤§å†™å­—æ¯ï¼ŒAã€Bã€Cç­‰ç­‰ï¼› â…¡ï¼‰ã€å°å†™ï¼Œæ–œä½“çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ expr ï¼Œ stamt ç­‰ç­‰ï¼› äº§ç”Ÿå¼ä½“ï¼š ä½¿ç”¨å°å†™çš„å¸Œè…Šå­—æ¯ï¼Œæ¯”å¦‚Î±ã€Î²ã€Î³è¡¨ç¤ºæ–‡æ³•ç¬¦å·ä¸²ã€‚æ¯”å¦‚ A -&gt; Î±ï¼Œå…¶ä¸­Aä¸ºäº§ç”Ÿå¼å¤´éƒ¨ï¼ŒÎ±ä¸ºäº§ç”Ÿå¼ä½“ã€‚ å¯é€‰ä½“ï¼š å…·æœ‰ç›¸åŒå¤´éƒ¨çš„äº§ç”Ÿå¼ A -&gt; Î±1ï¼ŒA -&gt; Î±2ï¼Œâ€¦ ,A -&gt; Î±kï¼Œå¯ä»¥ç®€å†™ä¸º A -&gt; Î±1 | Î±2 | â€¦ | Î±kã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠÎ±1ï¼ŒÎ±2ï¼ŒÎ±kç§°ä½œAçš„å¯é€‰ä½“ã€‚è¿™ä¸ªå¯é€‰ä½“æ¦‚å¿µä¸å¤ªé‡è¦ï¼Œåªéœ€è¦è®°ä½ç›¸åŒäº§ç”Ÿå¼å¤´éƒ¨çš„ç®€å†™å½¢å¼å³å¯ã€‚ å› æ­¤ï¼Œè¿ç”¨å‰é¢çš„çº¦å®šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™é‡Œä¸€å…±æœ‰ä¸‰ä¸ªäº§ç”Ÿå¼ï¼›å…¶ä¸­Eã€Tã€Fä¸ºéžç»ˆç»“ç¬¦ï¼›+ã€*ã€(ã€)ã€idä¸ºç»ˆç»“ç¬¦ï¼›å…¶ä¸­éžç»ˆç»“ç¬¦Eä¸ºå¼€å§‹ç¬¦å·ã€‚ 1ã€æŽ¨å¯¼â€”â€”æœ€å·¦æŽ¨å¯¼ã€æœ€å³æŽ¨å¯¼ä»Žå¼€å§‹ç¬¦å·å‡ºå‘ï¼Œæ¯ä¸ªé‡å†™æ­¥éª¤æŠŠä¸€ä¸ªéžç»ˆç»“ç¬¦æ›¿æ¢ä¸ºå®ƒçš„æŸä¸ªäº§ç”Ÿå¼çš„ä½“ã€‚æ¯”å¦‚ä¸‹é¢å…³äºŽéžç»ˆç»“ç¬¦Eçš„æ–‡æ³•ï¼š äº§ç”Ÿå¼ E --&gt; -E è¡¨æ˜Žï¼Œè®²ä¸€ä¸ªEæ›¿æ¢ä¸º -E çš„è¿‡ç¨‹å†™ä½œï¼š è¯»ä½œ â€œEæŽ¨å¯¼å‡º-Eâ€ ã€‚åŒæ ·çš„æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå¯¹å•ä¸ªEä¸æ–­åœ°åº”ç”¨å„ä¸ªäº§ç”Ÿå¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ›¿æ¢åºåˆ—ï¼Œæ¯”å¦‚ï¼š å¥åž‹ï¼šæ˜¯æŒ‡æŽ¨å¯¼è¿‡ç¨‹ä¸­å‡ºçŽ°çš„å„ç§è¡¨è¾¾å¼ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«ç»ˆç»“ç¬¦å·ï¼Œä¹Ÿå¯ä»¥åŒ…å«éžç»ˆç»“ç¬¦å·ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯ç©ºä¸²ï¼› å¥å­ï¼šæ˜¯ä¸åŒ…å«éžç»ˆç»“ç¬¦çš„å¥åž‹ï¼› ä¸€ä¸ªç»ˆç»“ç¬¦å·ä¸²å­˜åœ¨äºŽæ–‡æ³•Gçš„çš„è¯­è¨€L(G)ä¸­ï¼Œå½“ä¸”ä»…å½“è¯¥ç¬¦å·ä¸²æ˜¯æ–‡æ³•Gçš„ä¸€ä¸ªå¥å­ã€‚å¯ä»¥ç”±æ–‡æ³•ç”Ÿæˆçš„è¯­è¨€ï¼Œç§°ä¸ºä¸Šä¸‹æ–‡æ— å…³è¯­è¨€ã€‚ å¦‚æžœä¸¤ä¸ªæ–‡æ³•ç”Ÿæˆç›¸åŒè¯­è¨€ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ–‡æ³•æ˜¯ç­‰ä»·çš„ã€‚ æ¯”å¦‚ä¸² -(id+id) æ˜¯æ–‡æ³• çš„ä¸€ä¸ªå¥å­ï¼Œè¿™æ˜¯å› ä¸ºå­˜åœ¨æŽ¨å¯¼è¿‡ç¨‹ï¼š ä¸²Eã€-Eã€â€¦ ã€-(id+id) éƒ½æ˜¯è¿™ä¸ªæ–‡æ³•çš„å¥åž‹ã€‚åœ¨ä¸Šè¯‰çš„æŽ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªæŽ¨å¯¼æ­¥éª¤ä¸Šéƒ½éœ€è¦åšä¸¤ä¸ªé€‰æ‹©ï¼Œæˆ‘ä»¬è¦é€‰æ‹©æ›¿æ¢æŽ‰å“ªä¸ªéžç»ˆç»“ç¬¦å·ã€‚ä¸‹é¢æ˜¯å¦å¤–ä¸€ç§æŽ¨å¯¼ï¼š è¿™ä¸€ä¸ªæŽ¨å¯¼å’Œä¸Šä¸€ä¸ªæŽ¨å¯¼ç¨æœ‰ä¸åŒï¼Œæˆ‘ä»¬æŽ¨å¯¼çš„ç¬¬å››æ­¥ï¼Œé€‰æ‹©æ›¿æ¢æŽ‰çš„æ˜¯å³è¾¹çš„éžç»ˆç»“ç¬¦ã€‚åŸºäºŽæ­¤æˆ‘ä»¬çš„æŽ¨å¯¼æœ‰ä¸¤ç§æŽ¨å¯¼å½¢å¼ï¼š æœ€å·¦æŽ¨å¯¼ï¼šæ€»æ˜¯é€‰æ‹©æ¯ä¸ªå¥åž‹æœ€å·¦è¾¹çš„éžç»ˆç»“ç¬¦å·è¿›è¡Œæ›¿æ¢ã€‚å¦‚æžœÎ± =&gt; Î² æ˜¯ä¸€ä¸ªæŽ¨å¯¼æ­¥éª¤ï¼Œä¸”è¢«æ›¿æ¢çš„æ˜¯Î±ä¸­çš„æœ€å·¦éžç»ˆç»“ç¬¦å·ã€‚æˆ‘ä»¬ç”¨ Î± =&gt;lm Î² ï¼ˆè¿™é‡Œlmåº”è¯¥æ˜¯åœ¨æŽ¨å¯¼ç¬¦å·=&gt;çš„ä¸‹æ–¹ï¼Œç”±äºŽä¸å¤ªå¥½ä¹¦å†™ï¼Œå› æ­¤è¿™é‡Œç”¨æ”¾åœ¨ç¬¦å·å³è¾¹çš„å½¢å¼ï¼‰ï¼› æœ€å³æŽ¨å¯¼ï¼šæ€»æ˜¯é€‰æ‹©æ¯ä¸ªå¥åž‹æœ€å³è¾¹çš„éžç»ˆç»“ç¬¦å·è¿›è¡Œæ›¿æ¢ã€‚æ­¤æ—¶æˆ‘ä»¬å†™ä½œ Î± =&gt;rm Î²ï¼ˆåŒä¸Šï¼‰ï¼› ä½¿ç”¨æœ€å·¦æŽ¨å¯¼å¾—åˆ°çš„å¥åž‹ç§°ä¸ºæœ€å·¦å¥åž‹ã€‚æœ€å³æŽ¨å¯¼ä¹Ÿè¢«ç§°ä¸º è§„èŒƒæŽ¨å¯¼ã€‚ 2ã€è¯­æ³•åˆ†æžæ ‘å’ŒæŽ¨å¯¼è¯­æ³•åˆ†æžæ ‘æ˜¯æŽ¨å¯¼çš„å›¾å½¢è¡¨ç¤ºï¼Œå®ƒè¿‡æ»¤æŽ‰äº†æŽ¨å¯¼è¿‡ç¨‹ä¸­å¯¹éžç»ˆç»“ç¬¦å·åº”ç”¨äº§ç”Ÿå¼çš„é¡ºåºã€‚è¯­æ³•åˆ†æžæ ‘çš„æ¯ä¸ªå†…éƒ¨ç»“ç‚¹è¡¨ç¤ºä¸€ä¸ªäº§ç”Ÿå¼çš„åº”ç”¨ã€‚è¯¥å†…éƒ¨ç»“ç‚¹çš„æ ‡å·æ˜¯äº§ç”Ÿå¼å¤´ä¸­çš„éžç»ˆç»“ç¬¦å·ã€‚ è¿™é‡Œå¯ä»¥å†å¯¹è¯­æ³•åˆ†æžæ ‘å’Œè¯æ³•åˆ†æžæ ‘è¿›è¡Œä¸€æ¬¡å¯¹æ¯”ã€‚ä¸Šä¸€ç« è¯æ³•åˆ†æžä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æž„é€ DFAæ—¶æåŠæŠ½è±¡è¯­æ³•æ ‘ä¸­æ¯ä¸ªå†…éƒ¨ç»“ç‚¹ä¸ºæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œè¯¥å†…éƒ¨ç»“ç‚¹å­æ ‘çš„å·¦å³å­èŠ‚ç‚¹åˆ†åˆ«è¡¨ç¤ºè¯¥è¿ç®—ç¬¦çš„è¿ç®—åˆ†é‡ã€‚ æ¯”å¦‚ -(id+id) çš„è¯­æ³•åˆ†æžæ ‘ä¸ºï¼š è¯¥è¯­æ³•åˆ†æžæ ‘å¯¹åº”çš„æŽ¨å¯¼è¿‡ç¨‹æ˜¯ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæŽ¨å¯¼ï¼š ä¸€é¢—è¯­æ³•åˆ†æžæ ‘çš„å¶å­ç»“ç‚¹æ—¢å¯ä»¥æ˜¯éžç»ˆç»“ç¬¦å·ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»ˆç»“ç¬¦å·ã€‚ä»Žå·¦åˆ°å³æŽ’åˆ—è¿™äº›ç¬¦å·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¥åž‹ï¼Œå®ƒæˆä¸ºè¿™é¢—æ ‘çš„ ç»“æžœã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä»Žå·¦åˆ°å³è¯»å–æ¯ä¸€ä¸ªå¶å­ç»“ç‚¹å¹¶æŽ’åˆ—èµ·æ¥ï¼Œå¾—åˆ°çš„ç»“æžœæ˜¯ï¼š- ( id + id ) ã€‚ äºŒä¹‰æ€§æ–‡æ³• ï¼Œå¦‚æžœä¸€ä¸ªæ–‡æ³•å¯ä»¥ä¸ºæŸä¸ªå¥å­ç”Ÿæˆå¤šé¢—è¯­æ³•åˆ†æžæ ‘ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯äºŒä¹‰æ€§çš„ã€‚æ¢å¥è¯è¯´ï¼ŒäºŒä¹‰æ€§æ–‡æ³•å°±æ˜¯å¯¹åŒä¸€ä¸ªå¥å­æœ‰å¤šä¸ªæœ€å·¦æŽ¨å¯¼æˆ–è€…æœ€å³æŽ¨å¯¼çš„æ–‡æ³•ã€‚ åˆ°è¿™å„¿ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚ ä¾‹ä¸€å¯¹äºŽæ–‡æ³• S \rightarrow\ a\ S\ b\ S\ |\ b\ S\ a\ S\ |\ Îµï¼Œæœ‰ä¸€ä¸²aabbabã€‚å°è¯•å†™å‡ºæœ€å·¦æŽ¨å¯¼å’Œæœ€å³æŽ¨å¯¼å‡ºè¯¥çš„è¯­æ³•åˆ†æžæ ‘ã€‚ æœ€å·¦æŽ¨å¯¼è¯­æ³•åˆ†æžæ ‘ï¼š æœ€å³æŽ¨å¯¼è¯­æ³•åˆ†æžæ ‘ï¼š ä»Žè¯­æ³•åˆ†æžçš„ç»“æž„ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºæ¥è¯¥æ–‡æ³•æ˜¯äºŒä¹‰æ€§æ–‡æ³•ã€‚ 3ã€ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•å’Œæ­£åˆ™è¡¨è¾¾å¼æ–‡æ³•æ˜¯æ¯”æ­£åˆ™è¡¨è¾¾å¼è¡¨è¾¾èƒ½åŠ›æ›´å¼ºçš„è¡¨ç¤ºæ–¹æ³•ã€‚å³æ¯ä¸ªå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æè¿°çš„æž„é€ éƒ½å¯ä»¥ä½¿ç”¨æ–‡æ³•æ¥æè¿°ï¼Œä½†åä¹‹åˆ™ä¸æˆç«‹ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æž„é€ å‡ºå¯¹åº”çš„æ–‡æ³•ï¼Œä¸‹é¢åˆ™æ˜¯ä»Žæ­£åˆ™è¡¨è¾¾å¼æž„é€ å¯¹åº”æ–‡æ³•çš„å¤§è‡´æ­¥éª¤ã€‚å¦‚ä¸‹ï¼š 1ï¼‰ã€å¯¹äºŽNFAçš„æ¯ä¸ªçŠ¶æ€iï¼Œåˆ›å»ºä¸€ä¸ªéžç»ˆç»“ç¬¦Aiï¼› 2ï¼‰ã€å¦‚æžœçŠ¶æ€iæœ‰ä¸€ä¸ªåœ¨è¾“å…¥aä¸Šåˆ°è¾¾çŠ¶æ€jçš„è½¬æ¢ï¼Œåˆ™åŠ å…¥äº§ç”Ÿå¼ A_{i} \rightarrow a A_{j} å¦‚æžœçŠ¶æ€iåœ¨è¾“å…¥ Îµ ä¸Šåˆ°è¾¾çŠ¶æ€jï¼Œåˆ™åŠ å…¥äº§ç”Ÿå¼ A_{i} \rightarrow A_{j}ï¼› 3ï¼‰ã€å¦‚æžœiæ˜¯ä¸€ä¸ªæŽ¥å—çŠ¶æ€ï¼Œåˆ™åŠ å…¥äº§ç”Ÿå¼ A_{i} \rightarrow Îµï¼› 4ï¼‰ã€å¦‚æžœiæ˜¯è‡ªåŠ¨æœºçš„å¼€å§‹çŠ¶æ€ï¼Œä»¤ Aiä¸ºæ‰€å¾—æ–‡æ³•çš„å¼€å§‹ç¬¦å·ï¼› æ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼ $(a|b)^{*}abb$ ï¼Œå®ƒå¯¹åº”çš„DFAä¸ºï¼š ä»Žä¸Šé¢æ­¥éª¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€å…±æœ‰4ä¸ªçŠ¶æ€ï¼Œå› æ­¤å¯¹äºŽå¯¹åº”æ–‡æ³•åˆ™æœ‰4ä¸ªéžç»ˆç»“ç¬¦ï¼Œåˆ†åˆ«ä¸º A_{0},A_{1},A_{2},A_{3} ã€‚æ ¹æ®ä¸Šå›¾çš„è½¬æ¢æˆ‘ä»¬å¾—åˆ°æ–‡æ³•ä¸ºï¼š äºŒã€è®¾è®¡æ–‡æ³•å¦‚æžœå‰é¢çœ‹åˆ°çš„ï¼Œä»»ä½•èƒ½å¤Ÿä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æè¿°çš„ä¸œè¥¿éƒ½å¯ä»¥ä½¿ç”¨æ–‡æ³•æ¥æè¿°ã€‚å› æ­¤åœ¨è¿™å„¿æ¥åˆ—ä¸¾4ç‚¹å…³äºŽæ­£åˆ™è¡¨è¾¾å¼å’Œæ–‡æ³•çš„å¼‚åŒï¼š 1ï¼‰ã€å°†ä¸€ä¸ªè¯­è¨€çš„è¯­æ³•ç»“æž„åˆ†ä¸ºè¯æ³•å’Œéžè¯æ³•ä¸¤éƒ¨åˆ†å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†ç¼–è¯‘å™¨å‰ç«¯æ¨¡å—åŒ–ï¼Œå°†å‰ç«¯åˆ†è§£ä¸ºå¤§å°åˆé€‚çš„ç»„ä»¶ï¼› 2ï¼‰ã€ä¸€ä¸ªè¯­è¨€çš„è¯æ³•è§„åˆ™é€šå¸¸å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨åƒæ–‡æ³•è¿™æ ·åŠŸèƒ½å¼ºå¤§çš„è¡¨ç¤ºæ–¹æ³•æ¥æè¿°è¿™äº›è§„åˆ™ï¼› 3ï¼‰ã€å’Œæ–‡æ³•ç›¸æ¯”ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸æ›´åŠ ç®€æ´ï¼Œå¹¶ä¸”æ›´å®¹æ˜“ç†è§£ï¼› 4ï¼‰ã€æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼è‡ªåŠ¨æž„é€ å¾—åˆ°çš„è¯æ³•åˆ†æžå™¨æ•ˆçŽ‡è¦é«˜äºŽæ–‡æ³•å¾—åˆ°çš„åˆ†æžå™¨ï¼› æ ¹æ®ä¸Šè¯‰4ç‚¹æ¥è¯´æ˜Žï¼Œæ—¢ç„¶æ­£åˆ™è¡¨è¾¾å¼éƒ½å¯ä»¥ä½¿ç”¨æ–‡æ³•æ¥æè¿°ï¼Œè€Œåœ¨è¯æ³•åˆ†æžä¸­æˆ‘ä»¬ä¾ç„¶é€‰æ‹©äº†æ­£åˆ™è¡¨è¾¾å¼æ¥æè¿°è¯æ³•å•å…ƒï¼› æ­£åˆ™è¡¨è¾¾å¼æ›´é€‚åˆæè¿°æ ‡è¯†ç¬¦ã€å¸¸é‡ã€å…³é”®å­—ã€ç©ºç™½è¿™æ ·çš„è¯­è¨€æž„é€ çš„ç»“æž„ï¼›æ–‡æ³•æ›´é€‚åˆæè¿°åµŒå¥—ç»“æž„ï¼Œæ¯”å¦‚if-elseä¹‹ç±»çš„ï¼› 1ã€å·¦é€’å½’å·¦é€’å½’æ˜¯æŒ‡ äº§ç”Ÿå¼ä½“çš„æœ€å·¦è¾¹ç¬¦å·å’Œäº§ç”Ÿå¼å¤´éƒ¨çš„éžç»ˆç»“ç¬¦å·ç›¸åŒ ã€‚å¯¹äºŽäº§ç”Ÿå¼ äº§ç”Ÿå¼çš„å¤´éƒ¨æ˜¯Eï¼ŒåŒæ—¶Eä¹Ÿæ˜¯äº§ç”Ÿå¼ä½“çš„æœ€å·¦è¾¹çš„éžç»ˆç»“ç¬¦å·ï¼Œå› æ­¤è¯¥æŽ¨å¯¼å°†ä¼šè¢«å°†è¢«é€’å½’è°ƒç”¨ã€‚ åŒæ ·çš„ï¼Œå³é€’å½’ä¹Ÿå°±æ˜¯æŒ‡çš„äº§ç”Ÿå¼å¤´éƒ¨çš„éžç»ˆç»“ç¬¦å·å’Œäº§ç”Ÿå¼ä½“æœ€å³è¾¹çš„ç»ˆç»“ç¬¦ç›¸åŒçš„æƒ…å†µã€‚ è¯¥æ–‡æ³•æ— æ³•ç”¨äºŽè‡ªé¡¶å‘ä¸‹çš„è¯­æ³•åˆ†æžä¸­ï¼Œè¿™æ˜¯å› ä¸ºè‡ªé¡¶å‘ä¸‹çš„è¯­æ³•åˆ†æžæ˜¯åŸºäºŽLLæ–‡æ³•çš„ã€‚è€Œå¯¹äºŽLLæ–‡æ³•æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªLæŒ‡çš„æ˜¯ä»Žå·¦åˆ°å³æ‰«æè¯­æ³•åˆ†æžæ ‘çš„ä¸€å±‚çš„æ¯ä¸ªç»“ç‚¹ï¼Œé‡åˆ°éžç»ˆç»“ç¬¦åˆ™åº”ç”¨å¯¹åº”éžç»ˆç»“ç¬¦çš„äº§ç”Ÿå¼ã€‚ç¬¬äºŒä¸ªLæŒ‡çš„æ˜¯æœ€å·¦æŽ¨å¯¼ã€‚å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†æœ€å·¦æŽ¨å¯¼ï¼Œå³æ¯ä¸€æ¬¡æ›¿æ¢æŽ‰äº§ç”Ÿå¼æœ€å·¦è¾¹çš„éžç»ˆç»“ç¬¦ï¼Œå› æ­¤è¿™ä¹Ÿå°±å’Œå·¦é€’å½’çš„å®šä¹‰å»åˆäº†ã€‚å…³äºŽæ›´è¯¦ç»†çš„è‡ªé¡¶å‘ä¸‹çš„è¯­æ³•åˆ†æžå°†åœ¨åŽé¢è¿›è¡Œè¯¦ç»†è®²è§£ã€‚ æ—¢ç„¶å­˜åœ¨å·¦é€’å½’ï¼Œé‚£ä¹ˆæ¶ˆé™¤å·¦é€’å½’è‚¯å®šæ˜¯æœ‰å¿…è¦çš„ã€‚ æ¶ˆé™¤ç«‹å³å·¦é€’å½’ï¼šæ¯”å¦‚å­˜åœ¨ç«‹å³å·¦é€’å½’çš„äº§ç”Ÿå¼ï¼š å…¶ä¸­ $\beta _{i}$ éƒ½ä¸ä»¥Aå¼€å¤´ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æŠ€æœ¯æ¥æ¶ˆé™¤ç«‹å³å·¦é€’å½’ï¼š éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šç¬¬äºŒä¸ªäº§ç”Ÿå¼åˆ°ç©ºä¸²çš„äº§ç”Ÿå¼ ã€‚éžç»ˆç»“ç¬¦å·Aç”Ÿæˆçš„ä¸²å’Œæ›¿æ¢ä¹‹å‰ç”Ÿæˆçš„ä¸²ä¸€æ ·ï¼Œä½†ä¸å†æ˜¯å·¦é€’å½’çš„ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†æ‰€æœ‰$A$å’Œ$A_{1}$äº§ç”Ÿå¼ç›¸å…³è”çš„å·¦é€’å½’ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯¹æ–‡æ³• åº”ç”¨æ¶ˆé™¤ç«‹å³å·¦é€’å½’çš„æŠ€æœ¯ä¸Šé¢æ–‡æ³•çš„å·¦é€’å½’ï¼Œå¾—åˆ°çš„ç»“æžœä¸ºï¼š æ¶ˆé™¤ä¸€èˆ¬å·¦é€’å½’ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–‡æ³•éƒ½æ˜¯ç«‹å³å·¦é€’å½’çš„ï¼Œæœ‰å¯èƒ½æ˜¯ç»è¿‡å¤šæ¬¡æŽ¨å¯¼ä¹‹åŽæ‰å‘çŽ°é€’å½’çš„æƒ…å½¢ã€‚æ¯”å¦‚ä¸‹é¢çš„æ–‡æ³•å°±ä¸æ˜¯ç«‹å³å·¦é€’å½’ï¼š å¯¹äºŽæŽ¨å¯¼ å¯ä»¥çœ‹å‡ºéžç»ˆç»“ç¬¦å·Sæ˜¯å·¦é€’å½’çš„ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ç«‹å³å·¦é€’å½’ã€‚é‚£ä¹ˆå¯¹äºŽè¿™ç§æƒ…å†µçš„å·¦é€’å½’å¦‚ä½•æ¶ˆé™¤å‘¢ï¼Ÿ 1ï¼‰ã€é¦–å…ˆå°†æ–‡æ³•çš„æ‰€æœ‰éžç»ˆç»“ç¬¦ï¼Œä»Žå¼€å§‹ç¬¦å·æŒ‰å‡ºçŽ°é¡ºåºï¼Œä¾æ¬¡å¯¹å®ƒä»¬è¿›è¡Œç¼–å·ä¸ºA1, A2, A3, â€¦,Anï¼› 2ï¼‰ã€ä»ŽA1å¼€å§‹ä¾æ¬¡è¯»å–æ¯ä¸€ä¸ªéžç»ˆç»“ç¬¦åˆ°Anï¼Œæˆ‘ä»¬ç§°ä½œAiï¼› åŒæ—¶åˆä»ŽA1å¼€å§‹è¯»å–éžç»ˆç»“ç¬¦å·åˆ°Ai-1ï¼Œæˆ‘ä»¬ç§°ä½œAj ã€‚å¦‚æžœå­˜åœ¨å½¢å¦‚A_{i} \rightarrow A_{j}\gamma é‚£æˆ‘ä»¬å°±å°†å…¶æ›¿æ¢ä¸ºäº§ç”Ÿå¼ç»„ï¼š A_{i} \rightarrow \sigma _{1} \gamma\ |\ \sigma _{2} \gamma\ |\ ...\ |\ \sigma _{k} \gamma \\ A_{j} \rightarrow \sigma _{1} \ |\ \sigma _{2} \ |\ ...\ |\ \sigma _{k} \\è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°½æœ€å¤§çš„å¯èƒ½æž„é€ ç«‹å³å·¦é€’å½’äº†ã€‚ 3ï¼‰ã€å¦‚æžœæ­¤æ—¶å­˜åœ¨ç«‹å³å·¦é€’å½’ï¼Œåˆ™ä½¿ç”¨ä¸Šé¢æåˆ°çš„æ¶ˆé™¤ç«‹å³å·¦é€’å½’çš„æ–¹å¼æ¥æ¶ˆé™¤ï¼› ä¸‹é¢æˆ‘ç”¨C++å†™äº†ä¸€ä¸ªç®€å•åœ°æ¶ˆé™¤å·¦é€’å½’çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120#include &lt;string&gt;#include &lt;vector&gt;#include &lt;iostream&gt;using namespace std;struct GrammerProduction &#123; string header; vector&lt;string&gt; bodies ; GrammerProduction() &#123;&#125; //GrammerProduction(const GrammerProduction&amp; lhs) &#123;&#125; //GrammerProduction&amp; operator=(const GrammerProduction&amp; lhs) &#123;&#125; GrammerProduction(string hdr)&#123; header = hdr; &#125; bool isEmpty() &#123; return bodies.empty(); &#125; void add_body(string bdy) &#123; bodies.push_back(bdy); &#125; private: string recursive_nonterminal; /// å‘ç”Ÿç«‹å³å·¦é€’å½’æ—¶ï¼Œéœ€è¦å¼•å…¥çš„éžç»ˆç»“ç¬¦ public: void set_recursive_nonterminal(string nt) &#123; recursive_nonterminal = nt; &#125; void replace_body(GrammerProduction* prd) &#123; if (prd==nullptr) &#123; return; &#125; vector&lt;string&gt; new_bodies; for (vector&lt;string&gt;::iterator itr_body = bodies.begin(); itr_body != bodies.end(); itr_body++) &#123; /// éåŽ†å½“å‰æ‰€æœ‰çš„äº§ç”Ÿå¼ if (itr_body-&gt;empty()) &#123; continue; &#125; string char_body(1,(*itr_body)[0]); string prd_header = prd-&gt;header; if (char_body != prd_header) &#123; new_bodies.push_back(*itr_body); continue; &#125; /// å¦‚æžœå½“å‰äº§ç”Ÿå¼æœ€å·¦è¾¹æ˜¯éžç»ˆç»“ç¬¦ï¼Œå¹¶ä¸”è¯¥éžç»ˆç»“ç¬¦å’ŒAjç›¸ç­‰ã€‚å³Ai -&gt; Aj Î³ for (vector&lt;string&gt;::iterator pitr_body = prd-&gt;bodies.begin(); pitr_body != prd-&gt;bodies.end(); ++pitr_body) &#123; string tmp_body = *itr_body; tmp_body = tmp_body.replace(0,1,*pitr_body); new_bodies.push_back(tmp_body); &#125; &#125; bodies = new_bodies; &#125; GrammerProduction* remove_immediately_left_recursive() &#123; vector&lt;string&gt; new_bodies; GrammerProduction* new_production = new GrammerProduction(recursive_nonterminal); if (!new_production) &#123; return nullptr; &#125; for (vector&lt;string&gt;::iterator itr_body = bodies.begin(); itr_body != bodies.end(); ++itr_body) &#123; /// éåŽ†å½“å‰æ‰€æœ‰çš„äº§ç”Ÿå¼ string tmp_body = *itr_body; string first_char_body(1,(*itr_body)[0]); if (first_char_body == header) &#123; /// ç«‹å³å·¦é€’å½’ tmp_body = tmp_body.erase(0,1); tmp_body = tmp_body+recursive_nonterminal; new_production-&gt;add_body(tmp_body); &#125;else&#123; tmp_body = tmp_body+recursive_nonterminal; new_bodies.push_back(tmp_body); &#125; &#125; if (new_production-&gt;isEmpty()) &#123; return nullptr; &#125; new_production-&gt;add_body(&quot;#&quot;); bodies = new_bodies; return new_production; &#125;&#125;;struct Grammer &#123; vector&lt;GrammerProduction*&gt; productions; Grammer() = default; void printProductions()&#123; cout&lt;&lt;&quot;-------------------------------------&quot;&lt;&lt;endl; for (vector&lt;GrammerProduction*&gt;::iterator itr = productions.begin(); itr != productions.end(); ++itr) &#123; /// å¤–å±‚å¾ªçŽ¯ä»Žç¬¬ä¸€ä¸ªå¼€å§‹ç¬¦å·å¼€å§‹ å§‘ä¸”å«ä½œAi GrammerProduction* p = *itr; /// èŽ·å–Aiæ‰€æœ‰çš„äº§ç”Ÿå¼ä½“ cout&lt;&lt;p-&gt;header&lt;&lt;endl; for (vector&lt;string&gt;::iterator body_itr = p-&gt;bodies.begin(); body_itr != p-&gt;bodies.end(); ++body_itr) &#123; cout&lt;&lt;&quot; &quot;&lt;&lt;*body_itr&lt;&lt;endl; &#125; cout&lt;&lt;&quot;-------------------------------------&quot;&lt;&lt;endl; &#125; &#125; void add_prodction(GrammerProduction* pro) &#123; if (pro==nullptr) return; this-&gt;productions.push_back(pro); &#125; void remove_left_recursive() &#123; vector&lt;GrammerProduction*&gt; new_productions; for (vector&lt;GrammerProduction*&gt;::iterator itr = productions.begin(); itr != productions.end(); ++itr) &#123; /// å¤–å±‚å¾ªçŽ¯ä»Žç¬¬ä¸€ä¸ªå¼€å§‹ç¬¦å·å¼€å§‹ å§‘ä¸”å«ä½œAi GrammerProduction* p = *itr; /// èŽ·å–Aiæ‰€æœ‰çš„äº§ç”Ÿå¼ä½“ for (vector&lt;GrammerProduction*&gt;::iterator itr_j = productions.begin(); itr_j != itr; ++itr_j) &#123; /// å†…å±‚å¾ªçŽ¯èŽ·å–å½“å‰éžç»ˆç»“ç¬¦ä¹‹å‰çš„å…¶ä»–éžç»ˆç»“ç¬¦ï¼Œå§‘ä¸”å«ä½œAj GrammerProduction* jp = *itr_j; /// èŽ·å–Ajæ‰€æœ‰çš„äº§ç”Ÿå¼ä½“ p-&gt;replace_body(jp); &#125; GrammerProduction *ptr = p-&gt;remove_immediately_left_recursive(); /// æ¶ˆé™¤å¯èƒ½å­˜åœ¨çš„ç«‹å³å·¦é€’å½’ if (ptr==nullptr) continue; new_productions.push_back(ptr); &#125; if (new_productions.size() &lt;= 0) &#123; return; &#125; productions.insert(productions.end(),new_productions.begin(),new_productions.end()); &#125;&#125;; æ¯”å¦‚æˆ‘ä»¬æœ‰å¸¦å·¦é€’å½’çš„äº§ç”Ÿå¼é›†åˆï¼š S \rightarrow Aa\ |\ b\\ A \rightarrow Ac\ |\ Sd\ |\ ÏµçŽ°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šè¯‰çš„C++ä»£ç æ¥å¸®æˆ‘ä»¬æ¶ˆé™¤å·¦é€’å½’ï¼š 123456789101112131415161718192021222324int main() &#123; GrammerProduction *s_productions = new GrammerProduction(&quot;S&quot;); /// S -&gt; Aa | b s_productions-&gt;set_recursive_nonterminal(&quot;T&quot;); s_productions-&gt;add_body(&quot;Aa&quot;); s_productions-&gt;add_body(&quot;b&quot;); GrammerProduction *a_productions = new GrammerProduction(&quot;A&quot;); /// A -&gt; Ac | Sd | Îµ a_productions-&gt;set_recursive_nonterminal(&quot;B&quot;); a_productions-&gt;add_body(&quot;Ac&quot;); a_productions-&gt;add_body(&quot;Sd&quot;); a_productions-&gt;add_body(&quot;#&quot;); Grammer grammer; grammer.add_prodction(s_productions); grammer.add_prodction(a_productions); cout&lt;&lt;&quot;å¸¦æœ‰å·¦é€’å½’çš„äº§ç”Ÿå¼ï¼š&quot;&lt;&lt;endl; grammer.printProductions(); grammer.remove_left_recursive(); cout&lt;&lt;&quot;æ¶ˆé™¤å·¦é€’å½’ä¹‹åŽçš„äº§ç”Ÿå¼ï¼š&quot;&lt;&lt;endl; grammer.printProductions(); cout&lt;&lt;&quot;Done&quot;&lt;&lt;endl; return 0;&#125; æœ€åŽçš„è¾“å‡ºç»“æžœå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627å¸¦æœ‰å·¦é€’å½’çš„äº§ç”Ÿå¼ï¼š-------------------------------------S Aa b-------------------------------------A Ac Sd #-------------------------------------æ¶ˆé™¤å·¦é€’å½’ä¹‹åŽçš„äº§ç”Ÿå¼ï¼š-------------------------------------S Aa b-------------------------------------A bdB #B-------------------------------------B cB adB #-------------------------------------Done è§£é‡Šä¸€ä¸‹ï¼Œè¿™é‡Œçš„éžç»ˆç»“ç¬¦å·Bæ˜¯Açš„äº§ç”Ÿå¼å‡ºçŽ°å·¦é€’å½’ä¹‹åŽï¼Œå¼•å…¥çš„éžç»ˆç»“ç¬¦ã€‚ 2ã€æå–å·¦å…¬å› å­æå–å·¦å…¬å› å­å¯ä»¥é€‚ç”¨äºŽé¢„æµ‹åˆ†æžæŠ€æœ¯æˆ–è‡ªé¡¶å‘ä¸‹åˆ†æžæŠ€æœ¯çš„æ–‡æ³•ã€‚å½“æˆ‘ä»¬ä¸æ¸…æ¥šåº”è¯¥åœ¨ä¸¤ä¸ªäº§ç”Ÿä¸­å¦‚ä½•é€‰æ‹©çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å†™äº§ç”Ÿå¼æ¥æŽ¨åŽè¿™ä¸ªå†³å®šï¼Œå½“æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ—¶å†åšå‡ºæ­£ç¡®åœ°å†³å®šã€‚ æ¯”å¦‚æœ‰äº§ç”Ÿå¼ A \rightarrow \alpha \beta_{1}\ |\ \alpha \beta_{2}ï¼Œæ˜¯Açš„ä¸¤ä¸ªäº§ç”Ÿå¼ï¼Œå¹¶ä¸”äº§ç”Ÿå¼ä½“å¼€å¤´éƒ½æ˜¯ä»Ž Î± æŽ¨å¯¼å¾—åˆ°çš„ä¸€ä¸ªéžç©ºä¸²ã€‚é‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬å°±ä¸æ¸…æ¥šæ˜¯äº§ç”Ÿå¼ A \rightarrow \alpha \beta_{1} è¿˜æ˜¯ä»¥äº§ç”Ÿå¼ A \rightarrow \alpha \beta_{2} è¿›è¡Œå±•å¼€ã€‚ ç„¶åŽæˆ‘ä»¬å¯ä»¥å°†Aå±•å¼€ä¸º \alpha A^{'}ï¼Œä»Žè€Œå»¶è¿Ÿè¦åšå‡ºå†³å®šçš„æ—¶åˆ»ï¼ŒåŽŸæ¥çš„äº§ç”Ÿå¼å°±å˜ä¸ºäº†ï¼š A \rightarrow \alpha A^{'}\\ A^{'} \rightarrow \beta_{1}\ |\ \beta_{2}æ€»ç»“ä¸€ä¸‹ä¸Šé¢æåˆ°çš„å†…å®¹ï¼šå¯¹äºŽæ¯ä¸ªéžç»ˆç»“ç¬¦å·Aï¼Œæ‰¾å‡ºä»–çš„ä¸¤ä¸ªæˆ–å¤šä¸ªé€‰é¡¹ä¹‹é—´çš„æœ€é•¿å…¬å…±å‰ç¼€ Î±ã€‚å¦‚æžœ Î± ä¸ä¸ºç©ºï¼Œå³å­˜åœ¨ä¸€ä¸ªéžå¹³å‡¡çš„å…¬å…±å‰ç¼€ï¼Œé‚£ä¹ˆå°†æ‰€æœ‰Açš„äº§ç”Ÿå¼ A \rightarrow \alpha\beta_{1}\ |\ \alpha\beta_{2}\ |\ ...\ |\ \alpha\beta_{n}\ |\ \gammaæ›¿æ¢ä¸º A \rightarrow \alpha A^{'}\ |\ \gamma\\ A^{'} \rightarrow \beta_{1}\ |\ \beta_{2}\ |\ ...\ |\ \beta_{n}å…¶ä¸­ Î³ è¡¨ç¤ºæ‰€æœ‰ä¸ä»¥ Î± å¼€å¤´çš„äº§ç”Ÿå¼ï¼› A^{'} æ˜¯ä¸€ä¸ªæ–°çš„éžç»ˆç»“ç¬¦å·ã€‚ä¸æ–­åœ°åº”ç”¨è¿™ä¸ªè½¬æ¢ï¼Œç›´åˆ°æ¯ä¸ªéžç»ˆç»“ç¬¦å·çš„ä»»æ„ä¸¤ä¸ªäº§ç”Ÿå¼ä½“éƒ½æ²¡æœ‰å…¬å…±å‰ç¼€ä¸ºæ­¢ã€‚ 3ã€éžä¸Šä¸‹æ–‡æ— å…³è¯­è¨€çš„æž„é€ åœ¨å¸¸è§çš„ç¨‹åºè®¾è®¡è¯­è¨€ä¸­ï¼Œå­˜åœ¨å°‘é‡æ— æ³•æ–‡æ³•æè¿°çš„è¯­æ³•æž„é€ ã€‚åœ¨Cæˆ–è€…Javaçš„æ–‡æ³•ä¸åŒºåˆ†ç”±ä¸åŒå­—ç¬¦ä¸²ç»„æˆçš„æ ‡è¯†ç¬¦ã€‚æ‰€æœ‰çš„æ ‡è¯†ç¬¦åœ¨æ–‡æ³•ä¸­éƒ½è¢«è¡¨ç¤ºä¸ºåƒ id è¿™æ ·çš„è¯æ³•å•å…ƒã€‚åœ¨è¿™äº›è¯­è¨€çš„ç¼–è¯‘å™¨ä¸­ï¼Œæ ‡è¯†ç¬¦æ˜¯å¦å…ˆå£°æ˜ŽåŽä½¿ç”¨æ˜¯åœ¨è¯­ä¹‰åˆ†æžé˜¶æ®µæ£€æŸ¥çš„ ã€‚ ä¸‰ã€æ€»ç»“åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œä»‹ç»äº†ä¸€å¤§å †çš„æ¦‚å¿µã€‚æ¯”å¦‚ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•é‡Œé¢çš„äº§ç”Ÿå¼ã€ç»ˆç»“ç¬¦ã€éžç»ˆç»“ç¬¦ï¼Œè¿˜æœ‰å¼€å§‹ç¬¦å·ç­‰ç­‰ï¼›ç„¶åŽæˆ‘ä»¬æŽ¥è§¦åˆ°äº†æŽ¨å¯¼çš„æ¦‚å¿µï¼ŒæŽ¨å¯¼åˆåˆ†ä¸ºæœ€å·¦æŽ¨å¯¼å’Œæœ€å³æŽ¨å¯¼ã€‚æˆ‘ä»¬æ ¹æ®è¿™ä¸¤ç§æŽ¨å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥æž„é€ å‡ºå¯¹åº”è¯­æ³•åˆ†æžæ ‘ï¼›è¯­æ³•åˆ†æžæ ‘çš„æ‰€æœ‰å¶å­ç»“ç‚¹ä»Žå·¦åˆ°å³æ‹¼èµ·æ¥ä¹‹åŽï¼Œå¾—åˆ°çš„å°±æ˜¯å¯¹åº”äº§ç”Ÿå¼æ–‡æ³•çš„å¥å­ã€‚è€Œä¸­é—´è¿‡ç¨‹ä¸­å‡ºçŽ°çš„åˆ™æˆä¸ºå¥åž‹ï¼› è€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿäº†è§£åˆ°å¦‚ä½•é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥æž„é€ å¯¹åº”çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ã€‚å¤§è‡´çš„è¿‡ç¨‹æ˜¯æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¯æ³•åˆ†æžä¸€ç« çš„çŸ¥è¯†æ¥æž„é€ ä¸€ä¸ªNFAï¼ˆæ ¹æ®è¿žæŽ¥ã€å¹¶ã€é—­åŒ…è¿ç®—å¯¹åº”çš„çŠ¶æ€è½¬æ¢å›¾ï¼‰ã€‚æˆ‘ä»¬æ ¹æ®NFAçš„çŠ¶æ€æ•°å¯¹åº”éžç»ˆç»“ç¬¦å·ï¼Œå…·ä½“è½¬æ¢è§„åˆ™éƒ½å·²ç»è¯¦ç»†åˆ—åœ¨äº†ä¸Šé¢ï¼› åœ¨æž„é€ æ–‡æ³•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°å·¦é€’å½’çš„æƒ…å†µã€‚å› æ­¤æˆ‘ä»¬éœ€è¦çŸ¥é“å¦‚ä½•åŽ»æ¶ˆé™¤ç«‹å³å·¦é€’å½’ï¼Œå’Œå·¦é€’å½’ã€‚è¯¦ç»†çš„æ¶ˆé™¤æ–¹æ³•åœ¨ä¸Šé¢ç”¨C++è¯­æ³•å·²åˆ—å‡ºï¼›æœ€åŽæˆ‘ä»¬è¿˜äº†è§£äº†æå–å·¦å…¬å› å­çš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬ä¸æ¸…æ¥šåº”è¯¥å¦‚ä½•é€‰æ‹©äº§ç”Ÿå¼ï¼ŒæŽ¨è¿Ÿè¿™ä¸ªæ—¶æœºï¼Œå¾…æˆ‘ä»¬æœ‰è¶³å¤Ÿä¿¡æ¯åšå‡ºæ­£ç¡®é€‰æ‹©ä¹‹å‰ã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä¼šåŽ»çœ‹çœ‹è‡ªé¡¶å‘ä¸‹çš„è¯­æ³•åˆ†æžæŠ€æœ¯ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è¯æ³•åˆ†æžâ€”â€”æ­£åˆ™è¡¨è¾¾å¼ç›´æŽ¥è½¬æ¢ä¸ºDFA]]></title>
      <url>%2F2019%2F10%2F28%2Fcompiler_regular2dfa%2F</url>
      <content type="text"><![CDATA[åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è‡³å°‘å­¦ä¼šäº†å°†æ­£åˆ™è¡¨è¾¾å¼æž„é€ æˆå¯¹åº”çš„NFAå’ŒDFAã€‚ä½†æ˜¯ç”¨ä¸Šç¯‡æ–‡ç« ä¸­ä»Žæ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºå¯¹åº”DFAçš„æ–¹å¼æ•ˆçŽ‡ä½Žä¸‹ï¼Œå³æˆ‘ä»¬è¦å…ˆå°†æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºNFAï¼Œç„¶åŽä½¿ç”¨å­é›†æž„é€ æ³•å°†NFAè½¬æ¢ä¸ºå¯¹åº”DFAã€‚ åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆå­¦ä¹ å¦‚ä½•å°†æ­£åˆ™è¡¨è¾¾å¼ç›´æŽ¥è½¬æ¢ä¸ºDFAï¼Œå¹¶æœ€å°åŒ–DFAçš„çŠ¶æ€æ•°ç›®ã€‚ç„¶åŽçœ‹çœ‹DFAæ¨¡æ‹Ÿä¸­æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡é—®é¢˜ã€‚ åœ¨æ­£å¼è¿›å…¥æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºDFAä¹‹å‰æˆ‘ä»¬éœ€è¦ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œæ²¡æœ‰è¿™äº›åŸºæœ¬æ¦‚å¿µå¯èƒ½ä¸å¤ªå¥½ç†è§£åŽé¢æåˆ°çš„å†…å®¹ã€‚ ä¸€ã€éœ€è¦çš„åŸºæœ¬æ¦‚å¿µé‡è¦çŠ¶æ€NFAçš„é‡è¦çŠ¶æ€ç›´æŽ¥å¯¹åº”äºŽæ­£åˆ™è¡¨è¾¾å¼ä¸­å­˜æ”¾å­—æ¯è¡¨ä¸­ç¬¦å·çš„ä½ç½®ï¼Œè€Œ é‡è¦çŠ¶æ€æ˜¯æŒ‡NFAçš„æŸä¸€çŠ¶æ€æœ‰ä¸€ä¸ªæ ‡å·ä¸ºéžç©ºçš„ç¦»å¼€è½¬æ¢ ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å°†æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºå¯¹åº”NFAæ—¶å¼•å…¥äº†æ–°çŠ¶æ€ï¼Œå®ƒä»¬çš„ç¦»å¼€è½¬æ¢éƒ½æ˜¯ç©ºè½¬æ¢ï¼Œå› æ­¤å®ƒä»¬å¹¶ä¸æ˜¯é‡è¦çŠ¶æ€ã€‚ æ¯ä¸ªé‡è¦çŠ¶æ€å¯¹åº”äºŽæ­£åˆ™è¡¨è¾¾å¼ä¸­æŸä¸ªè¿ç®—åˆ†é‡ ã€‚ å› æ­¤æˆ‘ä»¬åœ¨æ¯”è¾ƒä¸¤ä¸ªNFAçŠ¶æ€é›†åˆæ—¶ï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦ä¸€è‡´çš„ä¾æ®å¦‚ä¸‹ï¼š1ï¼‰ã€å…·æœ‰ç›¸åŒçš„é‡è¦çŠ¶æ€ï¼›2ï¼‰ã€è¦ä¹ˆéƒ½åŒ…å«æŽ¥å—çŠ¶æ€ï¼Œè¦ä¹ˆéƒ½ä¸åŒ…å«æŽ¥å—çŠ¶æ€ï¼› æŠ½è±¡è¯­æ³•æ ‘æ³¨æ„è¿™é‡Œçš„æŠ½è±¡è¯­æ³•æ ‘å’Œä¸Šä¸€èŠ‚æåˆ°çš„è¯­æ³•åˆ†æžæ ‘æœ‰ä¸€ç‚¹ä¸åŒï¼Œå…³äºŽè¯­æ³•åˆ†æžæ ‘å¯ä»¥å›žåŽ»çœ‹ä¸Šä¸€ç¯‡æåˆ°çš„è¯­æ³•åˆ†æžæ ‘å®šä¹‰ã€‚ä½†æŠ½è±¡è¯­æ³•æ ‘æ˜¯å¿…é¡»è¦å®Œå…¨ç†è§£çš„ã€‚ æŠ½è±¡è¯­æ³•æ ‘ä¸­ï¼Œæ¯ä¸ªå†…éƒ¨ç»“ç‚¹ä»£è¡¨ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦ç»“ç‚¹çš„å­ç»“ç‚¹ä»£è¡¨è¿™ä¸ªè¿ç®—ç¬¦çš„è¿ç®—åˆ†é‡ !!! åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­ï¼Œå†…éƒ¨ç»“ç‚¹ä»£è¡¨çš„æ˜¯ç¨‹åºçš„æž„é€ ï¼›è€Œåœ¨è¯­æ³•åˆ†æžæ ‘ä¸­ï¼Œå†…éƒ¨ç»“ç‚¹ä»£è¡¨çš„æ˜¯éžç»ˆç»“ç¬¦ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å°†è¯­æ³•åˆ†æžæ ‘ç§°ä¸ºå…·ä½“è¯­æ³•æ ‘ï¼›è€ŒæŠ½è±¡è¯­æ³•æ ‘ç®€ç§°ä¸ºè¯­æ³•æ ‘ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ–‡æ³•çš„å¾ˆå¤šéžç»ˆç»“ç¬¦éƒ½ä»£è¡¨ç¨‹åºçš„å…·ä½“æž„é€ ï¼Œè¿˜æœ‰å„ç§è¾…åŠ©ç¬¦å·ã€‚è€Œè¿™äº›åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­éƒ½æ˜¯ä¸éœ€è¦çš„ã€‚ è€Œå‰é¢æåˆ°çš„é‡è¦çŠ¶æ€å°±æ˜¯æŠ½è±¡è¯­æ³•æ ‘ä¸­è¿ç®—ç¬¦çš„è¿ç®—åˆ†é‡ã€‚ä¸‹é¢æ˜¯æ­£åˆ™è¡¨è¾¾å¼ (a|b)*abbå¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼š 1ï¼‰ã€ç»“æŸæ ‡è®°ç¬¦#ï¼šå‰é¢æˆ‘ä»¬æåˆ°äº†é‡è¦çŠ¶æ€ï¼Œä½†ï¼ˆNFAæˆ–è€…DFAï¼‰æŽ¥å—çŠ¶æ€æ²¡æœ‰ä¸€ä¸ªæ ‡å·ä¸ºéžç©ºçš„ç¦»å¼€è½¬æ¢ï¼Œå› æ­¤æŽ¥å—çŠ¶æ€ä¸ºéžé‡è¦çŠ¶æ€ã€‚åŸºäºŽæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ­£åˆ™è¡¨è¾¾å¼çš„å³è¾¹è¿žæŽ¥ä¸€ä¸ªç»“æŸæ ‡è®°ç¬¦ # ï¼Œä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼çš„æŽ¥å—çŠ¶æ€æˆä¸ºé‡è¦çŠ¶æ€ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±ä¸ç”¨ç‰¹æ®Šå¤„ç†æŽ¥å—çŠ¶æ€äº†ã€‚ 2ï¼‰ã€å¶å­èŠ‚ç‚¹ä½ç½®ï¼šä¸Šé¢æŠ½è±¡è¯­æ³•æ ‘å¶å­ç»“ç‚¹ä¸‹æ–¹éƒ½æœ‰ä¸€ä¸ªæœ‰åºçš„æ•´æ•°ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ•´æ•°ä¸ºå¯¹åº”å¶å­çš„ç»“ç‚¹çš„ä½ç½®ã€‚éžç©ºçš„å¶å­ç»“ç‚¹æ‰ä¼šèµ‹äºˆç›¸åº”çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ºç©ºä¸²çš„å¶å­ç»“ç‚¹æˆ‘ä»¬ä¸éœ€è¦å¯¹å…¶å¢žåŠ ä½ç½®ã€‚ äºŒã€nullableã€firstposã€lastposå’Œfollowposå‡½æ•°æˆ‘ä»¬è¦ä»Žä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ç›´æŽ¥æž„é€ å‡ºDFAï¼Œé™¤äº†å‰é¢æˆ‘ä»¬å·²ç»æž„é€ äº†çš„æŠ½è±¡è¯­æ³•æ ‘ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—nullableã€firstposã€lastposå’Œfollowposå‡½æ•°ã€‚ 1ï¼‰ã€bool nullable(n)ï¼šå…¶ä¸­nçš„å–å€¼ä¸ºæŠ½è±¡è¯­æ³•æ ‘ä¸­ä»»æ„ç»“ç‚¹ï¼ˆå¯ä»¥æ˜¯å¶å­ç»“ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯æ˜¯å†…éƒ¨ç»“ç‚¹ã€‚å³è¿ç®—ç¬¦å’Œè¿ç®—åˆ†é‡ï¼‰ï¼Œå…¶è¿”å›žå€¼çš„é€»è¾‘æ˜¯å½“æ­¤ç»“ç‚¹çš„å­è¡¨è¾¾å¼ä¸­åŒ…å«æœ‰ç©ºä¸²Îµæ—¶è¿”å›žtrueï¼Œå¦åˆ™ä¸ºfalseï¼› 2ï¼‰ã€nodes firstpos(n)ï¼šå­è¡¨è¾¾å¼çš„è¯­è¨€ä¸­æŸä¸ªä¸²çš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼Œè¯¥è¯­è¨€æ˜¯ä»¥nä¸ºæ ¹çš„å­è¡¨è¾¾å¼ï¼› 3ï¼‰ã€nodes lastpos(n)ï¼šå­è¡¨è¾¾å¼çš„è¯­è¨€ä¸­æŸä¸ªä¸²çš„æœ€åŽä¸€ä¸ªç¬¦å·ï¼ŒåŒæ ·çš„è¯¥è¯­è¨€ä¹Ÿæ˜¯ä»¥nä¸ºæ ¹çš„å­è¡¨è¾¾å¼ï¼› 4ï¼‰ã€nodes followpos(n)ï¼šè¿™ç›¸å¯¹è¦å¤æ‚ä¸€ç‚¹ã€‚æ¯”å¦‚åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­å­˜åœ¨ä¸¤ä¸ªç»“ç‚¹åˆ†åˆ«ä¸ºnå’Œmï¼Œå­˜åœ¨æŸä¸ªä¸²s = a1â€¦aiai+1â€¦apï¼Œå³ä»¥è¯¥æ­£åˆ™è¡¨è¾¾å¼ä¸ºæ¨¡å¼çš„ä¸²ã€‚è¦æ»¡è¶³followpos(n)==mï¼Œé‚£ä¹ˆåˆ™éœ€è¦aiå’Œä½ç½®nåŒ¹é…ï¼ŒaI+1å’Œä½ç½®måŒ¹é…ã€‚æ¯”å¦‚å½“å‰æœ‰ä¸€ä¸ªç¬¦å·ä¸²aabbï¼Œæƒ³è¦æž„é€ è¯¥ä¸²å¯¹åº”äºŽä¸Šå›¾æŠ½è±¡è¯­æ³•æ ‘ä¸­å„ä¸ªèŠ‚ç‚¹é¡ºåºä¸º1ã€3ã€4ã€5ï¼Œå› æ­¤æˆ‘ä»¬å°±è¯´follow(3)=4ã€‚é€šä¿—ä¸€ç‚¹è¯´å°±æ˜¯è¦çœ‹æŠ½è±¡è¯­æ³•æ ‘æŒ‡å®šç»“ç‚¹çš„followposï¼Œéœ€è¦å…ˆæ‰¾åˆ°å¯¹åº”ç»“ç‚¹åœ¨æŸä¸ªç¬¦å·ä¸²ä¸­çš„ä½ç½®ï¼Œç„¶åŽçœ‹è¯¥ç¬¦å·åŽä¸€ä½ç¬¦å·å³å¯ã€‚ ä¸Šé¢çš„nodesè¡¨ç¤ºçš„ç»“ç‚¹é›†åˆã€‚å‰é¢è¯´çš„ç»“ç‚¹å‡æŒ‡çš„æ˜¯æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„é‡è¦ä½ç½®ã€‚ æ›´è¯¦ç»†ç‚¹ï¼Œå½“æˆ‘ä»¬è®¡ç®—ä¸Šé¢æŠ½è±¡è¯­æ³•æ ‘ä½ç½®1çš„followposï¼Œå³followpos(1)ã€‚é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡æŠ½è±¡è¯­æ³•æ ‘æ¥çœ‹ï¼Œä½ç½®1ä¹‹åŽç»è¿‡å¹¶è¿ç®—å’Œé—­åŒ…è¿ç®—å¯ä»¥å¾—åˆ°çš„å­ä¸²æœ‰ï¼š 123aa;/// ç¬¬ä¸€ä¸ªaæ¥è‡ªäºŽä½ç½®1ï¼Œç¬¬äºŒä¸ªaæ¥è‡ªäºŽä½ç½®1ã€‚é—­åŒ…è¿ç®—å¾ªçŽ¯äº†ä¸¤æ¬¡ï¼›ab;/// aæ¥è‡ªäºŽä½ç½®1ï¼Œbæ¥è‡ªäºŽä½ç½®2ã€‚é—­åŒ…è¿ç®—å¾ªçŽ¯äº†2æ¬¡ï¼›aa;///ç¬¬ä¸€ä¸ªaæ¥è‡ªäºŽä½ç½®1ï¼Œç¬¬äºŒä¸ªaæ¥è‡ªäºŽä½ç½®3ã€‚é—­åŒ…è¿ç®—å¾ªçŽ¯äº†1æ¬¡ï¼› å› æ­¤å¾—åˆ° followpos(1) = {1,2,3}; ä¸‹è¡¨æ•´ç†äº†è®¡ç®—nullableã€firstposã€lastposçš„è®¡ç®—è§„åˆ™ï¼š åºå· ç»“ç‚¹n nullabl(n) firstpos(n) lastpos(n) 1 æ ‡å·ä¸ºÎµçš„å¶å­ç»“ç‚¹ true âˆ… âˆ… 2 ä½ç½®ä¸ºiçš„å¶å­ç»“ç‚¹ false {i} {i} 3 å¹¶ ç»“ç‚¹n=c1,c2 nullable(c1) é€»è¾‘æˆ– nullable(c2) firstpos(c1) âˆª firstpos(c2) lastpos(c1) âˆª lastpos(c2) 4 è¿žæŽ¥ ç»“ç‚¹n=c1c2 nullable(c1) é€»è¾‘ä¸Ž nullable(c2) å¦‚æžœ nullable(c1) ä¸ºçœŸï¼Œé‚£ä¹ˆå€¼ä¸ºfirstpos(c1) âˆª firstpos(c2)ã€‚å¦åˆ™ä¸ºfirstpos(c1) å¦‚æžœ nullable(c2) ä¸ºçœŸï¼Œé‚£ä¹ˆå€¼ä¸ºlastpos(c1) âˆª lastpos(c2)ã€‚å¦åˆ™ä¸ºlastpos(c2) 5 é—­åŒ… ç»“ç‚¹n=c1* true firstpos(c1) lastpos(c1) ç”±äºŽmdæ ¼å¼é—®é¢˜ï¼Œä¸Šè¡¨ç¬¬3è¡Œçš„é€—å·â€œ,â€æ›¿æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„â€|â€ç¬¦å·ã€‚ 1ã€æ¯ä¸ªå¶å­ç»“ç‚¹çš„firstposå’ŒlastposåªåŒ…å«å®ƒè‡ªèº«ã€‚ä¸Šè¡¨ä¸­ç¬¬2ç‚¹ï¼› 2ã€â€œå¹¶â€ ç»“ç‚¹çš„firstposå’Œlastposåˆ†åˆ«æ˜¯å®ƒæ‰€æœ‰å­èŠ‚ç‚¹çš„firstposå’Œlastposçš„å¹¶é›†ã€‚ä¸Šè¡¨ç¬¬3ç‚¹ï¼› 3ã€â€œé—­åŒ…â€ç»“ç‚¹çš„firstposå’Œlastposåˆ†åˆ«æ˜¯å®ƒå”¯ä¸€å­èŠ‚ç‚¹çš„firstposå’Œlastposã€‚ä¸Šè¡¨çš„ç¬¬5ç‚¹ï¼› 4ã€å¯¹äºŽâ€œè¿žæŽ¥â€ç»“ç‚¹è€Œè¨€ï¼Œfirstposä¸»è¦æ˜¯çœ‹å·¦å­ç»“ç‚¹æ˜¯å¦ä¸ºç©ºã€‚è€Œlastposå³å­èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºã€‚ çŽ°åœ¨æˆ‘ä»¬è¿ç”¨ä¸Šé¢çš„è§„åˆ™ï¼Œå°†ç¬¬ä¸€èŠ‚çš„æŠ½è±¡è¯­æ³•æ ‘ä¸­æ¯ä¸ªç»“ç‚¹çš„firstposå’Œlastposæ±‚å‡ºæ¥ã€‚å¦‚ä¸‹å›¾ï¼š å›¾ä¸­è“è‰²è¡¨ç¤ºfirstposé›†åˆï¼Œè€Œæ©™è‰²è¡¨ç¤ºlastposé›†åˆã€‚ è®¡ç®—followposåªæœ‰ä¸¤ç§æƒ…å†µä¼šä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼çš„æŸä¸ªä½ç½®è·Ÿåœ¨å¦ä¸€ä¸ªä½ç½®ä¹‹åŽï¼š 1ï¼‰ã€å¦‚æžœæ˜¯ç»“ç‚¹næ˜¯ä¸€ä¸ªâ€œè¿žæŽ¥â€ç»“ç‚¹ï¼Œä¸”åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­å…¶å·¦å³å­èŠ‚ç‚¹åˆ†åˆ«ä¸ºc1ï¼Œc2ã€‚é‚£ä¹ˆå¯¹äºŽlastpos(c1)ä¸­çš„æ¯ä¸ªä½ç½®iï¼Œfirstpos(c2)ä¸­æ‰€æœ‰ä½ç½®éƒ½åœ¨followpos(i)ä¸­ï¼›é€šä¿—çš„è®²å°±æ˜¯ä»¥â€œè¿žæŽ¥â€ç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘ï¼Œå·¦å­ç»“ç‚¹lastposé›†åˆä¸­æ¯ä¸ªä½ç½®çš„followposéƒ½åŒ…å«å³å­ç»“ç‚¹çš„firstposã€‚æœ‰ç‚¹ç±»ä¼¼äºŽäºŒå‰æ ‘åŽåºéåŽ†ï¼Œå·¦å­æ ‘æœ€å¤§ç»“ç‚¹çš„åŽé¢è·Ÿç€çš„æ˜¯å³å­æ ‘çš„æœ€å°ç»“ç‚¹ã€‚ 2ï¼‰ã€å¦‚æžœnæ˜¯â€œé—­åŒ…â€ç»“ç‚¹ï¼Œlastpos(n)ä¸­æ¯ä¸ªä½ç½®çš„followposéƒ½åŒ…å«äºŽçš„firstpos(n)ä¸­ï¼› åŸºäºŽä¸Šè¯‰ä¸¤ä¸ªè§„åˆ™ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„å›¾æ±‚è§£å„ä¸ªé‡è¦ç»“ç‚¹çš„followposï¼ˆä¸Šå›¾å·²ç»æ ‡å‡ºæ¯ä¸ªç»“ç‚¹çš„firstposå’Œlastposï¼‰ã€‚ä¸‹é¢æ˜¯è¯¦ç»†æ­¥éª¤ï¼š 1ã€é¦–å…ˆæˆ‘ä»¬è¿ç”¨è§„åˆ™1æ¥æŸ¥çœ‹ç¬¬ä¸€ä¸ªâ€œè¿žæŽ¥â€ç»“ç‚¹ï¼Œå…¶å·¦å­ç»“ç‚¹çš„lastposä¸º{1,2}ï¼Œå¹¶ä¸”å…¶å³å­ç»“ç‚¹çš„firstposä¸º{3}ã€‚å› æ­¤ä½ç½®1ç»“ç‚¹å’Œä½ç½®2ç»“ç‚¹çš„followposéƒ½åŒ…å«æœ‰ä½ç½®3ã€‚ éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯å¹¶ä¸æ˜¯çœ‹çš„å½“å‰ç»“ç‚¹æœ¬èº«çš„lastposå’Œfirstposï¼Œè€Œæ˜¯çœ‹çš„å…¶å·¦å­ç»“ç‚¹çš„lastposå’Œå³å­ç»“ç‚¹çš„firstposã€‚ ä½ç½®n followpos(n) 1 {3} 2 {3} 2ã€åŒç†æˆ‘ä»¬å°†å‰©ä¸‹çš„â€œè¿žæŽ¥â€ç»“ç‚¹è¿ç”¨è§„åˆ™1ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼ˆè¿™é‡Œå¤ªç®€å•äº†æˆ‘å°±ä¸ç”»å›¾äº†ï¼‰ï¼š ä½ç½®n followpos(n) 3 {4} 4 {5} 5 {6} 3ã€çŽ°åœ¨æ˜¯æ—¶å€™è¿ç”¨ä¸Šé¢çš„è§„åˆ™2äº†ï¼ŒæŸ¥æ‰¾æŠ½è±¡è¯­æ³•æ ‘ä¸­çš„â€œé—­åŒ…â€ç»“ç‚¹ã€‚å®ƒå’Œâ€œè¿žæŽ¥â€ç»“ç‚¹ä¸åŒçš„æ˜¯ï¼šâ€œè¿žæŽ¥â€ç»“ç‚¹çœ‹çš„æ˜¯å…¶å·¦å³å­æ ‘çš„lastposå’Œfirstposï¼Œè€Œâ€œé—­åŒ…â€ç»“ç‚¹çœ‹çš„æ˜¯å…¶æœ¬èº«çš„lastposå’Œfirstposã€‚ ä½ç½®n followpos(n) 1 {1,2} 2 {1,2} 4ã€çŽ°åœ¨æˆ‘ä»¬å°†å‰é¢ä¸‰æ­¥å¾—åˆ°çš„æ•°æ®è¿›è¡Œåˆå¹¶ä¹‹åŽçš„ç»“æžœä¸ºï¼š å¾ˆæ˜Žæ˜¾ä½ç½®6ä½œä¸ºå¢žå¹¿æ­£åˆ™è¡¨è¾¾å¼ä¸­å­˜åœ¨çš„ç»ˆç»“ç¬¦æ ‡è¯†ï¼Œå› æ­¤å…¶followposä¸ºç©ºé›†ã€‚ ä½ç½®n followpos(n) 1 {1,2,3} 2 {1,2,3} 3 {4} 4 {5} 5 {6} 6 âˆ… å›žè¿‡å¤´æ¥çœ‹ä¸€ä¸‹æ­£åˆ™è¡¨è¡¨è¾¾å¼ (a|b)*abbåŒ¹é…å­ä¸²ä¸­ï¼Œä½ç½®1å¯¹åº”çš„ç»“ç‚¹aå…¶åŽå¯èƒ½å­˜åœ¨å­—ç¬¦ä¸ºaï¼ˆä½ç½®1ï¼‰ã€bï¼ˆä½ç½®2ï¼‰ã€aï¼ˆä½ç½®3ï¼‰ã€‚ä½ç½®2å’Œä½ç½®1åŒç†ã€‚ çŽ°åœ¨æˆ‘ä»¬å°†æ¯ä¸ªä½ç½®ï¼Œå·²ç»å¯¹åº”çš„followposç”¨ä¸€ä¸ªæœ‰å‘å›¾æ¥è¡¨ç¤ºå¦‚ä¸‹ï¼š å¾ˆæ˜Žæ˜¾çš„å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¡¨ç¤ºfollowposå‡½æ•°çš„æœ‰å‘å›¾å‡ ä¹Žå°±æ˜¯ç›¸åº”çš„æ­£åˆ™è¡¨è¾¾å¼ä¸åŒ…å«ç©ºè½¬æ¢çš„NFAã€‚ ä¸‰ã€æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æž„å»ºDFAè¦ä»Žä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æž„é€ ä¸€ä¸ªDFAçš„å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š 1ã€æ ¹æ®æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼æž„é€ å‡ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼› 2ã€è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„nullableå‡½æ•°å€¼ã€firstposå‡½æ•°å€¼ã€lastposå‡½æ•°å€¼ã€‚ä»¥åŠé‡è¦ä½ç½®èŠ‚ç‚¹çš„followposå‡½æ•°å€¼ï¼› 3ã€æŠ½è±¡è¯­æ³•æ ‘æ ¹èŠ‚ç‚¹çš„ firstpos ä½œä¸ºDFAçš„å¼€å§‹çŠ¶æ€ï¼› 4ã€æŸ¥çœ‹æ­£åˆ™è¡¨è¾¾å¼ä¸­å­˜åœ¨çš„å„ä¸ªè½¬æ¢ï¼ˆå³aæˆ–è€…bï¼‰ï¼Œå°†å½“å‰çŠ¶æ€ä¸­ç›¸åŒè½¬æ¢çš„followposåˆå¹¶åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼› 5ã€å¦‚æžœåˆå¹¶çš„é›†åˆå‡ºçŽ°æ–°çš„çŠ¶æ€ï¼Œåˆ™å°†è¯¥çŠ¶æ€æ·»åŠ åˆ°DFAçš„çŠ¶æ€é›†åˆä¸­ï¼› 6ã€å¦‚æžœç»è¿‡å„ä¸ªè½¬æ¢ä¹‹åŽæ²¡æœ‰æ–°çŠ¶æ€å°±åœæ­¢ã€‚å¦åˆ™é‡å¤æ‰§è¡Œ4~6æ­¥ï¼› çœ‹ä¸€ä¸‹ä¾‹å­èƒ½å¤Ÿæ›´åŠ æ¸…æ™°åœ°è®¤è¯†åˆ°å¦‚ä½•æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æž„å»ºDFAã€‚ å›¾ä¸­è“è‰²è¡¨ç¤ºfirstposé›†åˆï¼Œè€Œæ©™è‰²è¡¨ç¤ºlastposé›†åˆã€‚ 1ï¼‰ã€å¯¹äºŽæ­£åˆ™è¡¨è¾¾å¼ (a|b)*abbï¼Œæˆ‘ä»¬æž„é€ å¾—åˆ°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå·²ç»å¯¹åº”çš„firstpos/lastposéƒ½åœ¨ä¸Šå›¾ä¸­; 2ï¼‰ã€æˆ‘ä»¬å°†æ ¹èŠ‚ç‚¹çš„firstpos = {1,2,3} ä½œä¸ºDFAçš„å¼€å§‹çŠ¶æ€ï¼š 3ï¼‰ã€è¯¥æ­£åˆ™è¡¨è¾¾å¼ä¸­å­˜åœ¨çš„è½¬æ¢æœ‰a, bï¼Œå¼€å§‹çŠ¶æ€é›†åˆä¸º{1,2,3}ï¼Œæ­¤æ—¶æˆ‘ä»¬å°†çŠ¶æ€é›†åˆ{1,2,3}ç›¸åŒçŠ¶æ€çš„followposåˆå¹¶åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚é›†åˆ{1,2,3}ä¸­å¯¹åº”è½¬æ¢açš„ä½ç½®æœ‰1ï¼Œ3ï¼›å¯¹åº”è½¬æ¢bçš„ä½ç½®æœ‰{2}ã€‚è½¬æ¢açš„ followpos(1)={1,2,3}, followpos(3)={4}ï¼Œå°†ä¸¤ä¸ªé›†åˆåˆå¹¶èµ·æ¥ä¸º {1,2,3,4}ï¼Œç”±äºŽè¯¥çŠ¶æ€æ˜¯æ–°çŠ¶æ€ï¼Œå› æ­¤å°†çŠ¶æ€é›†åˆ{1,2,3,4}æ·»åŠ åˆ°DFAä¸­ï¼›è½¬æ¢bçš„followpos(2)={1,2,3}ï¼Œç”±äºŽè¯¥çŠ¶æ€å¹¶ä¸æ˜¯æ–°çŠ¶æ€ã€‚å› æ­¤åªæ˜¯ä¸€ä¸ªç®€å•è½¬æ¢å³å¯ã€‚ é‡å¤æ‰§è¡Œç¬¬ä¸‰æ­¥ï¼Œå¾—åˆ°çš„æœ€ç»ˆç»“æžœä¸ºï¼š å››ã€æœ€å°åŒ–DFAçš„çŠ¶æ€æ•°å¯¹äºŽåŒä¸€ä¸ªè¯­è¨€ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªè¯†åˆ«æ­¤è¯­è¨€çš„DFAã€‚ä¾‹å¦‚ä¸Šå›¾å’Œä¸Šä¸€èŠ‚ä¸­ç”±NFAé€šè¿‡å­é›†æž„é€ æ³•å¾—åˆ°çš„DFAéƒ½èƒ½å¤Ÿè¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼ (a|b)*abbã€‚å¯ä»¥çœ‹å‡ºæ¥å®ƒä»¬çš„ä¸ªæ•°ä¹Ÿä¸ä¸€æ ·ã€‚å› æ­¤å¦‚æžœè®©æˆ‘ä»¬ä½¿ç”¨DFAæ¥å®žçŽ°è¯æ³•åˆ†æžå™¨ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯å¸Œæœ›ä½¿ç”¨çŠ¶æ€æ•°é‡å°½é‡å°‘çš„DFAäº†ã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹çœ‹åŒºåˆ†çŠ¶æ€çš„æ¦‚å¿µï¼š åŒºåˆ†çŠ¶æ€ï¼Œå¦‚æžœä»ŽçŠ¶æ€så’Œtå‡ºå‘ï¼Œæ²¿ç€æ ‡å·ä¸ºxçš„è·¯å¾„åˆ°è¾¾çš„ä¸¤ä¸ªçŠ¶æ€ä¸­åªæœ‰ä¸€ä¸ªæ˜¯æŽ¥å—çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´ä¸²xåŒºåˆ†çŠ¶æ€så’Œtã€‚çŠ¶æ€så’Œtæ˜¯å¯åŒºåˆ†çš„ã€‚ç©ºä¸²Îµå¯ä»¥åŒºåˆ†ä»»ä½•ä¸€ä¸ªæŽ¥å—çŠ¶æ€å’ŒéžæŽ¥å—çŠ¶æ€ã€‚ ä¸Šå›¾ä¸­ä¸² bb å¯ä»¥åŒºåˆ†çŠ¶æ€Aå’ŒBï¼Œè¿™æ˜¯å› ä¸ºä»ŽAå‡ºå‘ç»è¿‡æ ‡å·ä¸ºbbçš„è·¯å¾„åˆ°è¾¾ä¼šæŽ¥å—çŠ¶æ€Cï¼Œè€ŒçŠ¶æ€Bç»è¿‡æ ‡å·bbçš„è·¯å¾„åˆ°è¾¾çŠ¶æ€EæŽ¥å—çŠ¶æ€ã€‚ å…¶æ¬¡è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç»“è®ºï¼šä»»ä½•æ­£åˆ™è¯­è¨€éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„çŠ¶æ€æ•°ç›®æœ€å°‘çš„DFAã€‚è€Œä¸”ä»Žä»»æ„ä¸€ä¸ªæŽ¥å—ç›¸åŒè¯­è¨€çš„DFAå‡ºå‘ï¼Œé€šè¿‡ åˆ†ç»„ã€åˆå¹¶ç­‰ä»·çš„çŠ¶æ€ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥æž„å»ºå¾—åˆ°è¿™ä¸ªçŠ¶æ€æ•°é‡æœ€å°‘çš„DFAã€‚ å› æ­¤DFAçŠ¶æ€æœ€å°åŒ–ç®—æ³•çš„å·¥ä½œåŽŸç†æ˜¯ï¼š å°†ä¸€ä¸ªDFAçš„çŠ¶æ€é›†åˆåˆ’åˆ†æˆå¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­çš„å„ä¸ªçŠ¶æ€ä¹‹é—´ç›¸äº’ä¸å¯åŒºåˆ†ï¼Œä½†æ˜¯æ¥è‡ªä¸åŒç»„ä»»æ„çš„ä¸¤ä¸ªçŠ¶æ€æ˜¯å¯åŒºåˆ†çš„ï¼ˆå‰é¢æåˆ°çš„åŒºåˆ†æ¦‚å¿µï¼‰ã€‚ ç„¶åŽå°†æ¯ä¸ªç»„ä¸­çš„çŠ¶æ€åˆå¹¶æˆçŠ¶æ€æœ€å°‘DFAçš„ä¸€ä¸ªçŠ¶æ€ã€‚ æœ€åˆï¼Œåˆ’åˆ†ä¸¤ä¸ªç»„ï¼šæŽ¥å—çŠ¶æ€ç»„å’ŒéžæŽ¥å—çŠ¶æ€ç»„ã€‚åŸºæœ¬æ­¥éª¤æ˜¯ä»Žå½“å‰åˆ’åˆ†ä¸­å–ä¸€ä¸ªçŠ¶æ€ç»„ï¼Œæ¯”å¦‚ A = {s1, s2, â€¦ , sk}ï¼Œå¹¶é€‰å®šæŸä¸ªè¾“å…¥ç¬¦å·aï¼Œæ£€æŸ¥aæ˜¯å¦å¯ä»¥ç”¨äºŽåŒºåˆ†Aç»„ä¸­çš„æŸäº›çŠ¶æ€ã€‚æŸ¥çœ‹s1, s2, â€¦ , skåœ¨aä¸Šçš„è½¬æ¢ï¼Œå¦‚æžœè¿™äº›è½¬æ¢çš„åˆ°è¾¾çš„çŠ¶æ€è½å…¥å½“å‰åˆ’åˆ†çš„ä¸¤ä¸ªæˆ–å¤šä¸ªç»„ä¸­ï¼Œæˆ‘ä»¬å°±å°†Aåˆ†å‰²æˆå¤šä¸ªç»„ã€‚ æˆ‘ä»¬ä»¥ä¸Šå›¾ä¸ºä¾‹æ¥çœ‹çœ‹DFAçŠ¶æ€æœ€å°åŒ–ç®—æ³•ï¼š1ï¼‰ã€é¦–å…ˆåˆ’åˆ†ä¸¤ç»„ï¼šæŽ¥å—çŠ¶æ€ç»„åˆéžæŽ¥å—çŠ¶æ€ç»„ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ†åˆ«ç»™ä»–ä»¬èµ·åä¸ºç»„1å’Œç»„2ã€‚ 2ï¼‰ã€åœ¨ä¸Šå›¾çœ‹åˆ°DFAä»…æœ‰aã€bä¸¤ç§è½¬æ¢ã€‚ç”±äºŽç»„2åªåŒ…å«äº†ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¯¥çŠ¶æ€ä¸ºæŽ¥å—çŠ¶æ€è€Œä¸èƒ½å†è¢«åˆ†å‰²ï¼Œæ‰€ä»¥ç»„2åŽŸå°ä¸åŠ¨ã€‚å› æ­¤æˆ‘ä»¬ç»§ç»­çœ‹ç»„1ã€‚ç»„1ä¸­çš„çŠ¶æ€Aã€Bã€Cã€Dé’ˆå¯¹açš„è½¬æ¢ï¼Œå¾—åˆ°çš„çŠ¶æ€å‡ä¸ºçŠ¶æ€Bï¼Œå› æ­¤ä¸²aæ— æ³•åŒºåˆ†çŠ¶æ€Aã€Bã€Cã€Dã€‚ 3ï¼‰ã€ç»„1ä¸­çš„çŠ¶æ€Aã€Bã€Cã€Dé’ˆå¯¹bçš„è½¬æ¢ï¼ŒçŠ¶æ€Aã€Bã€Céƒ½æ˜¯åˆ°è¾¾ç»„å†…æŸä¸ªæˆå‘˜ä¸Šï¼Œè¿™æ˜¾ç„¶æ˜¯æ— æ³•åŒºåˆ†çš„ï¼ˆå‰é¢æåˆ°è¿‡ç»„å†…å„ä¸ªçŠ¶æ€ä¹‹é—´äº’ä¸å¯åŒºåˆ†ï¼‰ã€‚ä½†çŠ¶æ€Dåˆ°è¾¾çš„æ˜¯ç»„2æˆå‘˜å¯¹åº”çš„çŠ¶æ€ï¼Œå¾ˆæ˜Žæ˜¾çŠ¶æ€Då¯ä»¥å’ŒAã€Bã€CåŒºåˆ†å¼€æ¥ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç»§ç»­å°†ç»„1åˆ’åˆ†æ›´å°çš„ç»„ï¼š 4ï¼‰ã€ç±»ä¼¼äºŽç¬¬ä¸‰æ­¥ï¼Œç»„3çš„çŠ¶æ€Aã€Bã€Cé’ˆå¯¹bçš„è½¬æ¢å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ç»„ã€‚è¿™æ˜¯å› ä¸ºçŠ¶æ€Aã€Cç»è¿‡è½¬æ¢bä¹‹åŽå‡ä¸ºç»„å†…çŠ¶æ€ï¼›è€ŒçŠ¶æ€Bç»è¿‡è½¬æ¢bå¾—åˆ°çš„ç»„4æˆå‘˜å¯¹åº”çš„çŠ¶æ€ï¼š ç”±äºŽç»„5ä¸­å„ä¸ªçŠ¶æ€ï¼Œæ— è®ºæ˜¯é’ˆå¯¹è½¬æ¢aï¼Œè¿˜æ˜¯è½¬æ¢bè€Œè¨€ï¼Œå¾—åˆ°çš„çŠ¶æ€å‡ç›¸åŒã€‚å› æ­¤æˆ‘ä»¬ä¸èƒ½è®²ç»„5è¿›è¡Œæ›´ç»†ç²’åº¦çš„åˆ’åˆ†ã€‚é‚£ä¹ˆä¸Šå›¾å°±æ˜¯æœ€ç»ˆçš„åˆ’åˆ†ç»“æžœã€‚ çŽ°åœ¨æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„ä¿¡æ¯ç”»å‡ºå¯¹åº”çš„çŠ¶æ€è½¬æ¢è¡¨ï¼Œç”±äºŽçŠ¶æ€Aå’ŒçŠ¶æ€Cç»è¿‡è½¬æ¢å¾—åˆ°çš„çŠ¶æ€æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤é›†åˆ{A,C}è¿™é‡Œä»¥çŠ¶æ€Aè¡¨ç¤ºï¼š çŠ¶æ€ a b A B A B B D D B E E B A æˆ‘ä»¬ç”»å‡ºå¯¹åº”çš„DFAï¼Œå¹¶å°†å…¶ä¸Žä¸Šé¢æˆ‘ä»¬ç”¨æŠ½è±¡è¯­æ³•æ ‘æž„é€ å¾—åˆ°çš„DFAè¿›è¡Œå¯¹æ¯”ï¼š å¾ˆæ˜Žæ˜¾èƒ½å¤Ÿå¯¹æ¯”å‡ºæ¥ï¼Œä¸Šé¢ä¸¤ä¸ªDFAé™¤äº†èµ‹äºˆå„ä¸ªçŠ¶æ€çš„åç§°ä¸ä¸€æ ·ä¹‹å¤–ï¼Œå„ä¸ªè½¬æ¢ä»¥åŠè½¬æ¢åŽçš„çŠ¶æ€éƒ½æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬ç§°è¿™ä¸¤ä¸ªçŠ¶æ€æœºæ˜¯åŒæž„çš„ã€‚åŒæž„æ˜¯æŒ‡å¯¹äºŽä¸¤ä¸ªä¸åŒçš„è‡ªåŠ¨æœºï¼Œå¦‚æžœæŸä¸ªè‡ªåŠ¨åªæ˜¯é€šè¿‡æ›´æ”¹çŠ¶æ€çš„åå­—å°±å¯ä»¥è½¬æ¢ä¸ºå¦ä¸€ä¸ªè‡ªåŠ¨æœºã€‚ äº”ã€DFAæ¨¡æ‹Ÿä¸­çš„æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡æœ€ç®€å•å’Œæœ€å¿«æ·çš„è¡¨ç¤ºä¸€ä¸ªDFAçš„è½¬æ¢å‡½æ•°çš„æ–¹æ³•æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªä»¥çŠ¶æ€å’Œå­—ç¬¦ä¸ºä¸‹æ ‡çš„äºŒç»´è¡¨ã€‚ç»™å®šä¸€ä¸ªçŠ¶æ€å’Œä¸‹ä¸€ä¸ªè¾“å…¥å­—ç¬¦ï¼Œæˆ‘ä»¬è®¿é—®è¿™ä¸ªæ•°ç»„å°±å¯ä»¥æ‰¾å‡ºä¸‹ä¸€ä¸ªçŠ¶æ€ä»¥åŠæˆ‘ä»¬å¿…é¡»è¦æ‰§è¡Œçš„ç‰¹æ®ŠåŠ¨ä½œã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¯¹äºŽäºŒç»´è¡¨è€Œè¨€ï¼Œå„ä¸ªçŠ¶æ€é’ˆå¯¹æŸäº›å­—ç¬¦å¹¶æ²¡æœ‰å¯¹åº”è½¬æ¢ã€‚å¦‚æžœæ•°é‡å˜å¤šäº†ä¹‹åŽå°±ä¼šå­˜åœ¨å¤§é‡çš„ç©ºé—´æµªè´¹é—®é¢˜ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰å››ä¸ªæ•°ç»„çš„æ•°æ®ç»“æž„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ï¼‰ã€baseæ•°ç»„ç”¨äºŽç¡®å®šçŠ¶æ€sæ¡ç›®çš„åŸºå‡†ä½ç½®ï¼›2ï¼‰ã€nextå’Œcheckæ•°ç»„å­˜æ”¾çš„æ­£å¼å¯¹åº”çŠ¶æ€æ¡ç›®ï¼›3ï¼‰ã€æ•°ç»„checkç”¨äºŽç¡®å®šbase[s]ç»™å‡ºçš„åŸºå‡†ä½ç½®æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æžœé”™è¯¯åˆ™ä½¿ç”¨defaultæ•°ç»„æ¥ç¡®å®šå¦ä¸€ä¸ªåŸºå‡†ä½ç½®ï¼› åœ¨è®¡ç®—çŠ¶æ€såœ¨è¾“å…¥açš„åŽç»§çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹æ•°ç»„nextå’Œcheckä¸­åœ¨ä½ç½® index = base[s] + a ï¼ˆaæŒ‡å½“å‰è¾“å…¥å­—ç¬¦ï¼Œå…¶å¯¹åº”äºŽasciiç è¡¨ä¸Šå›ºå®šæ•°å­—ï¼‰ä¸Šçš„çŠ¶æ€æ¡ç›®ã€‚aã€å¦‚æžœcheck[index] == sï¼Œé‚£ä¹ˆè¯¥çŠ¶æ€æ¡ç›®æœ‰æ•ˆï¼ˆè¯¥çŠ¶æ€æŒ‡çš„æ˜¯ç»è¿‡è½¬æ¢aä¹‹åŽå¾—åˆ°çš„åŽç»­çŠ¶æ€ï¼‰ï¼›bã€å¦‚æžœcheck[index] != sï¼Œé‚£æˆ‘ä»¬åˆ™å¾—åˆ°å¦ä¸€ä¸ªçŠ¶æ€æ¡ç›®t = default[s]ã€‚å¹¶å°†çŠ¶æ€tè®¾ç½®ä¸ºå½“å‰çŠ¶æ€é‡å¤ä¸Šè¯‰è¿‡ç¨‹èŽ·å–ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼› ä¸‹é¢æ˜¯å¯¹åº”çš„ä¼ªä»£ç ï¼š 1234int nextState(s,a) &#123; if(check[base[s]+a] == s) return next[base[s]+a]; else return nextState(default[s],a);&#125; æ€»ç»“åœ¨è¿™ä¸€èŠ‚ä¸­éœ€è¦é‡ç‚¹ç†è§£çš„å°±æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼šæŠ½è±¡è¯­æ³•æ ‘çš„æ¯ä¸ªå†…éƒ¨ç»“ç‚¹ä»£è¡¨ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œè¯¥å†…éƒ¨ç»“ç‚¹çš„å­èŠ‚ç‚¹ä»£è¡¨è¿ç®—ç¬¦çš„è¿ç®—åˆ†é‡ã€‚ç„¶åŽå¯ä»¥æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æž„é€ å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ã€‚å‡½æ•°nullableã€firsposã€lastposä»¥åŠfollowposåœ¨æž„é€ DFAä¸­èµ·ç€é‡è¦çš„ä½œç”¨ã€‚nullableæŒ‡çš„æ˜¯å¯¹åº”ç»“ç‚¹çš„å­è¡¨è¾¾å¼æ˜¯å¦å¯èƒ½è¿”å›žç©ºä¸²ï¼›firstposæ˜¯å­è¡¨è¡¨è¾¾å¼ä¸²çš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼›lastposæ˜¯å­è¡¨è¾¾å¼ä¸²çš„æœ€åŽä¸€ä¸ªç¬¦å·ï¼›followposåˆ™æ˜¯ç›¸å¯¹è¦å¤æ‚ä¸€ç‚¹ï¼Œåªé’ˆå¯¹è¿žæŽ¥ç»“ç‚¹å’Œé—­åŒ…ç»“ç‚¹æ±‚followposã€‚åœ¨æœ‰äº†ä¸Šé¢åªæ˜¯ä½œä¸ºé“ºåž«ä¹‹åŽï¼Œæ±‚æ­£åˆ™è¡¨è¾¾å¼æ¥DFAçš„è½¬æ¢å°±è¦è½»æ¾è®¸å¤šã€‚é¦–å…ˆæ˜¯åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­ä»¥æ ¹èŠ‚ç‚¹æ‰€åœ¨çš„firstposé›†åˆä½œä¸ºDFAçš„å¼€å§‹çŠ¶æ€ã€‚ç„¶åŽæŸ¥çœ‹é›†åˆå†…éƒ¨å„ä¸ªåºå·å¯¹åº”çš„è½¬æ¢ï¼ŒèŽ·å–å¯¹åº”éœ€è¦çš„followposæ±‚å¹¶é›†ã€‚ä»¥æ­¤ç±»æŽ¨ä¸‹åŽ»å¯æž„é€ ä¸€ä¸ªå®Œæ•´çš„DFAã€‚è€Œåœ¨æœ€å°åŒ–DFAçŠ¶æ€æ•°æ—¶ï¼Œåˆ™æ ¹æ®ä¸åŒçš„åˆ’åˆ†ï¼Œé€’å½’åœ°å°†å„ç»„åŒºåˆ†å¼€æ¥ï¼Œå¾—åˆ°çŠ¶æ€æ•°æœ€å°‘çš„DFAã€‚è€Œåœ¨æœ€åŽä¹Ÿç»™å‡ºäº†æƒè¡¡æ—¶é—´å’Œç©ºé—´çš„æ•°æ®ç»“æž„ã€‚ åˆ°è¿™å„¿åŸºæœ¬ä¸ŠæŠŠè¯æ³•åˆ†æžç›¸å…³çš„çŸ¥è¯†éƒ½ç®€å•è¿‡äº†ä¸€éäº†ã€‚åŽç»­å†ç»§ç»­æ›´æ–°è¯­æ³•åˆ†æžéƒ¨åˆ†ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è¯æ³•åˆ†æžâ€”â€”ä»Žæ­£åˆ™è¡¨è¾¾å¼åˆ°æœ‰ç©·è‡ªåŠ¨æœº]]></title>
      <url>%2F2019%2F10%2F28%2Fcompiler_regular_fa%2F</url>
      <content type="text"><![CDATA[è‡ªåŠ¨æœºåœ¨æœ¬è´¨ä¸Šæ˜¯å’ŒçŠ¶æ€è½¬æ¢å›¾ç±»ä¼¼çš„ã€‚ä½†ä¹Ÿæœ‰ä¸€ç‚¹ä¸åŒï¼Œå®ƒä»¬åªèƒ½å¯¹æ¯ä¸ªå¯èƒ½çš„è¾“å…¥ä¸²ç®€å•åœ°å›žç­”â€œæ˜¯â€æˆ–è€…â€œå¦â€ï¼›æœ‰ç©·è‡ªåŠ¨æœºåˆ†ä¸ºä¸¤ç±»ï¼š 1ã€ä¸ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼ˆNFAï¼‰ï¼šå…¶è¾¹ä¸Šçš„æ ‡å·æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç¦»å¼€ä¸€ä¸ªçŠ¶æ€çš„å¤šæ¡è¾¹ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªç›¸åŒçš„ç¬¦å·ï¼Œä¹Ÿå¯ä»¥æ˜¯ç©ºï¼› 2ã€ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼ˆDFAï¼‰ï¼šå¯¹äºŽæ¯ä¸ªç¬¦å·è€Œè¨€ï¼Œä»¥è¯¥ç¬¦å·ä¸ºæ ‡å·çš„è¾¹æœ‰ä¸”åªæœ‰ä¸€æ¡ç¦»å¼€è¯¥çŠ¶æ€ã€‚ ä¸‹é¢æˆ‘ä»¬å°±ä¸€æ¬¡æ¥çœ‹çœ‹ä¸ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼Œå’Œç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºã€‚ ä¸€ã€NFAâ€”â€”ä¸ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºä¸ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºç”±ä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š1ï¼‰ã€æœ‰ç©·çš„çŠ¶æ€é›†åˆï¼Œç±»ä¼¼äºŽä¸Šä¸€èŠ‚ä¸­çŠ¶æ€è½¬æ¢è¡¨çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼›2ï¼‰ã€ä¸€ä¸ªè¾“å…¥ç¬¦å·é›†åˆï¼Œå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºunicodeå­—ç¬¦é›†ä¹‹ç±»çš„ï¼›3ï¼‰ã€è½¬æ¢å‡½æ•°ï¼Œç±»ä¼¼äºŽçŠ¶æ€è½¬æ¢è¡¨ä¸­çš„æœ‰å‘ç®­å¤´ä¸€æ ·ï¼›4ï¼‰ã€å¼€å§‹çŠ¶æ€ï¼Œæˆ–è€…å«åˆå§‹çŠ¶æ€ï¼›5ï¼‰ã€æŽ¥å—çŠ¶æ€ï¼Œä¹Ÿç§°ä½œç»ˆæ­¢çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾çš„åŒåœ†åœˆè¡¨ç¤ºï¼› ä¸Šå›¾æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼ (a|b)*abbçš„NFAè½¬æ¢å›¾ã€‚ è½¬æ¢è¡¨å’ŒæŽ¥æ”¶ä¸²æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªNFAè¡¨ç¤ºä¸ºä¸€å¼ è½¬æ¢è¡¨ã€‚è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªçŠ¶æ€ï¼Œè¡¨çš„æ¯ä¸€åˆ—å¯¹åº”äºŽè¾“å…¥ç¬¦å·å’Œç©ºä¸²ã€‚å…ˆå°†ä¸Šå›¾çš„NFAè½¬æ¢å›¾è½¬æ¢æˆä¸ºå¯¹åº”çš„è½¬æ¢è¡¨ï¼Œç„¶åŽæ ¹æ®è½¬æ¢è¡¨å†å…·ä½“è¯´æ˜Žå…¶ä¸­çš„å«ä¹‰ï¼š çŠ¶æ€ a b ç©ºå­—ç¬¦Îµ 0 {0,1} {0} âˆ… 1 âˆ… {2} âˆ… 2 âˆ… {3} âˆ… 3 âˆ… âˆ… âˆ… å¯¹äºŽä¸€ä¸ªç»™å®šçš„çŠ¶æ€å’Œç»™å®šçš„è½¬æ¢ï¼Œå…¶å¾—åˆ°çš„å€¼æ˜¯NFAè½¬æ¢å›¾ä¸­åº”ç”¨å¯¹åº”è½¬æ¢ä¹‹åŽå¾—åˆ°çš„çŠ¶æ€é›†åˆã€‚å¦‚æžœå¯¹åº”çš„è½¬æ¢æ²¡æœ‰åŽç»­çŠ¶æ€ï¼Œåˆ™ç”¨ç¬¦å·âˆ…è¡¨ç¤ºã€‚ è€Œè‡ªåŠ¨æœºåœ¨åˆ¤æ–­æ˜¯å¦æŽ¥æ”¶å­—ç¬¦ä¸²çš„ä¾æ®æ˜¯ï¼šå­˜åœ¨æŸæ¡å­—ç¬¦åºåˆ—ç»„æˆç¬¦å·ä¸²çš„è·¯å¾„ï¼Œè¯¥è·¯å¾„èƒ½å¤Ÿä»Žå¼€å§‹çŠ¶æ€åˆ°è¾¾æŸä¸ªæŽ¥æ”¶çŠ¶æ€ã€‚æˆ‘ä»¬å°±è¯´NFAæŽ¥æ”¶è¿™ä¸ªç¬¦å·ä¸²ã€‚æ¯”å¦‚ï¼š è¯¥NFAæŽ¥æ”¶ç¬¦å·ä¸²ï¼š å³å­—ç¬¦ä¸²aaaè¢«è¿™ä¸ªNFAæŽ¥å—ã€‚è·¯å¾„ä¸­çš„Îµå¹¶ä¸ä¼šè®°å½•åœ¨å®žé™…çš„è·¯å¾„ä¸­ã€‚ äºŒã€DFAâ€”â€”ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºæ˜¯ä¸ç¡®å®šæœ‰ç©·è‡ªåŠ¨æœºçš„ç‰¹ä¾‹ï¼Œå®ƒæ€§è´¨å¦‚ä¸‹ï¼š1ï¼‰ã€æ²¡æœ‰è¾“å…¥ç¬¦å·Îµï¼›2ï¼‰ã€å¯¹äºŽæ¯ä¸€ä¸ªçŠ¶æ€sï¼Œæ¯ä¸€ä¸ªè¾“å…¥ç¬¦å·aï¼Œæœ‰ä¸”åªæœ‰ä¸€æ¡è¾¹ç¦»å¼€çŠ¶æ€sã€‚ é€šä¿—æ¥è®²å°±æ˜¯æŒ‡å®šæŸä¸ªçŠ¶æ€ï¼Œä¸å­˜åœ¨ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šç›¸åŒçš„è½¬æ¢å­˜åœ¨ã€‚æ¯”å¦‚å¯¹äºŽNFAè€Œè¨€ï¼ŒçŠ¶æ€0ä¸­è½¬æ¢aå¯ä»¥åˆ°è¾¾ä¸¤ä¸ªåŠå…¶ä»¥ä¸Šä¸åŒçš„çŠ¶æ€ï¼›è€ŒDFAåˆ™åªèƒ½åˆ°è¾¾ä¸€ä¸ªï¼ˆæœ‰ä¸”åªæœ‰ï¼‰çŠ¶æ€ã€‚ æ¯”å¦‚ä¸‹é¢åŒæ ·æ˜¯è¯†åˆ«(a|b)*abbçš„DFAè½¬æ¢å›¾ï¼š å¯¹äºŽç»™å®šçš„è¾“å…¥ä¸²ababbï¼Œè¿™ä¸ªDFAçš„å¯¹åº”çŠ¶æ€é¡ºåºä¸ºï¼š0ã€1ã€2ã€1ã€2ã€3ã€‚ ä¸‰ã€æ­£åˆ™è¡¨è¾¾å¼ã€NFAä»¥åŠDFAä¹‹é—´çš„å…³è”è¿™é‡Œé¦–å…ˆæˆ‘ä»¬å°†æ­£åˆ™è¡¨è¾¾å¼è½¬å˜ä¸ºæŽ¥å—ç›¸åŒè¯­è¨€çš„NFAã€‚ç„¶åŽä»‹ç»å¦‚ä½•å°†NFAè½¬å˜ä¸ºDFAã€‚è¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªç²—ç•¥çš„æ–¹å¼å°†æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºNFAå’ŒDFAçš„æ–¹æ¡ˆã€‚ æ­£åˆ™è¡¨è¾¾æž„é€ NFAçš„è§„åˆ™é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æž„é€ NFAä¸»è¦åˆ†ä¸ºå…­ç§æƒ…å†µã€‚åœ¨ä¸‹é¢æ¯ä¸€ä¸ªæƒ…å†µä¸­ï¼Œæˆ‘ä»¬éƒ½æœ‰æå‡ºçŠ¶æ€iå’ŒçŠ¶æ€fæ˜¯å¦ä¸ºæ–°çŠ¶æ€ã€‚æŒ‡å‡ºçš„æ„ä¹‰åœ¨äºŽæˆ‘ä»¬éœ€è¦æ˜Žç¡®æ–°æž„å»ºNFAæ—¶å‡ºçŽ°çš„çŠ¶æ€æ˜¯å¦ä¸ºåŽŸå„ä¸ªNFAä¸­å·²æœ‰çŠ¶æ€ï¼Œè¿˜æ˜¯éœ€è¦æˆ‘ä»¬åŽ»æ–°å¢žä¸€ä¸ªçŠ¶æ€ã€‚æ¯”å¦‚åœ¨è¿žæŽ¥è¿ç®—ä¸­å‡ºçŽ°çš„çŠ¶æ€iå’Œfå¹¶éžæ–°çŠ¶æ€ï¼Œè€Œæ˜¯å·²æœ‰çŠ¶æ€çš„ç‰¹æ®ŠçŠ¶æ€ï¼š è§„åˆ™1ã€ç©ºå­—ç¬¦Îµè¡¨è¾¾å¼ï¼›å¯¹äºŽè¡¨è¾¾å¼Îµï¼Œæž„é€ ä¸‹é¢çš„NFAè¿™é‡Œiæ˜¯ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œä¹Ÿæ˜¯NFAçš„å¼€å§‹çŠ¶æ€ï¼›fæ˜¯å¦ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œä¹Ÿè¡¨ç¤ºNFAçš„æŽ¥å—çŠ¶æ€ è§„åˆ™2ã€å­—æ¯è¡¨ä¸­å­è¡¨è¾¾å¼ï¼›è¿™é‡ŒçŠ¶æ€iå’ŒçŠ¶æ€fæ˜¯æ–°çŠ¶æ€ è§„åˆ™3ã€æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å¹¶è¿ç®—ï¼›å‡è®¾æ­£åˆ™è¡¨è¾¾å¼så’Œtå¯¹åº”çš„NFAä¸ºN(s)å’ŒN(t)ï¼Œr = s|tçš„NFAä¸ºN(r)ã€‚è¿™é‡ŒçŠ¶æ€iå’ŒçŠ¶æ€fæ˜¯æ–°çŠ¶æ€ï¼šå› æ­¤ä»ŽçŠ¶æ€iåˆ°çŠ¶æ€fçš„ä»»ä½•è·¯å¾„è¦ä¹ˆåªé€šè¿‡N(s)ï¼Œè¦ä¹ˆåªé€šè¿‡N(t)ã€‚ä¸”ç¦»å¼€iæˆ–è¿›å…¥fçš„Îµè½¬æ¢éƒ½ä¸ä¼šæ”¹å˜è·¯å¾„ä¸Šçš„æ ‡å·ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ¤å®š N(r)è¯†åˆ« L(r) = L(s) âˆª L(t) ã€‚ è§„åˆ™4ã€æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è¿žæŽ¥è¿ç®—ï¼›åŒæ ·çš„ï¼Œå‡è®¾æ­£åˆ™è¡¨è¾¾å¼så’Œtå¯¹åº”çš„NFAä¸ºN(s)å’ŒN(t)ï¼Œr = st ã€‚å¯¹åº”çš„NFAä¸ºï¼šè¿™ä¸ªæƒ…å½¢ä¸‹çš„çŠ¶æ€iå’ŒçŠ¶æ€få¹¶éžæ–°å¼•å…¥çš„çŠ¶æ€ï¼Œè€Œæ˜¯åŽŸæœ‰æ­£åˆ™è¡¨è¾¾å¼så’Œtä¸­å·²æœ‰çš„çŠ¶æ€ã€‚ è§„åˆ™5ã€æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„é—­åŒ…è¿ç®—ï¼›è¿™é‡Œå‡è®¾æ­£åˆ™è¡¨è¾¾å¼ r = s*ï¼ŒN(s)è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼så¯¹åº”çš„NFAã€‚å› æ­¤é—­åŒ…è¿ç®—å¾—åˆ°çš„NFAä¸ºï¼šè¿™é‡ŒçŠ¶æ€iå’ŒçŠ¶æ€féƒ½æ˜¯æ–°å¼•å…¥çš„çŠ¶æ€ã€‚ è§„åˆ™6ã€æ‹¬å·è¡¨è¾¾å¼r = (s) å…¶NFAæ˜¯å®Œå…¨ç›¸åŒçš„ï¼› å› æ­¤ åªæœ‰åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„è¿žæŽ¥è¿ç®—å’Œæ‹¬å·å­˜åœ¨æ—¶ï¼Œæ‰ä¸ä¼šå¼•å…¥æ–°çš„çŠ¶æ€ ã€‚N(r)çš„çŠ¶æ€æ•°æœ€å¤šä¸ºrä¸­å‡ºçŽ°çš„è¿ç®—ç¬¦å’Œè¿ç®—åˆ†é‡æ€»æ•°çš„ä¸¤å€ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸€ä¸ªæž„é€ æ­¥éª¤æœ€æ¯’åªå¼•å…¥ä¸¤ä¸ªæ–°çŠ¶æ€ã€‚ æ­£åˆ™è¡¨è¾¾å¼æž„é€ NFAå®žä¾‹çŽ°åœ¨æˆ‘ä»¬è¿ç”¨ä¸Šé¢æåˆ°çš„è§„åˆ™ï¼Œæ¥å°†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºå¯¹åº”çš„NFAã€‚å°†æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºNFAçš„ç®—æ³•æ˜¯è¯­æ³•åˆ¶å¯¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š æ²¿ç€æ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•åˆ†æžæ ‘ è‡ªåº•å‘ä¸Š é€’å½’çš„è¿›è¡Œã€‚ ä¸‹é¢å…³äºŽè¯­æ³•åˆ†æžæ ‘å®šä¹‰éƒ¨åˆ†å¯ä»¥é€‰è¯»ï¼Œç”±äºŽä¼šç”¨åˆ°å¾ˆå¤šä¸“ä¸šåè¯ï¼Œæ­¤æ—¶å¤§å¯ä¸å¿…åŽ»ç»†ç©¶è¯­æ³•åˆ†æžæ ‘ï¼Œå› ä¸ºå¯¹äºŽæˆ‘æ¥è¯´ç†è§£ä¸‹æ–‡å¹¶ä¸æ˜¯å¿…é¡»éœ€è¦è¿™äº›çŸ¥è¯†ç‚¹ã€‚ä½†ä¸ºäº†è¡Œæ–‡çš„å‡†ç¡®æ€§ï¼Œæˆ‘å°†ä¸‹é¢è¦ç”¨çš„è¯­æ³•åˆ†æžæ ‘çš„å®šä¹‰å…ˆåˆ—å‡ºæ¥ã€‚è¯­æ³•åˆ†æžæ ‘ç”¨å›¾å½¢æ–¹å¼å±•ç¤ºäº†ä»Žæ–‡æ³•çš„å¼€å§‹ç¬¦å·æŽ¨å¯¼å‡ºç›¸åº”è¯­è¨€ä¸­ç¬¦å·ä¸²çš„è¿‡ç¨‹ã€‚ç»™å®šä¸€ä¸ªä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼Œè¯¥æ–‡æ³•çš„è¯­æ³•åˆ†æžæ ‘å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š1ï¼‰ã€æ ¹èŠ‚ç‚¹çš„æ ‡å·ä¸ºæ–‡æ³•çš„å¼€å§‹ç¬¦å·ï¼ˆå¤§ä½“ä¸Šä¸ºæ–‡æ³•çš„ç¬¬ä¸€ä¸ªäº§ç”Ÿå¼çš„é¦–ä¸ªç¬¦å·ï¼‰ï¼›2ï¼‰ã€æ¯ä¸ªå¶å­ç»“ç‚¹çš„æ ‡å·ä¸ºä¸€ä¸ªç»ˆç»“ç¬¦æˆ–è€…ç©ºÎµï¼ˆå…·ä½“å­—æ¯è¡¨ä¸­çš„ç¬¦å·ï¼Œç²—ç•¥æ¥çœ‹å®ƒçš„å¶å­ç»“ç‚¹ä»Žå·¦åˆ°å³ç»„æˆäº†æœ€ç»ˆçš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼›3ï¼‰ã€æ¯ä¸ªå†…éƒ¨ç»“ç‚¹çš„æ ‡å·ä¸ºä¸€ä¸ªéžç»ˆç»“ç¬¦ï¼ˆå¯ä»¥ç®€å•ç†è§£ä¸ºè¯¥ç¬¦å·è¿˜å­˜åœ¨äº§ç”Ÿå¼è¿˜å¯ä»¥å¯ä»¥æŽ¨å¯¼å‡ºç»ˆç»“ç¬¦å·ï¼‰ã€‚4ï¼‰ã€å¯¹äºŽäº§ç”Ÿå¼A-&gt;XYZï¼Œå¯¹äºŽX, Y ,Zæ¥è¯´æ—¢å¯ä»¥æ˜¯ç»ˆç»“ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯éžç»ˆç»“ç¬¦ã€‚ å¯¹äºŽæ­£åˆ™è¡¨è¾¾å¼ (a|b)*abb ï¼Œæˆ‘ä»¬æž„é€ å¤„å¯¹åº”çš„è¯­æ³•åˆ†æžæ ‘ï¼š 1ï¼‰ã€æ—¢ç„¶æ˜¯è‡ªåº•å‘ä¸Šçš„ï¼Œé‚£é¦–å…ˆè‚¯å®šæ˜¯çœ‹å­è¡¨è¾¾å¼aå’Œbã€‚è¿ç”¨è§„åˆ™1ï¼Œå³å¯å¾—åˆ°ä¸¤ä¸ªNFAï¼š 2ï¼‰ã€çŽ°åœ¨çš„å¶å­èŠ‚ç‚¹ä¸ºå¹¶è¿ç®—ç¬¦ï¼Œæ­¤æ—¶è¿ç”¨è§„åˆ™3ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ–°å¼•å…¥ä¸¤ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”åŽŸæœ‰NFAä¸­çš„æŽ¥å—çŠ¶æ€è¦å˜ä¸ºéžæŽ¥å—çŠ¶æ€ï¼š å¯¹äºŽå¸¦æœ‰æ‹¬å·çš„æ­£åˆ™è¡¨è¾¾å¼è€Œè¨€ï¼Œæˆ‘ä»¬ä»Žè§„åˆ™6å¯çŸ¥ï¼Œæ‹¬å·è¿ç®—ç¬¦ä¸ä¼šæ”¹å˜å½“å‰çš„NFAã€‚å› æ­¤å½“é‡åˆ°æ‹¬å·æ—¶NFAä¸æ”¹å˜ã€‚ 3ï¼‰ã€å¯¹äºŽé—­åŒ…è¿ç®—ç¬¦æ¥è¯´ï¼ŒåŒæ ·ä¼šå¼•å…¥ä¸¤ä¸ªæ–°çŠ¶æ€ï¼š 4ï¼‰ã€æœ€åŽæ˜¯3ä¸ªè¿žæŽ¥æ“ä½œï¼Œè¿žæŽ¥çš„å­è¡¨è¾¾å¼åˆ†åˆ«æ˜¯aã€bã€bã€‚å› æ­¤å°†å®ƒä»¬è¿žæŽ¥ä¹‹åŽå¾—åˆ°çš„æœ€ç»ˆNFAå¦‚ä¸‹ï¼š NFAåˆ°DFAçš„è½¬æ¢â€”â€”å­é›†æž„é€ æ³•çŽ°åœ¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿä»Žæ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºNFAäº†ï¼Œé‚£å¦‚æžœæˆ‘ä»¬è¦æŠŠæ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸ºDFAå‘¢ï¼Ÿè¿™é‡Œå…ˆä»‹ç»ç”¨NFAè½¬æ¢ä¸ºDFAçš„æ–¹å¼ï¼ŒåŽç»­ä¼šå°†é€šè¿‡æŠ½è±¡è¯­æ³•æ ‘æ­é…firstposï¼Œlastposå’Œfollowposç›´æŽ¥ä»Žæ­£åˆ™è¡¨è¾¾å¼æž„é€ DFAã€‚çŽ°åœ¨æˆ‘ä»¬å…ˆé€šè¿‡å­é›†æž„é€ æ³•æ¥è®²NFAè½¬æ¢ä¸ºDFAã€‚ å­é›†æž„é€ æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡NFAä¸ºDFAæž„é€ è½¬æ¢è¡¨ã€‚ DFAçš„æ¯ä¸€ä¸ªçŠ¶æ€æ˜¯ä¸€ä¸ªNFAçš„çŠ¶æ€é›†åˆã€‚ DFAçš„çŠ¶æ€æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¯¥é›†åˆé‡Œé¢åŒ…å«çš„æ˜¯å¯¹åº”NFAçš„çŠ¶æ€ã€‚ æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°åœ¨å°†æ­£åˆ™è¡¨è¾¾å¼æž„é€ æˆNFAæ—¶ï¼ŒNFAé‡Œé¢å­˜åœ¨å¾ˆå¤šç©ºè½¬æ¢ã€‚æ‰€ä»¥å½“åŠ¡ä¹‹æ€¥æ˜¯å¦‚æžœæ­£ç¡®åœ°å¤„ç†NFAä¸Šé¢çš„ç©ºè½¬æ¢ã€‚ä¸‹é¢å±•ç¤ºäº†NFAçš„çŠ¶æ€é›†åˆä¸Šçš„ç›¸å…³æ“ä½œï¼š åºå· æ“ä½œ è§£é‡Š 1 Îµ-closure(s) æŒ‡çš„æ˜¯ä»ŽNFAçš„çŠ¶æ€så¼€å§‹ï¼Œå¯ä»¥é€šè¿‡Îµè½¬æ¢å¾—åˆ°çš„çŠ¶æ€é›†åˆ 2 Îµ-closure(T) æŒ‡çš„æ˜¯é›†åˆTä¸­çš„æŸä¸ªNFAçŠ¶æ€ï¼Œè¯¥çŠ¶æ€åªé€šè¿‡Îµè½¬æ¢å¾—åˆ°çš„çŠ¶æ€é›†åˆ 3 move(T,a) å³é›†åˆTä¸­çš„çŠ¶æ€é€šè¿‡è½¬æ¢aå¾—åˆ°çš„çŠ¶æ€é›†åˆ å‡è®¾s0æ˜¯NFAçš„å¼€å§‹çŠ¶æ€ï¼Œé‚£ä¹ˆå¯¹åº”DFAçš„å¼€å§‹çŠ¶æ€å°±æ˜¯ Îµ-closure(s0) ã€‚è€ŒDFAçš„æŽ¥å—çŠ¶æ€æ˜¯è‡³å°‘åŒ…å«NFAæŽ¥å—çŠ¶æ€çš„é›†åˆã€‚ æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚å¾—åˆ°çš„NFAï¼ŒçŽ°åœ¨æˆ‘ä»¬å°†è¯¥NFAè½¬æ¢ä¸ºDFAï¼š 1ã€å¯¹äºŽå¼€å§‹çŠ¶æ€0ï¼Œæˆ‘ä»¬ä½¿ç”¨æ“ä½œ1ï¼ˆä¸Šè¡¨ä¸­åºå·ä¸º1çš„æ“ä½œï¼Œä¸‹æ–‡ç±»ä¼¼ï¼‰ï¼Œå³çŠ¶æ€0é€šè¿‡Îµç©ºè½¬æ¢å¯ä»¥å¾—åˆ°çš„çŠ¶æ€é›†åˆä¸ºï¼š {0, 1, 2, 3, 7}ã€‚è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå› ä¸ºè·¯å¾„å¯ä»¥ä¸åŒ…å«è¾¹ï¼Œæ‰€ä»¥çŠ¶æ€0ä¹Ÿæ˜¯å¯ä»¥ä»Žå®ƒè‡ªèº«å‡ºå‘ç»è¿‡æ ‡å·Îµåˆ°è¾¾çš„çŠ¶æ€ã€‚ 2ã€æˆ‘ä»¬å¯¹ç¬¬ä¸€æ­¥å¾—åˆ°çš„é›†åˆæ±‚è½¬æ¢açš„é›†åˆã€‚çŽ°åœ¨æˆ‘ä»¬çœ‹çŠ¶æ€é›†åˆ{0, 1, 2, 3, 7}é€šè¿‡è½¬æ¢aï¼ˆå³åº”ç”¨æ“ä½œ3ï¼‰å¯ä»¥å¾—åˆ°çš„çŠ¶æ€é›†åˆ{3,8}ã€‚æ­¤æ—¶æˆ‘ä»¬å¯¹é›†åˆ{3,8}åº”ç”¨æ“ä½œ2å¾—åˆ°çš„é›†åˆä¸º{1, 2, 4, 6, 7}ï¼š åœ¨é›†åˆ{0, 1, 2, 3, 7}é‡Œé¢ï¼Œåªæœ‰çŠ¶æ€2å’ŒçŠ¶æ€7å¯ä»¥é€šè¿‡aè½¬æ¢å¾—åˆ°çš„é›†åˆæ˜¯{3, 8}ã€‚æ­¤æ—¶æŸ¥çœ‹çŠ¶æ€3é€šè¿‡ç©ºè½¬æ¢å¾—åˆ°é›†åˆä¸ºï¼šaã€s3 â€”Îµâ€”&gt; s6 â€”Îµâ€”&gt; s7;bã€s3 â€”Îµâ€”&gt; s6 â€”Îµâ€”&gt; s1 â€”Îµâ€”&gt; s2;cã€s3 â€”Îµâ€”&gt; s6 â€”Îµâ€”&gt; s1 â€”Îµâ€”&gt; s4;å› æ­¤æœ€ç»ˆçš„é›†åˆä¸º {1,2,3,4,6,7,8}ã€‚ 3ã€åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸€æ­¥å¾—åˆ°çš„é›†åˆæ±‚è½¬æ¢bçš„é›†åˆã€‚çŽ°åœ¨æˆ‘ä»¬çœ‹çŠ¶æ€é›†åˆ{0, 1, 2, 3, 7}é€šè¿‡è½¬æ¢bå¯ä»¥å¾—åˆ°çš„çŠ¶æ€é›†åˆ{5}ã€‚ç„¶åŽé›†åˆ{5}é€šè¿‡ç©ºè½¬æ¢å¯ä»¥å¾—åˆ°çš„é›†åˆä¸º{1, 2, 4, 6, 7} å…·ä½“çš„åˆ†æžå’Œç¬¬2æ­¥ç±»ä¼¼ã€‚ è¿™æ ·æˆ‘ä»¬å¯¹åŽç»­å‡ºçŽ°çš„æ¯ä¸€ä¸ªçŠ¶æ€éƒ½æ‰§è¡Œå¯¹åº”çš„è½¬æ¢aã€è½¬æ¢bã€‚æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªçŠ¶æ€è½¬æ¢è¡¨ï¼š NFAçŠ¶æ€ DFAçŠ¶æ€ a b {0,1,2,4,7} A B C {1,2,3,4,6,7,8} B B D {1,2,4,5,6,7} C B C {1,2,4,5,6,7,9} D B E {1,2,4,5,6,7,10} E B C æˆ‘ä»¬å‰é¢è¯´è¿‡NFAå¼€å§‹çŠ¶æ€é€šè¿‡Îµè½¬æ¢å¾—åˆ°é›†åˆä¸ºå¼€å§‹çŠ¶æ€ï¼Œå› æ­¤ä¸Šè¡¨ä¸­å¯¹åº”DFAå¯¹åº”çš„çŠ¶æ€ä¸ºAã€‚è€ŒNFAçŠ¶æ€é›†åˆä¸­åŒ…å«æœ‰æŽ¥å—çŠ¶æ€å¯¹åº”DFAçš„çŠ¶æ€Eï¼Œå› æ­¤Eä¸ºDFAçš„æŽ¥å—çŠ¶æ€ã€‚å¯¹åº”çš„DFAå¦‚ä¸‹ï¼š ä¸‹é¢æ˜¯å¯¹åº”ç®—æ³•çš„ä¼ªä»£ç æè¿°ã€‚æ¨¡æ‹Ÿä¸€ä¸ªNFAçš„æ‰§è¡Œï¼ˆå³NFAè½¬æ¢ä¸ºDFAï¼‰ aï¼‰ã€è¾“å…¥éƒ¨åˆ†ï¼šä¸€ä¸ªä»¥eofç»“æŸçš„è¾“å…¥ä¸²xï¼›ä¸€ä¸ªNFA Nï¼Œå®ƒçš„å¼€å§‹çŠ¶æ€ä¸ºs0ï¼ŒæŽ¥å—çŠ¶æ€ä¸ºFï¼Œè½¬æ¢å‡½æ•°moveï¼›bï¼‰ã€è¾“å‡ºï¼šå¦‚æžœNFA NæŽ¥å—ç¬¦å·ä¸²xï¼Œåˆ™è¿”å›žyesï¼Œå¦åˆ™è¿”å›žnoï¼› 12345678910S = Îµ-closure(s0); /// é¦–å…ˆæ±‚å‡ºå¼€å§‹çŠ¶æ€ç»è¿‡ç©ºè½¬æ¢ä¹‹åŽçš„é›†åˆï¼Œå³ä¸Šé¢çš„ç¬¬1æ­¥c = nextChar(); /// è¯»å–ä¸‹ä¸€ä¸ªè¾“å…¥å­—ç¬¦while(c != eof) &#123; /// é¦–å…ˆè®¡ç®—å½“å‰é›†åˆSç»è¿‡è½¬æ¢cä¹‹åŽå¾—åˆ°é›†åˆï¼Œç„¶åŽç”¨è¯¥é›†åˆè¿›è¡Œç©ºè½¬æ¢ã€‚å¾—åˆ°cè½¬æ¢ä¹‹åŽçœŸæ­£çš„å…ƒç´ é›†åˆã€‚ /// å³ä¸Šé¢æåˆ°çš„ç¬¬2ã€3æ­¥ S = Îµ-closure(move(S,c)); c = nextChar();&#125;if (S âˆ© F != âˆ…) return YES;else retnru NO; å››ã€è¯æ³•åˆ†æžå™¨ç”Ÿæˆå·¥å…·çš„è®¾è®¡è¯æ³•åˆ†æžå™¨çš„ç¨‹åºåŒ…å«ä¸€ä¸ªå›ºå®šæ¨¡æ‹Ÿè‡ªåŠ¨æœºçš„ç¨‹åºï¼ˆå…ˆä¸æŒ‡å®šæ˜¯NFAï¼Œè¿˜æ˜¯DFAï¼‰ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªlexç¨‹åºè½¬æ¢æˆè‡ªåŠ¨æœºçš„ç»“æž„ï¼š è¿™é‡Œæåˆ°äº†å‰é¢ä»‹ç»çš„å‡ ä¸ªæ¦‚å¿µï¼Œè¿™å„¿ç®€è¦è¯´æ˜Žä¸€ä¸‹ã€‚è¾“å…¥ç¼“å†²åŒºå¯ä»¥è®©æˆ‘ä»¬ä¾æ¬¡è¯»å…¥å¤šä¸ªå­—ç¬¦åˆ°ç¼“å†²åŒºä¸­ï¼ˆè¿™ä¸ªå¤§è‡´ä¸º4096å­—èŠ‚ï¼‰ï¼Œè€Œä¸æ˜¯æ¯è¯»å…¥ä¸€ä¸ªå­—ç¬¦å°±è°ƒç”¨ä¸€æ¬¡ç³»ç»Ÿè¯»å–å‘½ä»¤ï¼›è¯ç´ ä½œä¸ºåŒ¹é…äº†æŸä¸ªæ¨¡å¼è¯æ³•å•å…ƒçš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚è¯ç´ ä¸ºnameè¯æ³•å•å…ƒidï¼›æŒ‡é’ˆlexemeBeginæŒ‡å‘å½“å‰è¯ç´ çš„å¼€å§‹ä½ç½®å¤„ï¼›æŒ‡é’ˆforwardçš„ä½œç”¨æ˜¯ä¸€ç›´å‘å‰æ‰«æï¼Œç›´åˆ°åŒ¹é…æŸä¸ªæ¨¡å¼ä¸ºæ­¢ã€‚ ä¸‹è¡¨ä¸­æœ‰ä¸‰ä¸ªæ¨¡å¼ï¼Œå·²ç»å¯¹åº”æ¨¡å¼çš„åŠ¨ä½œã€‚è¿™ä¸ªè¡¨æŒ‡æ˜Žäº†è¯æ³•åˆ†æžå™¨éœ€è¦çš„æ¨¡å¼ï¼Œå·²ç»åŒ¹é…åˆ°å¯¹åº”æ¨¡å¼ä¹‹åŽçš„åŠ¨ä½œï¼š åºå· æ¨¡å¼ åŠ¨ä½œ P1 a A1 P2 abb A2 P3 a*b+ A3 è¿™é‡Œçš„åŠ¨ä½œæ˜¯æŒ‡åŒ¹é…åˆ°å¯¹åº”æ¨¡å¼ä¹‹åŽéœ€è¦åšçš„ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚åŒ¹é…åˆ°è¯æ³•å•å…ƒidä¹‹åŽçš„åŠ¨ä½œæ˜¯ç”Ÿæˆå¯¹åº”çš„æ ‡è¯†ç¬¦ï¼ŒèŽ·å–å¯¹åº”è¯æ³•å•å…ƒå¹¶è¿”å›žç»™è¯­æ³•åˆ†æžå™¨ï¼›åŒ¹é…åˆ°ç©ºç™½ç¬¦ä¹‹åŽæˆ‘ä»¬å°†è¾“å…¥å›žé€€åˆ°éžç©ºç™½ç¬¦çš„å¼€å¤´ï¼Œè€Œä¸”ä¸å‘è¯­æ³•åˆ†æžå™¨è¿”å›žä»»ä½•è¯æ³•å•å…ƒã€‚ç­‰ç­‰ã€‚ ä¸Šè¡¨ä¸­æ»¡è¶³æ¨¡å¼P2å’Œä¹ŸåŒæ—¶æ»¡è¶³æ¨¡å¼P3ï¼Œå½“å‡ºçŽ°è¿™ç§å†²çªæ—¶æˆ‘ä»¬é¦–å…ˆé€‰æ‹©P2ã€‚è¿™æ˜¯å› ä¸ºåœ¨è§£å†³å†²çªæ—¶ ä»¥å…ˆå‡ºçŽ°çš„æ¨¡å¼ä¸ºä¸» (P2å…ˆäºŽP3åˆ—å‡º)ã€‚ ä¸‹é¢åˆ—å‡ºä¸‰ä¸ªæ¨¡å¼å¯¹åº”çš„NFAï¼š ä»¥åŠå°†ä¸Šé¢ä¸‰ä¸ªåˆå¹¶ä¹‹åŽå¾—åˆ°çš„NFAï¼š çŽ°åœ¨å¦‚æžœè¯æ³•åˆ†æžå™¨æ¨¡æ‹Ÿäº†ä¸Šå›¾çš„NFAï¼Œé‚£ä¹ˆè¯¥åˆ†æžå™¨å¿…é¡»ä»Žå®ƒçš„è¾“å…¥ä¸­lexemeBeginæŒ‡å‘çš„ä½ç½®å¼€å§‹è¯»å–è¾“å…¥ï¼Œå¹¶ç§»åŠ¨forwardæŒ‡é’ˆã€‚ç„¶åŽæ ¹æ®å­é›†æž„é€ æ³•æ¥èŽ·å–å½“å‰çš„çŠ¶æ€é›†åˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œå¹¶ä¸æ˜¯ä½¿ç”¨å­é›†æž„é€ æ³•å°†NFAè½¬æ¢ä¸ºDFAï¼Œè€Œåªæ˜¯ç®€å•åœ°æƒ³çŸ¥é“æŸä¸€çŠ¶æ€é›†åˆé€šè¿‡å­é›†æž„é€ æ³•ä¹‹åŽå¾—åˆ°çš„æ–°çš„çŠ¶æ€é›†åˆï¼ˆä¸è¿‡åœ¨ä¸‹é¢çš„â€œè¯æ³•åˆ†æžå™¨ä½¿ç”¨çš„DFAâ€ä¸€èŠ‚ä¼šä½¿ç”¨è¯¥è¡¨ï¼Œè¯¥è¡¨çš„ç¬¬äºŒåˆ—å°±æ˜¯å¯¹åº”DFAçš„çŠ¶æ€ï¼‰ã€‚ NFAçŠ¶æ€ çŠ¶æ€ç¼–å·ï¼ˆDFAçŠ¶æ€ï¼‰ a b {0,1,3,7} A B C {2,4,7} B D E {8} C âˆ… C {7} D D C {5,8} E âˆ… F {6,8} F âˆ… C åœ¨ä¸Šè¡¨ä¸­ï¼Œæœ€ç»ˆä¼šè¾¾åˆ°ä¸€ä¸ªæ²¡æœ‰åŽç»­çŠ¶æ€çš„è¾“å…¥ç‚¹ã€‚æ­¤æ—¶ä¸å¯èƒ½æœ‰ä»»ä½•æ›´é•¿çš„è¾“å…¥å‰ç¼€ä½¿å¾—è¿™ä¸ªNFAåˆ°è¾¾æŸä¸ªæŽ¥å—çŠ¶æ€ï¼Œæ­¤åŽçš„çŠ¶æ€å°†ä¸€ç›´ä¸ºç©ºã€‚æ¯”å¦‚ä¸Šè¡¨ä¸­çŠ¶æ€ç¼–å·ä¸ºCã€Eã€Fä¹‹åŽå†ç»§ç»­è¾“å…¥aï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ²¡æœ‰ä»»ä½•çš„åŽç»­çŠ¶æ€ã€‚ ä¸Šå›¾ä¸­æˆ‘ä»¬çš„è¾“å…¥å­—ç¬¦ä¸²ä»¥ aaba å¼€å¤´ã€‚å½“æˆ‘ä»¬åœ¨è¯»å…¥ç¬¬å››ä¸ªç¬¦å· a ä¹‹åŽï¼Œæ­¤æ—¶æˆ‘ä»¬å¤„äºŽä¸€ä¸ªç©ºçŠ¶æ€é›†åˆä¸­ï¼ˆä¹Ÿå¯ä»¥ä»Žä¸Šè¡¨ä¸­ç¬¬ä¸‰è¡Œå¾—å‡ºï¼‰ã€‚ è¿™æ—¶å€™æˆ‘ä»¬å°±æ²¿ç€çŠ¶æ€é›†çš„é¡ºåºå¾€å›žæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŽ¥å—çŠ¶æ€çš„é›†åˆä¸ºæ­¢ ã€‚ å¦‚æžœé›†åˆä¸­å­˜åœ¨å¤šä¸ªæŽ¥å—çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±é€‰æ‹©æ¨¡å¼é å‰ç›¸å¯¹åº”çš„æŽ¥å—çŠ¶æ€ã€‚æ­¤æ—¶å°†forwardæŒ‡é’ˆç§»åŠ¨åˆ°è¯ç´ çš„æœ«å°¾ï¼ŒåŒæ—¶æ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œï¼ˆå‰é¢è¡¨æ ¼ä¸­çš„A1â€¦A3ï¼‰ã€‚ åœ¨è¿™é‡Œè¡¨æ˜Žè¾“å…¥ä¸²aabaè¢«æ¨¡å¼ a*b+ åŒ¹é…ã€‚ç„¶åŽæ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œA3ã€‚ è¯æ³•åˆ†æžå™¨ä½¿ç”¨çš„DFAæ ¹æ®å‰é¢çš„è½¬æ¢è¡¨ï¼Œæˆ‘ä»¬æž„é€ å‡ºå¯¹åº”çš„DFAï¼š å¯¹äºŽçŠ¶æ€{6,8}è€Œè¨€æœ‰ä¸¤ä¸ªæŽ¥å—çŠ¶æ€ï¼Œåˆ†åˆ«å¯¹åº”äºŽæ¨¡å¼ abb å’Œ ab+ ã€‚ç”±äºŽå‰ä¸€ä¸ªæ¨¡å¼å…ˆè¢«åˆ—å‡ºï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹© *abb ä½œä¸ºçŠ¶æ€{6,8}æ‰€å…³è”çš„æ¨¡å¼ã€‚ åœ¨è¯æ³•åˆ†æžå™¨ä¸­ï¼Œä½¿ç”¨DFAå’Œä½¿ç”¨NFAçš„æ–¹æ³•ç›¸ä¼¼ã€‚æ¨¡æ‹ŸDFAè¿è¡Œï¼Œç›´åˆ°æŸä¸€ç‚¹ä¸Šæ²¡æœ‰åŽç»­çŠ¶æ€ä¸ºæ­¢ã€‚è¿™ç§æ—¶å€™æˆ‘ä»¬å°±æ²¿ç€é¡ºåºå¾€å›žæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŽ¥å—çŠ¶æ€çš„é›†åˆä¸ºæ­¢ã€‚ å‘å‰çœ‹è¿ç®—ç¬¦æœ‰æ—¶å€™ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®åœ°è¯†åˆ«æŸä¸ªè¯æ³•å•å…ƒçš„å®žé™…è¯ç´ ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡æ˜Ž è¯¥è¯æ³•å•å…ƒæ¨¡å¼r1ä¹‹åŽå¿…é¡»è·Ÿç€æ¨¡å¼r2 ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶è¡¨ç¤ºä¸º â€œr1/r2â€œ ã€‚å®žé™…ä¸Šåœ¨å°†r1/r2è½¬æ¢ä¸ºå¯¹åº”çš„NFAæ—¶ï¼Œæˆ‘ä»¬æŠŠ/çœ‹æˆÎµï¼ˆä¸ä¼šåŽ»è¾“å…¥ä¸­æŸ¥æ‰¾/ï¼‰ã€‚ ä¾‹å¦‚ï¼š ä¸Šå›¾æ˜¯è¯æ³•å•å…ƒIFçš„æ¨¡å¼ï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸­æˆ‘ä»¬ä½¿ç”¨äº†å‘å‰çœ‹è¿ç®—ç¬¦ã€‚çŠ¶æ€6è¡¨æ˜Žäº†å…³é”®å­—IFçš„å‡ºçŽ°ï¼Œå› ä¸ºå¦‚æžœåªæ˜¯å•å•çš„ç©ºè½¬æ¢ä¹‹å‰çš„æ¨¡å¼ï¼ˆr1ï¼‰å°†æ— æ³•å‡†ç¡®çš„è¯†åˆ«æ˜¯å…³é”®å­—ifï¼Œè¿˜æ˜¯ä¸€ä¸ªå¸¦æœ‰ifå‰ç¼€çš„æ ‡è¯†ç¬¦ã€‚å½“è¿›å…¥äº†çŠ¶æ€6æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‘å›žæ‰«æåˆ°æœ€æ™šå‡ºçŽ°çš„çŠ¶æ€2ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰¾åˆ°äº†å¯¹åº”è¯æ³•å•å…ƒçš„è¯ç´ ã€‚ æ€»ç»“åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¤è¯†åˆ°äº†NFAï¼ˆä¸ç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼‰å’ŒDFAï¼ˆç¡®å®šçš„æœ‰ç©·è‡ªåŠ¨æœºï¼‰ï¼Œä»¥åŠå®ƒä»¬ä¸ŽçŠ¶æ€è½¬æ¢å›¾ä¹‹é—´çš„å·®å¼‚ã€‚DFAå’ŒNFAæœ€æ˜Žæ˜¾çš„å·®å¼‚èŽ«è¿‡äºŽå¯¹äºŽæ¯ä¸€ä¸ªçŠ¶æ€sï¼Œå¯¹äºŽåŒä¸€ä¸ªè¾“å…¥ç¬¦å·è€Œè¨€æœ‰ä¸”åªæœ‰ä¸€æ¡ç¦»å¼€è¯¥çŠ¶æ€çš„è¾¹ã€‚å…¶æ¬¡æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æž„é€ NFAï¼Œå¤§è‡´çš„æ“ä½œæœ‰è¿žæŽ¥ã€å¹¶ã€é—­åŒ…å’Œç®€å•çš„æ‹¬å·æ“ä½œæ“ä½œã€‚å…¶ä¸­å¹¶å’Œé—­åŒ…æ“ä½œä¼šå¼•å…¥æ–°çŠ¶æ€ï¼ˆä½¿ç”¨ç©ºè½¬æ¢è¿›è¡Œè¿žæŽ¥ï¼‰ã€‚ç„¶åŽæˆ‘ä»¬é€šè¿‡å­é›†æž„é€ æ³•å¯ä»¥å°†NFAè½¬æ¢ä¸ºå¯¹åº”çš„DFAã€‚å…¶ä¸­åŒ…æ‹¬æœ‰ä¸‰ç§æ“ä½œï¼Œåˆ†åˆ«æ˜¯ï¼šæŸä¸€æŒ‡å®šçŠ¶æ€çš„ç©ºè½¬æ¢ï¼›æŸä¸€æŒ‡å®šé›†åˆæ‰§è¡Œç©ºè½¬æ¢ï¼›æŸä¸€æŒ‡å®šé›†åˆæ‰§è¡Œç‰¹å®šè½¬æ¢aã€‚é€šè¿‡è¿™ä¸‰ç§æ“ä½œæˆ‘ä»¬æž„é€ å‡ºNFAå¯¹åº”DFAçš„è½¬æ¢è¡¨ã€‚æœ€åŽæˆ‘ä»¬äº†è§£äº†ä¸€ç‚¹è¯æ³•åˆ†æžå™¨ç”Ÿæˆå·¥å…·çš„è®¾è®¡ï¼Œä»¥åŠå‘å‰çœ‹è¿ç®—ç¬¦çš„ä½œç”¨ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è¯æ³•åˆ†æžâ€”â€”æ‰‹åŠ¨è¯æ³•å•å…ƒçš„è¯†åˆ«ï¼ˆçŠ¶æ€è½¬æ¢å›¾ã€KMPç®—æ³•ï¼‰]]></title>
      <url>%2F2019%2F10%2F28%2Fcompiler_stateGraph_kmp%2F</url>
      <content type="text"><![CDATA[åœ¨è¿™å„¿æˆ‘ä»¬å…ˆç”¨æ‰‹å·¥çš„æ–¹å¼å°†æ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºçš„æ¨¡å¼è½¬æ¢ä¸ºçŠ¶æ€è½¬æ¢å›¾ã€‚åœ¨ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šç”¨è‡ªåŠ¨åŒ–çš„æ–¹æ³•æž„é€ å¯¹åº”çš„è½¬æ¢å›¾ã€‚ 1ï¼‰ã€ç»“ç‚¹ï¼šçŠ¶æ€è½¬æ¢å›¾æœ‰ä¸€ç»„è¢«ç§°ä¸ºâ€œçŠ¶æ€â€çš„ç»“ç‚¹ï¼Œå®ƒè¡¨ç¤ºåœ¨æ‰«æè¿‡ç¨‹ï¼ˆå³è¯æ³•åˆ†æžå™¨æ‰«ææŒ‡å®šè¾“å…¥ä¸²ï¼Œå¯»æ‰¾æŒ‡å®šæ¨¡å¼è¯ç´ ï¼‰ä¸­å¯èƒ½å‡ºçŽ°çš„çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯lexemeBeginæŒ‡é’ˆå’ŒforwardæŒ‡é’ˆä¹‹é—´çš„æ‰€æœ‰çš„å­—ç¬¦ã€‚2ï¼‰ã€è¾¹ï¼šä»Žå›¾çš„ä¸€ä¸ªçŠ¶æ€æŒ‡å‘å¦ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯æ¡è¾¹çš„æ ‡å·åŒ…å«äº†ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦å·ã€‚å¦‚æžœæ‰¾åˆ°è¿™æ ·çš„ä¸€æ¡è¾¹ï¼Œå°±å°†forwardæŒ‡é’ˆå‰ç§»ï¼Œå¹¶è¿›å…¥è¯¥è¾¹æŒ‡å‘çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚3ï¼‰ã€å¼€å§‹çŠ¶æ€ï¼šä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„startã€‚4ï¼‰ã€æŽ¥æ”¶çŠ¶æ€æˆ–è€…æœ€ç»ˆçŠ¶æ€ï¼šè¯¥çŠ¶æ€è¡¨æ˜Žå·²ç»æ‰¾åˆ°äº†ä¸€ä¸ªè¯ç´ ã€‚ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­ä¸¤ä¸ªåœ†åœˆã€‚ æŽ¥æ”¶çŠ¶æ€é€šå¸¸æ˜¯ å‘è¯­æ³•åˆ†æžå™¨è¿”å›žä¸€ä¸ªè¯æ³•å•å…ƒå’Œç›¸å…³çš„å±žæ€§å€¼ ã€‚ 5ï¼‰ã€å›žé€€ðŸŒŸå·ï¼šä¸Šå›¾ä¸­æŽ¥å—çŠ¶æ€å³ä¸Šè§’çš„*å·ï¼Œè¡¨ç¤ºæˆ‘ä»¬è¯†åˆ«åˆ°çš„è¯ç´ å¹¶ä¸åŒ…å«ä½¿æˆ‘ä»¬åˆ°è¾¾æŽ¥å—çŠ¶æ€çš„ç¬¦å·ï¼ˆä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„no let/digè¾¹ï¼‰ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦å›žé€€forwardæŒ‡é’ˆåˆ°å€’æ•°ç¬¬äºŒä¸ªçŠ¶æ€ã€‚è¿™å…¶ä¸­å¯èƒ½ä¼šå›žé€€å¤šæ­¥ï¼Œæ‰€ä»¥è¿™é‡Œç”¨*å·æ¥è¡¨ç¤ºéœ€è¦å›žé€€ï¼› relopçŠ¶æ€è½¬æ¢å›¾æˆ‘ä»¬æ ¹æ®ä¸Šä¸€èŠ‚çš„relopè¯æ³•å•å…ƒï¼Œå·²ç»å¯¹åº”çš„å±žæ€§æ¥æž„é€ ä¸€ä¸ªrelopçš„çŠ¶æ€è½¬æ¢å›¾ è¯ç´  è¯æ³•å•å…ƒåå­— å±žæ€§å€¼ &lt; relop LT &gt; relop GT â€¦ â€¦ â€¦ != relop NE å…¶å®žå¯¹äºŽè¿™ä¸ªçŠ¶æ€è½¬æ¢å›¾æ¥è¯´ï¼Œæˆ‘åªç”»äº†å…¶ä¸­çš„æ¯”è¾ƒè¿ç®—ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦ã€‚å¯¹äºŽä½è¿ç®—ç¬¦ï¼ˆ&lt;&lt;å·¦ç§», &gt;&gt;å³ç§»ï¼‰å¹¶æ²¡ç”»å‡ºæ¥ã€‚è¿™é‡Œä¸»è¦æ˜¯æƒ³è¡¨è¾¾å„ä¸ªæŽ¥æ”¶çŠ¶æ€ï¼Œå’ŒforwardæŒ‡é’ˆå›žé€€çš„æ“ä½œã€‚ idï¼ˆæ ‡è¯†ç¬¦ï¼‰å’Œå…³é”®å­—çš„çŠ¶æ€è½¬æ¢å›¾ è¯æ³•å•å…ƒ æ¨¡å¼ letter [A-Za-z] id letter(letter , digit)* æ³¨ï¼šä¸Šè¡¨ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å°†é€—å·â€œ,â€æ›´æ”¹ä¸ºâ€|â€ã€‚å¯¹äºŽå…³é”®å­—æ¥è¯´ï¼Œå®ƒä»¬çœ‹èµ·æ¥å’Œæ ‡è¯†ç¬¦æ˜¯å¾ˆåƒçš„ã€‚ä½†å®ƒä»¬å¹¶ä¸æ˜¯æ ‡è¯†ç¬¦ã€‚ å¯¹äºŽå…³é”®å­—if/else/forç­‰ç­‰å…³é”®å­—ï¼Œæ ‡è¯†ç¬¦forearmåŒæ ·ä¹Ÿæ˜¯æ»¡è¶³ä¸Šè¯‰è½¬æ¢å›¾çš„ã€‚ ä¸ºäº†è§£å†³ä¸Šè¯‰é—®é¢˜ï¼Œç¼–è¯‘åŽŸç†ä¸­çš„å¤„ç†æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼š ï¼ˆ1ï¼‰ðŸ‘ðŸ‘ðŸ‘ã€åˆå§‹åŒ–æ—¶å°±å°†å„ä¸ªä¿ç•™å­—å¡«å…¥ç¬¦å·è¡¨ä¸­ï¼›ç¬¦å·è¡¨çš„æŸä¸ªå­—æ®µä¼šæŒ‡æ˜Žè¿™äº›ä¸²å¹¶ä¸æ˜¯æ™®é€šçš„æ ‡è¯†ç¬¦ï¼Œå¹¶æŒ‡å‡ºå…¶å¯¹åº”çš„è¯æ³•å•å…ƒã€‚å½“æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªæ ‡è¯†ç¬¦æ—¶ï¼Œå¦‚æžœè¯¥æ ‡è¯†ç¬¦å°šæœªå‡ºçŽ°åœ¨ç¬¦å·è¡¨ä¸­ï¼Œå°±ä¼šè°ƒç”¨ä¸Šå›¾ä¸­å‡ºçŽ°çš„installIDå°†æ­¤æ ‡è¯†ç¬¦æ”¾å…¥ç¬¦å·è¡¨ä¸­ï¼Œå¹¶è¿”å›žä¸€ä¸ªæŒ‡é’ˆï¼ˆè¯¥æŒ‡é’ˆæŒ‡å‘è¯ç´ å¯¹åº”çš„ç¬¦å·è¡¨æ¡ç›®ï¼‰ã€‚ ä»»ä½•åœ¨è¯æ³•åˆ†æžæ—¶ä¸åœ¨ç¬¦å·è¡¨ä¸­çš„æ ‡è¯†ç¬¦éƒ½ä¸å¯èƒ½æ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œå› æ­¤å®ƒçš„è¯æ³•å•å…ƒæ˜¯id ï¼ˆ2ï¼‰ã€ä¸ºæ¯ä¸€ä¸ªå…³é”®å­—å»ºç«‹å•ç‹¬çš„çŠ¶æ€è½¬æ¢å›¾ï¼› å¯¹äºŽè¿™ä¸ªçŠ¶æ€å›¾æ¥è¯´ï¼Œæˆ‘ä»¬å¿…é¡»è¦åŒºåˆ†ä»¥elseä¸ºå‰ç¼€çš„æ ‡è¯†ç¬¦ï¼ˆæ¯”å¦‚elseidï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨å€’æ•°ç¬¬äºŒä¸ªçŠ¶æ€åŽçš„è¾¹ï¼Œå¿…é¡»è¦é™åˆ¶ä¸ºéžå­—ç¬¦å’Œæ•°å­—ã€‚ ä½¿ç”¨ç¬¬äºŒä¸ªæ–¹æ¡ˆæ—¶ï¼šå¿…é¡»è¦è®¾å®šè¯æ³•å•å…ƒçš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—å½“ä¸€ä¸ªè¯ç´ åŒæ—¶åŒ¹é…idå’Œä¿ç•™å­—æ¨¡å¼æ—¶ï¼Œä¼˜å…ˆè¯†åˆ«ä¿ç•™å­—è¯æ³•å•å…ƒã€‚ æˆ‘ä»¬ä»Žç¬¬ä¸€ç‚¹å¯ä»¥ç¡®å®šæ ‡è¯†ç¬¦åŠ å…¥ç¬¦å·è¡¨çš„æ—¶æœºæ˜¯ï¼š è¯†åˆ«åˆ°å¯¹åº”è¯æ³•å•å…ƒæ—¶ï¼Œå¦‚æžœè¯¥æ ‡è¯†ç¬¦å°šæœªåŠ å…¥ç¬¦å·è¡¨ã€‚æ­¤æ—¶è¯æ³•åˆ†æžå™¨ä¼šå°†è¯¥ æ ‡è¯†ç¬¦ (ä¹Ÿå¯ä»¥ç†è§£ä¸ºè¯ç´ ) æ”¾å…¥ç¬¦å·è¡¨ä¸­ã€‚ è¯æ³•å•å…ƒnumberçŠ¶æ€è½¬æ¢å›¾ è¯æ³•å•å…ƒ æ¨¡å¼ digit [0-9] digits digit+ number digits(.digits)?(E[+-]?digits)? ä¸‹å›¾æ˜¯ä¸€ä¸ªè¯†åˆ«æ•´æ•°å’Œæµ®ç‚¹æ•°çš„çŠ¶æ€è½¬æ¢å›¾ï¼š ä»Žä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŽ¥æ”¶çŠ¶æ€22æ—¢åŒ¹é…åˆ°äº†ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆåŒ…å«å°æ•°éƒ¨åˆ†ï¼Œä¹ŸåŒ…å«æŒ‡æ•°éƒ¨åˆ†ï¼‰ï¼Œä¹ŸåŒ¹é…åˆ°äº†ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æ•´æ•°ã€‚æŽ¥æ”¶çŠ¶æ€23æ˜¯åŒ¹é…åˆ°çš„æ•´æ•°è¯ç´ ï¼›æŽ¥æ”¶çŠ¶æ€24ä¸ºä¸å¸¦ç§‘å­¦è®¡æ•°æ³•çš„çš„æ•´æ•°ã€‚ å½“æˆ‘ä»¬åœ¨æŽ¥æ”¶çŠ¶æ€æ—¶ï¼Œè¿”å›žè¯æ³•å•å…ƒ number ä»¥åŠä¸€ä¸ªæŒ‡å‘ å¸¸é‡è¡¨ æ¡ç›®çš„æŒ‡é’ˆï¼Œä¸Šé¢æ‰¾åˆ°çš„è¯ç´ å°±æ”¾åœ¨è¿™ä¸ªå¸¸é‡è¡¨æ¡ç›®ä¸­ã€‚ wsï¼ˆç©ºç™½ç¬¦ï¼‰çŠ¶æ€è½¬æ¢å›¾ è¯æ³•å•å…ƒ æ¨¡å¼ ws(ç©ºç™½ç¬¦) (blank \ tab \ newline)+ æˆ‘ä»¬ç”¨è½¬æ¢delimæ›¿æ¢ä¸Šè¡¨ä¸­çš„blankã€tabã€newlineï¼š ç©ºç™½ç¬¦åŽé¢éœ€è¦è·Ÿä¸€ä¸ªéžç©ºç™½ç¬¦æ‰èƒ½ç¡®å®šå½“å‰å·²ç»å®Œæˆäº†å¯¹è¿žç»­ç©ºç™½ç¬¦çš„æ‰«æã€‚ å½“æˆ‘ä»¬è¯†åˆ«åˆ°ç©ºç™½ç¬¦ä¹‹åŽï¼Œä½†æˆ‘ä»¬ å¹¶ä¸å‘è¯­æ³•åˆ†æžå™¨è¿”å›žä»»ä½•è¯æ³•å•å…ƒã€‚ç›¸åï¼Œæˆ‘ä»¬å¿…é¡»åœ¨è¿™ä¸ªç©ºç™½ç¬¦ä¹‹åŽå†æ¬¡å¯åŠ¨è¯æ³•åˆ†æžè¿‡ç¨‹ ã€‚ åŸºäºŽçŠ¶æ€è½¬æ¢å›¾çš„çš„è¯æ³•åˆ†æžå™¨ä½“ç³»ç»“æž„ 1ã€ä½¿ç”¨ä¸€ä¸ªstateå˜é‡æ¥ä¿å­˜ä¸€ä¸ªçŠ¶æ€è½¬æ¢å›¾çš„å½“å‰çŠ¶æ€ç¼–å·ï¼ˆå°±æ˜¯å‰é¢æˆ‘ä»¬ä»Ž0åˆ°27çš„ç¼–å·ï¼‰ã€‚ 2ã€ç”¨switchè¯­å¥æ ¹æ®stateçš„å€¼å°†æˆ‘ä»¬è½¬åˆ°å¯¹åº”çŠ¶æ€ç›¸åº”çš„ä»£ç æ®µï¼Œè¯¥ä»£ç æ®µä¸ºå¯¹åº”çŠ¶æ€æ‰€éœ€è¦æ‰§è¡Œçš„åŠ¨ä½œï¼› äºŒã€KMPç®—æ³•çŽ°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹KMPç®—æ³•ï¼Œå®ƒå¯ä»¥ç”¨äºŽåœ¨æ–‡æœ¬ä¸²ä¸­è¯†åˆ«ä¸€ç»„å…³é”®å­—ã€‚åœ¨çœ‹KMPå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€‚ æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•æ˜¯åŒä¸€ä¸ªå¾ªçŽ¯æ‰¾åˆ°æ‰€æœ‰æœ‰æ•ˆåç§»ï¼Œå¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„æƒ…å†µã€‚ æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•å¯ä»¥å½¢è±¡åœ°çœ‹æˆæ˜¯å¾…åŒ¹é…ä¸²ï¼ˆå­ä¸²ï¼‰æ²¿ç€åŽŸæ–‡æœ¬ï¼ˆä¸»ä¸²ï¼‰æ»‘åŠ¨ï¼ŒåŒæ—¶å¯¹æ¯ä¸ªåç§»éƒ½è¦æ£€æµ‹å­ä¸²ä¸Šçš„å­—ç¬¦æ˜¯å¦ä¸Žä¸»ä¸²ä¸­å¯¹åº”å­—ç¬¦ç›¸ç­‰ã€‚å…¶ä¸­çº¢è‰²å­—ç¬¦è¡¨ç¤ºå¯¹åº”ä½ç½®åŒ¹é…æˆåŠŸï¼Œç°è‰²å­—ç¬¦è¡¨ç¤ºåŒ¹é…å¤±è´¥ã€‚å¤§è‡´çš„ä»£ç æ˜¯è¿™æ ·ï¼š 12345678910111213141516171819using namespace std;int naive_string_matcher(string text, string pattern)&#123; string::size_type n = text.size(); string::size_type m = pattern.size(); string::size_type total = n-m; string::size_type s = -1; for (string::size_type i = 0; i &lt; total; i++) &#123; s = i; string::size_type matched = 0; for(string::size_type idx = 0; idx &lt; m; idx++) &#123; if(pattern[idx] == text[s+idx]) matched++; &#125; if (matched == m) return s; &#125; return s; &#125; åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n2) ã€‚ å¤±æ•ˆå‡½æ•°KMPç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹ä¹Ÿä¼šæ¯”æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•å¥½å¾ˆå¤šã€‚ä¸ºäº†å¿«é€Ÿå¤„ç†æ–‡æœ¬ä¸²å¹¶åœ¨è¿™äº›ä¸²ä¸­æœç´¢ä¸€ä¸ªå…³é”®å­—ï¼Œå®šä¹‰äº† å¤±æ•ˆå‡½æ•° f(s) ï¼Œå…¶ä¸­sä¸ºå¯¹åº”çŠ¶æ€å›¾ä¸Šçš„å„ä¸ªçŠ¶æ€ã€‚ä¹Ÿå¯ä»¥å«åšè¾…åŠ©å‡½æ•°ã€‚åœ¨è¿™ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸²çš„ä¸€éƒ¨åˆ†æœ¯è¯­ï¼š å‰ç¼€ï¼šä»Žä¸²så°¾éƒ¨åˆ é™¤0ä¸ªæˆ–å¤šä¸ªç¬¦å·åŽå¾—åˆ°çš„ä¸²ï¼› åŽç¼€ï¼šä»Žä¸²så¼€å§‹å¤„åˆ é™¤0ä¸ªæˆ–å¤šä¸ªç¬¦å·åŽå¾—åˆ°çš„ä¸²ï¼› å­ä¸²ï¼šåˆ é™¤æŸä¸ªå‰ç¼€æˆ–è€…åŽç¼€ä¹‹åŽå¾—åˆ°çš„ä¸²ï¼› çœŸå‰ç¼€ã€çœŸåŽç¼€ã€çœŸå­ä¸²ï¼šæŒ‡çš„æ˜¯æ—¢ä¸åŒ…å«ç©ºä¸²ï¼Œä¹Ÿä¸åŒ…å«æœ¬èº«çš„å‰ç¼€ã€åŽç¼€ã€å­ä¸²ï¼› é’ˆå¯¹å…³é”®å­—b1b2b3â€¦bnï¼Œå…¶ç›®æ ‡æ˜¯ä½¿å¾—b1b2â€¦bf(s)ä¸ä»…æ˜¯b1â€¦bsçš„çœŸå‰ç¼€ï¼Œåˆæ˜¯b1â€¦bsåŽç¼€çš„å­ä¸²ã€‚å¹¶ä¸”b1b2â€¦bf(s)æ˜¯æ‰€æ±‚å¾—çš„æœ€é•¿ä¸²ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥ä¸²ababacaæ¥è¿›è¡Œè®²è§£ï¼š aã€æž„é€ å…³é”®å­—çŠ¶æ€è½¬æ¢å›¾æˆ‘ä»¬æ ¹æ®å‰é¢çš„çŸ¥è¯†ï¼ŒèŠ‚ç‚¹è¡¨ç¤ºçŠ¶æ€ï¼Œæœ‰å‘è¾¹æŒ‡çš„æ˜¯è½¬æ¢ çŽ°åœ¨æœ‰äº†çŠ¶æ€è½¬æ¢å›¾ï¼Œæˆ‘ä»¬éœ€è¦æž„é€ æ¯ä¸€ä¸ªçŠ¶æ€èŠ‚ç‚¹sï¼Œæ‰€å¯¹åº”çš„å¤±æ•ˆå‡½æ•°å€¼ã€‚ bã€æ±‚è§£æ¯ä¸€ä¸ªçŠ¶æ€sçš„å‡½æ•°å€¼ 1ï¼‰ã€ç”±äºŽå‰é¢æåˆ°è¿‡çœŸå‰ç¼€çš„å‰æï¼Œå› æ­¤æˆ‘ä»¬ä»Žs=1å¼€å§‹è®¡ç®—ã€‚é¦–å…ˆæˆ‘ä»¬å°†f(1)è®¾ç½®ä¸º0ï¼Œæ—¢çŠ¶æ€1å¯¹åº”çš„å¤±æ•ˆå‡½æ•°å€¼ä¸º0ã€‚å¹¶ä¸”è¿™é‡Œæˆ‘ä»¬æ–°å¢žä¸€ä¸ªè¾…åŠ©æ¸¸æ ‡tç”¨äºŽå¯¹ç…§çŠ¶æ€sï¼š s 1 2 3 4 5 6 7 f(s) 0 - - - - - - 2ï¼‰ã€æ­¤æ—¶æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹çŠ¶æ€tçš„è½¬æ¢ï¼ˆaï¼‰å’ŒçŠ¶æ€sçš„è½¬æ¢ï¼ˆbï¼‰ï¼Œå‘çŽ°å­—ç¬¦aå¹¶ä¸ç­‰äºŽå­—ç¬¦bã€‚æ­¤æ—¶æˆ‘ä»¬å°†f(s+1)ï¼Œå³f(2)çš„å€¼è®¾ç½®ä¸º0ï¼š s 1 2 3 4 5 6 7 f(s) 0 0 - - - - - å¹¶ä¸”å°†sç§»åŠ¨åˆ°çŠ¶æ€2ï¼š 3ï¼‰ã€ç»§ç»­æ¯”è¾ƒçŠ¶æ€tçš„è½¬æ¢ï¼ˆaï¼‰å’ŒçŠ¶æ€sçš„è½¬æ¢ï¼ˆaï¼‰æ­¤æ—¶ä»–ä»¬ç›¸ç­‰ã€‚å› æ­¤ å…ˆå°†tçš„è‡ªå¢ž1ï¼Œç„¶åŽå°†f(s+1)ï¼Œå³f(2)çš„å€¼è®¾ç½®ä¸ºtçš„å€¼ï¼ˆæ­¤æ—¶ä¸º1ï¼‰ï¼š s 1 2 3 4 5 6 7 f(s) 0 0 1 - - - - åŒæ ·çš„ï¼Œæ­¤æ—¶å°†sç§»åŠ¨åˆ°çŠ¶æ€3ï¼š 4ï¼‰ã€ä¾æ¬¡æ¯”è¾ƒåŽç»­çš„s=3ï¼Œå’Œs=4çš„æƒ…å†µã€‚å®ƒä»¬çš„æƒ…å½¢å’Œç¬¬ä¸‰æ­¥ç±»ä¼¼ï¼š s 1 2 3 4 5 6 7 f(s) 0 0 1 2 3 - - æ­¤æ—¶t=3ï¼Œs=5ã€‚å¯¹åº”çš„çŠ¶æ€è½¬æ¢å›¾ä¸ºï¼š 5ï¼‰ã€çŽ°åœ¨æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹çŠ¶æ€tçš„è½¬æ¢ï¼ˆbï¼‰å’ŒçŠ¶æ€sçš„è½¬æ¢ï¼ˆcï¼‰ï¼Œå®ƒä»¬å¹¶ä¸ç›¸ç­‰ã€‚ç”±äºŽ æ­¤æ—¶tä¸ä¸º0ï¼Œè¯´æ˜Žåœ¨æ­¤ä¹‹å‰è‚¯å®šæ˜¯å­˜åœ¨æŸä¸€ä¸²æ—¢ä¸ºçœŸå‰ç¼€ï¼Œåˆä¸ºåŽç¼€å­ä¸² ã€‚å› æ­¤æˆ‘ä»¬èŽ·å–tå½“å‰ä½ç½®å¯¹åº”å¤±æ•ˆå‡½æ•°å‡½æ•°çš„å€¼ã€‚æ­¤æ—¶t=3ï¼ŒæŸ¥ä¸Šè¡¨å¯çŸ¥f(3)=1ã€‚æ‰€ä»¥çŽ°åœ¨æˆ‘ä»¬å°†tç§»åŠ¨åˆ°çŠ¶æ€1ï¼š 6ï¼‰ã€åŒæ ·çš„æ¯”è¾ƒçŠ¶æ€tçš„è½¬æ¢ï¼ˆbï¼‰å’ŒçŠ¶æ€sçš„è½¬æ¢ï¼ˆcï¼‰ï¼Œä¾ç„¶ä¸ç›¸ç­‰ã€‚ç”±äºŽtä¸ç­‰äºŽ0ï¼Œæ­¤æ—¶t=1ï¼ŒæŸ¥ç¬¬4æ­¥çš„è¡¨å¯çŸ¥f(1)=0ã€‚æ‰€ä»¥æˆ‘ä»¬çŽ°åœ¨å°†tç§»åŠ¨åˆ°çŠ¶æ€0ï¼š 7ï¼‰ã€å¯¹äºŽåŽç»­çŠ¶æ€çš„å¤±æ•ˆå‡½æ•°å€¼ç¡®å®šï¼Œå¯ä»¥ä»¿ç…§ç¬¬2ã€3å’Œ5æ­¥è¿›è¡Œæ±‚è§£ã€‚æœ€ç»ˆå®Œæ•´å¤±æ•ˆå‡½æ•°ä¸ºï¼š s 1 2 3 4 5 6 7 f(s) 0 0 1 2 3 0 1 ä¸‹é¢æ˜¯å¯¹åº”çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;vector&gt;using namespace std;void trie_func(string pattern, vector&lt;int&gt; &amp;f) &#123; const string::size_type length = pattern.size()+1; int t = 0; f[0]=t;// f[0] store t f[1]=0; for(int s = 1; s&lt; length-1; s++) &#123; while(t&gt;0 &amp;&amp; pattern[t] != pattern[s])&#123; t=f[t]; f[0]=t; &#125; if(pattern[s]==pattern[t])&#123; t=t+1; f[s+1]=t; f[0]=t; &#125; else &#123;f[s+1]=0;&#125; &#125;&#125;int main(int argc, const char * argv[])&#123; string pattern(&quot;ababaca&quot;); vector &lt;int&gt; trie(pattern.size()+1); trie_func(pattern,trie); for (vector&lt;int&gt;::iterator itr = trie.begin(); itr != trie.end(); itr++) &#123; cout&lt;&lt;*itr&lt;&lt;endl; &#125; return 0;&#125; å­ä¸²ä¸Žä¸»ä¸²çš„æ¯”è¾ƒçŽ°åœ¨æˆ‘ä»¬ä»¥ä¸»ä¸²bcbababaababacacd å’Œå­ä¸² ababaca ä½œä¸ºä¾‹å­ï¼Œæ¥çœ‹ä¸»ä¸²æ˜¯å¦åŒ…å«å­ä¸²ã€‚ æˆ‘ä»¬ä»Žå‰é¢çŸ¥é“å­ä¸²å¤±æ•ˆå‡½æ•°ä¸ºï¼š state 1 2 3 4 5 6 7 f(s) 0 0 1 2 3 0 1 è¿™é‡Œæˆ‘å°†ä¸Šä¸€èŠ‚çš„å­—ç¬¦sæ›¿æ¢ä¸ºstateï¼Œæ˜¯å› ä¸ºè¿™ä¸€èŠ‚æˆ‘ä¼šç”¨å­—ç¬¦sç”¨ä½œå½“å‰å­ä¸²ç›¸å¯¹äºŽä¸»ä¸²çš„åç§»é‡ã€‚è€ŒçœŸæ­£åŽŸå› æ˜¯æˆ‘å¤ªæ‡’äº†ï¼Œå‘çŽ°å›¾ä¸­å’Œå¤±æ•ˆå‡½æ•°éƒ½ç”¨äº†åŒä¸€ä¸ªå­—ç¬¦sã€‚ä¸ºäº†é¿å…æ··æ·†ï¼Œä½†åˆä¸æƒ³é‡æ–°ç”»å›¾ðŸ¤£ã€‚ 1ï¼‰ã€ä¸»ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œå­ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ç›¸ç­‰ã€‚æ­¤æ—¶æˆ‘ä»¬å°†å­ä¸²å‘å³æ»‘åŠ¨ä¸€ä½ï¼Œæ­¤æ—¶åç§»å€¼s = 1 ï¼š 2ï¼‰ã€ä¾æ¬¡å¯¹åŽé¢æœºä¼šå­—ç¬¦è¿›è¡Œå¯¹æ¯”ï¼Œç›´åˆ°s=3æ—¶ï¼Œæˆ‘ä»¬å‘çŽ°å­—ç¬¦ä¸² ababa æˆåŠŸåŒ¹é…ï¼Œä½†æ˜¯å­ä¸²çš„ç¬¬å…­ä¸ªå­—ç¬¦å’Œä¸»ä¸²çš„ç¬¬ä¹ä¸ªå­—ç¬¦å¹¶ä¸ç›¸ç­‰ï¼š è¿™æ—¶å€™å¤±æ•ˆå‡½æ•°å°±æ´¾ä¸Šç”¨é€”äº†ã€‚æ­¤æ—¶å·²åŒ¹é…é•¿åº¦q=5ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨çŠ¶æ€è½¬æ¢å›¾ä¸­å¯¹åº”äºŽçŠ¶æ€5ã€‚è€ŒçŠ¶æ€5å¯¹åº”çš„å¤±æ•ˆå‡½æ•°å€¼ä¸º3ï¼Œå¯¹äºŽä¸²ababaæ¥è¯´ï¼Œé•¿åº¦ä¸º3çš„ä¸²abaæ—¢æ˜¯å®ƒçš„çœŸå‰ç¼€ï¼Œåˆæ˜¯å®ƒåŽç¼€çš„å­ä¸²ã€‚æ­¤æ—¶ä¸»ä¸²å’Œå­ä¸²ä¸­çš„abaå·²ç»å¤±æ•ˆï¼Œå·²ç»æ²¡æœ‰å†åŽ»æ¯”è¾ƒçš„æ„ä¹‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥åŽ»æ¯”è¾ƒä¸»ä¸²ä¸­çš„aå’Œå­ä¸²ä¸­çš„bäº†ï¼š 3ï¼‰ã€çŽ°åœ¨æˆ‘ä»¬å°†å­ä¸²å‘å³è¾¹ç§»åŠ¨2ä¸ªå­—ç¬¦ï¼Œç„¶åŽç»§ç»­è¿›è¡Œæ¯”è¾ƒï¼š è¿™é‡Œè®¡ç®—åç§»é‡så¾ˆé‡è¦ï¼š âš ï¸âš ï¸âš ï¸ s = s + (state - f(state)) æ¯”å¦‚è¿™é‡Œçš„q=5ï¼Œä¹Ÿå°±è¯´æ˜Žstate=5ï¼Œè€Œf(state) = 3ã€‚å› æ­¤å‘å³çš„åç§»é‡ä¸ºï¼šs = 3 + (5-3) = 5ã€‚ 4ï¼‰ä»Žå›¾ä¸­æ ‡çº¢ä¹Ÿèƒ½çœ‹å‡ºæ¥aâ‰ bï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»§ç»­é‡å¤æ­¥éª¤3çš„äº‹æƒ…ï¼š 5ï¼‰ã€å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç»§ç»­å°†å­ä¸²å‘å³ç§»åŠ¨2ä¸ªå­—ç¬¦ï¼Œè¿›è¡Œæ¯”è¾ƒï¼š ç›¸ç­‰ã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼šæ­¤æ—¶stateä¸º1ï¼Œè€Œf(state)=0ã€‚è¿™æ„å‘³ç€æ­¤æ—¶å¹¶æ²¡æœ‰å­˜åœ¨å³æ˜¯çœŸå‰ç¼€åˆæ˜¯åŽç¼€çš„å­ä¸²ã€‚çŽ°åœ¨åªèƒ½å’Œç¬¬ä¸€æ­¥ä¸€æ ·ï¼Œæ‰‹åŠ¨å°†åç§»é‡åŠ 1ã€‚ 6ï¼‰ã€çŽ°åœ¨å°†åç§»é‡åŠ 1ä¹‹åŽï¼Œå¹¶å°†å­ä¸²å’Œä¸»ä¸²è¿›è¡ŒåŒ¹é…ã€‚æ­¤æ—¶åŒ¹é…æˆåŠŸï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åˆ¤æ–­ä¸»ä¸²æ˜¯åŒ…å«æœ‰æŒ‡å®šå…³é”®å­—çš„å­—ç¬¦ä¸²ï¼š ä¸‹é¢æ˜¯ç®€å•çš„ä»£ç å®žçŽ°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰åšæžç«¯æƒ…å†µçš„å¤„ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738int kmp_match(string text, string pattern) &#123; vector&lt;int&gt; trie(pattern.size() + 1); trie_func(pattern, trie); int offset = -1; int q = 0; string::size_type m = text.size(); string::size_type n = pattern.size(); if (m &lt; n) &#123; return -1; &#125; for (string::size_type i = 0; i &lt; m; i++) &#123; while (q &gt; 0 &amp;&amp; text[i] != pattern[q] &amp;&amp; q != 0) &#123; q = trie[q]; &#125; if (text[i] == pattern[q]) &#123; q++; &#125; if (q==n) &#123; offset = i - q + 1; &#125; &#125; return offset;&#125;int main()&#123; string text(&quot;bcbababaababacacd&quot;); string pattern(&quot;ababaca&quot;); int offset = kmp_match(text, pattern); cout &lt;&lt; &quot;offset: &quot; &lt;&lt; offset &lt;&lt; endl;&#125; æ€»ç»“æœ¬èŠ‚åˆ°è¿™å„¿ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿæ‰‹å·¥åœ°ä¸ºå„ç±»è¯æ³•å•å…ƒæž„é€ çŠ¶æ€è½¬æ¢å›¾äº†ã€‚è¿™ç±»è¯æ³•å•å…ƒåŒ…æ‹¬æœ‰ï¼šæ ‡è¯†ç¬¦ï¼ˆåŒ…æ‹¬å­—ç¬¦ï¼‰ã€æ•°å­—ï¼ˆåŒ…æ‹¬æ•°ä½ï¼‰ã€å…³é”®å­—ã€è¿ç®—ç¬¦ç­‰ç­‰ï¼Œè€Œä¸”ä¹ŸçŸ¥é“å¦‚ä½•ä½¿ç”¨KMPç®—æ³•æ¥å¯»æ‰¾æŒ‡å®šä¸²ï¼Œä¾‹å¦‚æ ‡è¯†ç¬¦å’Œå…³é”®å­—ç­‰ç­‰ã€‚åœ¨ä¸‹ä¸€èŠ‚å°±éœ€è¦é€šè¿‡è‡ªåŠ¨åœ°æ–¹å¼é‡Œç”Ÿå±‚å¯¹åº”çš„çŠ¶æ€å›¾äº†ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è¯æ³•åˆ†æžâ€”â€”è¯æ³•å•å…ƒå’Œæ­£åˆ™è¡¨è¾¾å¼]]></title>
      <url>%2F2019%2F10%2F28%2Fcompiler_token_regular%2F</url>
      <content type="text"><![CDATA[æœ¬ç³»åˆ—æ–‡ç« æ˜¯ã€Šç¼–è¯‘åŽŸç†ã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œå¹¶åŠ å…¥äº†ä¸€äº›ä¸ªäººçš„ç†è§£ã€‚æœ¬ç³»åˆ—çš„ä¸»è¦å†…å®¹é¡ºåºå¦‚ä¸‹ï¼š1ï¼‰ã€é¦–å…ˆè§£é‡Šä»€ä¹ˆæ˜¯è¯æ³•å•å…ƒï¼›2ï¼‰ã€å¦‚ä½•æ‰‹åŠ¨è¯†åˆ«è¯æ³•å•å…ƒï¼›3ï¼‰ã€æœ€åŽæ˜¯è¯æ³•åˆ†æžå™¨å¦‚ä½•è‡ªåŠ¨æœºè‡ªåŠ¨è¯†åˆ«è¯æ³•å•å…ƒï¼›æœ¬æ–‡ä¸»è¦æ˜¯çœ‹ä¸€ä¸‹è¯åˆ†æžå™¨çš„è¯æ³•å•å…ƒéƒ¨åˆ†ã€‚åŒ…æ‹¬ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠè¯æ³•å•å…ƒçš„è¯†åˆ«ã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆå¤§ä½“ä¸Šçœ‹ä¸€ä¸‹è¯æ³•åˆ†æžå™¨çš„ä½œç”¨ã€‚å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯è¯»å…¥æºç¨‹åºçš„è¾“å…¥å­—ç¬¦ã€å°†å®ƒä»¬ç»„æˆè¯ç´ ï¼Œç”Ÿæˆå¹¶è¾“å‡ºä¸€ä¸ªè¯æ³•å•å…ƒçš„åºåˆ—ã€‚æ¯ä¸ªè¯æ³•å•å…ƒå¯¹åº”ä¸€ä¸ªè¯ç´ ã€‚ è¿™é‡Œæˆ‘ä»¬æœ‰æåˆ°å‡ ä¸ªä¸“ä¸šåè¯ï¼šè¯ç´ ã€è¯æ³•å•å…ƒã€‚å®ƒä»¬çš„å®šä¹‰é©¬ä¸Šå°±ä¼šè¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ä¸‹é¢è¿™å¹…å›¾ï¼š ä»Žå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¯æ³•åˆ†æžå™¨è¿˜åœ¨å’Œç¬¦å·è¡¨è¿›è¡Œäº¤äº’ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ä»Žç¬¦å·è¡¨ä¸­è¯»å–æœ‰å…³æ ‡è¯†ç¬¦ç§ç±»ä¿¡æ¯ï¼Œä»¥ç¡®å®šéœ€è¦å‘è¯­æ³•åˆ†æžå™¨ä¼ é€çš„è¯æ³•å•å…ƒã€‚ ä¸€ã€è¯æ³•å•å…ƒçŽ°åœ¨æˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹å‰é¢æåˆ°çš„ä¸€äº›ä¸“ä¸šåè¯ï¼š è¯æ³•å•å…ƒï¼šç”±ä¸€ä¸ª è¯æ³•å•å…ƒåå’Œä¸€ä¸ªå¯é€‰çš„å±žæ€§ æž„æˆã€‚æ¯”å¦‚ä¸€ä¸ªç‰¹å®šçš„å…³é”®å­—ï¼Œæˆ–è€…ä»£è¡¨ä¸€ä¸ªæ ‡è¯†ç¬¦çš„è¾“å…¥å­—ç¬¦åºåˆ—ã€‚ è¯æ³•å•å…ƒæ˜¯è¯­æ³•åˆ†æžå™¨å¤„ç†çš„è¾“å…¥ç¬¦å·ã€‚ è¯ç´ ï¼šæºç¨‹åºä¸­çš„ä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œå®ƒå’ŒæŸä¸ªè¯æ³•å•å…ƒçš„æ¨¡å¼åŒ¹é…ã€‚å®ƒè¢«è¯æ³•åˆ†æžå™¨è¯†åˆ«ä¸ºè¯¥è¯æ³•å•å…ƒçš„ä¸€ä¸ªå®žä¾‹ï¼› æ¨¡å¼ï¼šå®ƒæè¿°äº†ä¸€ä¸ªè¯æ³•å•å…ƒçš„è¯ç´ å¯èƒ½å…·æœ‰çš„å½¢å¼ï¼› è¿™å„¿æˆ‘å¤§è‡´åœ°è§£é‡Šä¸€ä¸‹è¿™ä¸‰ä¸ªæ¦‚å¿µä¹‹é—´çš„å…³ç³»ï¼šè¯æ³•å•å…ƒæŒ‡å®šçš„æ˜¯æŸä¸€ç±»åž‹çš„äº‹ç‰©ï¼Œç”¨é¢å‘å¯¹è±¡æ¥è¯´å°±æ˜¯ï¼Œè¯æ³•å•å…ƒç±»ï¼ˆclassï¼‰ï¼›è¯ç´ å°±æ˜¯æŒ‡çš„æ˜¯è¯¥ç±»çš„å…·ä½“å®žä¾‹ï¼›è€Œæ¨¡å¼å°±æ˜¯è¯¥ç±»çš„ä¸€ä¸ªå±žæ€§ï¼Œå®ƒæè¿°äº†è¯ç´ æ‰€å…·æœ‰çš„å…·ä½“ç‰¹å¾ã€‚ 1234class Tokens&#123; string pattern;&#125;;Tokens lexeme; å¹¶ä¸æ˜¯è¯´å®žé™…å°±æ˜¯è¿™ä¸ªä»£ç ï¼Œæˆ‘åªæ˜¯ä¸ºäº†ä¾¿äºŽç†è§£ï¼Œè€Œè¿›è¡Œçš„ç±»æ¯”ã€‚ä¸‹è¡¨ç»™å‡ºäº†ä¸€äº›å¸¸è§çš„è¯æ³•å•å…ƒï¼š è¯æ³•å•å…ƒ éžæ­£å¼æè¿° è¯ç´ å®žä¾‹ if(å…³é”®å­—) å­—ç¬¦i,f if else(å…³é”®å­—) å­—ç¬¦e,l,s,e else comparison(æ¯”è¾ƒè¿ç®—ç¬¦) &lt;,&gt;,&lt;=,&gt;=,==â€¦ &lt;=, != id(æ ‡è¯†ç¬¦) å­—æ¯å¼€å¤´çš„å­—æ¯/æ•°å­—ä¸² pi, printf number(æ•°å­—) æ•°å­—å¸¸é‡ 3.1415 literal(å­—ç¬¦/ä¸²) ä¸¤åŒå¼•å·ä¹‹é—´çš„ä»»ä½•å­—ç¬¦ â€œhello, worldâ€ è¯æ³•å•å…ƒçš„å¤§è‡´åˆ†ç±»1ï¼‰ã€å…³é”®å­—ï¼šæ¯ä¸ªå…³é”®å­—æœ‰ä¸€ä¸ªè¯æ³•å•å…ƒï¼›2ï¼‰ã€æ ‡è¯†ç¬¦ï¼šä¸€ä¸ªè¡¨ç¤ºæ‰€æœ‰æ ‡è¯†ç¬¦çš„è¯æ³•å•å…ƒï¼›3ï¼‰ã€å¸¸é‡ï¼šå¸¸é‡è¯æ³•å•å…ƒåŒ…å«çš„æ•°å­—å’Œå­—ç¬¦ä¸²ï¼›4ï¼‰ã€è¿ç®—ç¬¦ï¼šè¿ç®—æ³•ä¹Ÿæ˜¯ä¸€ä¸ªè¯æ³•å•å…ƒï¼Œå¯ä»¥æ˜¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯ç®—æœ¯è¿ç®—ç¬¦ï¼›5ï¼‰ã€æ ‡ç‚¹ç¬¦å·ï¼šæ¯ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·æœ‰ä¸€ä¸ªè¯æ³•å•å…ƒã€‚æ¯”å¦‚æ‹¬å·ç­‰ç­‰ï¼› è¯æ³•å•å…ƒçš„å±žæ€§å€¼ä»Žè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥è¯æ³•å•å…ƒè¡¨ç¤ºäº†ä¸€ç±»äº‹ç‰©ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åŽ»åŒºåˆ†å…·ä½“çš„è¯ç´ ï¼Ÿ è¯æ³•åˆ†æžå™¨ä¸ä»…å‘è¯­æ³•åˆ†æžå™¨è¿”å›žä¸€ä¸ªè¯æ³•å•å…ƒçš„åå­—ï¼Œè¿˜ä¼šè¿”å›žä¸€ä¸ªæè¿°è¯¥è¯æ³•å•å…ƒçš„è¯ç´ å±žæ€§å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å£°æ˜Žçš„ä¸€ä¸ªå˜é‡ã€æˆ–è€…å‡½æ•°æ—¶ï¼Œå®ƒä½œä¸ºæ ‡è¯†ç¬¦ä¸€ç±»çš„è¯æ³•å•å…ƒã€‚å®ƒä»¬æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼ˆè¯ç´ ã€ç±»åž‹ã€ç¬¬ä¸€æ¬¡åœ¨æºä»£ç ä¸­å‡ºçŽ°çš„ä½ç½®ï¼‰éƒ½ä¼šä¿å­˜åœ¨ç¬¦å·è¡¨ä¸­ã€‚å› æ­¤ï¼š ä¸€ä¸ªæ ‡è¯†ç¬¦çš„å±žæ€§å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘ç¬¦å·è¡¨ä¸­è¯¥æ ‡è¯†ç¬¦å¯¹åº”é¡¹çš„æŒ‡é’ˆã€‚ æ³¨æ„ï¼Œè¯æ³•å•å…ƒçš„å±žæ€§å€¼æ˜¯æŒ‡å‘ç¬¦å·è¡¨é¡¹çš„æŒ‡é’ˆã€‚ äºŒã€æ­£åˆ™è¡¨è¾¾å¼è¿™ä¸€èŠ‚ä¸»è¦æ˜¯åœ¨è®²æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æžœå·²ç»ç†Ÿæ‚‰äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ç›´æŽ¥è·³è¿‡é˜…è¯»è¯æ³•å•å…ƒçš„è¯†åˆ«ã€‚è€Œä¸”è¿™ä¸€èŠ‚ä¼šå¢žåŠ å¾ˆå¤šæ¦‚å¿µï¼Œä¹Ÿæ˜¯æ¯”è¾ƒæž¯ç‡¥çš„ã€‚ä»Žå‰é¢æˆ‘ä»¬å¯ä»¥æ„Ÿæ€§ï¼ˆç›´è§‚ï¼‰çŸ¥é“å“ªäº›è¯ç´ æ˜¯æŸä¸€ç±»åž‹çš„è¯æ³•å•å…ƒã€‚ä¸ºäº†èƒ½å¤Ÿæ˜Žç¡®åœ°åˆ’åˆ†ä¸åŒè¯ç´ å¯¹åº”çš„è¯æ³•å•å…ƒï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥æ­£åˆ™è¡¨è¾¾å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§ç”¨æ¥æè¿°è¯ç´ æ¨¡å¼çš„é‡è¦è¡¨ç¤ºæ–¹æ³•ã€‚å› æ­¤æ­£åˆ™è¡¨è¾¾å¼å°±æè¿°äº†ç‰¹å®šè¯ç´ å¯¹åº”çš„æ¨¡å¼ã€‚ åœ¨è¯æ³•åˆ†æžä¸­ï¼Œæœ€é‡è¦çš„è¯­è¨€ä¸Šçš„è¿ç®—æ˜¯ï¼šå¹¶ã€è¿žæŽ¥å’Œé—­åŒ… è¿ç®—ï¼š å¹¶ï¼ˆL|Mï¼‰ï¼šå¾—åˆ°çš„ä¸²så¯èƒ½å±žäºŽLä¹Ÿå¯èƒ½å±žäºŽMã€‚ä½†åªèƒ½æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼› è¿žæŽ¥(LM)ï¼šå¾—åˆ°çš„ä¸²så³å±žäºŽLï¼Œä¹Ÿå±žäºŽMï¼› é—­åŒ…ï¼šé—­åŒ…åˆ†Kleeneé—­åŒ…å’Œæ­£é—­åŒ…ã€‚Kleeneé—­åŒ…æ˜¯æŒ‡æŸä¸€é›†åˆçš„ç¬¦å·é‡å¤ 0ï½žâˆž å¤šæ¬¡ï¼Œå¯èƒ½æ˜¯ç©ºä¸²ã€‚æ­£å¿…æŠ¥ä¸åŒ…å«é‡å¤0æ¬¡ï¼Œå³ä¸åŒ…å«ç©ºä¸²ï¼› letter_ (letter_ | digit_) *è¿™æ˜¯ä¸€ä¸ªcè¯­è¨€ä¸­æ ‡è¯†ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å…¶ä¸­ç”¨letter_æ¥è¡¨ç¤ºä»»ä¸€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ï¼Œç”¨digit_è¡¨ç¤ºæ•°ä½ã€‚cè¯­è¨€ä¸­æ ‡è¯†ç¬¦å¿…é¡»æ˜¯å¿…é¡»æ˜¯ä»¥å­—ç¬¦å¼€å¤´ï¼ŒåŒ…å«æ•°å­—ã€å­—ç¬¦æ¥è¡¨ç¤ºã€‚ ä¼˜å…ˆçº§æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæ‹¬å·çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¼˜å…ˆçº§ä¾æ¬¡é™ä½Žï¼š1ï¼‰ã€ä¸€å…ƒè¿ç®—ç¬¦ *ï¼›2ï¼‰ã€è¿žæŽ¥ï¼ˆå·¦ç»“åˆï¼‰ï¼›3ï¼‰ã€å¹¶è¿ç®—ç¬¦ä¼˜å…ˆçº§æœ€ä½Žï¼ˆå·¦ç»“åˆï¼‰ï¼› æ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼ (a|b)*ï¼Œå¯ä»¥è¡¨ç¤ºå¤šä¸ªä¸²ï¼š 12345678910ç©ºé›†;//é—­åŒ…æ¬¡æ•°ä¸º0; a;//é—­åŒ…æ¬¡æ•°ä¸º1,å–å¹¶çš„å·¦è¾¹;aa;//é—­åŒ…æ¬¡æ•°ä¸º2,ä¸€ç›´å–å¹¶çš„å·¦è¾¹;aa...a;//é—­åŒ…æ¬¡æ•°ä¸ºn,ä¸€ç›´å–å¹¶çš„å·¦è¾¹;b;//é—­åŒ…æ¬¡æ•°ä¸º1,å–å¹¶çš„å³è¾¹;bb;//é—­åŒ…æ¬¡æ•°ä¸º2,å–å¹¶çš„å³è¾¹;bb...b;//é—­åŒ…æ¬¡æ•°ä¸ºn,å–å¹¶çš„å³è¾¹;ab;//é—­åŒ…æ¬¡æ•°ä¸º2,å…ˆå–å·¦è¾¹å†å–å³è¾¹;ba;//é—­åŒ…æ¬¡æ•°ä¸º2,å…ˆå–å³è¾¹å†å–å·¦è¾¹;... å¦‚ä¸Š, å¯ä»¥ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„è¯­è¨€å«åšæ­£åˆ™é›†åˆã€‚å¦‚æžœä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼rå’Œsè¡¨ç¤ºç›¸åŒçš„è¯­è¨€ï¼Œåˆ™ç§° r å’Œ s ç­‰ä»·r=s ã€‚ ä¾‹ä¸€cè¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦æ˜¯ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆçš„ä¸²ï¼Œä¸‹é¢æ˜¯cæ ‡è¯†ç¬¦å¯¹åº”è¯­è¨€çš„æ­£åˆ™å®šä¹‰ï¼š 123letter_ -&gt; A | B | C | ... | Z | a | b | c | ... | z | _ digit -&gt; 0 | 1 | ... | 9 id -&gt; letter_ (letter_ | digit ) * ä¾‹äºŒæ— ç¬¦å·æ•°æ˜¯å½¢å¦‚5280ã€0.01234ã€6.336E4æˆ–è€…1.89E-4çš„ä¸²ã€‚ä¸‹é¢çš„æ­£åˆ™å®šä¹‰ç»™å‡ºäº†è¿™ç±»ç¬¦å·ä¸²çš„ç²¾ç¡®å®šä¹‰ï¼š 12345digit -&gt; 0 | 1 | ...| 9digits -&gt; digit digit* optionalFraction -&gt; . digits | ç©ºé›†optionalExponent -&gt; (E (+|-|ç©º) digits) | ç©ºnumber -&gt; digits optionalFraction optionalExponent æ­£åˆ™è¡¨è¾¾å¼çš„æ‰©å±• å•ç›®åŽç¼€è¿ç®—ç¬¦+ï¼šæŒ‡çš„æ­£é—­åŒ…ï¼› å•ç›®åŽç¼€è¿ç®—ç¬¦?ï¼šè¡¨ç¤ºå‡ºçŽ°0ä¸ªï¼Œæˆ–è€…ä¸€ä¸ªï¼› å­—ç¬¦ç±»ï¼šæ­£åˆ™è¡¨è¾¾å¼a1 | a2 | a3 |â€¦|anå¯ä»¥ç¼©å†™ä¸º [a1a2a3â€¦an]ã€‚å½“a1åˆ°anå½¢æˆä¸€ä¸ªé€»è¾‘ä¸Šè¿žç»­çš„åºåˆ—æ—¶ï¼Œå¯ä»¥å†™ä½œ [a1 - an]; ä¾‹ä¸‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ‰©å±•ï¼Œæ¥æŠŠä¾‹ä¸€çš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ”¹å†™ï¼š 123letter_ -&gt; [A-Za-z_]digit -&gt; [0-9]id -&gt; letter_ (letter_ | digit ) * çŽ°åœ¨é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºå¯¹åº”è¯æ³•å•å…ƒå¯¹åº”çš„æ¨¡å¼æ¥ã€‚å› æ­¤ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯è¯»å–æºä»£ç é‡Œé¢çš„å­—ç¬¦æµï¼Œæ­é…å¯¹åº”çš„è¯æ³•å•å…ƒçš„æ¨¡å¼ï¼Œç”Ÿæˆå¯¹åº”çš„è¯æ³•å•å…ƒã€‚ ä¸‰ã€è¾“å…¥ç¼“å†²å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è‡³å°‘å‘å‰çœ‹ä¸€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚åœ¨cè¯­è¨€ä¸­ï¼Œåƒ-ã€=æˆ–è€…&lt; è¿™æ ·å•å­—ç¬¦è¿ç®—ç¬¦ä¹Ÿæœ‰å¯èƒ½æ˜¯ -&gt; ã€== æˆ–è€…&lt;= è¿™æ ·çš„åŒå­—ç¬¦ã€‚åœ¨ç¼–è¯‘åŽŸç†ä¸­ä¼šå¼•å…¥ä¸€ä¸ªå“¨å…µæ ‡è®°çš„åŒç¼“å†²åŒºæ–¹æ¡ˆæ¥å¤„ç†å‘å‰çœ‹è¿ç®—ç¬¦çš„é—®é¢˜ã€‚ ä¸Šå›¾ä¸­å‡ºçŽ°çš„lexemeBeginå’ŒforwardæŒ‡é’ˆä½œç”¨åˆ†åˆ«æ˜¯ï¼š1ï¼‰ã€lexemeBeginï¼šè¯¥æŒ‡é’ˆæŒ‡å‘å½“å‰è¯ç´ çš„å¼€å§‹å¤„ã€‚å½“å‰æˆ‘ä»¬æ­£åœ¨åŒ¹é…æŸä¸€æ­£åˆ™è¡¨è¾¾å¼å¯¹åº”æ¨¡å¼çš„è¯ç´ ï¼›2ï¼‰ã€forwardï¼šè¯¥æŒ‡é’ˆä¸€ç›´å‘å‰æ‰«æï¼Œç›´åˆ°å‘çŽ°æŸä¸ªæ¨¡å¼è¢«åŒ¹é…ä¸ºæ­¢ã€‚ ç¬¬ä¸€æ­¥ã€è¯»å–å†…å®¹åˆ°ç¼“å†²åŒºä¸­ï¼šæ¯æ¬¡è¯»å–ç¼“å†²åŒºé•¿åº¦çš„å­—ç¬¦åˆ°ç¼“å†²åŒºä¸­ï¼›æ¯ä¸ªè¾“å…¥ç¼“å†²åŒºçš„å®¹é‡é€šå¸¸æ˜¯ä¸€ä¸ªç£ç›˜å—çš„å¤§å°ï¼Œæ¯”å¦‚4096å­—èŠ‚ã€‚æˆ‘ä»¬åœ¨è¯»å–çš„æ—¶å€™å°±æ˜¯ä¸€æ¬¡æ€§è¯»å–ä¸€ä¸ªç¼“å†²åŒºé•¿åº¦çš„å­—ç¬¦åˆ°ç¼“å†²åŒºä¸­ï¼Œä»¥é¿å…é¢‘ç¹çš„ä½¿ç”¨è¯»å–å‡½æ•°ã€‚å½“è¾“å…¥æ–‡ä»¶ä¸­çš„å‰©ä½™å­—ç¬¦ä¸è¶³ç¼“å†²åŒºé•¿åº¦çš„æ—¶å€™ï¼Œæ–‡ä»¶çš„é»˜è®¤ä¼šæœ‰ä¸€ä¸ªeofï¼ˆend of fileï¼‰æ¥è¡¨ç¤ºæ–‡ä»¶ç»“æŸã€‚ ç¬¬äºŒæ­¥ã€lexemeBeginå’ŒforwardæŒ‡é’ˆçš„ç§»åŠ¨ï¼šä½¿ç”¨lexemeBeginæŒ‡é’ˆå’ŒforwardæŒ‡é’ˆè¯»å–æŒ‡å®šæ¨¡å¼çš„è¯ç´ ã€‚ä¸€æ—¦ç¡®å®šäº†ä¸‹ä¸€ä¸ªè¯ç´ ï¼ˆä¸‹å›¾ä¸­çš„å·¦æ‹¬å·ï¼‰forwardæŒ‡é’ˆå°†æŒ‡å‘è¯¥è¯ç´  ç»“å°¾çš„å­—ç¬¦ ã€‚è¯æ³•åˆ†æžå™¨å°†è¿™ä¸ªè¯ç´ ä½œä¸ºæŸä¸ªè¿”å›žç»™è¯­æ³•åˆ†æžå™¨çš„è¯æ³•å•å…ƒçš„å±žæ€§å€¼è®°å½•ä¸‹æ¥ï¼ˆåœ¨å‰é¢æˆ‘ä»¬æè¿‡çš„è¯æ³•å•å…ƒåˆ†ä¸ºè¯æ³•å•å…ƒåå’Œå¯é€‰çš„å±žæ€§ï¼‰ã€‚ç„¶åŽlexemeBeginæŒ‡é’ˆç§»åŠ¨åˆ° åˆšåˆšæ‰¾åˆ°è¯ç´ ä¹‹åŽçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¬¬ä¸‰æ­¥ã€ç¼“å†²åŒºçš„æ›¿æ¢ï¼šæˆ‘ä»¬åœ¨ç§»åŠ¨forwardæŒ‡é’ˆå‰éœ€è¦åˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»åˆ°è¾¾æŸä¸ªç¼“å†²åŒºçš„æœ«å°¾ã€‚å¦‚æžœæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–°å­—ç¬¦è¯»å…¥åˆ°å¦å¤–ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼ˆå‰é¢æåˆ°çš„åŒç¼“å†²åŒºï¼‰ï¼Œä¸”å°†forwardæŒ‡é’ˆæŒ‡å‘æ–°ç¼“å†²åŒºçš„å¤´éƒ¨ã€‚ å“¨å…µæ ‡è®°å¦‚å‰é¢æ‰€è¯´ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡ç§»åŠ¨forwardæŒ‡é’ˆæ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ£€æŸ¥æ˜¯å¦åˆ°è¾¾äº†ç¼“å†²åŒºçš„æœ«å°¾ã€‚å¦‚æžœæ˜¯çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åŠ è½½å¦ä¸€ä¸ªç¼“å†²åŒºã€‚å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦åšä¸¤æ¬¡æµ‹è¯•ï¼š1ï¼‰ã€æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç¼“å†²åŒºçš„æœ«å°¾ï¼›2ï¼‰ã€ç¡®å®šè¯»å…¥çš„å­—ç¬¦æ˜¯ä»€ä¹ˆï¼›è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼“å†²åŒºçš„æœ«å°¾å¢žåŠ ä¸€ä¸ªâ€œå“¨å…µâ€ï¼Œæ¯”å¦‚eofï¼š ä»Žè¿™å„¿æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¯¹äºŽç¼–è¯‘å™¨è€Œè¨€åœ¨è¿›è¡Œè¯æ³•åˆ†æžçš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡lexemeBeginå’Œforwardæ¥æ‰«æç¼“å†²åŒºã€‚å¦‚æžœåŒ¹é…æŸä¸€ä¸ªè¯ç´ æ—¶ï¼Œæ¯”å¦‚å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚å°†ä¸€ç‰‡çŸ­ç¯‡å°è¯´ä½œä¸ºå¸¸é‡å­—ç¬¦ä¸²æ”¾åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼‰æ—¶ï¼Œé‚£å°±ä¼šå‡ºçŽ°ç¼“å†²åŒºé•¿åº¦ä¸è¶³çš„æƒ…å†µï¼Œå› æ­¤åœ¨æ—¥å¸¸ç¼–ç ä¸­å°†é•¿å­—ç¬¦ä¸²æ‹†åˆ†æˆå¤šä¸ªçŸ­çš„å­—ç¬¦ä¸²ã€‚ è¿™å…¶å®žä¹Ÿç®—æ˜¯å­¦ä¹ ç¼–è¯‘åŽŸç†ï¼Œæœ‰åŠ©äºŽæä¾›ç¼–ç¨‹æ•ˆçŽ‡çš„ä¸€ä¸ªä¾‹å­äº†ã€‚ æ€»ç»“åœ¨å‰é¢æˆ‘ä»¬ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¡¨ç¤ºä¸€ä¸ªæ¨¡å¼ï¼ŒçŽ°åœ¨æˆ‘ä»¬éœ€è¦é€šè¿‡åˆ¶å®šæ¨¡å¼æ¥è¯†åˆ«å¯¹åº”çš„è¯æ³•å•å…ƒã€‚ä¸‹é¢æ˜¯å¤§éƒ¨åˆ†è¯æ³•å•å…ƒï¼Œä»¥åŠå¯¹åº”çš„æ¨¡å¼ï¼š è¯æ³•å•å…ƒ æ¨¡å¼ digit [0-9] digits digit+ number digits(.digits)?(E[+-]?digits)? letter [A-Za-z] id letter(letter,digit)* if if then then else else relop &lt;,&gt;,&lt;=,&gt;=,==,!= ws(ç©ºç™½ç¬¦) (blank,tab,newline)+ ç”±äºŽè¿™å—å„¿markdownè§£æžçš„é—®é¢˜ï¼ˆåŠ äº†è½¬ä¹‰å­—ç¬¦ä¹‹åŽä¾ç„¶æ˜¾ç¤ºæœ‰ç‚¹é—®é¢˜ï¼‰ï¼Œæˆ‘å°†â€|â€æ›¿æ¢ä¸ºâ€,â€ã€‚åœ¨ç†è§£çš„æ—¶å€™åªéœ€è¦å°†â€,â€æ›´æ”¹ä¸ºâ€|â€å³å¯ã€‚ ä¸Šè¡¨ä¸­çš„è¯æ³•å•å…ƒwså’Œå…¶ä»–è¯æ³•å•å…ƒä¸åŒã€‚å½“æˆ‘ä»¬è¯†åˆ«åˆ°wsæ—¶ï¼Œ æˆ‘ä»¬å¹¶ä¸å°†å®ƒè¿”å›žç»™è¯­æ³•åˆ†æžå™¨ï¼Œè€Œæ˜¯ä»Žè¿™ä¸ªç©ºç™½ç¬¦ä¹‹åŽçš„å­—ç¬¦å¼€å§‹ç»§ç»­è¿›è¡Œè¯æ³•åˆ†æžã€‚è¿”å›žç»™è¯­æ³•åˆ†æžå™¨çš„æ˜¯ä¸‹ä¸€ä¸ªè¯æ³•å•å…ƒ ã€‚ æˆ‘ä»¬ä»Žå‰é¢çš„çŸ¥è¯†äº†è§£åˆ°ï¼Œè¯æ³•åˆ†æžå™¨é€šè¿‡å¯¹åº”æ¨¡å¼è¯†åˆ«åˆ°è¯æ³•å•å…ƒä¹‹åŽï¼Œä¼šå°†è¯æ³•å•å…ƒåè¿”å›žç»™è¯­æ³•åˆ†æžå™¨ï¼ˆç©ºç™½ç¬¦é™¤å¤–ï¼‰ï¼Œä»¥åŠå¯¹åº”è¯æ³•å•å…ƒçš„å±žæ€§æ¥ç¡®å®šæŸä¸€ç‰¹å®šå®žä¾‹ã€‚ä¸‹è¡¨å±•ç¤ºäº†å¯¹åº”è¯æ³•å•å…ƒï¼Œå’Œå¯¹åº”å±žæ€§ï¼š è¯ç´  è¯æ³•å•å…ƒåå­— å±žæ€§å€¼ ä»»ä½•ç©ºç™½ç¬¦ - - if if - else else - id id æŒ‡å‘ç¬¦å·è¡¨æ¡ç›®çš„æŒ‡é’ˆ number number æŒ‡å‘ç¬¦å·è¡¨æ¡ç›®çš„æŒ‡é’ˆ &lt; relop LT &gt; relop GT â€¦ â€¦ â€¦ != relop NE è¡¨æ ¼é‡Œé¢çš„relopè¯æ³•å•å…ƒï¼ŒåŒºåˆ†å…¶å…·ä½“å®žä¾‹æ˜¯é€šè¿‡å¯¹åº”è¯æ³•å•å…ƒå±žæ€§å€¼è¿›è¡Œã€‚ è¿™ä¸€èŠ‚ä¸»è¦æ˜¯äº†è§£äº†è¯æ³•å•å…ƒç›¸å…³çŸ¥è¯†å…¶ä¸­ï¼ŒåŒ…æ‹¬æœ‰è¯æ³•å•å…ƒã€è¯ç´ å’Œæ¨¡å¼ã€‚ä¸ºäº†èƒ½å¤Ÿäº†è§£æ¨¡å¼ï¼Œæˆ‘ä»¬åˆå­¦ä¹ äº†ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¸‹ä¸€èŠ‚åˆ™ä¸»è¦æ˜¯è®²è§£è¯æ³•å•å…ƒçš„è¯†åˆ«ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[A Malloc Tutorial]]></title>
      <url>%2F2019%2F02%2F17%2Fa_malloc_tutorial%2F</url>
      <content type="text"><![CDATA[å‰è¨€æœ¬ç¯‡æ–‡ç« æ˜¯å¯¹è¯¥æ–‡ç« çš„ç¿»è¯‘ï¼Œå¦‚æœ‰ç–‘é—®å¯å¯¹ç…§åŽŸæ–‡ã€‚ ä¸€ã€ä»‹ç»ä»€ä¹ˆæ˜¯mallocï¼Ÿå¦‚æžœè¿žè¿™ä¸ªåå„¿éƒ½æ²¡æœ‰å¬è¯´çš„è¯ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰å…ˆåŽ»å­¦ä¹ ä¸€ä¸‹UnixçŽ¯å¢ƒä¸‹çš„Cè¯­è¨€ã€‚å¯¹äºŽç¨‹åºå‘˜æ¥è¯´ï¼Œmallocæ˜¯åœ¨Cè¯­è¨€ç¼–ç¨‹ä¸­åˆ†é…ä¸€å—å†…å­˜çš„å‡½æ•°ï¼Œç„¶åŽå¤§å¤šæ•°äººå¹¶ä¸çŸ¥é“å…¶èƒŒåŽçš„çœŸå®žæƒ…å†µï¼Œæˆ–è€…ä»…ä»…æ˜¯è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªsyscallæˆ–è€…è¯­è¨€å…³é”®å­—ã€‚è¿™ç¯‡æ–‡ç« ä¸­åªéœ€è¦ä¸€äº›Cçš„æŠ€èƒ½å’Œä¸€äº›ç³»ç»ŸçŸ¥è¯†ï¼Œå°±èƒ½äº†è§£åˆ°mallocä¹Ÿåªä¸è¿‡æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°è€Œå·²ã€‚æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ç¼–å†™ä¸€ä¸ªç®€å•çš„mallocå‡½æ•°ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬äº†è§£åº•å±‚æ¦‚å¿µã€‚å…¶ç›®çš„å¹¶ä¸æ˜¯ä¸ºäº†å®žçŽ°ä¸€ä¸ªé«˜æ•ˆçš„mallocï¼Œä»…ä»…æä¾›åŸºç¡€åŠŸèƒ½ã€‚ä½†æ˜¯èƒŒåŽçš„æ¦‚å¿µèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°åŽ»ç†è§£è¿›ç¨‹ä¸­å†…å­˜æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Œä»¥åŠå¦‚ä½•å¤„ç†å—çš„åˆ†é…ï¼Œå†åˆ†é…ä»¥åŠé‡Šæ”¾ç­‰ç­‰ã€‚ç«™åœ¨æ•™å­¦çš„è§’åº¦æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„Cè¯­è¨€ç¼–ç¨‹ç»ƒä¹ ã€‚åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½æ–‡æ¡£ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç†è§£æŒ‡é’ˆæ€Žä¹ˆæ¥çš„ï¼Œå®ƒä»¬åœ¨å †é‡Œé¢æ˜¯æ€Žæ ·ç»„ç»‡èµ·æ¥çš„ã€‚ mallocæ˜¯ä»€ä¹ˆ12#include &lt;stdlib.h&gt; void *malloc(size_t size); mallocæ˜¯ä¸€ä¸ªæ ‡å‡†Cåº“å‡½æ•°ï¼Œç”¨äºŽåˆ†é…å†…å­˜å—ã€‚å®ƒéµå¾ªä»¥ä¸‹è§„åˆ™ï¼š mallocè‡³å°‘è¦åˆ†é…è¯·æ±‚å­—èŠ‚å¤§å°ï¼ˆsizeï¼‰å†…å­˜ï¼› mallocçš„è¿”å›žçš„æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå·²åˆ†é…çš„å†…å­˜ï¼ˆæ¯”å¦‚ä¸€ä¸ªåœ¨ç¼–ç¨‹æ—¶å¯è¯»æˆ–è€…å¯å†™çš„ç©ºé—´ï¼‰ï¼› åœ¨è¯¥æŒ‡é’ˆæ²¡æœ‰è¢«é‡Šæ”¾ä¹‹å‰ï¼Œå…¶ä»–ä»»ä½•çš„mallocè°ƒç”¨éƒ½ä¸ä¼šåˆ†é…è¯¥ç©ºé—´æˆ–è€…è¯¥ç©ºé—´ä¸­çš„ä»»ä½•ä¸€éƒ¨åˆ†ï¼› mallocåº”è¯¥èƒ½å¾ˆå¥½å¤„ç†ï¼Œè€Œä¸”èƒ½å¤Ÿå¾ˆå¿«æ‰§è¡Œç»“æŸï¼› mallocéœ€è¦æä¾›é‡æ–°è®¾ç½®å¤§å°æˆ–è€…é‡Šæ”¾çš„èƒ½åŠ›ï¼› mallocå‡½æ•°è¿”å›žçš„æŒ‡é’ˆåœ¨å¤±è´¥æˆ–è€…æ²¡æœ‰å¯ç”¨å†…å­˜ç©ºé—´çš„æƒ…å†µä¸‹ä¸ºNULLã€‚ äºŒã€å †å’Œbrkã€sbrkç³»ç»Ÿè°ƒç”¨åœ¨ç¼–å†™mallocä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å†…å­˜åœ¨å¤šä»»åŠ¡ç³»ç»Ÿä¸­æ˜¯å¦‚ä½•ç®¡ç†çš„ã€‚ç”±äºŽå…·ä½“å®žçŽ°ä¾èµ–äºŽæ“ä½œç³»ç»Ÿçš„å®žçŽ°ç»†èŠ‚ï¼Œä¸‹é¢æåˆ°çš„å†…å®¹æ›´å¤šæ˜¯åŸºäºŽæŠ½è±¡çš„æ¦‚å¿µæ¥è¿›è¡Œé˜è¿°ã€‚ è¿›ç¨‹çš„å†…å­˜æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç”±MMUï¼ˆå†…æ ¸ï¼‰æä¾›ä»Žè™šæ‹Ÿåœ°å€ç©ºé—´åˆ°ç‰©ç†åœ°å€ç©ºé—´çš„è½¬æ¢ã€‚è€Œè¯¥ç©ºé—´è¢«åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚ç”¨æˆ·å­˜å‚¨å±€éƒ¨å˜é‡å’Œvolatileå˜é‡çš„æ ˆï¼Œè¿˜æœ‰å­˜å‚¨å¸¸é‡å’Œå…¨å±€å˜é‡çš„ç©ºé—´ï¼Œä»¥åŠç”¨äºŽå­˜å‚¨ç¨‹åºæ•°æ®ï¼Œç§°ä¸ºå †çš„æ•£ä¹±ç©ºé—´ã€‚ å°±è™šæ‹Ÿåœ°å€è€Œè¨€ï¼Œå †æ˜¯ä¸€ä¸ªè¿žç»­çš„å†…å­˜ç©ºé—´ï¼Œå®ƒæœ‰ä¸‰ä¸ªåˆ’åˆ†çš„è¾¹ç•Œï¼šèµ·å§‹ç‚¹ã€æœ€å¤§å€¼å’Œç§°ä¸€ä¸ªä¸ºbreakçš„ç»ˆç‚¹ã€‚æœ€å¤§å€¼çš„ç®¡ç†å¯ä»¥è°ƒç”¨(åŽŸæ–‡ä¸­å†™æˆäº†sys/ressource.h)é‡Œé¢çš„setrlimitå’Œgetrlimitã€‚breakç”¨äºŽæ ‡è®°å·²æ˜ å°„å†…å­˜ç©ºé—´çš„å°¾éƒ¨ï¼Œå·²æ˜ å°„å†…å­˜ç©ºé—´æŒ‡çš„æ˜¯å·²ç»å’Œå®žé™…å†…å­˜ä¸€ä¸€å¯¹åº”èµ·æ¥çš„é‚£éƒ¨åˆ†è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆæˆ‘çš„ç†è§£ä¹Ÿå°±æ˜¯å¯¹åº”çš„PTEé‡Œé¢æœ‰æ•ˆä½åº”è¯¥æ˜¯ä¸º1ï¼Œæ›´æˆ–è€…TLBæœ‰å¯¹åº”çš„ç¼“å­˜çš„Pageï¼‰ã€‚ä¸‹å›¾å±•ç¤ºäº†å†…å­˜ç»„ç»‡çš„å½¢å¼ï¼š ä¸ºäº†èƒ½å¤Ÿç¼–å†™mallocå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å †ï¼ˆheapï¼‰çš„å¼€å§‹ä½ç½®å’Œbreakçš„ä½ç½®ã€‚å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦æœ‰èƒ½åŠ›åŽ»ç§»åŠ¨breakï¼Œå¯ä»¥ä½¿ç”¨brkå’Œsbrkç³»ç»Ÿè°ƒç”¨æ¥å®žçŽ°ã€‚ brkå’Œsbrkæˆ‘ä»¬å¯ä»¥åœ¨ä»–ä»¬çš„æ‰‹å†Œï¼ˆæ¯”å¦‚man brkï¼‰é‡Œé¢æ‰¾åˆ°å…³äºŽè¿™äº›ç³»ç»Ÿè°ƒç”¨çš„æè¿°ï¼š 12int brk(const void *addr);void *sbrk(int incr); brkå‡½æ•°é€šè¿‡ä¼ å…¥çš„ addr æ¥è®¾ç½®brakçš„å€¼ï¼ŒæˆåŠŸè¿”å›ž0ï¼Œå¤±è´¥è¿”å›ž-1ã€‚ä½¿ç”¨å…¨å±€errnoæ¥æŒ‡æ˜Žé”™è¯¯çš„åŽŸå› ï¼ˆé”™è¯¯ç å¯¹åº”çš„é”™è¯¯ä¿¡æ¯å¯ä»¥åœ¨\ä¸­æŸ¥çœ‹ï¼‰ï¼› è€Œsbrké€šè¿‡ä¼ å…¥çš„å¢žé‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰æ¥ç§»åŠ¨breakçš„ä½ç½®ã€‚åŸºäºŽä¸åŒç³»ç»Ÿçš„å®žçŽ°ï¼Œå…¶è¿”å›žå€¼å¯èƒ½ä¼šè¿”å›žè€çš„åœ°å€ï¼Œä¹Ÿå¯èƒ½è¿”å›žç§»åŠ¨ä¹‹åŽæ–°çš„åœ°å€ã€‚å¦‚æžœå‡½æ•°è°ƒç”¨å¤±è´¥åˆ™è¿”å›ž-1ï¼Œå¹¶ä¸”è®¾ç½®errnoçš„å€¼ã€‚åœ¨æœ‰äº›ç³»ç»Ÿä¸Šsbrkæ”¯æŒä¼ å…¥ä¸€ä¸ªè´Ÿæ•°ç”¨äºŽé‡Šæ”¾é‚£äº›å·²è¢«æ˜ å°„çš„åœ°å€ç©ºé—´ã€‚ ç”±äºŽsbrkæ²¡æœ‰è§„èŒƒå…¶è¿”å›žå€¼çš„æ„ä¹‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ ç§»åŠ¨breakçš„æ—¶å€™ ä¸ä¼šåŽ»ä½¿ç”¨å®ƒè¿”å›žå€¼ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹å®šæƒ…å†µä¸‹çš„sbrkï¼Œå½“è°ƒç”¨sbrkå…¶å¢žé‡ä¸º0æ—¶ï¼Œå®ƒçš„è¿”å›žå€¼å°±æ˜¯å®žé™…çš„breakåœ°å€ï¼ˆä¹Ÿå°±æ˜¯è€çš„åœ°å€å’Œæ–°çš„åœ°å€æ˜¯åŒä¸€ä¸ªå€¼ï¼‰ã€‚å› æ­¤sbrkç”¨äºŽèŽ·å–å †çš„å¼€å§‹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯breakçš„åˆå§‹ä½ç½®ï¼ˆä¸Šå›¾ä¸­mapped Regioné•¿åº¦ä¸º0çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯breakçš„åˆå§‹ä½ç½®ï¼‰ã€‚ å› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨sbrkä½œä¸ºæˆ‘ä»¬ä¸»è¦çš„å·¥å…·ã€‚è€Œæˆ‘ä»¬çš„ç›®çš„æ˜¯åœ¨éœ€è¦æ›´å¤šç©ºé—´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯èŽ·å–æ›´å¤šçš„èµ„æºæ¥æ»¡è¶³éœ€æ±‚ã€‚ æœªæ˜ å°„åŒºåŸŸå’Œæ— äººåŒºï¼ˆNo-Manâ€™s Landï¼‰æˆ‘ä»¬çœ‹ä¸€ä¸‹æ—©æœŸbreakæ ‡è®°å·²æ˜ å°„è™šæ‹Ÿåœ°å€ç©ºé—´ç»“æŸç‚¹çš„åŽŸç†ï¼šåœ¨è®¿é—®breakä¹‹å‰çš„åŒºåŸŸæ—¶ä¼šè§¦å‘ä¸€ä¸ªæ€»çº¿é”™è¯¯ã€‚åœ¨breakç‚¹å’Œæœ€å¤§é™åˆ¶ï¼ˆrlimitï¼‰ä¹‹é—´çš„ç©ºé—´ï¼Œç³»ç»Ÿï¼ˆMMUå’Œå†…æ ¸éƒ¨åˆ†ï¼‰æ˜¯æ²¡æœ‰å°†ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜å…³è”èµ·æ¥çš„ã€‚å¦‚æžœçŸ¥é“ä¸€ç‚¹å…³äºŽè™šæ‹Ÿå†…å­˜çš„çŸ¥è¯†çš„è¯ï¼Œåº”è¯¥æ¸…æ¥šå†…å­˜æ˜¯é€šè¿‡é¡µçš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†ï¼šç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜é€šå¸¸æƒ…å†µä¸‹ä»¥å›ºå®šå¤§å°çš„é¡µé¢è¿›è¡Œç»„ç»‡ï¼Œè€Œé¡µçš„å¤§å°åœ¨å®žé™…ç³»ç»Ÿä¸­é€šå¸¸ä¸º4096Byteï¼ˆ4KBï¼‰ã€‚å› æ­¤breakç‚¹å¯èƒ½å¹¶ä¸æ˜¯åœ¨æ•´é¡µçš„è¾¹ç•Œä¸Šã€‚è¯´ç‚¹é¢˜å¤–è¯ï¼Œåœ¨ã€ŠçŽ°ä»£æ“ä½œç³»ç»Ÿã€‹ä¸­ä»‹ç»ç¼ºé¡µå¤„ç†ç¨‹åºæ˜¯é€šè¿‡æ‡’åŠ è½½çš„æ–¹å¼æ¥å°†ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜è”ç³»èµ·æ¥çš„ã€‚ä¸è€ƒè™‘TLBçš„æƒ…å†µä¸‹ï¼ŒMMUæ˜¯å°†VPNå’ŒPPNé€šè¿‡PTEæ¥è¿›è¡Œæ˜ å°„çš„ å›¾äºŒç›¸æ¯”äºŽå›¾ä¸€ï¼Œæˆ‘ä»¬å¢žåŠ äº†é¡µé¢è¾¹ç•Œçš„è¡¨ç¤ºã€‚å¯ä»¥çœ‹åˆ°breakå¹¶æ²¡æœ‰å’Œé¡µè¾¹ç•Œå»åˆå¯¹åº”èµ·æ¥ã€‚é‚£ä¹ˆå¤„äºŽbreakå’Œä¸‹ä¸€é¡µè¾¹ç•Œä¹‹é—´çš„å†…å­˜æ˜¯ä»€ä¹ˆçŠ¶æ€å‘¢ï¼Ÿå®žé™…ä¸Šï¼Œè¿™ä¸€æ®µç©ºé—´æ˜¯å¯ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™æ®µç©ºé—´è¿›è¡Œè¯»å†™æ“ä½œã€‚ä½†é—®é¢˜åœ¨äºŽæˆ‘ä»¬æ²¡æœ‰åŠžæ³•çŸ¥é“ä¸‹ä¸€é¡µè¾¹ç•Œçš„ä»»ä½•å¤´ç»ªï¼Œå®ƒçš„å®žçŽ°æ˜¯éžå¸¸ä¾èµ–äºŽç‰¹å®šç³»ç»Ÿçš„ï¼Œæ‰€ä»¥å¯¹äºŽå¯ç§»æ¤æ€§æ¥è¯´ï¼Œä¸å»ºè®®è¿™ä¹ˆåŽ»åšã€‚ æ— äººåŒºï¼ˆno-manâ€™s landï¼‰å¯èƒ½æ˜¯å¤§éƒ¨åˆ†BUGçš„æ ¹æºï¼šåœ¨å †å¤–é¢è¿›è¡Œé”™è¯¯åœ°æŒ‡é’ˆæ“ä½œæ—¶ï¼Œå¯¹äºŽå°è§„æ¨¡æµ‹è¯•å¤§éƒ¨åˆ†æ—¶é—´æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œä½†æ˜¯åœ¨æ›´å¤§é‡æ•°æ®çš„æ—¶å€™è¯¥æ“ä½œå°±ä¼šå‡ºçŽ°å¤±è´¥ã€‚ mmapå°½ç®¡åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­æˆ‘ä»¬å¹¶ä¸ä¼šä½¿ç”¨å®ƒï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥è¦æ³¨æ„åˆ°mmapç³»ç»Ÿè°ƒç”¨ã€‚mmapå¤§éƒ¨åˆ†æƒ…å†µç”¨äºŽå°†æ–‡ä»¶å’Œå†…å­˜æ˜ å°„èµ·æ¥ï¼Œä½†æ˜¯å®ƒå¯ä»¥ä»¥åŒ¿åæ¨¡å¼æ¥å®žçŽ°mallocï¼ˆåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼‰ã€‚åŒ¿åæ¨¡å¼ä¸‹çš„mmapå¯ä»¥åˆ†é…æŒ‡å®šæ•°é‡çš„å†…å­˜ï¼ˆä»¥é¡µé¢å¤§å°ä¸ºå•ä½ï¼‰ï¼Œmunmapå¯ä»¥é‡Šæ”¾æŽ‰å®ƒä»¬ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼å®žçŽ°çš„mallocç›¸è¾ƒäºŽä¼ ç»ŸåŸºäºŽsbrkå®žçŽ°çš„mallocé€šè¿‡æ›´åŠ ç®€å•ã€‚ æœ‰äº›mallocä½¿ç”¨mmapæ¥å®žçŽ°å¤§å†…å­˜çš„åˆ†é…ï¼ˆè¶…è¿‡ä¸€é¡µçš„å¤§å°ï¼‰ã€‚OpenBSDçš„åšæ³•æ˜¯ä½¿ç”¨mmapå¹¶æ­é…ä¸€äº›å¥‡æŠ€æ·«å·§æ¥å¢žåŠ å®‰å…¨æ€§ï¼ˆé¡µä¸Žé¡µä¹‹é—´åœ¨åˆ†é…çš„æ—¶å€™å¢žåŠ è¾¹æ¡†æ¥è¿›è¡Œåˆ†é…ã€‚è¿™é‡Œç¿»è¯‘ä¸å¤ªé¡ºï¼ŒåŠ è¾¹æ¡†çš„æ„æ€æ˜¯åœ¨é¡µçš„è¾¹ç•Œå¤„ä½¿ç”¨é¢å¤–çš„ç©ºé—´æ¥è¾¾åˆ°æ•´é¡µä½¿ç”¨çš„æ•ˆæžœï¼Œæƒ³è±¡å·ç§¯çš„æ—¶å€™å¢žåŠ paddingæ¥è¯»å–çŸ©é˜µå·¦ä¸Šè§’çš„æ•°æ®ã€‚å¦‚æžœç¿»è¯‘æœ‰é—®é¢˜è¯·è”ç³»æˆ‘ï¼‰ã€‚ ä¸‰ã€Dummy mallocé¦–å…ˆï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨sbrkæ¥å‡è®¾ä¸€ä¸ªmallocã€‚è¿™ä¸ªç‰ˆæœ¬çš„mallocå¯èƒ½æ˜¯æœ€å·®çš„ä¸€ä¸ªï¼Œç”šè‡³æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªã€‚ åŽŸç†æ€æƒ³å¾ˆç®€å•ï¼Œæ¯æ¬¡åœ¨è°ƒç”¨mallocçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ ¹æ®è¯·æ±‚çš„ç©ºé—´å¤§å°æ¥ç§»åŠ¨breakï¼Œå¹¶ä¸”è¿”å›žbreakä¹‹å‰çš„åœ°å€ã€‚è¿™æ ·åšçš„ç¡®å¤Ÿç®€å•ï¼Œä¹Ÿå¤Ÿå¿«ã€‚ã€‚ã€‚å®ƒä»…ä»…åªéœ€è¦ä¸‰è¡Œä»£ç ã€‚ä½†æ˜¯è¿™æ ·çš„è¯æˆ‘ä»¬æ²¡æ³•åŽ»å®žçŽ°ä¸€ä¸ªçœŸå®žçš„freeï¼Œå½“ç„¶reallocåŒæ ·ä¹Ÿä¸è¡Œã€‚ è¿™ä¸ªç‰ˆæœ¬çš„mallocä¼šæµªè´¹å¾ˆå¤§ä¸€éƒ¨åˆ†ç”¨è¿‡çš„å†…å­˜å—å„¿ã€‚åœ¨è¿™å„¿åªæ˜¯å‡ºäºŽç§‘æ™®çš„ç›®çš„æ¥æŒ‡å‡ºå¦‚ä½•sbrkç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ ·è¿˜å°†ä¸ºmallocæ·»åŠ ä¸€äº›é”™è¯¯ç®¡ç†ã€‚ å®žçŽ°123456789void *malloc(size_t size)&#123; void *p; p = sbrk(0); /// å¦‚æžœsbrkå¤±è´¥ï¼Œè¿”å›žNULL if (-1 == sbrk(size)) &#123; return NULL; &#125; return p;&#125; å››ã€ç»„ç»‡å †ï¼ˆOrganizing the Heapï¼‰åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å†™äº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„mallocå‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ»¡è¶³æˆ‘ä»¬æ‰€æœ‰çš„éœ€æ±‚ï¼ˆå‰é¢æåˆ°çš„freeå’Œreallocï¼‰ã€‚åœ¨è¿™ä¸€èŠ‚æˆ‘ä»¬ä¼šå°è¯•æ‰¾åˆ°ä¸€ä¸ªé«˜æ•ˆç»„ç»‡heapçš„æ–¹æ¡ˆï¼Œå…¶ä¸­åŒ…æ‹¬äº†mallocã€freeå’Œreallocã€‚ æˆ‘ä»¬éœ€è¦ä»€ä¹ˆå¦‚æžœæˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸Šä¸‹æ–‡ä¹‹å¤–æ€è€ƒé—®é¢˜ï¼Œèƒ½æŽ¨æ–­å‡ºåœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å“ªäº›ä¿¡æ¯å—ï¼Ÿæ¥çœ‹ä¸ªæ¯”å–»ï¼šä½ æ‹¥æœ‰ä¸€ç‰‡å†œåœºï¼Œå¹¶å°†ä»–ä»¬åˆ’åˆ†æˆå¾ˆå¤šå—å†œç”°åŒºåŸŸå‡ºæ¥ã€‚å°†è¿™äº›åˆ†å—çš„å†œç”°å‡ºç§Ÿå‡ºåŽ»ã€‚ç§Ÿæˆ·å¸Œæœ›ç§Ÿç”¨è¿žç»­çš„ï¼Œä½†ä¸åŒé•¿åº¦çš„å†œç”°ï¼ˆè¿™é‡Œåªä½¿ç”¨é•¿åº¦è¿™ä¸ªç»´åº¦æ¥åˆ’åˆ†ï¼Œä¸è€ƒè™‘é¢ç§¯ï¼‰ã€‚å½“ç§Ÿæˆ·ä½¿ç”¨å®Œæˆä¹‹åŽå°†å…¶ç§Ÿç”¨å†œç”°å½’è¿˜ï¼Œä»¥ä¾¿ä¸‹æ¬¡ç»§ç»­å‘å¤–å‡ºç§Ÿã€‚ åœ¨å†œåœºè¾¹æä¾›äº†ç”¨äºŽè¡Œé©¶â€œå¯ç¼–ç¨‹â€è½¦çš„é“è·¯ï¼šè¾“å…¥è·ç¦»å¼€å§‹ç‚¹çš„åç§»é‡å’Œç›®çš„åœ°ï¼ˆç›®çš„åœ°æ˜¯ä¸€å—ä¸æ˜¯ä¸€ä¸ªç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œè¡¨è¾¾çš„æ˜¯è¯¥å—çš„å¼€å§‹ç‚¹ä½ï¼‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸€å—çš„å¼€å§‹ç‚¹åœ¨å“ªå„¿ï¼Œè€Œä¸”å½“æˆ‘ä»¬å¤„äºŽæŸä¸€å—çš„èµ·å§‹ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ä¸‹ä¸€å—çš„åœ°å€ã€‚ å…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯åœ¨æ¯ä¸€å—å†œç”°çš„å¼€å¤´éƒ¨åˆ†æ”¾å…¥ä¸€ä¸ªæ ‡ç­¾æ¥æ ‡æ˜Žä¸‹ä¸€å—çš„åœ°å€ï¼ˆå’Œå½“å‰å—çš„å¤§å°ä»¥é¿å…ä¸å¿…è¦çš„è®¡ç®—ï¼‰ï¼Œå½“ç§Ÿæˆ·å°†å†œç”°èµ„æºå½’è¿˜çš„æ—¶å€™ï¼Œåœ¨ç©ºé—²åŒºåŸŸæ·»åŠ ä¸€ä¸ªæ ‡è®°ã€‚å¥½äº†ï¼ŒçŽ°åœ¨å½“ç§Ÿæˆ·æƒ³è¦å›ºå®šå¤§å°å†œç”°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¸¦ç€ä»–è¡Œé©¶åœ¨ä¸€å¤„ä¸€å¤„çš„æ ‡ç­¾é‚£å„¿åŽ»ã€‚å½“æˆ‘ä»¬å‘çŽ°ä¸€å—æ ‡è®°ä¸ºå¯ç”¨çŠ¶æ€çš„å†œç”°ï¼Œå¹¶ä¸”è¶³å¤Ÿäº¤ä»˜ç§Ÿæˆ·éœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†è¯¥ç©ºé—²æ ‡è®°ä»Žæ ‡ç­¾ä¸­ç§»é™¤ã€‚ä½†æ˜¯å¦‚æžœåˆ°è¾¾æœ€åŽä¸€å—å†œç”°ï¼ˆä¹Ÿå°±æ˜¯æ ‡ç­¾ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªå†œç”°çš„åœ°å€ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ°è¾¾è¯¥åŒºåŸŸçš„æœ«å°¾å¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„æ ‡è®°ã€‚ çŽ°åœ¨æˆ‘ä»¬å°†è¿™ä¸ªæ¯”å–»è½¬æ¢åˆ°å†…å­˜ï¼š æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€å—å¼€å§‹éƒ¨åˆ†å­˜å‚¨é¢å¤–çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸€ä¸ªå—çš„å¤§å°ã€ä¸‹ä¸€ä¸ªå—çš„åœ°å€ã€ä»¥åŠæ˜¯å¦ç©ºé—²ç­‰ä¿¡æ¯ã€‚ å¦‚ä½•è¡¨ç¤ºå—ä¿¡æ¯æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€ä¸ªå¤§å—ï¼ˆchunkï¼‰çš„å¼€å§‹éƒ¨åˆ†åŒ…å«ä¸€å°æ®µï¼ˆblockï¼‰ç”¨äºŽå®¹çº³é¢å¤–ä¿¡æ¯ï¼Œè¿™ä¸€å°æ®µæˆ‘ä»¬æˆä¸ºâ€œmeta-dataâ€ï¼›è¯¥æ®µè‡³å°‘åŒ…å«äº†ä¸‹ä¸€å—çš„æŒ‡é’ˆã€ç”¨äºŽç©ºé—²å—çš„æ ‡è®°ã€ä»¥åŠè¯¥å—æ•°æ®å¤§å°ã€‚å½“ç„¶ï¼Œè¯¥æ®µä¿¡æ¯æ˜¯åœ¨mallcå‡½æ•°è¿”å›žçš„æŒ‡é’ˆä¹‹å‰ã€‚ å›¾ä¸‰å±•ç¤ºäº†ä¸€ä¸ªå †ç»„ç»‡çš„ä¾‹å­ï¼Œå«æœ‰å·²åˆ†é…æ®µå‰é¢çš„meta-dataã€‚ æ¯ä¸€ä¸ªå¤§å—ï¼ˆchunkï¼‰ç”±æ•°æ®å—å’Œmeta-dataç»„æˆï¼Œmallocå‡½æ•°è¿”å›žçš„æŒ‡é’ˆåœ¨ä¸Šå›¾ä¸‹é¢ç”±çº¢è‰²æ ‡è®°å‡ºæ¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¯¥æŒ‡é’ˆæ˜¯æŒ‡å‘çš„æ•°æ®å—ï¼Œå¹¶ä¸æ˜¯å®Œæ•´çš„å¤§å—ï¼ˆchunkï¼Œä¸æ˜¯æŒ‡å‘meta-dataçš„èµ·å§‹ç‚¹ï¼‰ã€‚çŽ°åœ¨æˆ‘ä»¬éœ€è¦æ€Žæ ·æ¥æŠŠè¿™äº›ç”¨Cä»£ç è¡¨ç¤ºå‡ºæ¥å‘¢ï¼Ÿè¿™ä¸ªçœ‹èµ·æ¥åƒä¼ ç»Ÿçš„é“¾è¡¨ï¼ˆå®žé™…ä¸Šå°±æ˜¯ä¸ªé“¾è¡¨ï¼‰ã€‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªé“¾è¡¨ç±»åž‹ï¼Œè¯¥ç±»åž‹æˆå‘˜ç”¨æ¥è¡¨ç¤ºæ‰€éœ€çš„ä¿¡æ¯ã€‚æˆ‘ä»¬ä½¿ç”¨ typedefæ¥ç®€åŒ–ç»“æž„ç±»åž‹ï¼š 123456typedef struct s_block* t_block;struct s_block &#123; size_t size; t_block next; int free;&#125;; åœ¨è¿™å„¿çœ‹èµ·æ¥ä½¿ç”¨intåž‹çš„freeæ ‡è®°æœ‰ç‚¹æµªè´¹ç©ºé—´ï¼Œä½†ç”±äºŽstructé»˜è®¤æ˜¯å†…å­˜å¯¹é½çš„ï¼Œå› æ­¤å®ƒä¸ä¼šæ”¹å˜ä»»ä½•å†…å®¹ï¼Œç¨åŽæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä½•ç¼©å°meta-dataçš„å¤§å°ã€‚åŽç»­æˆ‘ä»¬ä¼šçœ‹åˆ°mallocè¿”å›žçš„åœ°å€å¿…é¡»æ˜¯å†…å­˜å¯¹é½çš„åœ°å€ã€‚è¿™å„¿å‡ºçŽ°æœ€é¢‘ç¹çš„é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬å¦‚ä½•åœ¨æ²¡æœ‰mallocçš„æƒ…å†µä¸‹åŽ»åˆ›å»ºä¸€ä¸ªstructï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“structå®žé™…ä¸Šæ˜¯ä»€ä¹ˆã€‚åœ¨å†…å­˜ä¸­ï¼Œstructåªæ˜¯å°†ä¸€å—å„¿åŒºåŸŸç»“åˆäº†èµ·æ¥ï¼Œæ‰€ä»¥ç»“æž„s_blockä»…ä»…åªæ˜¯12å­—èŠ‚ï¼ˆå¯¹äºŽ32ä½æ•´åž‹æ¥è¯´ï¼‰ã€‚sizeå­—æ®µå¯¹åº”å‰é¢çš„4å­—èŠ‚ï¼ŒæŽ¥ä¸‹æ¥çš„4å­—èŠ‚æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªblockçš„nextæŒ‡é’ˆï¼Œæœ€åŽ4ä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ªæ•´åž‹çš„freeæ ‡è®°ã€‚å½“ç¼–è¯‘å™¨é‡åˆ°è®¿é—®ç»“æž„çš„åŸŸæ—¶ï¼ˆæ¯”å¦‚s.freeæˆ–è€…p-&gt;freeï¼‰ï¼Œå°†å…¶è½¬æ¢ä¸ºè¯¥ç»“æž„çš„åŸºåœ°å€åŠ ä¸Šè¯¥åŸŸä¹‹å‰é•¿åº¦çš„å’Œã€‚æ¯”å¦‚ï¼šp-&gt;freeå°±æ˜¯((char )p+8)ï¼Œs.freeå°±æ˜¯((char )&amp;s+8)ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨sbrkåˆ†é…è¶³å¤Ÿçš„ç©ºé—´å—ï¼ˆåŒ…å«äº†meta-dataçš„å¤§å°å’Œæ•°æ®å—çš„å¤§å°ï¼‰ï¼Œå¹¶å°†è€çš„breakæ”¾å…¥t_blockç±»åž‹çš„å˜é‡å†…ï¼š 12345678/* Example of using t_block without malloc */t_block b;/// ä½¿ç”¨bä¿å­˜è€çš„breakb = sbrk(0);/// æ·»åŠ æ‰€éœ€ç©ºé—´/// sizeå˜é‡æ˜¯mallocå‡½æ•°çš„å‚æ•°sbrk(sizeof(struct s_block)+size);b-&gt;size = size; äº”ã€é¦–æ¬¡é€‚é…ç­–ç•¥çš„mallocâ€œé¦–æ¬¡é€‚é…â€æ˜¯æˆ‘é‡‡ç”¨ã€Šæ·±å…¥äº†è§£è®¡ç®—è®¡ç®—æœºç³»ç»Ÿã€‹çš„ç¿»è¯‘è¯ã€‚åœ¨è¿™ä¸€èŠ‚æˆ‘ä»¬å°†ä¼šå®žçŽ°ç»å…¸çš„é¦–æ¬¡é€‚é…ç­–ç•¥çš„mallocå‡½æ•°ã€‚é¦–æ¬¡é€‚é…ç®—æ³•å¾ˆç®€å•ï¼šæˆ‘ä»¬åªè¦æ‰¾åˆ°äº†ä¸€ä¸ªç©ºé—´å¤§å°è¶³å¤Ÿæ»¡è¶³è¯·æ±‚åˆ†é…çš„æ—¶å€™å°±åœæ­¢éåŽ†å…¶ä»–çš„å—ï¼ˆchunkï¼‰ã€‚ æŒ‡é’ˆå¯¹é½é€šå¸¸æƒ…å†µéœ€è¦å°†æŒ‡é’ˆå’Œæ•´åž‹å¤§å°å¯¹é½ï¼ˆå³ æŒ‡é’ˆå¤§å°å°±æ˜¯ä¸€ä¸ªæ•´åž‹çš„å¤§å°ï¼‰ã€‚æ­¤å¤„æˆ‘ä»¬åªè€ƒè™‘32ä½çš„æƒ…å†µï¼Œæ‰€ä»¥æŒ‡é’ˆæ˜¯4çš„å€æ•°ï¼ˆ32bit = 4 byteï¼Œé‚£å½“ç„¶æ˜¯4çš„å€æ•°ï¼‰ã€‚å› æ­¤æˆ‘ä»¬çš„meta-dataå·²å¯¹é½ï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦åšçš„åªæ˜¯åŽ»å¯¹é½æ•°æ®å—çš„å¤§å°ã€‚é‚£æˆ‘ä»¬è¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿè¿™å„¿æœ‰å‡ ç§æ–¹å¼ï¼Œæœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ç®—æœ¯æŠ€å·§æ·»åŠ é¢„å¤„ç†å®ã€‚é¦–å…ˆï¼Œç®—æœ¯æŠ€å·§ï¼šç»™å®šä»»æ„æ­£æ•´æ•°é™¤ä»¥4ï¼Œç„¶åŽå†å°†å®ƒä¹˜ä»¥4å¾—åˆ°æœ€æŽ¥è¿‘4çš„å€æ•°ã€‚å› æ­¤ä¸ºäº†èŽ·å¾—æœ€æŽ¥è¿‘ä¸”å¤§äºŽå®ƒæ—¶ï¼Œåªéœ€è¦ä¹˜ä»¥4ï¼Œç„¶åŽåœ¨æ­¤åŸºç¡€ä¸ŠåŠ 4ã€‚è¿™ç§æ–¹å¼çš„ç¡®å¾ˆç®€å•ï¼Œä½†å®ƒæ²¡åŠžæ³•å¾ˆå¥½åœ°å·¥ä½œåœ¨æœ¬èº«å°±æ˜¯4çš„å€æ•°ä¸Šï¼Œç»“æžœä¼šå˜æˆ4çš„å€æ•°çš„ä¸‹ä¸€ä¸ªï¼ˆç”±äºŽåŠ äº†4ï¼‰ã€‚å†æ¥ä½¿ç”¨ä¸€æ¬¡ç®—æœ¯ï¼Œå‡è®¾xæ˜¯æ•´åž‹ï¼Œå¹¶ä¸”æ»¡è¶³ï¼š 1ï¼‰ã€å¦‚æžœxæ˜¯4çš„å€æ•°ï¼Œé‚£ä¹ˆq = 0ï¼Œå¹¶ä¸”æ»¡è¶³ï¼š è¿ç”¨ä¸Šé¢è¯´çš„ï¼Œå…ˆé™¤ä»¥4ï¼Œç„¶åŽä¹˜ä»¥4ï¼Œæœ€åŽå†åŠ ä¸Š4ï¼š åœ¨è¿™ä¸ªæŽ¨ç®—è¿‡ç¨‹æ˜¯å°†ä¸Šé¢x-1çš„è¡¨ç¤ºç”¨pæ¥è¿›è¡Œè¡¨ç¤ºã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œåœ¨æ•´åž‹é™¤æ³•ä¸­3/4ç»“æžœä¸º0ï¼› 2ï¼‰ã€å¦‚æžœxä¸æ˜¯4çš„å€æ•°ï¼Œæ­¤æ—¶q != 0ï¼š åŒæ ·è¿ç”¨ä¸Šé¢çš„ï¼Œå…ˆé™¤ä»¥4ï¼Œç„¶åŽä¹˜ä»¥4ï¼Œæœ€åŽå†åŠ ä¸Š4ï¼š å› æ­¤ï¼Œå…¬å¼ _(x-1)/4 * 4 + 4_ çš„ç»“æžœæ˜¯æœ€æŽ¥è¿‘å¹¶ä¸”å¤§äºŽæˆ–è€…ç­‰äºŽ4çš„å€æ•°ã€‚ é‚£ä¹ˆæˆ‘ä»¬åœ¨Cé‡Œé¢è¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆï¼Œæ³¨æ„åˆ°é™¤æ³•å’Œä¹˜æ³•æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å³ç§»å’Œå·¦ç§»ç§»ä½æ“ä½œç¬¦æ¥è§£å†³ï¼ˆ&gt;&gt;å’Œ&lt;&lt;ï¼‰ï¼Œå®ƒä»¬ç›¸å¯¹äºŽç®€å•ä¹˜æ³•è¦å¿«å¾ˆå¤šã€‚å› æ­¤æˆ‘ä»¬çš„å…¬å¼åœ¨Cé‡Œé¢å¯ä»¥å†™æˆè¿™æ · ((x-1)&gt;&gt;2)&lt;&lt;2+4ï¼Œä½†æ˜¯åœ¨å®é‡Œé¢éœ€è¦ä½¿ç”¨é¢å¤–çš„æ‹¬å·ï¼š 1#define align4(x) (((((x)-1)&gt;&gt;2)&lt;&lt;2)+4) å¯»æ‰¾å—ï¼šé¦–æ¬¡é€‚é…ç®—æ³•æ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿé•¿åº¦çš„å—éžå¸¸ç®€å•ï¼šä»Žå †çš„èµ·å§‹ç‚¹å¼€å§‹ï¼ˆä»¥æŸç§æ–¹å¼ä¼šä¿å­˜åœ¨ä»£ç ï¼ŒåŽç»­ä¼šçœ‹åˆ°ï¼‰æµ‹è¯•å½“å‰å—ï¼Œå¦‚æžœè¯¥å—æˆåŠŸé€‚é…åˆ™è¿”å›žè¯¥å—çš„å¤´éƒ¨ï¼Œå¦åˆ™ç»§ç»­å‘ä¸‹ä¸€å—å¯»æ‰¾ï¼Œç›´åˆ°æœ€åŽä¸€ä¸ªå—çš„å¤´éƒ¨ã€‚è¿™é‡Œå”¯ä¸€çš„æŠ€å·§æ˜¯éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡éåŽ†è¿‡çš„å—ï¼Œæ‰€ä»¥å½“æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å—çš„æ—¶å€™ï¼Œmallocå‡½æ•°å¯ä»¥å¾ˆè½»æ¾åœ°åŽ»æ‰©å±•å †çš„å°¾éƒ¨ï¼ˆé•¿åº¦ï¼‰ã€‚ä»£ç é€»è¾‘å¾ˆç›´æŽ¥ï¼Œbaseæ˜¯ä¸€ä¸ªå…¨å±€æŒ‡é’ˆå˜é‡ï¼ŒæŒ‡å‘å †çš„å¼€å§‹ä½ç½®ï¼š 12345678t_block find_block(t_block *last, size_t size) &#123; t_block b = base; while (b &amp;&amp; !(b-&gt;free &amp;&amp; b-&gt;size &gt;= size)) &#123; *last = b; b = b-&gt;next; &#125; return b;&#125; è¿™ä¸ªå‡½æ•°ä¼šè¿”å›žä¸€ä¸ªåˆé€‚çš„å—ï¼Œæˆ–è€…è¿”å›žNULLï¼ˆåœ¨æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼‰ã€‚å‡½æ•°æ‰§è¡ŒåŽï¼ŒlastæŒ‡é’ˆæŒ‡å‘ä¸Šä¸€æ¬¡è®¿é—®è¿‡çš„å—ã€‚ æ‰©å±•å †çŽ°åœ¨ï¼Œå¹¶ä¸èƒ½æ€»æ˜¯æ‰¾åˆ°åˆé€‚çš„å—ï¼Œæœ‰æ—¶å€™ï¼ˆç‰¹åˆ«æ˜¯æœ€å¼€å§‹ä½¿ç”¨mallocå‡½æ•°ï¼‰éœ€è¦åŽ»æ‰©å±•å †ã€‚å®žçŽ°åŒæ ·å¾ˆç®€å•ï¼šç§»åŠ¨breakï¼Œå¹¶åˆå§‹åŒ–æ–°çš„blockã€‚å½“ç„¶è¿˜éœ€è¦æ›´æ–°å †ä¸­ä¸Šä¸€ä¸ªå—çš„nextåŸŸã€‚åœ¨åŽç»­å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦çŸ¥é“struct s_blockçš„å¤§å°ï¼Œæ‰€ä»¥åœ¨è¿™å„¿å®šä¹‰ä¸€ä¸ªå®ï¼š 1#define BLOCK_SZIE sizeof(struct s_block) ä¸‹é¢ä»£ç æ²¡æœ‰ä»€ä¹ˆå¯æƒŠè®¶çš„ï¼Œä»…ä»…åªæ˜¯å½“sbrkå¤±è´¥ä¹‹åŽè¿”å›žNULLï¼ˆæ²¡å¿…è¦æƒ³è¿™ä¹ˆåšçš„åŽŸå› ï¼‰ã€‚æ³¨æ„ï¼Œå‰é¢æåˆ°è¿‡æˆ‘ä»¬ä¸èƒ½ç¡®ä¿¡sbrkå‡½æ•°è¿”å›žçš„ä¸Šä¸€ä¸ªbreakï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆä¿å­˜breakå€¼ï¼Œç„¶åŽç§»åŠ¨å®ƒã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨lastå’Œlast-&gt;sizeæ¥è¿›è¡Œè®¡ç®—ï¼š 123456789101112131415t_block extend_heap(t_block last, size_t size)&#123; t_block b; b = sbrk(0); if ((void *)-1 == sbrk(BLOCK_SZIE+size)) &#123; /// sbrkå¤±è´¥ return NULL; &#125; b-&gt;size = size; b-&gt;next = NULL; if (last) &#123; last-&gt;next = b; &#125; b-&gt;free = 0; return b;&#125; æ‹†åˆ†å—ï¼ˆblockï¼‰æ³¨æ„åˆ°æˆ‘ä»¬å¯»æ‰¾é¦–ä¸ªå¯ç”¨çš„å—ï¼Œä½†å¹¶æ²¡æœ‰ç®¡å®ƒçš„å¤§å°ï¼ˆè¶³å¤Ÿå¤§ï¼‰ã€‚å‡æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœåªéœ€è¦2byteçš„å¤§å°ï¼Œä½†æ˜¯æ‰¾åˆ°çš„å—æ˜¯256byteçš„ï¼Œå¦‚æžœè¿™æ ·åšä¼šä¸¢å¤±å¾ˆå¤§ä¸€éƒ¨åˆ†çš„ç©ºé—´ã€‚ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æ‹†åˆ†å—ï¼šå½“ä¸€ä¸ªå—è¶³å¤Ÿå®½åˆ°è¯·æ±‚çš„å¤§å°åŠ ä¸Šä¸€ä¸ªæ–°å—å¤§å°ï¼ˆè‡³å°‘BLOCK_SIZE+4ï¼‰ï¼Œé‚£ä¹ˆå‘é“¾è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°å—ã€‚ ä¸‹é¢çš„å‡½æ•°ï¼ˆsplit_blockï¼‰ä¼šåœ¨ç©ºé—´å¯ç”¨çš„æ—¶å€™è¢«è°ƒç”¨ã€‚æä¾›çš„å¤§å°(å‚æ•°size)å¿…é¡»è¦æ˜¯å¯¹é½çš„ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬ä¼šåšä¸€äº›å…³äºŽæŒ‡é’ˆè¿ç®—ï¼Œä¸ºäº†é˜²æ­¢é”™è¯¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº›å°æŠ€å·§æ¥ç¡®ä¿æˆ‘ä»¬æ‰€æœ‰çš„æ“ä½œéƒ½ä»¥ä¸€ä¸ªå­—èŠ‚çš„ç²¾åº¦å®Œæˆï¼ˆéœ€è¦æ³¨æ„ä¸€ä¸‹p+1æ˜¯ä¾èµ–äºŽpçš„ç±»åž‹çš„ï¼Œä¹Ÿå°±æ˜¯ä¸åŒç±»åž‹æŒ‡é’ˆåŠ ä¸€çš„æ­¥é•¿ä¸ä¸€æ ·ï¼‰ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨struct s_blockä¸­æ·»åŠ ä¸€ä¸ªå­—ç¬¦æ•°ç»„çš„åŸŸã€‚ç»“æž„ä½“ä¸­æ·»åŠ æ•°ç»„å¾ˆç®€å•ï¼šæ•°ç»„ç›´æŽ¥å®šä¹‰åœ¨ç»“æž„çš„å†…å­˜å—ä¸­ï¼Œå› æ­¤æ•°ç»„æŒ‡é’ˆçš„ä½œç”¨æ˜¯æŒ‡å‘meta-dataçš„å°¾éƒ¨ã€‚Cç¦æ­¢é•¿åº¦ä¸ºé›¶çš„æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å®šä¹‰ä¸ªä¸€å­—èŠ‚é•¿çš„æ•°ç»„ï¼š 123456struct s_block &#123; size_t size; t_block next; int free; char data[1];&#125;; å¹¶ä¸”éœ€è¦æ›´æ–°ä¸€ä¸‹å®BLOCK_SIZEçš„å€¼ï¼Œç”±äºŽæ‰©å±•äº†s_blockçš„dataï¼Œå¦‚æžœè¿˜æ˜¯ä½¿ç”¨sizeofçš„è¯å°†ä¼šæŠŠdataå­—æ®µä¹Ÿç®—è¿›åŽ»ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦å°†BLOCK_SIZEå›ºå®šä½12å­—èŠ‚ï¼ˆæ³¨æ„ï¼ŒçŽ°åœ¨è¯´çš„32ä½æ•´åž‹ï¼‰ï¼š 1#define BLOCK_SZIE 12 è¿™é‡Œæˆ‘è¯´ä¸€ä¸‹è¿™é‡ŒåŠ äº†ä¸€ä¸ªdataåŸŸï¼Œä¸ºä»€ä¹ˆBLOCK_SIZEè¦è®¾ç½®ä¸º12ï¼Œä¸éšsizeof(struct s_block)å‘¢ï¼Ÿå‰é¢ä¹Ÿè¯´è¿‡ç»“æž„åªæ˜¯æŠŠå†…å­˜é‡Œé¢çš„å„ä¸ªå­—èŠ‚èµ‹äºˆäº†å«ä¹‰è€Œå·²ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³æŠŠ12å­—èŠ‚è®¤ä¸ºæ˜¯meta-dataï¼Œè€Œå¹¶ä¸æ˜¯ç¡¬ç”Ÿç”Ÿå¾—å¡žäº†ä¸€å—æ•°æ®åˆ°meta-dataå’Œæ•°æ®å—ä¹‹é—´ã€‚åŠ è¿™ä¸ªåŸŸåªæ˜¯ä¸ºäº†æˆ‘ä»¬åœ¨æ‹†åˆ†blockçš„æ—¶å€™æ–¹ä¾¿ï¼Œä¸åŠ è¿™ä¸ªåŸŸåŒæ ·ä¹Ÿæ˜¯å¯ä»¥æ“ä½œçš„ã€‚ å¢žåŠ äº†è¿™ä¸ªæ‰©å±•ä¹‹åŽï¼Œå¹¶ä¸éœ€è¦æ˜Žç¡®ä¸ºä¹‹å‰ extend_heapå‡½æ•°é€‚é…æ–°å¢žçš„dataåŸŸã€‚å‡½æ•°split_blockï¼šä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥æ‹†åˆ†ä¸ºæ‰€éœ€å¤§å°çš„å—ã€‚å›¾å››å±•ç¤ºè¯¥å‡½æ•°çš„ç›¸å…³æ“ä½œï¼š 1234567891011121314/// å‚æ•°så¿…é¡»è¦å¯¹é½çš„void split_block(t_block b, size_t s) &#123; if (!b) &#123; return; &#125; t_block new; new = b-&gt;data + s; new-&gt;size = b-&gt;size - s - BLOCK_SZIE; new-&gt;free = 1; new-&gt;next = b-&gt;next; b-&gt;size = s; b-&gt;next = new;&#125; æ³¨æ„ä»£ç b-&gt;data+sï¼Œç”±äºŽdataåŸŸæ—¶char[]ç±»åž‹ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿç²¾ç¡®åœ°æŽ§åˆ¶æ˜¯ä»¥å­—èŠ‚çš„æ­¥é•¿è¿›è¡Œå¢žåŠ ã€‚ mallocå‡½æ•°çŽ°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹å†™mallocå‡½æ•°äº†ï¼Œå®ƒä¸»è¦æ˜¯å°†å‰é¢è®²åˆ°çš„å‡½æ•°å°è£…èµ·æ¥ã€‚æˆ‘ä»¬å¿…é¡»è¦å°†è¯·æ±‚çš„sizeå¯¹é½ï¼Œå¹¶æµ‹è¯•æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨mallocå‡½æ•°ï¼Œä»¥åŠå·²å‘ŠçŸ¥å…¶ä½™æ‰€éœ€çš„æ¡ä»¶ã€‚åœ¨ä¸Šä¸€èŠ‚çš„find_blockå‡½æ•°ä¸­ä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€å˜é‡ baseï¼Œä¸‹é¢æ˜¯è¯¥å˜é‡çš„å®šä¹‰ï¼š 1void *base = NULL; å®ƒæ˜¯ä¸€ä¸ªvoid *ç±»åž‹çš„æŒ‡é’ˆï¼Œå¹¶åˆå§‹åŒ–ä¸ºNULLã€‚åœ¨mallocä¸­æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯åˆ¤æ–­baseæ˜¯å¦ä¸ºNULLï¼Ÿå¦‚æžœä¸ºNULLé‚£ä¹ˆå°±è¡¨ç¤ºç¬¬ä¸€æ¬¡è°ƒç”¨mallocå‡½æ•°ï¼Œå¦åˆ™å°±æ˜¯ç”¨å‰é¢æåˆ°çš„ç›¸å…³ç®—æ³•ã€‚ mallocå‡½æ•°éœ€è¦å…·å¤‡ä¸‹é¢å‡ è¡Œä¸­çš„ç‰¹æ€§ï¼š é¦–å…ˆéœ€è¦å¯¹é½è¯·æ±‚çš„å¤§å°ï¼› å½“baseå·²ç»åˆå§‹åŒ–ï¼š æœç´¢è¶³å¤Ÿå¤§å°çš„ç©ºé—²å—ï¼› å¦‚æžœæ‰¾åˆ°è¯¥å—çš„æƒ…å†µä¸‹ï¼š å°è¯•ç€åŽ»æ‹†åˆ†è¯¥å—ï¼ˆè¯·æ±‚çš„å¤§å°å’Œå—çš„å¤§å°è¶³å¤Ÿå­˜å‚¨meta-dataå’Œæœ€å°å—æ•°æ®ï¼Œæ¯”å¦‚4byteï¼‰ï¼› æ ‡è®°è¯¥å—ä¸ºå·²æ˜¯ç”¨(b-&gt;free = 0)ï¼› å¦åˆ™ï¼šæ‰©å±•å †ï¼›æ³¨æ„åœ¨find_blockå‡½æ•°ä¸­ä½¿ç”¨çš„lastæŒ‡é’ˆï¼Œå®ƒç”¨äºŽè®°å½•ä¸Šä¸€æ¬¡è®¿é—®è¿‡çš„å—ï¼ˆchunkï¼‰ï¼Œå› æ­¤å½“æˆ‘ä»¬åœ¨æ‰©å±•å—çš„æ—¶å€™å°±ä¸ç”¨å†é‡æ–°åŽ»éåŽ†æ•´ä¸ªé“¾è¡¨ã€‚ å¦åˆ™ï¼šæ‰©å±•å †ï¼ˆç©ºæŒ‡é’ˆï¼‰ã€‚æ³¨æ„æ­¤æ—¶å·¥ä½œåœ¨extend_heapå‡½æ•°æ—¶last=NULLã€‚ ä¹Ÿéœ€è¦æ³¨æ„åœ¨æ¯æ¬¡å¤±è´¥ä¹‹åŽï¼Œæˆ‘ä»¬æŒ‰ç…§é¢„æœŸæŒ‡å®šçš„mallocå‡½æ•°è¿”å›žNULLã€‚ 1234567891011121314151617181920212223242526void *malloc(size_t size)&#123; t_block last,b; size_t align_size = align4(size); if (base) &#123; last = base; if ((b = find_block(&amp;last, align_size))) &#123; if (b-&gt;size - align_size &gt;= (BLOCK_SZIE + 4)) &#123;/// meta-data + 4 split_block(b, align_size); &#125; b-&gt;free = 0; &#125;else&#123;///æŸ¥æ‰¾heapå¤±è´¥ï¼Œextend heap b = extend_heap(base, align_size); if (!b) &#123; return NULL; &#125; &#125; &#125;else&#123;///é¦–æ¬¡è°ƒç”¨mallocå‡½æ•°ï¼Œextend heap /// base = null; b = extend_heap(base, align_size); if (!b) &#123; return NULL; &#125; base = b; &#125; return b-&gt;data;&#125; å…­ã€calloc, freeå’Œreallocå‡½æ•°callocå‡½æ•°callocå‡½æ•°ï¼š é¦–å…ˆè°ƒç”¨mallocå‡½æ•°ï¼Œå¹¶åˆ†é…æ­£ç¡®çš„å¤§å°ï¼› å°†å—é‡Œé¢çš„æ¯ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º0ï¼› è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼šchunkä¸­æ•°æ®å—çš„å¤§å°æ€»æ˜¯4çš„å€æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥4å­—èŠ‚çš„æ­¥é•¿è¿›è¡Œè¿­ä»£ã€‚å› æ­¤æˆ‘ä»¬æŠŠnewæŒ‡é’ˆå½“åšæ— ç¬¦å·æ•´åž‹çš„æ•°ç»„ï¼š 123456789101112void *calloc(size_t number, size_t size) &#123; size_t *new; size_t s4,i; new = malloc(number*size); if (new) &#123; s4 = align4(number*size)&lt;&lt;2; for (i = 0; i &lt; s4; i++) &#123; new[i] = 0;/// newä¸ºsize_tï¼Œæ‰€ä»¥è¿™é‡Œ+1çš„æ­¥é•¿ä¸ºsize_tçš„å­—èŠ‚æ•°ï¼Œåœ¨32ä½æ•´åž‹ä¸‹é¢ï¼Œsize_tä¸º4å­—èŠ‚ &#125; &#125; return 0;&#125; freeå‡½æ•°æ³¨ï¼šåœ¨ä¸‹æ–‡æåˆ°çš„å—åœ¨åŽŸæ–‡ä¸­çš„æè¿°å¦‚æžœæ²¡æœ‰ç‰¹æ®Šæ³¨æ˜Žå‡ä¸ºchunkï¼Œè€Œéžåœ¨mallocä¸€èŠ‚å¤§é‡ä½¿ç”¨çš„blockã€‚ å¿«é€Ÿå®žçŽ°freeæ˜¯å¾ˆç®€å•çš„ï¼Œä½†ç®€å•å¹¶ä¸æ„å‘³ç€å¾ˆæ–¹ä¾¿å°±èƒ½å®Œæˆã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šæ‰¾åˆ°è¢«é‡Šæ”¾çš„å—ï¼Œå¹¶ä¸”é˜²æ­¢å‡ºçŽ°ç©ºé—´ç¢Žç‰‡ã€‚ ç¢Žç‰‡ï¼šmallocå‡½æ•°é—ç•™é—®é¢˜mallocå‡½æ•°çš„ä¸€ä¸ªé‡å¤§é—®é¢˜æ˜¯ç¢Žç‰‡ï¼šåœ¨å¤šæ¬¡ä½¿ç”¨mallocå’Œfreeä¹‹åŽï¼Œå †è¢«åˆ’åˆ†ä¸ºè®¸å¤šå—ï¼Œè¿™äº›å—å·²ç»å°åˆ°è¶³å¤Ÿæ»¡è¶³å¤§çš„mallocï¼Œç›´åˆ°æ•´ä¸ªå¯ç”¨ç©ºé—´ä½¿ç”¨ã€‚è¿™å°±æ˜¯ç©ºé—´ç¢Žç‰‡çš„é—®é¢˜ã€‚åœ¨è¿™ä¸ªç®—æ³•ä¸­æˆ‘ä»¬è™½ç„¶æ²¡æœ‰åŠžæ³•é¿å…å‡ºçŽ°é¢å¤–çš„ç¢Žç‰‡ï¼Œä½†å¯ä»¥é¿å…å…¶ä»–æ¥æºçš„ç¢Žç‰‡ã€‚å½“æˆ‘ä»¬é€‰æ‹©çš„ç©ºé—²å—è¶³ä»¥å®¹çº³è¯·æ±‚åˆ†é…çš„é‡å’Œå¦å¤–çš„å—æ—¶ï¼Œæˆ‘ä»¬ä¼šæ‹†åˆ†å½“å‰å—ã€‚åœ¨æä¾›æ›´å¥½åœ°å†…å­˜ä½¿ç”¨çŽ‡ï¼ˆæ–°çš„å—ä¸ºç©ºé—²çŠ¶æ€ä»¥å¤‡åŽç”¨ï¼‰çš„åŒæ—¶ä¹Ÿå¼•å…¥äº†æ›´å¤šçš„ç¢Žç‰‡ã€‚è§£å†³ç¢Žç‰‡åŒ–çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç©ºé—²å—ã€‚å½“æˆ‘ä»¬é‡Šæ”¾ä¸€ä¸ªå—æ—¶ï¼Œå¦‚æžœä¸´æŽ¥çš„å—åŒæ ·æ˜¯ç©ºé—²çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬åˆå¹¶ä»–ä»¬æˆä¸€ä¸ªæ›´å¤§çš„å—ã€‚åœ¨è¿™å„¿æˆ‘ä»¬æ‰€æœ‰éœ€è¦çš„å°±æ˜¯åŽ»æµ‹è¯•å‰é¢å—å’ŒåŽé¢å—çš„çŠ¶æ€ã€‚é‚£ä¹ˆå¦‚ä½•åŽ»èŽ·å–ä¹‹å‰çš„å—ï¼ˆblockï¼‰å‘¢ï¼Ÿä¸‹é¢æœ‰å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š ä»Žå¤´å¼€å§‹æœç´¢ï¼Œä½†éžå¸¸æ…¢ï¼ˆç‰¹åˆ«æ˜¯æˆ‘ä»¬å·²ç»æœäº†ä¸€äº›ç©ºé—²å—ä¹‹åŽï¼Œå†ä»Žå¤´æœç´¢ï¼‰ï¼› å½“æˆ‘ä»¬æœç´¢åˆ°å½“å‰å—çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªè®¿é—®çš„å—ï¼› åŒé“¾è¡¨ï¼› æˆ‘ä»¬é€‰æ‹©æœ€åŽè¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆéžå¸¸ç®€å•åœ°åŽ»è·Ÿè¸ªç›®æ ‡å—ã€‚æ‰€ä»¥æˆ‘ä»¬å†ä¸€æ¬¡åŽ»ä¿®æ”¹struct s_blockï¼ˆç¬¬ä¸€æ¬¡ä¿®æ”¹æ˜¯mallocçš„æ—¶å€™å¢žåŠ çš„dataæˆå‘˜ï¼‰ã€‚ä½†ç”±äºŽæˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€ä¸ªå¾…ä¿®æ”¹çš„åœ°æ–¹ï¼ˆä¸‹ä¸€èŠ‚ï¼‰ï¼Œå› æ­¤å…ˆä¸æ€¥ç€åšä¿®æ”¹ã€‚ æ‰€ä»¥æˆ‘ä»¬çŽ°åœ¨è¦åšçš„å°±æ˜¯åˆå¹¶ï¼Œæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„åˆå¹¶å‡½æ•°æ¥åˆå¹¶å—ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­æˆ‘ä»¬ä¼šç”¨ä¸€ä¸ª prevåŸŸæ¥ä½œä¸ºç›´æŽ¥å‰é©±ï¼š 12345678910t_block fusion(t_block b) &#123; if (b-&gt;next &amp;&amp; b-&gt;next-&gt;free) &#123; b-&gt;size += BLOCK_SZIE + b-&gt;next-&gt;size; b-&gt;next = b-&gt;next-&gt;next; if (b-&gt;next) &#123; b-&gt;next-&gt;prev = b; &#125; &#125; return b;&#125; fusionå‡½æ•°å¾ˆç›´æˆªäº†å½“ï¼šå¦‚æžœä¸‹ä¸€ä¸ªå—æ˜¯ç©ºé—²å—ï¼Œé‚£ä¹ˆå°±å°†å½“å‰å—çš„sizeå’Œä¸‹ä¸€ä¸ªå—çš„sizeï¼Œä»¥åŠmeta-dataçš„å¤§å°ã€‚ç„¶åŽå°†nextåŸŸæŒ‡å‘å½“å‰å˜é‡åŽç»§çš„åŽç»§ï¼ˆb-&gt;next-&gt;nextï¼‰ï¼Œæ­¤æ—¶å¦‚æžœå½“å‰çš„åŽç»§å­˜åœ¨ï¼Œé‚£ä¹ˆä¹…æ›´æ–°è¯¥åŽç»§çš„ç›´æŽ¥å‰é©±ï¼ˆb-&gt;next-&gt;prevï¼‰ã€‚ æ‰¾åˆ°æ­£ç¡®çš„å—å…³äºŽå…¶ä½™é‡Šæ”¾å¸¦æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•é«˜æ•ˆåœ°å¯»æ‰¾ç”±mallocå‡½æ•°è¿”å›žçš„æ­£ç¡®çš„å—ã€‚å®žé™…ä¸Šï¼Œè¿™å„¿å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š éªŒè¯è¾“å…¥çš„æŒ‡é’ˆï¼ˆå®ƒæ˜¯å¦çœŸçš„æ˜¯ä¸€ä¸ªmallocæŒ‡é’ˆï¼‰ï¼› æ‰¾åˆ°meta-dataæŒ‡é’ˆï¼› æˆ‘ä»¬å¯ä»¥é€šè¿‡quick range testæ¥æ¶ˆé™¤æ— ç”¨çš„æŒ‡é’ˆï¼šå¦‚æžœè¯¥æŒ‡é’ˆåœ¨å †å¤–ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆæŒ‡é’ˆã€‚é‚£ä¹ˆå‰©ä¸‹çš„caseå’Œä¸Šä¸€ä¸ªcaseç›¸å…³ï¼Œæˆ‘ä»¬å¦‚ä½•ç¡®å®šè¯¥æŒ‡é’ˆæ˜¯ç”±mallocå‡½æ•°èŽ·å¾—ï¼Ÿå…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯åœ¨ç»“æž„å†…ä½¿ç”¨ä¸€ä¸ªé­”æ•°ï¼ˆmagic numberï¼‰ã€‚ç›¸å¯¹äºŽé­”æ•°æ›´ä¼˜çš„ä¸€ä¸ªæ–¹æ¡ˆæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒè‡ªå·±ã€‚è§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªptråŸŸæŒ‡å‘dataåŸŸï¼Œå¦‚æžœb-&gt;ptr == b-&gt;dataçš„æ—¶å€™ï¼Œé‚£ä¹ˆè¯¥æŒ‡é’ˆå¤§æ¦‚çŽ‡æ˜¯æœ‰æ•ˆå—ï¼ˆblockï¼‰ã€‚ä¸‹é¢æ˜¯æ‰©å±•ä¹‹åŽçš„ç»“æž„ï¼Œä»¥åŠè®¿é—®å’Œæ ¡éªŒç»™å®šçš„æŒ‡é’ˆæ˜¯å¦ä¸ºç›¸åº”çš„å—ï¼ˆblockï¼‰ï¼š 1234567891011121314151617181920212223242526typedef struct s_block* t_block;struct s_block &#123; size_t size; t_block next;/// åŽç»§ t_block prev;/// å‰é©± int free; void *ptr; char data[1];&#125;;t_block get_block(void *p)&#123; char *tmp; tmp = p; tmp = tmp-BLOCK_SZIE; p = tmp; return p;&#125;int vaild_addr(void *p) &#123; if (base) &#123; if (p &gt; base &amp;&amp; p &lt; sbrk(0)) &#123;/// sbrk(0)æ˜¯èŽ·å–å½“å‰breakçº¿ï¼Œç»“åˆå‰é¢æåˆ°çš„å›¾ return p == (get_block(p)-&gt;ptr); &#125; &#125; return 0;&#125; å®žçŽ°freeå‡½æ•°freeå‡½æ•°åˆ°çŽ°åœ¨ä¹Ÿæ¸æ¸æ­å¼€äº†ç¥žç§˜é¢çº±ï¼šéªŒè¯æŒ‡é’ˆçš„æ­£ç¡®æ€§ï¼Œå¹¶æ‰¾åˆ°ç›¸åº”çš„å—ï¼Œç„¶åŽå°†å…¶æ ‡è®°ä¸ºç©ºé—²å—ï¼Œæœ€åŽå¦‚æžœæœ‰å¿…è¦å°±è¿›è¡Œåˆå¹¶æ“ä½œã€‚é‡Šæ”¾å†…å­˜æ—¶ï¼Œå½“æˆ‘ä»¬å¤„äºŽå †çš„å°¾éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€ä¸‹brkå‡½æ•°æ¥è°ƒæ•´breakå…ˆåˆ°å½“å‰å—çš„ä½ç½®å¤„ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºå…·ä½“å®žçŽ°ï¼Œå¤§è‡´çš„é€»è¾‘å¦‚ä¸‹ï¼š å¦‚æžœæŒ‡é’ˆæœ‰æ•ˆï¼š èŽ·å–blockå—çš„åœ°å€ï¼› æ ‡è®°ä¸ºç©ºé—²çŠ¶æ€ï¼› å¦‚æžœå½“å‰èŠ‚ç‚¹çš„ç›´æŽ¥å‰é©±æ˜¯ç©ºé—²çš„ï¼Œé‚£ä¹ˆå°±åˆå¹¶ä¸¤ä¸ªå—ï¼› ç»§ç»­å°è¯•åˆå¹¶ç›´æŽ¥åŽç»§å—ï¼› å¦‚æžœå½“å‰å¤„äºŽæœ€åŽä¸€ä¸ªå—ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡Šæ”¾å†…å­˜ï¼› å¦‚æžœè¿™å„¿æ²¡æœ‰æ›´å¤šçš„å—äº†ï¼Œé‚£æˆ‘ä»¬é‡ç½®ä¸ºåŽŸå§‹çŠ¶æ€ï¼ˆbaseè®¾ç½®ä¸ºNULLï¼‰ï¼› å¦‚æžœè¯¥æŒ‡é’ˆä¸æ˜¯æœ‰æ•ˆæŒ‡é’ˆçš„è¯ï¼Œæˆ‘ä»¬å°±ä»€ä¹ˆä¹Ÿä¸åšï¼› 12345678910111213141516171819202122void free(void *ptr) &#123; t_block b; if (vaild_addr(ptr)) &#123; b = get_block(ptr); b-&gt;free = 1; /// å¦‚æžœå¯ä»¥åˆå¹¶ç›´æŽ¥å‰é©± if (b-&gt;prev &amp;&amp; b-&gt;prev-&gt;free) &#123; b = fusion(b-&gt;prev); &#125; /// åˆå¹¶ç›´æŽ¥åŽç»§ if (b-&gt;next) &#123; fusion(b); &#125;else&#123; if (b-&gt;prev) &#123; b-&gt;prev-&gt;next = NULL; &#125;else&#123; base = NULL; &#125; brk(0); &#125; &#125;&#125; ä½¿ç”¨reallocé‡ç½®å—çš„å¤§å°reallocå‡½æ•°å’Œcallocå‡½æ•°å·®ä¸å¤šä¸€æ ·ç›´æŽ¥ã€‚åŸºæœ¬ä¸Šæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå†…å­˜æ‹·è´çš„æ“ä½œï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨é‡Œé¢çš„memcpyæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæ›´å¥½çš„ï¼ˆå¤§å°ä»¥å—ä¸ºå•ä½ï¼Œå¹¶ä¸”å·²ç»å¯¹é½ï¼‰ã€‚æ‹·è´å‡½æ•°å¦‚ä¸‹ï¼š 12345678910void copy_block(t_block src, t_block dst) &#123; int *sdata; int *ddata; size_t i; sdata = src-&gt;ptr; ddata = dst-&gt;ptr; for (i = 0; src-&gt;size &gt; 4*i &amp;&amp; dst-&gt;size &gt; 4*i; i++) &#123; ddata[i] = sdata[i]; &#125;&#125; æŒ‰ç…§ä¸‹é¢çš„åšæ³•å¯ä»¥å®žçŽ°ä¸€ä¸ªéžå¸¸å¹¼ç¨šï¼ˆä½†æ˜¯èƒ½å·¥ä½œï¼‰çš„reallocå‡½æ•°ï¼š ä½¿ç”¨mallocæ ¹æ®æŒ‡å®šçš„å¤§å°åˆ†å™¢è¯¶ä¸€ä¸ªæ–°å—ï¼› å°†æ•°æ®ä»Žæ—§å†…å­˜æ•°æ®å¤åˆ¶åˆ°æ–°å†…å­˜åœ°å€å¤„ï¼› é‡Šæ”¾æ—§å†…å­˜ä¸­çš„æ•°æ®ï¼› è¿”å›žæŒ‡å‘å†…å†…å­˜åœ°å€å¤„çš„æŒ‡é’ˆï¼› å½“ç„¶æˆ‘ä»¬è¿˜æƒ³åšä¸€ç‚¹äº‹å„¿è®©reallocå‡½æ•°æ›´é«˜æ•ˆä¸€ç‚¹ã€‚å½“æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç©ºé—´çš„æ—¶å€™ï¼Œæ­¤æ—¶å¹¶ä¸éœ€è¦åŽ»åˆ†é…æ–°çš„ç©ºé—´ã€‚å› æ­¤ä¸åŒç‚¹æœ‰ï¼š å¦‚æžœå¤§å°æœªå‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…é¢å¤–å¯ç”¨å¤§å°è¶³å¤Ÿä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»€ä¹ˆä¹Ÿä¸åšï¼› å¦‚æžœéœ€è¦æ”¶ç¼©å—ï¼Œé‚£ä¹ˆæ‹†åˆ†è¯¥å—ï¼› å¦‚æžœä¸‹ä¸€ä¸ªæ˜¯ç©ºé—²å—è€Œä¸”æä¾›äº†è¶³å¤Ÿçš„ç©ºé—´ï¼Œå¦‚æžœéœ€è¦çš„è¯æˆ‘ä»¬å¯ä»¥åˆå¹¶æˆ–è€…æ‹†åˆ†è¿™äº›å—ï¼› ä¸‹é¢æ˜¯reallocå‡½æ•°çš„å…·ä½“å®žçŽ°ï¼š 1234567891011121314151617181920212223242526272829303132333435void *realloc(void *p, size_t size) &#123; if (NULL == p) &#123; return malloc(size); &#125; size_t s; t_block b, new; void *newp; if (vaild_addr(p)) &#123; s = align4(size); b = get_block(p); if (b-&gt;size &gt; s) &#123; if (b-&gt;size &gt;= s+BLOCK_SZIE+4) &#123; split_block(b, s); &#125; &#125;else&#123; if (b-&gt;next &amp;&amp; b-&gt;next-&gt;free &amp;&amp; (b-&gt;next-&gt;size + b-&gt;size + BLOCK_SZIE) &gt;= s) &#123; fusion(b); if (b-&gt;size - s &gt; BLOCK_SZIE+4) &#123; split_block(b, s); &#125; &#125;else&#123; newp = malloc(s); if (!newp) &#123; return NULL; &#125;else&#123; new = get_block(newp); copy_block(b, new); free(p); return newp; &#125; &#125; &#125; &#125; return p;&#125; åˆ«å¿˜äº†realloc(NULL, s)æ˜¯å¯ä»¥ç›´æŽ¥æåˆ°malloc(s)çš„ã€‚ FreeBSDä¸­reallocfå‡½æ•°FreeBSDæä¾›äº†å¦å¤–ä¸€ä¸ªreallocå‡½æ•°çš„å®žçŽ°ï¼šreallocfï¼Œå®ƒä¼šåœ¨ä»»ä½•æƒ…å†µä¸‹é‡Šæ”¾è¾“å…¥çš„æŒ‡é’ˆï¼ˆå³ä½¿æ˜¯å†åˆ†é…å¤±è´¥ä¹‹åŽï¼‰ã€‚æˆ‘ä»¬ä¸€æ ·ä¼šè°ƒç”¨reallocå‡½æ•°ï¼Œä½†æ˜¯åªæœ‰æˆ‘ä»¬åœ¨èŽ·å¾—ç©ºçš„æŒ‡é’ˆä¹‹åŽæ‰ä¼šè°ƒç”¨freeå‡½æ•°ã€‚ä¸‹é¢æ˜¯å…·ä½“çš„å®žçŽ°éƒ¨åˆ†ï¼š 1234567void *reallocf(void *p, size_t size) &#123; void *ptr = realloc(p, size); if (!p) &#123; free(p); &#125; return ptr;&#125; åˆ°è¿™å„¿åŸºæœ¬ç¿»è¯‘å®Œæˆï¼Œå¦‚æœ‰é”™è¯¯è¯·åŠæ—¶æ¥è”ç³»æˆ‘ï¼Œè°¢è°¢â¤ï¸]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ç»†çœ‹objc-weakæºç ]]></title>
      <url>%2F2018%2F05%2F18%2Fsource_code_objc_weak_t%2F</url>
      <content type="text"><![CDATA[æœ¬æ–‡ä¸çœ‹å…¶ä»–ï¼Œåªä¸“æ³¨äºŽweakçš„å†…éƒ¨ç»“æž„å®žçŽ°ç»†èŠ‚å’Œæºç è§£è¯»ï¼Œçœ‹äº†ç½‘ä¸Šå¾ˆå¤šçš„æ–‡ç« éƒ½æ˜¯è´´ä¸Šä¸€ç¯‡open sourceé‡Œé¢çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰å¯¹å®žçŽ°ç»†èŠ‚è¿›è¡Œè§£é‡Šã€‚æ‰€ä»¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦åˆ†ä¸ºweak_entry_tã€weak_table_tçš„æºç è§£æžï¼Œweak_entry_tå’Œweak_table_tçš„ç›¸äº’å…³ç³»ï¼Œä»¥åŠå¯¹åº”çš„æ“ä½œå‡½æ•°ã€‚ ä¸‹æ–‡çš„ä¸»è¦æ˜¯åŸºäºŽä¸¤ä¸ªå¯¹è±¡æ¥è¯´çš„ï¼Œä¸€ä¸ªæ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¼±å¼•ç”¨å˜é‡ï¼ˆä¹Ÿå°±æ˜¯æºä»£ç ä¸­å¤§é‡å‡ºçŽ°çš„æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼‰ã€‚ æˆ‘è¯´ä¸€ä¸‹æˆ‘æºç é˜…è¯»çš„ä¹ æƒ¯ï¼Œå…ˆæŠŠç›®å…‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå› ä¸ºå¤´æ–‡ä»¶èƒ½å¤Ÿç»™æˆ‘ä»¬ä¸€ä¸ªæ•´ä½“åŸºç¡€ç»“æž„ã€‚å¼„æ¸…æ¥šå…·ä½“çš„ç»“æž„ä¹‹åŽï¼Œç„¶åŽå†è·³åˆ°å®žçŽ°æ–‡ä»¶ä¸­åŽ»çœ‹å…·ä½“çš„å®žçŽ°ç»†èŠ‚ã€‚å…ˆäº¤ä»£ä¸€ä¸‹æˆ‘çš„ç¼–è¯‘çŽ¯å¢ƒå’Œæºä»£ç ç‰ˆæœ¬ï¼š ç¼–è¯‘çŽ¯å¢ƒï¼šApple LLVM version 9.1.0 (clang-902.0.39.1)Target: x86_64-apple-darwin17.5.0Thread model: posixInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/binæºä»£ç ç‰ˆæœ¬ï¼š objc4-723 å¤´æ–‡ä»¶ç±»å…³ç³»å’Œç»“æž„åˆ†æžæˆ‘å…ˆæ ¹æ®å¤´æ–‡ä»¶ç”»ä¸€ä¸ªåŸºæœ¬çš„UMLç±»å›¾ï¼š DisguisedPtræ¨¡æ¿ç±»å…ˆå°†è§†çº¿æ”¾åœ¨weak_entry_tä¸Šé¢ï¼Œç»“æž„weak_entry_tçš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡æ˜¯referentï¼Œå®ƒæ˜¯ä¸€ä¸ªDisguisedPtrç±»æ¨¡æ¿å®žä¾‹åŒ–ä¹‹åŽçš„å˜é‡ï¼ˆç‚¹å¼€å‰é¢çš„é“¾æŽ¥å§ï¼Œä¸ç„¶æˆ‘è®²ä¸æ¸…æ¥šï¼Œä¸ç„¶ä½ ä¼šéª‚æˆ‘çš„ï¼‰ï¼Œè¿™ä¸ªæˆå‘˜å…¶å®žå°±æ˜¯ä¿å­˜è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚DisguisedPtrç±»é‡Œé¢çœ‹èµ·æ¥è¿™ä¸ªç±»å¹¶ä¸å¤æ‚ï¼Œæœ‰ä¸€ä¸ªuintptr_tç±»åž‹çš„æˆå‘˜å˜é‡ï¼Œç”±æ­¤DisguisedPtrç±»çš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å¤§å°ä¹Ÿåº”è¯¥ä¸º8å­—èŠ‚ã€‚publicä¸‹é¢ä¸»è¦æ˜¯æž„é€ å‡½æ•°åŠ ä¸‰å¤§å‡½æ•°ä¸­çš„ä¸¤ä¸ªï¼šé‡è½½å¤åˆ¶è¿ç®—ç¬¦ï¼Œèµ‹å€¼æž„é€ å‡½æ•°ï¼›ç”±äºŽè¯¥ç±»é‡Œé¢å¹¶æ²¡æœ‰æ¶‰åŠåˆ°åŠ¨æ€newæŒ‡é’ˆå˜é‡ï¼Œæ‰€ä»¥å…¶æžæž„å‡½æ•°ä¾¿ä½¿ç”¨äº†é»˜è®¤æžæž„å‡½æ•°ã€‚é™¤æ­¤ä¹‹å¤–è¿˜é‡è½½ä¸€äº›å…¶ä»–çš„æ“ä½œç¬¦ã€‚ä¸»è¦çœ‹ä¸€ä¸‹ç§æœ‰çš„ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼š 123456static uintptr_t disguise(T* ptr) &#123; return -(uintptr_t)ptr;&#125;static T* undisguise(uintptr_t val) &#123; return (T*)-val;&#125; å…¶ä¸­disguiseå‡½æ•°æ˜¯å°†æŒ‡é’ˆå˜é‡å¼ºè½¬ä¸ºuintptr_tçš„æ•´å½¢å˜é‡ï¼Œå…·ä½“æ€Žä¹ˆä¼ªè£…å‘¢ï¼Ÿå°±æ˜¯æŠŠè¯¥æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€ï¼ˆ16è¿›åˆ¶æ•°æ®æ¯”å¦‚ï¼š0x7ffeefbff4e8ï¼‰å¼ºåˆ¶è½¬æ¢ä¸ºæ— ç¬¦å·é•¿æ•´åž‹çš„åè¿›åˆ¶æ•°æ®ã€‚ç”±äºŽå…¶ç±»åž‹æ˜¯æ— ç¬¦å·é•¿æ•´åž‹ï¼Œå› æ­¤å–è´Ÿæ•°æ˜¯æ•°æ®æº¢å‡ºä¹‹åŽå–è¯¥ç±»åž‹å–å€¼èŒƒå›´å†…è¾ƒå¤§çš„é•¿æ•´åž‹å€¼è¾¾åˆ°ä¼ªè£…çš„æ•ˆæžœï¼ˆä¹Ÿå°±æ˜¯ä¸å¥½åŽ»æ‰¾åˆ°åŽŸå†…å­˜åœ°å€ï¼‰ã€‚ 123456unsigned long ul_val = 2;unsigned long*bitl = &amp;ul_val;cout&lt;&lt;&quot;ul_val address: &quot;&lt;&lt;bitl&lt;&lt;endl;///0x7ffeefbff4e8///140732920755432 å–è´Ÿæ•° -&gt; 18446744069408184208cout&lt;&lt;&quot;disguise: &quot;&lt;&lt;disguise(bitl)&lt;&lt;endl;cout&lt;&lt;&quot;undisguise: &quot;&lt;&lt;undisguise(*bitl)&lt;&lt;endl;/// 0xfffffffffffffffe 1111...1110 å…¶ä½œç”¨åœ¨æºæ–‡ä»¶çš„æ³¨é‡Šä¸­ä¹Ÿè¯´äº†ï¼Œæˆ‘é€šä¿—æ€»ç»“æ˜¯ï¼šå¯¹é‚£äº›æ¯”å¦‚leakè¿™ç§å†…å­˜æ£€æµ‹å·¥å…·è¿›è¡Œä¼ªè£…ï¼Œç„¶åŽè¿™äº›æ£€æµ‹å·¥å…·å¯èƒ½å°±ä¸å¥½åŽ»è·Ÿè¸ªè¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ weak_entry_tçŽ°åœ¨æ¥çœ‹ä¸€ä¸‹unionçš„å…·ä½“å†…å­˜åˆ†å¸ƒç»†èŠ‚ï¼Œæ€Žä¹ˆæ¥è§£é‡Šè¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå¥‰ä¸Šobjc-weak.hçš„æºç ï¼Œæ‰“å¼€æºç é…åˆæ–‡ç« æ¥çœ‹ã€‚ 12345678910111213union &#123; struct &#123;/// ä¸ºäº†æ–¹ä¾¿è¯´æ˜Žé—®é¢˜ï¼Œæˆ‘å°†è¯¥ç»“æž„å–åä¸ºï¼šstruct1 weak_referrer_t *referrers; uintptr_t out_of_line : 2; uintptr_t num_refs : PTR_MINUS_1;/// num_refsè®°å½•çš„æ˜¯å®žé™…å¼•ç”¨æ•°é‡ uintptr_t mask;/// è®°å½•å½“å‰referrersæ•°ç»„å®¹å™¨çš„å¤§å° uintptr_t max_hash_displacement;/// æ ¹æ®hash-keyå¯»æ‰¾indexçš„æœ€å¤§ç§»åŠ¨æ•°ï¼Œè¿™ä¸ªåœ¨åŽé¢çš„append_referrerä¼šè®² &#125;; struct &#123;/// ä¸ºäº†æ–¹ä¾¿è¯´æ˜Žé—®é¢˜ï¼Œæˆ‘å°†è¯¥ç»“æž„å–åä¸ºï¼šstruct2 // out_of_line=0 is LSB of one of these (don&apos;t care which) weak_referrer_t inline_referrers[WEAK_INLINE_COUNT]; &#125;;&#125;; é¦–å…ˆè¦æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œunioné‡Œé¢çš„å¤šä¸ªæˆå‘˜æ˜¯å…±äº«åŒä¸€ä¸”ç›¸åŒå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œåœ¨strcut1ç»“æž„æˆå‘˜ä¸­ç®—å‡ºå…¶æ€»å…±æ‰€å å†…å­˜å¤§å°ä¸º64*4ï¼Œä¹Ÿå°±æ˜¯32ä¸ªå­—èŠ‚ã€‚å…¶ä¸­æˆ‘çš„æœºå™¨æ˜¯64ä½æœºï¼Œæˆ‘çš„ç¼–è¯‘å™¨å¯¹äºŽæŒ‡é’ˆç±»åž‹æ‰€å å†…å­˜å¤§å°çš„ABIå®žçŽ°ä¸º64ä½ï¼Œè€Œæ— ç¬¦å·é•¿æ•´åž‹å ç”¨çš„å†…å­˜å¤§å°ä¹Ÿä¸º64ä½ã€‚å¤šè¯´ä¸€å¥ï¼Œåœ¨C++ä¸­ç»“æž„å’Œç±»çš„å†…å­˜å­˜å‚¨åŒºåŸŸå¥½åƒéƒ½æ˜¯åœ¨å †ä¸Šé¢ï¼Œç”±ä½Žåœ°å€å‘é«˜åœ°å€ç”Ÿé•¿ã€‚åŸºäºŽæ­¤æ¥ç”»å‡ºinline_referrerså’Œä¸Šé¢ç¬¬ä¸€ä¸ªç»“æž„å¤§è‡´çš„å†…å­˜åˆ†å¸ƒæ ·å¼ï¼ˆå…³äºŽinline_referrersçš„å…ƒç´ ç±»åž‹æ¨¡æ¿ç±»DisguisedPtræ‰€å å†…å­˜å¤§å°åœ¨ä¸Šé¢è®²DisguisedPtrç±»æ—¶æåˆ°äº†ï¼‰ï¼šåœ¨æºç ä¸­æ³¨é‡Šä¹Ÿè¯´äº†ï¼š 12345// out_of_line_ness field overlaps with the low two bits of inline_referrers[1].// inline_referrers[1] is a DisguisedPtr of a pointer-aligned address.// The low two bits of a pointer-aligned DisguisedPtr will always be 0b00// (disguised nil or 0x80..00) or 0b11 (any other address).// Therefore out_of_line_ness == 0b10 is used to mark the out-of-line state. out_of_line_nessæ˜¯å’Œinline_referrers[1]çš„ä½Ž2ä½æ˜¯ç­‰åŒçš„ï¼Œout_of_line_nesså’Œnum_refsä½¿ç”¨äº†ä½æ®µï¼Œä¸€å…±å ç”¨64ä½ï¼ˆ2ä½å’Œ62ä½ï¼‰ã€‚ç”±äºŽæ­¤æ—¶å·²ç»æ˜¯ç»“æž„å†…å­˜å¯¹é½äº†ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªç»“æž„æˆå‘˜maskçš„å†…å­˜åœ°å€å°±åˆšå¥½æ¢è¡Œã€‚ä¸Šé¢è¿˜æåˆ°çš„0x0b10ï¼Œå®ƒåº”è¯¥æ˜¯ç»è¿‡DisguisedPträ¼ªè£…ä¹‹åŽå¾—åˆ°çš„å€¼ï¼Œå¹¶ä¸æ˜¯å®žé™…çš„ç­‰äºŽ0b10ï¼Œä¸€ä¸ªåªå ä¸¤ä½å†…å­˜ç©ºé—´çš„ï¼Œæ€Žä¹ˆä¹Ÿå­˜å‚¨ä¸äº†16ä½çš„æ•°æ®ã€‚out_of_line_ness == 0b10æ˜¯æ ‡è®°ä½¿ç”¨out-of-lineçš„çŠ¶æ€ã€‚å…³äºŽè¿™ä¸ª0b10æˆ‘æ²¡æœ‰æƒ³æ¸…æ¥šå®ƒçš„ç”±æ¥ï¼Œæœ‰çŸ¥é“çš„åŒå­¦éº»çƒ¦å‘ŠçŸ¥äºŽæˆ‘ï¼ï¼ï¼ç»§ç»­æ¥çœ‹è¯¥ç»“æž„çš„æž„é€ å‡½æ•°ï¼š 12345678weak_entry_t(objc_object *newReferent, objc_object **newReferrer) : referent(newReferent)&#123; inline_referrers[0] = newReferrer; for (int i = 1; i &lt; WEAK_INLINE_COUNT; i++) &#123; inline_referrers[i] = nil; &#125;&#125; åœ¨åˆ›å»ºweak_entry_tå®žä¾‹çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨inline_referrersçš„æ–¹å¼æ¥ç®¡ç†å¯¹è±¡å¼•ç”¨çš„ï¼Œå¹¶æŠŠå…¶ä½™çš„ä½ä¸Šçš„æ•°æ®æ¸…ç©ºã€‚out_of_line_nessç”¨æ¥åˆ¤æ–­ä½¿ç”¨out_of_lineçš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨ç®¡ç†ï¼Œè¿™ä¸ªout_of_line_nessçš„å€¼ä¸»è¦æ˜¯ä¾æ®äºŽè¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå…¶å¼•ç”¨å˜é‡çš„ä¸ªæ•°å†³å®šçš„ï¼Œå…·ä½“çš„é€»è¾‘åœ¨ä¸‹æ–‡ä¼šè®²åˆ°ã€‚å†çœ‹çœ‹struct1çš„referrersæˆå‘˜ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œæ›´å…·ä½“çš„è¯´æ˜¯å­˜å‚¨çš„å¼•ç”¨å˜é‡æ•°ç»„çš„èµ·å§‹åœ°å€ï¼Œè€Œè¿™äº›å¼•ç”¨å˜é‡æŒ‡é’ˆæŒ‡å‘çš„åœ°å€è¢«DisguisedPtrè¿›è¡Œäº†ä¼ªè£…ã€‚ åˆ°è¿™é‡Œæˆ‘æŠŠweak_entry_tçš„å†…å­˜åˆ†å¸ƒè®²äº†ä¸€éï¼ˆå…·ä½“çš„å«ä¹‰åœ¨ä¸Šé¢ä»£ç å—ä¸­çš„æ³¨é‡Šé‡Œï¼‰ï¼Œç„¶åŽä¸‹é¢æ¥çœ‹ä¸€ä¸‹weak_table_tã€‚ weak_table_tweak_table_tåœ¨å¤´æ–‡ä»¶ä¸­çœ‹ä¸å‡ºä»€ä¹ˆç‰¹åˆ«çš„å†…å®¹ï¼Œä½†æ˜¯ä»Žæºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªåŸºäºŽCçš„ç»“æž„ï¼Œæ²¡æœ‰ä½¿ç”¨C++ä¸­ç»“æž„ç‹¬æœ‰çš„ç‰¹æ€§ã€‚ 123456struct weak_table_t &#123; weak_entry_t *weak_entries; size_t num_entries;/// å’Œweak_entry_tçš„num_refsæ¦‚å¿µç±»ä¼¼ uintptr_t mask;///å’Œ weak_entry_tçš„maskæ¦‚å¿µç±»ä¼¼ uintptr_t max_hash_displacement;/// å’Œweak_entry_tçš„max_hash_displacementæ¦‚å¿µç±»ä¼¼&#125;; åŒæ ·çš„ï¼Œå…¶weak_entriesæˆå‘˜ä¹Ÿåº”è¯¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨ç€weak_entry_tå˜é‡çš„æŒ‡é’ˆã€‚é’ˆå¯¹è¯¥ç»“æž„å¤´æ–‡ä»¶ä¸­å…¬å¼€çš„æ“ä½œå‡½æ•°æœ‰ï¼š 1234567id weak_register_no_lock(weak_table_t *weak_table, id referent, id *referrer, bool crashIfDeallocating);void weak_unregister_no_lock(weak_table_t *weak_table, id referent, id *referrer);#if DEBUGbool weak_is_registered_no_lock(weak_table_t *weak_table, id referent);#endifvoid weak_clear_no_lock(weak_table_t *weak_table, id referent); è¿™çœ‹ä¸äº†ä»€ä¹ˆå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥é’ˆå¯¹å¤´æ–‡ä»¶çš„è§£è¯»å°±åˆ°è¿™é‡Œã€‚ä¸‹é¢åŽ»å®žçŽ°æ–‡ä»¶ä¸­çœ‹çœ‹å…·ä½“çš„å®žçŽ°ï¼Œçœ‹çœ‹ç½‘ä¸Šä¸ºä»€ä¹ˆéƒ½åœ¨è¯´çš„åŸºäºŽHashè¡¨çš„ä¸€ä¸ªå­˜å‚¨ç»“æž„ã€‚æºç åœ°å€ï¼Œè€è§„çŸ©ï¼Œæ‰“å¼€è¿™ä¸ªç½‘é¡µå¯¹ç…§ç€æºç æ¥çœ‹ã€‚ objc-weakå…·ä½“å®žçŽ°ç»†èŠ‚é¦–å…ˆçœ‹ä¸¤ä¸ªhashå‡½æ•°ï¼š 12static inline uintptr_t hash_pointer(objc_object *key);static inline uintptr_t w_hash_pointer(objc_object **key); å®ƒä»¬ä¼šæ ¹æ®å¯¹è±¡çš„æŒ‡é’ˆï¼ˆä¸ç®¡æ˜¯æŒ‡é’ˆè¿˜æ˜¯æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼‰è°ƒç”¨ä¸€ä¸ªfast-hashå‡½æ•°æ¥ç”Ÿæˆä¸€ä¸ªkeyï¼Œå…¶åŽŸç†æ˜¯åŸºäºŽfast_hashï¼Œè€Œè¿™ä¸ªkeyçš„ä½œç”¨ç›®å‰æˆ‘ä»¬æ— ä»Žå¾—çŸ¥ã€‚ grow_refs_and_insertå‡½æ•°ç»§ç»­çœ‹æºç ï¼Œä¸‹é¢ä¸»è¦æ¥çœ‹çœ‹ä¸€ä¸ªå¾ˆé‡è¦çš„å‡½æ•°ï¼š 12345678910111213141516171819202122232425262728293031__attribute__((noinline, used))static void grow_refs_and_insert(weak_entry_t *entry, objc_object **new_referrer)&#123; assert(entry-&gt;out_of_line); /** * #define TABLE_SIZE(entry) (entry-&gt;mask ? entry-&gt;mask + 1 : 0) * entry-&gt;maskç”¨æ¥è®°å½•referrersçš„æ•°é‡ */ size_t old_size = TABLE_SIZE(entry); size_t new_size = old_size ? old_size * 2 : 8;/// å¢žé•¿ä¸€å€çš„å¤§å° size_t num_refs = entry-&gt;num_refs; weak_referrer_t *old_refs = entry-&gt;referrers; entry-&gt;mask = new_size - 1; entry-&gt;referrers = (weak_referrer_t *) _calloc_internal(TABLE_SIZE(entry), sizeof(weak_referrer_t)); entry-&gt;num_refs = 0; entry-&gt;max_hash_displacement = 0; /// å¼€å§‹å¤„ç†æ•°æ® for (size_t i = 0; i &lt; old_size &amp;&amp; num_refs &gt; 0; i++) &#123; if (old_refs[i] != nil) &#123; append_referrer(entry, old_refs[i]);/// æŠŠè€æ•°æ®å¤åˆ¶è¿›æ–°çš„entryé‡Œé¢ num_refs--; &#125; &#125; // Insert append_referrer(entry, new_referrer);/// ç»™entryæ’å…¥æ–°çš„æ•°æ® if (old_refs) _free_internal(old_refs);&#125; ç”±äºŽåŸºäºŽCçš„æ•°ç»„å…¶å®žéƒ½æ˜¯å®šé•¿çš„ï¼Œä¸ºäº†èƒ½å¤ŸåŠ¨æ€åœ°å¢žåŠ æ–°å…ƒç´ å°±éœ€è¦ä¸æ–­åœ°åŽ»ç”³è¯·æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”è¿˜è¦æ˜¯è¿žç»­çš„å†…å­˜åœ°å€ï¼ˆè¦æ˜¯ä¸è¿žç»­çš„åœ°å€å°±åŽ»ä½¿ç”¨é“¾è¡¨çš„æ–¹å¼ï¼Œä½†æ˜¯é“¾è¡¨çš„ç´¢å¼•æ˜Žæ˜¾å¼±äºŽæ•°ç»„çš„ï¼‰ã€‚æ­£æ˜¯å› ä¸ºæ–°åŠ¨æ€ç”³è¯·çš„è¿žç»­å†…å­˜ç©ºé—´ï¼Œè¿™å°±éœ€è¦æŠŠè€æ•°æ®å¤åˆ¶è¿‡æ¥ï¼Œå¹¶æŠŠéœ€è¦æ–°å¢žçš„æ•°æ®ä¹Ÿè¿½åŠ è¿›åŽ»ï¼Œæœ€åŽé‡Šæ”¾æŽ‰åŽŸå†…å­˜ç©ºé—´ï¼šå®ƒå…¶å®žå’ŒC++é‡Œé¢çš„åŠ¨æ€æ•°ç»„çš„åŽŸç†ä¸€æ ·ï¼Œä¸ºäº†ä¸é¢‘ç¹åœ°åŽ»ç”³è¯·ï¼ˆcallocï¼‰æ–°çš„ç©ºé—´å’Œé¢‘ç¹åœ°æ•°æ®ç§»åŠ¨ã€‚æ‰€ä»¥æ¯æ¬¡2å€å¢žé•¿æ¥å¢žåŠ weak_entry_tçš„é•¿åº¦ã€‚ä¸ºä»€ä¹ˆè¯´æ˜¯C++é‡Œé¢åŠ¨æ€æ•°ç»„çš„åšæ³•ï¼Œåœ¨ã€Šæ•°æ®ç»“æž„ä¸Žç®—æ³•å®žçŽ°-C++æè¿°ã€‹é‡Œæœ‰æåŠè¿™äº›å†…å®¹ã€‚ append_referrerå’Œremove_referreråœ¨grow_refs_and_insertå‡½æ•°ä¸­è°ƒç”¨äº†append_referrerå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¾ˆæ˜Žæ˜¾æ˜¯åšæ’å…¥æ“ä½œçš„ï¼Œé»˜è®¤ä½¿ç”¨inlineçš„æ–¹å¼æ¥å¢žåŠ æ–°å¢žçš„weakå¼•ç”¨ï¼Œå¦‚æžœä½¿ç”¨inlineçš„æ–¹å¼å¤±è´¥äº†ï¼Œåˆ™æ˜¯ä»¥outlineçš„æ–¹å¼ï¼Œå¹¶ç”³è¯·å¯¹åº”çš„å­˜å‚¨ç©ºé—´ï¼ŒæŠŠentry-&gt;referrersæŒ‡å‘æ–°ç”³è¯·çš„å†…å­˜åœ°å€ï¼ŒæŠŠinline_referrersæ•°ç»„é‡Œçš„æ•°æ®æ‹·è´åˆ°new_referrersä¸­ï¼Œå…¶æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122if (! entry-&gt;out_of_line) &#123; // Try to insert inline. for (size_t i = 0; i &lt; WEAK_INLINE_COUNT; i++) &#123; if (entry-&gt;inline_referrers[i] == nil) &#123; entry-&gt;inline_referrers[i] = new_referrer; return; &#125; &#125; // Couldn&apos;t insert inline. Allocate out of line. weak_referrer_t *new_referrers = (weak_referrer_t *) _calloc_internal(WEAK_INLINE_COUNT, sizeof(weak_referrer_t)); // This constructed table is invalid, but grow_refs_and_insert // will fix it and rehash it. for (size_t i = 0; i &lt; WEAK_INLINE_COUNT; i++) &#123; new_referrers[i] = entry-&gt;inline_referrers[I]; &#125; entry-&gt;referrers = new_referrers; entry-&gt;num_refs = WEAK_INLINE_COUNT; entry-&gt;out_of_line = REFERRERS_OUT_OF_LINE; entry-&gt;mask = WEAK_INLINE_COUNT-1; entry-&gt;max_hash_displacement = 0;&#125; ä»Žè¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œå½“è¢«å¼•ç”¨å¯¹è±¡çš„å¼±å¼•ç”¨referrersä¸ªæ•°å°äºŽWEAK_INLINE_COUNTæ—¶ï¼Œå…¶entryé‡Œé¢æ˜¯ä»¥inlineå°æ•°ç»„æ–¹å¼æ¥å­˜å‚¨è¿™äº›å¼±å¼•ç”¨å˜é‡çš„ï¼Œåªæœ‰å½“inline_referrerså…¨éƒ¨è£…æ»¡ä¹‹åŽï¼Œè¯¥entry out_of_lineè¢«è®¾ç½®ä¸ºREFERRERS_OUT_OF_LINEï¼ŒåŽç»­å¦‚è‹¥æœ‰å˜é‡ç»§ç»­å¼•ç”¨è¯¥å¯¹è±¡åˆ™æ˜¯ä»¥outlineçš„æ–¹å¼å­˜å‚¨çš„ã€‚ unionæ˜¯åœ¨è¢«å¼•ç”¨å˜é‡çš„referrersä¸ªæ•°å°äºŽç­‰äºŽWEAK_INLINE_COUNTæ—¶ï¼Œä½¿ç”¨inlineæ•°ç»„çš„å†…å­˜è¡¨çŽ°å½¢å¼ï¼›å½“referrersä¸ªæ•°è¶…è¿‡äº†WEAK_INLINE_COUNTåˆ™ä»¥struct1çš„å†…å­˜è¡¨çŽ°å½¢å¼ï¼ ç”±äºŽä½¿ç”¨inlineçš„æ–¹å¼æ˜¯ä½¿ç”¨å°æ•°ç»„çš„æ–¹å¼ï¼Œä½†æ˜¯é’ˆå¯¹å¼±å¼•ç”¨å¯¹è±¡è¿‡å¤šï¼Œé‚£ä¹ˆå®ƒçš„å­˜å–æ€§èƒ½å°±æ˜¯è€ƒè™‘çš„ä¸€ä¸ªé‡ç‚¹ã€‚è€Œæ•£åˆ—æ˜¯ä¸€ç§ç”¨äºŽä»¥å¸¸æ•°å¹³å‡æ—¶é—´æ‰§è¡Œæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾çš„æŠ€æœ¯ã€‚ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹æˆ‘ä¸æ˜¯å¾ˆç¡®å®šï¼Œå¦‚æœ‰ä¸åŒçš„å»ºè®®å¸Œæœ›æŒ‡å‡ºã€‚ 123456789101112size_t index = w_hash_pointer(new_referrer) &amp; (entry-&gt;mask);size_t hash_displacement = 0;while (entry-&gt;referrers[index] != NULL) &#123; index = (index+1) &amp; entry-&gt;mask; hash_displacement++;&#125;if (hash_displacement &gt; entry-&gt;max_hash_displacement) &#123; entry-&gt;max_hash_displacement = hash_displacement;&#125;weak_referrer_t &amp;ref = entry-&gt;referrers[index];ref = new_referrer;entry-&gt;num_refs++; beginæ˜¯é€šè¿‡å¼•ç”¨new_referrerè°ƒç”¨æ•£åˆ—å‡½æ•°èŽ·å–ä¸€ä¸ªæ•£åˆ—å€¼ï¼Œè¿™ä¸ªæ•£åˆ—å€¼å°±æ˜¯æ•£åˆ—è¡¨ä¸­çš„å…ƒç´ æŸ¥æ‰¾è‡ªå·±æ‰€åœ¨æ•£åˆ—æ§½çš„keyã€‚ä»Žæºç å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡æ•£åˆ—å€¼æŸ¥æ‰¾å…ƒç´ å¯¹åº”æ•£åˆ—æ§½çš„æ–¹å¼å¥½åƒæ˜¯ä½¿ç”¨äº†çº¿æ€§æŽ¢æµ‹æ³•ã€‚ç®€åŒ–ä¸Šé¢çš„ä»£ç ï¼Œé…åˆä¸‹æ–¹è¿™å›¾æ¥çœ‹ä¸€ä¸‹æŠŠnew_referreræŒ‡é’ˆæŸ¥æ‰¾æ­£ç¡®indexçš„è¿‡ç¨‹ï¼šå¦‚ä¸Šå›¾ï¼Œå‡è®¾ä½¿ç”¨w_hash_pointerèŽ·å–åˆ°çš„keyä¸º2ï¼Œobj1æˆåŠŸæ’å…¥åˆ°æ•£åˆ—æ§½2ä¸­ï¼Œobj2ä½¿ç”¨w_hash_pointerèŽ·å–åˆ°çš„keyä¹Ÿä¸º2ï¼Œæ­¤æ—¶æ•£åˆ—æ§½2å·²ç»æ”¾å…¥äº†obj1ï¼Œé‚£ä¹ˆåªæœ‰æ­£å‘åœ°åŽ»å¯»æ‰¾ä¸‹ä¸€ä¸ªæ•£åˆ—æ§½ï¼Œå¦‚æžœä¸ºç©ºåˆ™æ”¾å…¥obj2ã€‚å›žåˆ°æºç ä¸­ï¼Œåœ¨æ±‚beginå€¼çš„æ—¶å€™ã€‚æŠŠhashå€¼å’Œentry-&gt;maskåšäº†æŒ‰ä½ä¸Žçš„æ“ä½œï¼Œä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆè¦å¯¹entry-&gt;maskåšä¸€æ¬¡æŒ‰ä½ä¸Žæ“ä½œå‘¢ï¼Ÿentry-&gt;maskå­˜å‚¨ç€weak_entry_tçš„referrersæ•°ç»„å¤§å°ï¼Œè¿™æ ·åšèƒ½ä¿è¯æ‰€å¾—çš„æ•£åˆ—å€¼æ˜¯å°äºŽå½“å‰æ•°ç»„çš„å‡ºç•Œçš„ï¼Œå› ä¸ºå¤§äºŽreferrersæ•°ç»„å¤§å°å¯¹åº”çš„äºŒè¿›åˆ¶ä½çš„é«˜ä½å…¨éƒ¨è¢«ç½®ä¸º0ï¼Œä»Žè€Œé¿å…å‡ºçŽ°æ•°ç»„è¶Šç•Œå¸¦æ¥çš„é—®é¢˜ã€‚å…³äºŽå‡ºç•Œå’Œå…¥ç•Œçš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨ã€ŠCé™·é˜±ä¸Žç¼ºé™·ã€‹ä¸­å…³äºŽä¸€ä¸ªä»‹ç»forå¾ªçŽ¯è¶Šç•Œå¯¼è‡´çš„æ­»å¾ªçŽ¯ä¸€èŠ‚ï¼Œå…·ä½“çš„è®°å¾—ä¸æ˜¯å¾ˆæ¸…æ¥šäº†ã€‚é’ˆå¯¹å‡ºç•Œè¿™ä¸ªæ¦‚å¿µè¿˜æ˜¯è›®é‡è¦çš„ï¼Œè€æ¿ä»¬å¯ä»¥åŽ»çœ‹ä¸€çœ‹ã€‚remove_referrerå’Œappend_referreråœ¨æºç ä¸Šæ¥çœ‹åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒåŒºåˆ«åªä¸è¿‡æ˜¯ä¸€ä¸ªèµ‹å€¼ï¼Œä¸€ä¸ªç½®ç©ºè€Œå·²ã€‚ weak_table_tçš„æ‰©å®¹å’Œå‡å®¹é’ˆå¯¹weak_table_tçš„æ‰©å®¹å’Œå‡å®¹æºç ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œé™äºŽç¯‡å¹…æˆ‘æ²¡æœ‰æä¾›å¯¹åº”çš„ä»£ç ï¼Œæ‰€ä»¥åœ¨çœ‹çš„æ—¶å€™è¿˜éº»çƒ¦è‡ªå·±æ‰“å¼€ä¸Šé¢æåˆ°çš„æºç åœ°å€å¯¹ç…§æ¥çœ‹ã€‚åœ¨æºç ä¸­ä¸»è¦æä¾›äº†å¦‚ä¸‹å‡½æ•°ï¼š weak_entry_insertï¼›å‡½æ•°weak_entry_insertå’Œä¸Šä¸€èŠ‚æåˆ°çš„append_referreræ˜¯ç±»ä¼¼çš„ï¼Œweak_table_tçš„å†…éƒ¨å®žçŽ°åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨æ•£åˆ—è¡¨çš„æ–¹å¼æ¥ç®¡ç†æ‰€æœ‰çš„entryå˜é‡çš„ã€‚åªæ˜¯weak_entry_insertæ²¡æœ‰åŽ»å°è¯•inlineçš„é‚£ä¸€æ­¥ã€‚ weak_resizeï¼›å‡½æ•°weak_resizeå’Œä¸Šé¢æåˆ°çš„grow_refs_and_insertå‡½æ•°ç±»ä¼¼ï¼Œåœ¨è°ƒæ•´å¤§å°æ—¶ï¼Œéƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å°ºå¯¸å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œç„¶åŽå°†åŽŸå†…å­˜ç©ºé—´çš„æ•°æ®ç§»åŠ¨åˆ°æ–°çš„å†…å­˜ç©ºé—´ã€‚weak_resizeåªæœ‰ç§»åŠ¨è€æ•°æ®ï¼Œæ²¡æœ‰æ–°æ•°æ®çš„æ·»åŠ ï¼æœ€åŽé‡Šæ”¾æŽ‰åŽŸå†…å­˜ã€‚ weak_grow_maybeï¼›å‡½æ•°weak_grow_maybeæ˜¯åœ¨åŽŸweak_tableçš„entryæ•°é‡å¤§äºŽäº†weak_tableæ•°ç»„å®¹é‡çš„3/4æ—¶ï¼Œä¾¿è°ƒç”¨weak_resizeåŽ»æ‰©å……å®¹é‡åˆ°åŽŸæ•°ç»„å®¹é‡çš„2å€ã€‚ weak_compact_maybeï¼›å‡½æ•°weak_compact_maybeæ˜¯ç”¨æ¥æ”¶ç¼©å®¹é‡çš„ï¼Œå½“æ•°ç»„çš„å®¹é‡å†…å¤§éƒ¨åˆ†éƒ½ä¸ºç©ºçš„è¯ï¼Œåˆ™å‡å®¹ã€‚ 1234if (old_size &gt;= 1024 &amp;&amp; old_size / 16 &gt;= weak_table-&gt;num_entries) &#123; weak_resize(weak_table, old_size / 8); // leaves new table no more than 1/2 full&#125; weak_entry_removeï¼›å‡½æ•°weak_entry_removeç”¨æ¥weak_table_tçš„entriesé‡Œå¯¹åº”çš„entry 1234if (entry-&gt;out_of_line()) free(entry-&gt;referrers);bzero(entry, sizeof(*entry));weak_table-&gt;num_entries--;weak_compact_maybe(weak_table); sizeof(*entry)èŽ·å–åˆ°äº†weak_entry_tæ‰€å ç”¨çš„å†…å­˜å¤§å°ï¼Œä½¿ç”¨bzeroæ˜¯å°†è¯¥å†…å­˜æ®µå…¨éƒ¨ç½®ä¸º0ï¼Œä½¿ç”¨bzeroè€Œä¸ä½¿ç”¨memsetå½±å“å¹¶ä¸å¤§ï¼Œä½¿ç”¨memsetéœ€è¦å¤šä¼ å…¥ä¸€ä¸ªå‚æ•°æ¥ç¡®å®šéœ€è¦é‡ç½®çš„å€¼ã€‚åœ¨ã€ŠUnixç½‘ç»œç¼–ç¨‹ã€‹é‡Œåˆ›å»ºsockaddr_inç»“æž„å˜é‡æ—¶ï¼ŒæŠŠå¯¹åº”å†…å­˜ç©ºé—´æ•°æ®æ¸…ç©ºç”¨åˆ°äº†bzeroï¼Œå¹¶è®²äº†ä¸€ä¸‹å’Œmemsetçš„åŒºåˆ«ï¼Œå…·ä½“å†…å®¹å¯ä»¥åŽ»çœ‹çœ‹è¿™æœ¬ä¹¦ã€‚ å¤´æ–‡ä»¶æš´éœ²çš„å››ä¸ªå‡½æ•°åœ¨å¤´æ–‡ä»¶ä¸­æš´éœ²äº†å››ä¸ªå¤–éƒ¨å¯ç”¨çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šweak_register_no_lockã€weak_unregister_no_lockã€weak_is_registered_no_lockå’Œweak_clear_no_lockï¼Œæ ¹æ®æ³¨é‡Šæ¥çœ‹ä¸»è¦æ˜¯é’ˆå¯¹weak_table_tçš„æ·»åŠ ã€åˆ é™¤å’Œæ¸…ç©ºæ•°æ®ç­‰æ“ä½œã€‚åœ¨è¿™é‡Œä»¥ä¸‹é¢çš„ä»£ç ä¸ºåŸºç¡€æ¥è®²è§£ï¼š 1__weak id refer = obj; ä¸‹é¢å†æ¥å…·ä½“çœ‹çœ‹è¿™å‡ ä¸ªå‡½æ•°åœ¨å¹²ä»€ä¹ˆï¼Ÿweak_register_no_lockæºä»£ç ä¸­æå‡ºï¼Œæ³¨å†Œä¸€ä¸ªæ–°çš„é”®å€¼å¯¹ï¼Œå¦‚æžœæ–°çš„å¼±å¯¹è±¡ä¸å­˜åœ¨åˆ™åŽ»æ–°åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„entryã€‚ 1if (!referent || referent-&gt;isTaggedPointer()) return referent_id; å¦‚æžœè¢«å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆobjï¼‰æ˜¯isTaggedPointerï¼Œè¿™é‡Œä¾¿ä¸åšç›¸å…³æ“ä½œï¼Œç›´æŽ¥è¿”å›žå¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆobjï¼‰ã€‚å…³äºŽä»€ä¹ˆæ˜¯Tagged Pointerï¼ŒåŽé¢æˆ‘å†åŽ»ç»†çœ‹ä¸€ä¸‹é‡Œé¢çš„æºç ã€‚ä»Žè¿™é‡Œçš„æºç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æžœæ˜¯TaggedPointerå°±ä¸åšåŽç»­æ“ä½œï¼Œå› ä¸ºæŒ‡é’ˆå¹¶æ²¡æœ‰æŒ‡å‘çœŸæ­£çš„å†…å­˜åœ°å€ï¼Œè¿”å›žçš„å€¼åˆ™æ˜¯è¢«å¼•ç”¨å¯¹è±¡è‡ªèº«ã€‚ 12345678weak_entry_t *entry;if ((entry = weak_entry_for_referent(weak_table, referent))) &#123; append_referrer(entry, referrer);&#125;else &#123; weak_entry_t new_entry(referent, referrer); weak_grow_maybe(weak_table); weak_entry_insert(weak_table, &amp;new_entry);&#125; å¦‚æžœå­˜åœ¨å¯¹åº”çš„entryåˆ™ç›´æŽ¥è°ƒç”¨append_referrerè¿›è¡Œæ’å…¥ã€‚å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨weak_entry_tçš„æž„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦éœ€è¦é’ˆå¯¹weak_tableè¿›è¡Œæ‰©å®¹ï¼Œå°†æ–°çš„entryæ’å…¥åˆ°weak_tableä¸­ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªä¸ºå¯¹è±¡å¢žåŠ å¼±å¼•ç”¨ï¼Œå¹¶å°†å¼•ç”¨æ·»åŠ åˆ°weak_tableä¸­çš„ç®€æ˜“æµç¨‹ï¼š çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹weak_unregister_no_lockå‡½æ•°ï¼Œé’ˆå¯¹weak_tableçš„ç§»é™¤ï¼Œå¿…é¡»ç¡®ä¿entryå·²ç»å­˜åœ¨äºŽweak_tableä¸­ï¼Œæ‰ä¼šåŽ»è¿›è¡ŒåŽç»­çš„æ“ä½œï¼ŒåŒæ ·æŠŠå¯¹åº”çš„æµç¨‹å›¾ç”»å‡ºæ¥ï¼šæœ€åŽä¸¤ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªæ˜¯debugçŠ¶æ€ä¸‹ç”¨äºŽåˆ¤æ–­æŸä¸€entryæ˜¯å¦å­˜åœ¨äºŽweak_tableä¸­ï¼Œå¦ä¸€ä¸ªå‡½æ•°åˆ™æ˜¯å¯¹ç‰¹å®šçš„è¢«å¼±å¼•ç”¨çš„å¯¹è±¡ï¼ˆobjï¼‰çš„æ‰€æœ‰å¼•ç”¨åšæ¸…æ¥šæ“ä½œã€‚ ç»“è¯­åˆ°è¿™é‡Œobjc-weakåº”è¯¥ç®—æ˜¯è®²æ¸…æ¥šäº†ï¼ˆå¤©çŸ¥é“æˆ‘çš„è¡¨è¾¾èƒ½åŠ›æ€Žä¹ˆæ ·ã€‚ã€‚ã€‚ï¼‰ï¼Œæœ€åŽæˆ‘ä»Žå¤–å±‚ç»“æž„åˆ°å†…å±‚ç»“æž„æ¥ä¸€ä¸€æ€»ç»“ä¸‹ï¼š1ã€weak_tableå¯ä»¥å­˜å‚¨å¤šä¸ªentryï¼Œè€Œä¸”å®ƒä¼šæ ¹æ®å…¶æ•£åˆ—è¡¨ä¸­entryçš„ä¸ªæ•°æ¥ä¼¸ç¼©å…¶æ‰€å å†…å­˜å¤§å°ï¼›2ã€ä¸€ä¸ªentryè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªè¢«å¼±å¼•ç”¨çš„å¯¹è±¡ï¼ˆä¸Šæ–‡æåˆ°çš„objï¼‰ï¼Œè¯¥å˜é‡å¯ä»¥è¢«å¤šä¸ªå˜é‡å¼±å¼•ç”¨ï¼ˆreferï¼‰ã€‚æ‰€ä»¥entryä¹Ÿå­˜åœ¨ä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œå…¶ç”¨æ¥å­˜å‚¨å¯¹åº”çš„å¼±å¼•ç”¨å˜é‡çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯å‰é¢æºç é‡Œé¢æåˆ°çš„æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆã€‚3ã€entryçš„out_of_line_nessåªæœ‰åœ¨å¼±å¼•ç”¨å˜é‡å¤§äºŽWEAK_INLINE_COUNTæ—¶æ‰ä¼šç½®ä¸ºREFERRERS_OUT_OF_LINEã€‚ä¹Ÿå°±æ˜¯åªæœ‰åœ¨è¿™æ—¶å€™unionæ‰ä¼šä½¿ç”¨struct1ç»“æž„å†…å­˜å¸ƒå±€ã€‚4ã€è¿˜æœ‰å°±æ˜¯out_of_line_ness == 0b10æ²¡æœ‰çœ‹æ‡‚ã€‚ã€‚ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è®°ä¸€æ¬¡LFUç¼“å­˜å®žçŽ°]]></title>
      <url>%2F2018%2F01%2F17%2Flfu4cIniOS%2F</url>
      <content type="text"><![CDATA[è¿™ç¯‡æ–‡ç« å¤§å¤šæ˜¯æˆ‘è‡ªå·±çš„åŸºäºŽiOSå¼€å‘ä¸€ä¸ªæƒ³æ³•è¿‡ç¨‹ï¼Œå®žçŽ°å¹¶ä¸éš¾ã€‚ä¸è¿‡æˆ‘å¹¶ä¸ä¼šè´´å‡ºå…¨éƒ¨ä»£ç ï¼Œå¤©çŸ¥é“æˆ‘ç»„ç»‡æ–‡ç« çš„æ ¹æ®æ˜¯ä»€ä¹ˆï¼Œèƒ½çœ‹æ‡‚éƒ½æ˜¯ç¼˜åˆ†ã€‚ å‰è¨€è®¨è®ºç¼“å­˜æ—¶ï¼Œéƒ½ä¼šåˆ†å†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åŸºäºŽå†…å­˜ç¼“å­˜çš„ï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥ç¨åŠ æ”¹åŠ¨ä¾¿å¯ä»¥åº”ç”¨äºŽç¡¬ç›˜ç¼“å­˜ä¸­ã€‚åœ¨åšå…¶ä»–æ–‡ä»¶IOçš„æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šæƒ…å†µä¼šåŸºäºŽCã€‚åŸºäºŽæ­¤ï¼Œæˆ‘é€‰æ‹©äº†ä½¿ç”¨Cæ¥å®žçŽ°æ ¸å¿ƒéƒ¨åˆ†ã€‚è€Œå®ƒçš„ä½œç”¨æ˜¯ä¸»è¦ç”¨äºŽWebViewåœ¨å†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®ã€‚ å…³äºŽLFUçš„ä¸€äº›æ¦‚å¿µä¹‹ç±»çš„ä¸œè¥¿å°±ä¸è¯´äº†ï¼ŒåŽŸç†å®žçŽ°ç½‘ä¸Šä¸€å¤§å †ã€‚åŸºäºŽè‡ªå·±å•é“¾è¡¨é€šè¿‡æ ˆæ¥å®žçŽ°LFUçš„æ–¹å¼å®žçŽ°ä¸€ä¸‹ï¼Œè¿™ä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æœ€å·®è§£ã€‚ä¸ç®¡æ€Žä¹ˆè¯´ï¼Œå…ˆé€šè¿‡ä¸€ä¸ªå›¾é˜è¿°ä¸€ä¸‹ä¸»è¦çš„æ•°æ®ç»“æž„ï¼š å¤šæƒ³ä¸€ç‚¹å„¿ä¸œè¥¿åœ¨çœ‹äº†ä¸Šå›¾ä¹‹åŽï¼Œé¦–å…ˆçš„æƒ³æ³•å°±æ˜¯åŽ»æŠŠå…·ä½“ç®—æ³•æ’¸å‡ºæ¥ã€‚ä½†æ˜¯åœ¨å¼€åŠ¨å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æƒ³çš„ä¸œè¥¿åº”è¯¥è¦æ›´å¤šã€‚åœ¨é¢å‘è¿‡ç¨‹çš„æ€æƒ³ä¸­æƒ³å¼€æ¥ï¼Œä½¿ç”¨æ ˆçš„æ—¶å€™å–å‡ºæ“ä½œå¯ä»¥å¾ˆå¿«é€Ÿçš„å®Œæˆæœ€å¿«å¯ä»¥è¾¾åˆ°æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè€Œåœ¨ç»´æŠ¤æ ˆé¡ºåºçš„æ—¶å€™ï¼Œæœ€åçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ï¼Œå…¶æŸ¥æ‰¾å’Œä½ç½®æ›´æ–°æ˜¯åœ¨åŒä¸€ä¸ªå¾ªçŽ¯ä¸­å®Œæˆçš„ï¼Œé¿å…äº†ä¸å¿…è¦çš„æ—¶é—´æ¶ˆè€—ã€‚ åŠ å…¥åˆ°é¢å‘å¯¹è±¡ä¸­æ˜¾ç„¶ç”¨Cæ¥åšä¸šåŠ¡é€»è¾‘å¼€å‘å§‹ç»ˆæœ‰ç‚¹å„¿è¹©è„šï¼Œæ‰€ä»¥å¾—å¼•å…¥åˆ°é¢å‘å¯¹è±¡ä¸­ã€‚æˆ‘æŠŠè¿™ä¸ªç±»å–åå«åšPPWebFetchCacheå§ï¼Œæ—¢ç„¶éƒ½é¢å‘å¯¹è±¡äº†ï¼Œè¦ä¸å†å¼„ç‚¹å„¿è®¾è®¡æ¨¡å¼è¿›åŽ»ï¼Ÿè€ƒè™‘åˆ°æ˜“äºŽæ“ä½œæ€§ï¼Œå¯¹äºŽPPWebFetchCacheç±»ï¼Œæˆ‘åšäº†ä¸€ä¸ªå•ä¾‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚åˆ°äº†è¿™é‡Œä¸‹é¢åº”è¯¥è¦æƒ³çš„å°±æ˜¯å¯¹è±¡çš„å±žæ€§å’Œæ“ä½œæ–¹æ³•ç­‰ç­‰äº‹æƒ…ï¼Œä½†æ˜¯è‡ªå·±æƒ³ç€å°±ç”¨äº†ä¸€ä¸ªå•ä¾‹æ¨¡å¼è¿™ä¸æ˜¯è¡¨æ˜Žæˆ‘è®¾è®¡æ¨¡å¼å¾ˆlowå—ï¼Ÿä¸è¿‡äº‹å®žçš„ç¡®æ˜¯è¿™æ ·ï¼Œæˆ‘æ²¡æœ‰ä»€ä¹ˆå¥½çš„è®¾è®¡æ¨¡å¼æ‹¿å‡ºæ¥~~~æ‰€ä»¥æˆ‘å°±ç¡¬å¡žäº†ä¸€ä¸ªç®€å•å·¥åŽ‚æ¨¡å¼è¿›åŽ»ã€‚å®ƒåšä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æƒ³çš„æ˜¯â€œçŽ°åœ¨åªæ˜¯åšLFUï¼Œä¸‡ä¸€å“ªä¸€å¤©å˜åŒ–æ¥äº†ï¼Œè®©æˆ‘ç”¨å†™ä¸€ä¸ªLRUçš„ç¼“å­˜ç­–ç•¥ï¼Œé‚£æˆ‘ä¸æ˜¯æ­»å¾—å¾ˆæƒ¨ï¼â€ï¼Œæ‰€ä»¥æˆ‘åˆåˆ›å»ºäº†ä¸€ä¸ªç»§æ‰¿äºŽPPWebFetchCacheç±»çš„PPWebFetchLFUCacheï¼Œå’Œå¦ä¸€ä¸ªç”¨äºŽå°†æ¥å®žçŽ°LRUç®—æ³•çš„PPWebFetchLRUCacheç±»ã€‚å¹¶åœ¨æœ€åŽç»™çˆ¶ç±»æ·»åŠ äº†å±žæ€§maxMemoryCostã€maxMemoryCountLimitå’Œä¸¤ä¸ªæ“ä½œæ–¹æ³•storeCacheInMemoryã€memoryCacheWithURLã€‚ èµ°è¿›å®žçŽ°ç»†èŠ‚ä¸Šé¢è¯´çš„LFUæ˜¯é’ˆå¯¹äºŽæŸä¸€ä¸ªURLçš„ä½¿ç”¨æ¬¡æ•°ã€‚åœ¨æ€è€ƒå¦‚ä½•ä½¿ç”¨æœ€å°‘æ—¶é—´æ‹¿åˆ°URLå¯¹åº”çš„æ•°æ®æ—¶ï¼Œæ˜¾ç„¶æ•£åˆ—è¡¨æœ€ç†æƒ³çš„æ•°æ®ç»“æž„ï¼Œè€Œä¸”åœ¨iOSä¸­ç”¨æ•£åˆ—è¡¨å®žçŽ°çš„ä»£è¡¨ä¾¿æ˜¯Dictionaryã€‚æ‰€ä»¥å¤§è‡´çš„é€»è¾‘æ˜¯ï¼š ä½¿ç”¨NSDictionaryæ¥å®žçŽ°URLå’Œæ•°æ®ä¸€å¯¹ä¸€åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ã€‚è€ŒLFUä¸»è¦ç”¨äºŽç®¡ç†æŸä¸€URLçš„ä½¿ç”¨æ¬¡æ•°ï¼Œæ·˜æ±°æŽ‰ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„URLï¼Œå¹¶åœ¨å†…å­˜å­—å…¸ä¸­åˆ é™¤å¯¹åº”çš„æ•°æ®ã€‚ PPWebFetchCacheå¯¹å¤–æš´éœ²çš„æŽ¥å£åªæœ‰å­˜å’Œå–ï¼Œè€Œå…·ä½“çš„åŠ å…¥å’Œåˆ é™¤æ“ä½œåˆ™æ˜¯åœ¨å†…éƒ¨é€šè¿‡maxMemoryCostã€maxMemoryCountLimitæŽ§åˆ¶å®žçŽ°ã€‚ å¼‚æ­¥çŽ¯å¢ƒæ˜¾ç„¶åœ¨æ•°æ®å­˜å–çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­åŽ»åšè¿™äº›äº‹å„¿ã€‚å› æ­¤æˆ‘åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—ç”¨æ¥æ‰§è¡Œè¿™äº›äº‹åŠ¡ï¼š 12345678910111213static dispatch_queue_t background_serialQueue()&#123; static dispatch_queue_t queue; if (!queue) &#123; char *const label = &quot;com.example.webprefetchCache&quot;; dispatch_queue_attr_t attr = dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_SERIAL, QOS_CLASS_USER_INITIATED, 0); queue = dispatch_queue_create(label, attr); &#125; return queue;&#125;void async_inbackground(void(^block)(void))&#123; dispatch_async(background_serialQueue(), block);&#125; ä¸ºä»€ä¹ˆè¦ç”¨ä¸²è¡Œé˜Ÿåˆ—ï¼Ÿå› ä¸ºåœ¨é˜Ÿåˆ—å†…éƒ¨æ“ä½œï¼Œæˆ‘ä¸éœ€è¦å…³å¿ƒä¼šå‡ºçŽ°èµ„æºç«žäº‰çš„é—®é¢˜ã€‚è€Œåœ¨ä¸²è¡Œé˜Ÿåˆ—ä»¥å¤–å…¶ä»–é˜Ÿåˆ—ä¸­æ¥æ“ä½œå•ä¾‹çš„ç›¸å…³æ•°æ®æ—¶ï¼Œæˆ‘å°±éœ€è¦åŽ»å…³å¿ƒçš„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚å› æ­¤æˆ‘ç›´æŽ¥ä½¿ç”¨é€‚ç”¨äºŽé™æ€åˆ†é…çš„çš„äº’æ–¥é‡PTHREAD_MUTEX_INITIALIZERæ¥ä¿è¯æ•°æ®çš„åŒæ­¥æ“ä½œã€‚åè§‚å¦‚æžœæˆ‘åŽ»ä½¿ç”¨pthread_mutex_initæ¥åŠ¨æ€ç”Ÿæˆä¸€ä¸ªäº’æ–¥é‡çš„è¯ï¼Œæˆ‘è¿˜è¦æ“å¿ƒä»€ä¹ˆæ—¶å€™åŽ»destroyæŽ‰å®ƒï¼ˆå½“ç„¶è¿™é‡Œå¾—ä»”ç»†æ€è€ƒé€ æˆæ­»é”çš„é—®é¢˜ï¼‰ã€‚ 1234567891011static inline pthread_mutex_t mutext_lock(void)&#123; static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER; return lock;&#125;static void safeProgressWith(void(^block)(void))&#123; pthread_mutex_t lock = mutext_lock(); pthread_mutex_lock(&amp;lock); block(); pthread_mutex_unlock(&amp;lock);&#125; åœ¨åŠ é”ç­‰æ“ä½œæ—¶ï¼Œå°½é‡è®©å…¶é¢—ç²’åº¦æ›´ä½Žã€‚è¿™æ ·å¯ä»¥å‡å°‘ä¸å¿…è¦çš„çº¿ç¨‹å¤„äºŽwaitingçŠ¶æ€ï¼Œä¹Ÿå°±ç›¸åº”åœ°å‡å°‘å‡ºçŽ°ä½Žä¼˜å…ˆçº§çº¿ç¨‹é¥¿æ­»çš„æƒ…å†µå‘ç”Ÿï¼ˆå°½é‡å‡å°‘CPUå¯†é›†åž‹çº¿ç¨‹çš„æ—¶é—´ç‰‡ï¼‰ã€‚ LFUçš„å…·ä½“å®žçŽ°LFUåªæ˜¯é’ˆå¯¹äºŽURLçš„æ·˜æ±°ç­–ç•¥ï¼Œæ·˜æ±°äº†URLä¹‹åŽï¼Œæ ¹æ®è¯¥URLåˆ°NSDictionaryä¸­æ‰¾å‡ºå¯¹åº”çš„æ•°æ®è¿›è¡Œç§»é™¤ã€‚è¿™é‡Œä½¿ç”¨é“¾è¡¨çš„æ–¹å¼å®žçŽ°æ ˆç»“æž„ï¼Œå…¶ç»“æž„å¦‚ä¸‹ï¼š 123456typedef struct __PPWebLFUFetchInlayerNode_ * _PPWebLFUInlayerNodeRef;typedef struct __PPWebLFUFetchInlayerNode_ &#123; char *url; int use_count; _PPWebLFUInlayerNodeRef next;&#125;_PPWebLFUFetchInlayerNode; åœ¨PPWebFetchLFUCacheç±»ä¸­ä¿å­˜äº†ä¸€ä¸ª_PPWebLFUInlayerNodeRefçš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ ˆé¡¶ï¼š 123@interface PPWebFetchLFUCache:PPWebFetchCache&#123; _PPWebLFUInlayerNodeRef _lfuStack;&#125; èµ°åˆ°è¿™é‡Œæˆ‘ä»¬å¤§å¯ä»¥ç›´æŽ¥ä½¿ç”¨_lfuStackæˆå‘˜å˜é‡æ¥å¯¹æ ˆè¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼è¿™é‡Œæ€ç»´è·³è·ƒä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬åœ¨æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶å¦‚ä½•åŽ»åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯æ–°å¢žèŠ‚ç‚¹ã€è¿˜æ˜¯å­˜åœ¨äºŽæ ˆä¸­çš„èŠ‚ç‚¹ã€æŠ‘æˆ–æ˜¯éœ€è¦åˆ é™¤çš„ç»“ç‚¹ï¼Ÿå¦‚æžœåªæ˜¯ç®€å•çš„å›žç­”â€œæˆ‘åœ¨æ’å…¥èŠ‚ç‚¹æ—¶ï¼Œå…ˆéåŽ†ä¸€éæ ˆçœ‹å…ƒç´ æ˜¯å¦å­˜åœ¨äºŽå…¶ä¸­â€ï¼Œè¿™æ ·åšæ¯«æ— æ„ä¹‰ï¼Œè€Œä¸”å¹³æ·»ä¸€å€çš„æ—¶é—´æ¶ˆè€—ï¼Œå› ä¸ºåŽé¢çš„æ’å…¥æ“ä½œæ—¶ï¼Œè¿˜è¦åŽ»éåŽ†ä¸€æ¬¡æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä½ç½®ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°åœ¨åŒä¸€ä¸ªå¾ªçŽ¯ä¸­å¤„ç†æ’å…¥æ•°æ®ï¼ŒæŸ¥æ‰¾æ•°æ®ï¼Œåˆ é™¤æ•°æ®ç­‰æ“ä½œã€‚è¿™é‡Œéœ€è¦åœ¨æ‰§è¡ŒCæ“ä½œæ—¶åœ¨é€‚å½“åœ°ç‚¹ç»™æˆ‘ä»¬å›žè°ƒï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šåœ¨ä¸€æ¬¡å¾ªçŽ¯ä¸­åšå®Œè¿™äº›æ“ä½œã€‚ä¸ºä»€ä¹ˆè¦ç”¨å›žè°ƒå‘¢ï¼Ÿæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠåˆ é™¤çš„ç›¸å…³é€»è¾‘æ”¾åœ¨æŸä¸€æ¬¡å¾ªçŽ¯ä¸­ï¼Œè¿™æ ·å°±éœ€è¦æˆ‘ä»¬åœ¨è°ƒç”¨é€»è¾‘æ—¶ä¼ å…¥ä¸€äº›åˆ¤æ–­æ¡ä»¶ã€‚è¿™æ— ç–‘æ˜¯å¢žåŠ äº†ç®—æ³•çš„å±€é™æ€§ï¼Œä»Žå¦ä¸€ç‚¹æ¥è¯´ï¼Œè¿™ä¸ªç®—æ³•çš„é€‚ç”¨èŒƒå›´å°±å¤§å¤§é™ä½Žäº†ã€‚æ‰€ä»¥æˆ‘å¼•å…¥äº†ä¸€ä¸ªä¸Šä¸‹æ–‡çŽ¯å¢ƒï¼Œè¿™ä¸ªçŽ¯å¢ƒä¸»è¦ç”¨äºŽåŒ…è£¹ç›¸å…³ä¿¡æ¯æ•°æ®å’Œå‡½æ•°æŒ‡é’ˆå›žè°ƒï¼š 1234567891011121314151617181920212223typedef struct __PPWebLFUFetchCacheContext *PPWebLFUFetchCacheContextRef;typedef struct __PPWebLFUFetchCacheContext &#123; _PPWebLFUInlayerNodeRef *node;/// root void *info;/// ä¸€èˆ¬ä¼ å…¥fetchCacherå¯¹è±¡ void (*appendInStackRootCallback)(void *info, char *const key);/// æ ˆé¡¶æ’å…¥å›žè°ƒ void (*appendInStackBottomCallback)(void *info, char *const key);/// æ ˆåº•æ’å…¥å›žè°ƒ void (*appendInStackCallback)(void *info, char *const key);/// æ ˆä¸­æ’å…¥å›žè°ƒ&#125;PPWebLFUFetchCacheContext;/// è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åŽï¼Œå¦‚æžœä¸å†éœ€è¦ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆï¼Œéœ€è¦è°ƒç”¨freeæ¥é‡Šæ”¾å†…å­˜ç©ºé—´PPWebLFUFetchCacheContextRef PPWebLFUFetchCacheContextCreate(void *root, void *info, void (* _Nonnull appendInStackRootCallback)(void *info, char *const key), void (* _Nonnull appendInStackBottomCallback)(void *info, char *const key), void (* _Nonnull appendInStackCallback)(void *info, char *const key))&#123; PPWebLFUFetchCacheContextRef ctx = (PPWebLFUFetchCacheContextRef)malloc(sizeof(PPWebLFUFetchCacheContext)); ctx-&gt;node = root; ctx-&gt;info = info; ctx-&gt;appendInStackRootCallback = appendInStackRootCallback; ctx-&gt;appendInStackBottomCallback = appendInStackBottomCallback; ctx-&gt;appendInStackCallback = appendInStackCallback; return ctx;&#125; è‡³äºŽè¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Ÿå½“æˆ‘ä»¬éœ€è¦å¤šä¸ªå›žè°ƒæ—¶ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦æŠŠæ¯ä¸€ä¸ªå›žè°ƒéƒ½æ·»åŠ åˆ°å‡½æ•°å‚æ•°ä¸­åŽ»ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å‚æ•°åŒ…è£…èµ·æ¥ã€‚è€Œä¸”è¿™æ ·åŒ…è£…èµ·æ¥åšè¿˜æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå°±æ˜¯æ–°å¢žå›žè°ƒåœºæ™¯æ—¶å°±è¦æ–¹ä¾¿è®¸å¤šï¼ å…ƒç´ æ·»åŠ çŽ°åœ¨æ‰€æœ‰çš„æ¡ä»¶éƒ½å·²å…·å¤‡ï¼Œæ˜¯æ—¶å€™æ¥å¤„ç†è¿™äº›å…·ä½“çš„é€»è¾‘äº†ã€‚å°±åƒæ˜¯åœ¨å­¦çº¢é»‘æ ‘çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šæŠŠå®ƒé‚£5ä¸ªç‰¹æ€§å…ˆæå‡ºæ¥æ˜¯å§ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦æ˜Žç¡®å‡ ç‚¹ç‰¹æ€§ï¼š 1ã€ç”±é“¾è¡¨å®žçŽ°çš„ä¸€ä¸ªæ ˆï¼Œåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼ˆä¸Šé¢æåˆ°çš„ï¼ŒåŒ…è£…åœ¨ä¸Šä¸‹æ–‡ä¸­çš„lfustackï¼‰ï¼› 2ã€æ ˆçš„æ·±åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼› 3ã€æ·»åŠ å’Œåˆ é™¤æ“ä½œæ˜¯åŸºäºŽæ ˆé¡¶ï¼› 4ã€æ ˆå†…å…ƒç´ çš„ä½¿ç”¨æ¬¡æ•°æ˜¯ä»Žå°åˆ°å¤§ï¼Œä»Žä¸Šåˆ°ä¸‹ç”Ÿé•¿ï¼› åŸºäºŽä»¥ä¸Šï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªå…ƒç´ æ·»åŠ å‡½æ•°çš„åŽŸåž‹ï¼š 1bool _PPWebFetchLFUInlayerQueueAdd(PPWebLFUFetchCacheContextRef context,char *const url) å¾ˆæ˜Žæ˜¾ä¼ å…¥çš„contextæ˜¯éœ€è¦åœ¨å¤–é¢åˆ›å»ºå¥½çš„ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä½†æ˜¯contextçš„å…·ä½“æˆå‘˜å˜é‡æˆ‘ä»¬æ²¡æœ‰æŽ§åˆ¶ï¼Œå…¨éƒ¨ä¼ å…¥NULLéƒ½å¯ä»¥ï¼ˆå› ä¸ºæ‡’ï¼Œä¸æƒ³å¯¹å‡½æ•°æŒ‡é’ˆåšéžç©ºåˆ¤æ–­ï¼Œæ‰€ä»¥æˆ‘æŠŠå‡½æ•°æŒ‡é’ˆè®¾ç½®ä¸º_Nonnullã€‚ã€‚ã€‚ï¼‰ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å› æ­¤é¦–å…ˆè¦åšçš„å°±æ˜¯åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºï¼š 123456789101112if (!(*(context-&gt;node))) &#123;/// åˆ›å»ºæ ˆé¡¶æŒ‡é’ˆ _PPWebLFUInlayerNodeRef node = allocNewNode(url); if (!node) &#123; return false; &#125; __block _PPWebLFUInlayerNodeRef *_broot = (context-&gt;node); safeProgressWith(^&#123; *_broot = node; (context-&gt;appendInStackRootCallback)(context-&gt;info,url); &#125;); return true;&#125; åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº†contextçš„ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆå›žè°ƒï¼Œå½“åœ¨ç©ºæ ˆä¸­åŠ å…¥æ ¹èŠ‚ç‚¹ï¼Œè¿™æ˜¯ç¬¦åˆè¯¥å‡½æ•°æŒ‡é’ˆå›žè°ƒè¯­ä¹‰çš„ã€‚æ­¤æ—¶çš„æ ˆåˆ†å¸ƒæƒ…å†µå¾ˆç®€å•ï¼Œä½†è¿˜æ˜¯ç”»å‡ºæ¥æ›´åŠ æ˜Žæ˜¾ï¼šåœ¨è¿™ä¹‹åŽæ’å…¥ç»“ç‚¹æ—¶ï¼Œæˆ‘ä»¬ä¾¿éœ€è¦è€ƒè™‘æ–°æ·»åŠ è¿›æ¥çš„URLæ˜¯æ–°èŠ‚ç‚¹è¿˜æ˜¯åœ¨åŽŸæœ‰èŠ‚ç‚¹ä¸Šå¢žåŠ ä½¿ç”¨æ¬¡æ•°ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾ªçŽ¯ä»Žæ ¹èŠ‚ç‚¹å¼€å§‹éåŽ†æ ˆï¼Œå¦‚æžœæ‰¾åˆ°äº†å¯¹åº”çš„URLï¼Œä¾¿å°†å…¶ä½¿ç”¨æ¬¡æ•°åŠ ä¸€ï¼Œå¦‚æžœèµ°åˆ°æ ˆåº•è¿˜æ˜¯æœªèƒ½å‘½ä¸­å¯¹åº”çš„URLï¼Œåˆ™éœ€è¦ä»¥è¯¥URLä¸ºæ•°æ®åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ˆæ ¹ã€‚å®žçŽ°ä»£ç å¦‚ä¸‹ï¼š 123456if (0 == strcmp(lead-&gt;url, url)) &#123; (context-&gt;node)-&gt;use_count++;&#125;else&#123; (context-&gt;appendInStackRootCallback)(context-&gt;info,url); return appendRootNodeInStack((context-&gt;node), url);&#125; ä¸Šé¢æ¶‰åŠåˆ°çš„å‡½æ•°appendRootNodeInStackä¸»è¦ç”¨äºŽç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ä¹‹åŽï¼Œå¹¶å°†è¯¥èŠ‚ç‚¹è®¾ç½®ä¸ºæ ¹ï¼š 12345678910111213bool appendRootNodeInStack(_PPWebLFUInlayerNodeRef *root ,char *const url)&#123; /// åœ¨æ ˆé¡¶æ’å…¥ _PPWebLFUInlayerNodeRef node = allocNewNode(url); if (!node) &#123; return false; &#125; __block _PPWebLFUInlayerNodeRef *_broot = root; safeProgressWith(^&#123; node-&gt;next = *_broot; *_broot = node; &#125;); return true;&#125; æ‰€ä»¥çŽ°åœ¨ä¼šå‡ºçŽ°ä¸¤ç§æƒ…å†µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šè¿™æ®µé€»è¾‘ä»£ç ç›®å‰å¹¶æ²¡æœ‰æ”¾åœ¨å¾ªçŽ¯ä¸­æ¥åšï¼Œå®ƒå’Œæ ˆä¸­å·²ç»å­˜åœ¨å››ä¸ªã€äº”ä¸ªèŠ‚ç‚¹çš„æƒ…å†µæ˜¯ç±»ä¼¼çš„ï¼Œä½†å®ƒçš„æƒ…å†µè¦ç®€å•è®¸å¤šï¼Œå®ƒåªéœ€è¦å¤„ç†ä½¿ç”¨æ¬¡æ•°æ›´æ–°æˆ–è€…å¤´èŠ‚ç‚¹æ’å…¥çš„æƒ…å†µï¼Œä¸ä¼šæ¶‰åŠåˆ°åˆ é™¤ï¼ˆé™¤éžä½ ä¸åšç¼“å­˜ï¼‰ã€ç§»ä½æ“ä½œã€‚åˆ°æœ€åŽæˆ‘ä¼šæŠŠè¿™æ®µä»£ç åˆå¹¶èµ·æ¥ï¼Œè€Œé‚£æ­£æ˜¯æˆ‘è®¾è®¡è¿™å¥—ç®—æ³•çš„ä¸­å¿ƒæ€æƒ³ã€‚ èŠ‚ç‚¹ç§»åŠ¨å’Œåˆ é™¤é’ˆå¯¹èŠ‚ç‚¹çš„ç§»åŠ¨ï¼Œéœ€è¦è€ƒè™‘å¤šä¸ªæƒ…å†µï¼ŒåŒ…æ‹¬ï¼šä»Žæ ˆé¡¶ç§»åŠ¨åˆ°æ ˆåº•ã€ä»Žæ ˆé¡¶ç§»åŠ¨åˆ°æ ˆä¸­æŸä¸€ä¸ªä½ç½®ã€ä»Žæ ˆä¸­æŸä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°æ ˆä¸­å¦ä¸€ä¸ªä½ç½®ã€ä»Žæ ˆä¸­æŸä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°æ ˆåº•ã€ä¸ç§»åŠ¨ã€‚æˆ‘æŠŠè¿™äº›æƒ…å†µä¾æ¬¡æè¿°åˆ°å›¾ä¸­ï¼Œè¿™æ ·çœ‹ç€æ›´ç›´è§‚ï¼šä¸‹é¢æ˜¯åŽé¢ä¸¤ç§æƒ…å†µï¼šä»Žä¸Šé¢è™šçº¿ç®­å¤´åˆ°å®žçº¿ç®­å¤´çš„å˜åŒ–å¯ä»¥å¾ˆæ˜Žæ˜¾çœ‹å‡ºæ¥ï¼Œæ˜¯å¤æ‚äº†ä¸å°‘ã€‚è€Œæœ€åŽä¸€ç§æ— å˜åŒ–çš„ï¼Œæˆ‘å°±æ²¡æœ‰åˆ—å‡ºæ¥ã€‚çœ‹çœ‹å‰é¢å››ç§æƒ…å†µå˜åŒ–åŽçš„æ ˆå…ƒç´ æŽ’åˆ—æƒ…å†µï¼Œä»Žå·¦åˆ°å³ï¼Œä»Žä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯ï¼š 2-&gt;3-&gt;4-&gt;1; 3-&gt;2-&gt;4-&gt;1; 2-&gt;4-&gt;3-&gt;1; 2-&gt;3-&gt;1-&gt;4; ä»Žä¸Šé¢å››ç§æƒ…å†µæ¥çœ‹ï¼Œå¯¹äºŽä¸€ä¸ªèŠ‚ç‚¹çš„ç§»åŠ¨å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨æ‹†å¼€æ¥çœ‹ï¼Œåˆ†åˆ«æ˜¯â€”â€”å–å‡ºã€æ”¾å…¥ä¸¤ä¸ªè¿‡ç¨‹ã€‚æˆ‘ç›´æŽ¥æŠŠä¸­é—´çš„çš„ç®—æ³•åˆ—å‡ºæ¥ï¼š 1234567891011121314151617181920212223242526272829303132333435363738_PPWebLFUInlayerNodeRef previous = lead;_PPWebLFUInlayerNodeRef pivot = NULL;_PPWebLFUInlayerNodeRef prepivot = NULL;do &#123; if (0 != strcmp(lead-&gt;url, url)) &#123; if (!pivot) &#123; continue; &#125; if (pivot-&gt;use_count &lt;= lead-&gt;use_count) &#123; break;/// è·³å‡ºå¾ªçŽ¯åŽ»æ‰§è¡Œæ”¾å…¥ &#125; if (*(context-&gt;node)==pivot) &#123; __block _PPWebLFUInlayerNodeRef *_broot = (context-&gt;node); safeProgressWith(^&#123; *_broot = previous-&gt;next; &#125;); &#125;else&#123;/// å–å‡º prepivot-&gt;next=pivot-&gt;next; &#125; continue; &#125; lead-&gt;use_count++; pivot = lead; prepivot = previous;&#125; while ((void)(previous=lead),(void)(lead=lead-&gt;next),lead);if (!pivot) &#123;/// åœ¨æ ˆé¡¶æ’å…¥ (context-&gt;appendInStackRootCallback)(context-&gt;info,url); return appendRootNodeInStack((context-&gt;node), url);&#125;if (!lead) &#123;/// å¤„ç†æ ˆåº•æƒ…å†µ previous-&gt;next=pivot; pivot-&gt;next=NULL; (context-&gt;appendInStackBottomCallback)(context-&gt;info,url);&#125;else&#123;/// å¤„ç†æ ˆä¸­çš„æ”¾å…¥ pivot-&gt;next=previous-&gt;next; previous-&gt;next=previous==pivot?lead:pivot; (context-&gt;appendInStackCallback)(context-&gt;info,url);&#125; è¿™æ®µä»£ç æŠŠä¸Šé¢æåˆ°çš„if-elseåˆ¤æ–­ä¹Ÿä¸€èµ·åˆå¹¶è¿›æ¥äº†ï¼Œè¿™é‡Œpivotä¸»è¦æ˜¯ç”¨æ¥è®°å½•æ‰¾åˆ°ç›®æ ‡URLçš„å“¨å…µï¼Œè€Œprepivotç”¨æ¥è®°å½•å“¨å…µå‰é¢ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚æžœä½¿ç”¨åŒå‘é“¾è¡¨å®Œå…¨å¯ä»¥ä¸ç”¨è¿™ä¸ªé›¶æ—¶å˜é‡ï¼‰ã€‚åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šæ˜¯æŠŠè¯¥ç®—æ³•çš„æ ¸å¿ƒéƒ¨åˆ†è¯´å®Œäº†ï¼Œè¯¥ç®—æ³•çš„æœ€åæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(N)ï¼Œè¿™ç§æœ€åæ—¶é—´å¤æ‚åº¦çš„æƒ…å†µåˆ†åˆ«æ˜¯ï¼šæ–°èŠ‚ç‚¹æ’å…¥ï¼Œæ ˆé¡¶ä¸€æ¬¡ç›´æŽ¥ç§»åŠ¨æ ˆåº•ï¼ˆè¿™ä¸ªæƒ…å†µæ˜¯å‘ç”Ÿåœ¨ä½¿ç”¨æ¬¡æ•°éƒ½ä¸º1æ—¶ï¼Œæ ˆé¡¶å…ƒç´ æ­¤æ—¶+1çš„æƒ…å†µï¼‰ã€‚æœ€ä¼˜çš„æ—¶é—´å¤æ‚åº¦æƒ…å†µæ˜¯O(1)ï¼Œç›´æŽ¥æ ˆé¡¶æ•°æ®æ›´æ–°ã€‚æœ€åŽå°±æ˜¯èŠ‚ç‚¹çš„åˆ é™¤æ“ä½œï¼Œä»…ä»…åªæ˜¯åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦è‚¯å®šæ˜¯O(1)çš„ã€‚ä½†æ˜¯äº‹æƒ…å¾€å¾€æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå¿…é¡»è¦è€ƒè™‘å½“å‰æ·»åŠ è¿›æ¥çš„å…ƒç´ æ˜¯åˆ°è¾¾å®¹é‡é™åˆ¶çš„æ–°å…ƒç´ ï¼Œè¿˜æ˜¯æ ˆé‡Œé¢å·²ç»å­˜åœ¨çš„å…ƒç´ å‘¢ï¼Ÿéš¾é“æˆ‘ä»¬åˆè¦åŽ»éåŽ†ä¸€æ¬¡æ ˆç„¶åŽæ¥åšåˆ é™¤æ“ä½œå—ï¼Ÿè¿™æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œå› ä¸ºè¦å‡ºçŽ°åˆ é™¤èŠ‚ç‚¹çš„æƒ…å†µï¼Œè‚¯å®šæ˜¯å‘ç”Ÿåœ¨å‘æ ˆä¸­Pushå…ƒç´ æ—¶å‘ç”Ÿã€‚å› æ­¤æˆ‘å°†ä¸Šé¢å„ä¸ªæƒ…å†µåˆ†ä¸ºä¸‰ç§å¤§ä½“æƒ…å†µï¼Œå¹¶ä¸ºè¿™ä¸‰ç§æƒ…å†µæä¾›äº†ä¸‰ä¸ªå›žè°ƒï¼Œè€Œè¿™ä¸ªä¸‰ä¸ªå›žè°ƒéƒ½æ˜¯æ”¾åœ¨ä¸Šé¢çš„contextä¸­ï¼š åœ¨æ ˆé¡¶æ’å…¥å…ƒç´ ï¼ˆappendInStackRootCallbackï¼‰ï¼› å¤„ç†æ ˆåº•æƒ…å†µï¼ˆappendInStackBottomCallbackï¼‰ï¼› å¤„ç†ä¸­é—´èŠ‚ç‚¹ï¼ˆappendInStackCallbackï¼‰ï¼› åŸºäºŽè¿™ï¼š æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡å¾ªçŽ¯ä¸­å®Œæˆæ–°å¢žã€ç§»åŠ¨ã€åˆ é™¤æ“ä½œï¼ ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªå›žè°ƒï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨PPWebFetchLFUCacheå®žä¾‹æ–¹æ³•æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªæ•´ä½“è¿‡ç¨‹ï¼š 123456789101112131415161718192021- (BOOL)insertCacheMap:(NSData *)object forKey:(NSString *)key&#123; PPWebLFUFetchCacheContextRef ctx = PPWebLFUFetchCacheContextCreate( &amp;_lfuStack, (__bridge void *)(self), &amp;progressingAppendInStackRootCallback, &amp;progressingAppendInStackBottomCallback, &amp;progressingAppendInStackCallback); bool result = _PPWebFetchLFUInlayerQueueAdd(ctx, (char *)[key UTF8String]); if (result == false) &#123; PPWebLFUFetchCacheContextRelease(&amp;ctx); return NO; &#125; if (![self.cacheMap.allKeys containsObject:key]) &#123; safeProgressWith(^&#123; [self.cacheMap setObject:object forKey:key]; self.currentCacheUsage += object.length; &#125;); &#125; PPWebLFUFetchCacheContextRelease(&amp;ctx); return YES;&#125; åœ¨ä¸Šé¢åˆ›å»ºä¸Šä¸‹æ–‡çš„ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¿å­˜åœ¨PPWebFetchLFUCacheå•ä¾‹ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè€Œinfoå‚æ•°ä¸»è¦ç”¨æ¥ä¼ é€’selfï¼Œè¿™é‡Œç”¨contextæ—¶ï¼Œ_lfuStackä¼šè¢«contextä¿ç•™ï¼Œè€Œ_lfuStackåˆä¼šè¢«PPWebFetchLFUCacheå•ä¾‹ä¿ç•™ï¼Œä½†æ˜¯åœ¨å‡½æ•°è¿”å›žä¹‹å‰ä¼šå¯¹contextåšreleaseæ“ä½œï¼Œä¼šæŠŠå¯¹_lfuStackçš„ä¿ç•™ç½®ç©ºï¼Œæ‰€ä»¥ä¸è¦æƒ³ç€OCé‡Œé¢å¸¸å‡ºçŽ°çš„å¼•ç”¨è®¡æ•°ä¸ä¼šé™ä¸º0çš„é—®é¢˜ã€‚è€Œä¸”ä¹Ÿä¸ä¼šå‡ºçŽ°ç›¸äº’æŒæœ‰çš„å…³ç³»ã€‚è€Œå›žè°ƒå‡½æ•°ä¸­ï¼Œä¸»è¦æ¥çœ‹progressingAppendInStackRootCallbackçš„å›žè°ƒï¼š 123456789101112void progressingAppendInStackRootCallback(void *info, char *const key)&#123; PPWebFetchLFUCache *cacher = (__bridge PPWebFetchLFUCache *)(info); if (!cacher) &#123; return; &#125; if (cacher.cacheMap.allKeys.count &gt;= kMaxMemoryCountLimit) &#123; [cacher deleteCacheMap]; progressingAppendInStackRootCallback(info, key); &#125;else&#123; return; &#125;&#125; ä¸‹é¢æˆ‘ç›´æŽ¥æŠŠåˆ é™¤å‡½æ•°è´´å‡ºæ¥ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ï¼š 1234567891011121314151617_PPWebLFUInlayerNodeRef _PPWebFetchLFUInlayerQueueDelete(PPWebLFUFetchCacheContextRef context ,char **url)&#123; if (!(context-&gt;node)) &#123; return NULL; &#125; _PPWebLFUInlayerNodeRef lead = NULL; lead = *(context-&gt;node); __block _PPWebLFUInlayerNodeRef *_broot = (context-&gt;node); if ((*_broot)-&gt;next) &#123; safeProgressWith(^&#123; *_broot = (*_broot)-&gt;next; &#125;); &#125; if (url) &#123; (*url) = (lead-&gt;url); &#125; return lead;&#125; ä¸Šé¢å‡ºçŽ°çš„deleteCacheMapæ–¹æ³•ä¸­ä¼šæŠŠä¸å†ä½¿ç”¨çš„èŠ‚ç‚¹freeæŽ‰ã€‚ åŽè¯­ä¸Šé¢ä»£ç ä¸­å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†safeProgressWithå‡½æ•°ï¼Œå…¶å®žçŽ°ä¹Ÿåœ¨ä¸Šé¢åˆ—å‡ºæ¥äº†ã€‚ä½¿ç”¨å®ƒçš„ç›®çš„æœ‰ä¸¤ä¸ªï¼šç¬¬ä¸€ä¸ªã€PPWebFetchLFUCacheç±»çš„æ“ä½œæ˜¯å¯ä»¥åœ¨å¤šçº¿ç¨‹å¼‚æ­¥çŽ¯å¢ƒä¸‹æ“ä½œçš„ï¼Œæ‰€ä»¥æˆ‘å¿…é¡»è¦ä¿è¯cacheMapçš„æ•°æ®åŒæ­¥ï¼›ç¬¬äºŒä¸ªã€è™½ç„¶åŸºäºŽCçš„æ“ä½œæˆ‘éƒ½æ˜¯æ”¾åœ¨ä¸€ä¸ªä¸²è¡Œçš„é˜Ÿåˆ—ä¸­è¿›è¡Œï¼š 123456async_inbackground(^&#123; BOOL result = [self insertCacheMap:data forKey:url]; if (complete) &#123; complete(result); &#125;&#125;); ä½†æ˜¯_lfuStackæˆå‘˜å˜é‡æ˜¯å¯ä»¥é€šè¿‡hookçš„æ–¹æ³•æ‹¿åˆ°ï¼Œå¹¶è®©å…¶åœ¨å¼‚æ­¥çŽ¯å¢ƒä¸‹åŽ»è¿›è¡Œä¿®æ”¹ï¼Œè¿™ä¸ªæˆ‘æ²¡æ³•åŽ»æŽ§åˆ¶ï¼Œä½†æ˜¯æˆ‘è¦åšåˆ°åœ¨LFUå†…åšåˆ°ä¸€ä¸ªåŒæ­¥æ“ä½œï¼Œæ‰€ä»¥åŸºäºŽè·ŸèŠ‚ç‚¹çš„æ“ä½œéƒ½æ˜¯åœ¨åŠ é”çŠ¶æ€ä¸‹å®Œæˆçš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯ä¸è¦å‡ºçŽ°äº’æ–¥é”çš„åµŒå¥—ä½¿ç”¨ï¼Œå¦‚æžœä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªé”å˜é‡çš„è¯ï¼Œé‚£è‚¯å®šä¼šé€ æˆæ­»é”çš„ã€‚ å®Œã€‚ã€‚ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ¥å” å—‘ä¸€ä¸‹çº¿ç¨‹ä¸­çš„ä¸€äº›äº‹å„¿]]></title>
      <url>%2F2017%2F11%2F16%2Ftalk_about_thread%2F</url>
      <content type="text"><![CDATA[ç”±äºŽå‰æ®µæ—¶é—´çš„å·¥ä½œä¸­ï¼Œåœ¨ä¸€ä¸ªå¹¶å‘ç¼–ç¨‹é¢˜ä¸­æ ½äº†è·Ÿå¤´,ä¹Ÿå› æ­¤å¢žåŠ äº†æˆ‘å¯¹è¿™ä¸€æ–¹é¢çš„ç†è§£ã€‚ä¸‹é¢æˆ‘ä¼šç»“åˆä¾‹å­çš„æ–¹å¼æ¥é˜è¿°ä¸€ä¸‹æˆ‘çš„ä¸€ç‚¹å„¿å°ç†è§£ã€‚ çº¿ç¨‹ å¯¹äºŽå¹¶å‘ç¼–ç¨‹å¯èƒ½é¦–å…ˆæƒ³åˆ°çš„ä¾¿æ˜¯å’Œå¤šçº¿ç¨‹æœ‰å…³ï¼Œè¿™åˆéœ€è¦æ¶‰åŠåˆ°çº¿ç¨‹çš„æ¦‚å¿µã€‚ç»´åŸºç™¾ç§‘ä¸Šå…³äºŽçº¿ç¨‹çš„è§£é‡Šï¼Œæˆ‘æå–ä¸€ä¸ªæˆ‘è®¤ä¸ºæ¯”è¾ƒå…³é”®çš„æ¦‚å¿µï¼š å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®žé™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æŽ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚ æ¯ä¸ªçº¿ç¨‹å­˜åœ¨è‡ªå·±çš„æ ˆå’Œå¯„å­˜å™¨é›†åˆï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹åŽ»ä¿è¯çº¿ç¨‹ç›¸å¯¹å®‰å…¨çš„æ—¶å€™åº”è¯¥è¦ä½¿ç”¨violateå˜é‡ï¼ˆé˜²æ­¢ç¼–è¯‘å™¨ç¼“å­˜äº†è¢«å¤šä¸ªçº¿ç¨‹å¯„å­˜å™¨å¹¶å‘ç”¨åˆ°çš„å˜é‡ï¼Œè®©ç¼–è¯‘å™¨ç›´æŽ¥åŽ»å˜é‡åœ°å€èŽ·å–ï¼‰ã€‚ ä¸Šé¢çš„é‡ç‚¹åœ¨äºŽâ€œçº¿ç¨‹æ˜¯åŒ…å«äºŽè¿›ç¨‹ä¸­ï¼Œå¹¶ä¸”ä¸€æ¡çº¿ç¨‹å®žé™…ä¸Šä¸€æ®µä»£ç çš„æ‰§è¡Œæµâ€ï¼ˆä»£ç åŒºæ˜¯è¢«è¿›ç¨‹å†…å¤šä¸ªçº¿ç¨‹å…±äº«çš„ï¼‰ã€‚è¿™é‡Œä¹Ÿå°±ä¸è¿‡å¤šæ·±å…¥åœ°åŽ»è§£é‡Šäº†ï¼Œè´´ä¸€ä¸ªæˆ‘ç¿»è¯‘çš„å®˜æ–¹çš„å¤šçº¿ç¨‹ç¼–ç¨‹æ–‡æ¡£ï¼Œå¹¶é…åˆæœ‰åˆ›å»ºçº¿ç¨‹ä¸åŒæ–¹å¼çš„ä»£ç ã€‚æˆ‘ä¹‹æ‰€ä»¥ä¸“é—¨æŠŠè¿™ä¸ªæå‡ºæ¥æ˜¯å› ä¸ºæˆ‘åœ¨è¿™ä¸ªçŸ¥è¯†åŸºç¡€ä¸Šé‡åˆ°è¿‡ä¸€ä¸ªé¢è¯•é¢˜â€”â€”â€œæˆ‘ä»¬ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼ä»ŽæœåŠ¡ç«¯èŽ·å–åˆ°äº†æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œç„¶åŽæˆ‘ä»¬å¦‚ä½•åŽ»æ›´æ–°å¯¹åº”è§†å›¾ï¼Ÿâ€ã€‚å¦‚æžœä¸åŽ»ç»†æƒ³çš„è¯ç›´æŽ¥æ‰”å‡ºä¸€æ®µä»£ç ï¼š12345678910 [self post:url aPara:nil completionBlock:^(id responseObject, NSError *error) &#123;#if defined(USE_GCD_UPDATE_UI) &amp;&amp; USE_GCD_UPDATE_UI == 1 dispatch_async(dispatch_get_main_queue(), ^&#123; /// æ›´æ–°UI &#125;);#else /// updateViewä¸­æ›´æ–°UI [self performSelectorOnMainThread:@selector(updateView:) withObject:responseObject waitUntilDone:NO];#endif &#125;]; ä¸ºä»€ä¹ˆåœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIæ˜¯ä¸å®‰å…¨çš„ ä»–ä¼šç»§ç»­è¿½é—®ä½ ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆå¿…é¡»è¦æŠŠæ›´æ–°UIçš„ä»»åŠ¡æ”¾åœ¨ä¸»çº¿ç¨‹æ¥åšï¼Ÿæ”¾åˆ°å­çº¿ç¨‹ä¸å¯ä»¥å—ï¼Ÿå¯¹äºŽè¿™ä¸ªé—®é¢˜æˆ‘åªèƒ½ç”¨æˆ‘æµ…æ˜¾åœ°è®¤è¯†æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿç›¸å…³çš„ä¸œè¥¿æˆ‘å‡ ä¹Žå¿˜çš„å·®ä¸å¤šäº†ã€‚è¿™é‡Œå…ˆæŠ›å‡ºä¸€ä¸ªæ¦‚å¿µâ€”â€”åŸºäºŽUIKitçš„æŽ§ä»¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè‹¹æžœè¦æŠŠUIKitè®¾è®¡ä¸ºçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ æœ€ç›´è§‚çš„æ¥è¯´ï¼Œåœ¨ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·çš„å‰æä¸‹ï¼Œä½¿ç”¨åŒæ­¥èƒ½å¤Ÿç¡®ä¿ä»£ç çš„æ­£ç¡®æ‰§è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨åŒæ­¥å·¥å…·éƒ½ä¼šé€ æˆå»¶è¿Ÿã€‚é”å’ŒåŽŸå­æ“ä½œé€šå¸¸ä¼šæ¶‰åŠåˆ°ä½¿ç”¨å†…å­˜å±éšœå’Œå†…æ ¸çº§çš„åŒæ­¥æ¥ç¡®ä¿ä»£ç æ­£ç¡®æ‰§è¡Œã€‚å½“å‡ºçŽ°é”ç«žäº‰çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å¯èƒ½ä¼šè¢«é˜»å¡žä»Žè€Œå¯¼è‡´ä½“éªŒä¸Šçš„å»¶è¿Ÿå¡é¡¿ã€‚æ‰€ä»¥æˆ‘çŒœæµ‹æœ‰åŸºäºŽè¿™ä¸ªåŽŸå› å¯¼è‡´äº†è‹¹æžœå°†UIKitè®¾è®¡æˆäº†çº¿ç¨‹ä¸å®‰å…¨ã€‚è¿™å°±å›žç­”äº†ä¸Šé¢æå‡ºçš„â€œæˆ‘ä»¬ä¸ºä»€ä¹ˆå¿…é¡»è¦æŠŠæ›´æ–°UIçš„ä»»åŠ¡æ”¾åœ¨ä¸»çº¿ç¨‹æ¥åšï¼Ÿâ€ ä¸‹é¢æˆ‘é€šè¿‡ç”»å›¾çš„æ–¹å¼æ¥è¡¨è¾¾ä¸€ä¸‹åœ¨å¹¶è¡ŒçŠ¶æ€ä¸‹UIKitä¸ä½¿ç”¨åŒæ­¥å·¥å…·çš„æƒ…å½¢ï¼šå°±å¦‚ä¸Šå›¾æ‰€ç¤ºåœ¨ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­åŒæ—¶åŽ»ä¿®æ”¹åŒä¸€å†…å­˜ç©ºé—´ä¸­çš„å€¼ï¼Œå¦‚æžœä¸æ·»åŠ ä¸€ä¸ªåŒæ­¥æ“ä½œçš„è¯ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ã€‚Objective-Cä¸­çš„å¯¹è±¡æ˜¯å­˜æ”¾åœ¨å †åŒºï¼Œè€Œå †åŒºå’Œå‰é¢æˆ‘æè¿‡çš„ä»£ç åŒºä¸€æ ·æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚çŽ°åœ¨æˆ‘ä»¬çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­åŽ»æ›´æ–°UIã€‚è€Œå¯¹äºŽå¦ä¸€ä¸ªé—®é¢˜ï¼šæ”¾åˆ°å­çº¿ç¨‹ä¸å¯ä»¥å—ï¼Ÿæˆ–è®¸åœ¨AsyncDisplayKitä¸­èƒ½å¤Ÿæ‰¾åˆ°å­çº¿ç¨‹å¤„ç†è§†å›¾çš„ç­”æ¡ˆã€‚ å­çº¿ç¨‹æ˜¯å¦‚ä½•å®žçŽ°åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI çŽ°åœ¨å›žåˆ°æœ€åˆçš„é—®é¢˜ä¸Šæ¥ï¼Œå­çº¿ç¨‹å’Œä¸»çº¿ç¨‹æ˜¯æ€Žæ ·åè°ƒå·¥ä½œæ¥æ›´æ–°è§†å›¾çš„å‘¢ï¼Ÿæ›´æ–°çš„ä»£ç æˆ‘åœ¨ä¸Šé¢å·²ç»æ”¾å‡ºæ¥äº†ï¼Œä½†æ˜¯é¢è¯•å®˜çš„ç›®çš„æ˜¯æƒ³è¦çŸ¥é“å…¶åº•å±‚å®žçŽ°ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¸­å‡ºçŽ°çš„ä¸€ä¸ªå›¾ç‰‡ï¼šå¦‚æžœè¦å®Œæ•´çš„è®²ä¸€ä¸‹æˆ‘çš„ç†è§£çš„è¯ï¼Œéœ€è¦ä»¥ä¸‹è¿™äº›å‡è®¾ã€‚æˆ‘ä»¬æŠŠå³è¾¹ç»¿è‰²çš„è¿™ä¸€éƒ¨åˆ†å½“åšæ˜¯å­çº¿ç¨‹ï¼Œè€Œå·¦è¾¹ç´«è‰²çš„éƒ¨åˆ†å½“åšæ˜¯ä¸»çº¿ç¨‹ï¼›å¹¶ä¸”æˆ‘ä»¬æœ‰è‡ªå®šä¹‰ä¸€ä¸ªè¾“å…¥æºï¼ˆå› ä¸ºæˆ‘æƒ³å®Œæ•´çš„æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å°é—­çš„è¾“å…¥æºï¼‰ï¼Œæˆ‘ä»¬è¦é€šè¿‡è¯¥è¾“å…¥æºæ¥ç»™ä¸»çº¿ç¨‹çš„Runloopå‘é€æ¶ˆæ¯ï¼ˆä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆè¦ç”¨è¾“å…¥æºï¼Ÿæˆ‘ç›´æŽ¥å‘æ¶ˆæ¯ä¸å¯ä»¥å—ï¼Ÿä¸å¥½æ„æ€ï¼ŒRunloopå°±äººè¾“å…¥æºæˆ–è€…å®šæ—¶å™¨æºï¼‰ã€‚ é¦–å…ˆæ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šçš„è¾“å…¥æºï¼Œè¿™ä¸ªè¾“å…¥æºè´Ÿè´£ä»Žå­çº¿ç¨‹ç»™ä¸»çº¿ç¨‹çš„Runloopå‘é€æ¶ˆæ¯ï¼š123456/// .h@interface RunloopSource : NSObjectvoid runloopsrc_schedule(void *info, CFRunLoopRef rl, CFRunLoopMode mode);void runloopsrc_perform(void *info);void runloopsrc_cancel(void *info, CFRunLoopRef rl, CFRunLoopMode mode);@end ä¸Šè¯‰å¤´æ–‡ä»¶ä¸­çš„ä¸‰ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯ï¼š scheduleè¡¨ç¤ºæ³¨å†ŒæˆåŠŸå¹¶æä¾›å¤–éƒ¨ç»™å­çº¿ç¨‹ä¼ é€’æ•°æ®ï¼›performæ˜¯å­çº¿ç¨‹é€šè¿‡è¾“å…¥æºæƒ³è¦ç»™ä¸»çº¿ç¨‹ä¼ è¾“çš„ä¸»è¦å‡ºå£ï¼›cancelæ˜¯åœ¨æˆ‘ä»¬å¼‚æ­¥å¤„ç†å®Œäº†ä¹‹åŽï¼Œè°ƒç”¨CFRunLoopSourceInvalidateå‡½æ•°å‘ŠçŸ¥ä¸»çº¿ç¨‹Runloopè¯¥è¾“å…¥æºå·²ç»å®Œæˆå…¶èŒè´£ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041///.m- (instancetype)init&#123; self = [super init]; if (self) &#123; CFRunLoopSourceContext ctx = &#123; .info = (__bridge void *)(self), .retain = NULL, .release = NULL, .copyDescription = NULL, .equal = NULL, .schedule = runloopsrc_schedule, .perform = runloopsrc_perform, .cancel = runloopsrc_cancel &#125;; &#125; return self;&#125;void runloopsrc_schedule(void *info, CFRunLoopRef rl, CFRunLoopMode mode)&#123; ...&#125;void runloopsrc_perform(void *info)&#123; RunloopSource *src = (__bridge RunloopSource *)info; [src sourceFire];/// æŽ¥å£ç”¨cï¼Œä½†æ˜¯å¤„ç†æ•°æ®ï¼Œçœ‹ä¹ æƒ¯ï¼Œä¹ æƒ¯ç”¨OC&#125;void runloopsrc_cancel(void *info, CFRunLoopRef rl, CFRunLoopMode mode)&#123; ...&#125;- (void)sourceFire&#123; if (self.sourceFire_handle == nil) &#123; return; &#125; @synchronized (command_data) &#123; /// å¤„ç†æ•°æ® /// å›žä¼ ç»™ä¸»çº¿ç¨‹æ•°æ® /// åœ¨è¾“å…¥æºä¸­ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå‡½æ•°ä¸­åŽ»ç»™ä¸»çº¿ç¨‹çš„Runloopå‘é€æ¶ˆæ¯ï¼Œè®©å…¶æ›´æ–°ç•Œé¢ /// - (void)performSelector:(SEL)aSelector onThread:waitUntilDone:modes: &#125; CFRunLoopSourceInvalidate(runloop_src);&#125; åˆ°è¿™é‡Œå‡è®¾æˆ‘ä»¬å·²ç»ä»Ž- (void)URLSession: dataTask:didReceiveData:;ï¼ˆNSURLSessionDataDelegateåè®®ï¼‰èŽ·å–åˆ°äº†æ•°æ®ï¼Œæ­¤æ—¶åœ¨runloopsrc_perform ä¸­è°ƒç”¨performSelectoræ–¹æ³•ç»™ä¸»çº¿ç¨‹Runloopå‘é€æ¶ˆæ¯ã€‚çŽ°åœ¨æˆ‘ä»¬æŠŠæ³¨æ„åŠ›æ”¾åœ¨ä¸Šå›¾å·¦è¾¹çš„ç´«è‰²éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡ºå®ƒä¸€ç›´å¤„äºŽä¸€ä¸ªå¾ªçŽ¯ä¸­ã€‚å¦‚æžœæ­¤æ—¶æ¶ˆæ¯é˜Ÿåˆ—ä¸­å­˜åœ¨æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¯¥Runloopä¼šå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¦‚æžœæ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆRunloopåº”è¯¥æ˜¯å¤„äºŽä¸€ä¸ªä¼‘çœ çŠ¶æ€ã€‚å½“ä»–æ”¶åˆ°äº†ç”±æˆ‘ä»¬ä»Žå­çº¿ç¨‹çš„è‡ªå®šä¹‰è¾“å…¥æºå‘æ¥çš„æ¶ˆæ¯æ—¶ï¼Œä»–ä¼šè¢«å”¤é†’æ¥å¤„ç†è¯¥æ¶ˆæ¯ã€‚æ­¤æ—¶åœ¨ä¸»çº¿ç¨‹ä¸­åŽ»æ‰§è¡Œæ›´æ–°UIçš„äº‹ä»¶ã€‚ å¯¹äºŽè¿™ä¸€å—å„¿æˆ‘å¹¶æ²¡æœ‰åè¶³çš„æŠŠæ¡ï¼Œå¦‚æžœæœ‰æ›´å¥½çš„ç†è§£éº»çƒ¦å‘ŠçŸ¥ä¸Žæˆ‘ï¼Œä¸‡åˆ†æ„Ÿè°¢ã€‚ æˆ‘æ‰€äº†è§£çš„çº¿ç¨‹å°å¸¸è¯†åˆ°è¿™å„¿äº†ä¸»è¦å°±è¯´ä¸€ç‚¹å„¿æˆ‘æ‰€äº†è§£çš„çº¿ç¨‹ï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬äº†çº¿ç¨‹ä¼˜å…ˆçº§å’Œè°ƒåº¦é—®é¢˜ï¼Œçº¿ç¨‹å’Œä»–å¯„å­˜å™¨ä¹‹é—´çš„ä¸€ç‚¹å„¿æ©æ€¨ï¼ å…³äºŽçº¿ç¨‹ä¼˜å…ˆçº§å’Œè°ƒåº¦åœ¨å¤šå¯¹ä¸€çš„çº¿ç¨‹æ¨¡åž‹ä¸­ï¼Œä¸€ä¸ªå†…æ ¸çº¿ç¨‹å¯¹åº”äº†å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹ï¼Œå…¶å®žè¿™æ—¶å€™çš„å¹¶å‘å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼Œå®ƒåº”è¯¥æ˜¯åŸºäºŽCPUè½®è½¬çš„æ–¹å¼æ¥è°ƒåº¦ä¸åŒç”¨æˆ·çº§çº¿ç¨‹ï¼Œè®©ä»–ä»¬æ¯ä¸ªéƒ½æ‰§è¡Œä¸€å°æ®µæ—¶é—´ï¼Œåšåˆ°ç±»ä¼¼å¹¶å‘çš„æ•ˆæžœã€‚æ‰€ä»¥åŽé¢çš„çº¿ç¨‹æ¨¡åž‹éƒ½æ˜¯åŸºäºŽå¤šå¯¹å¤šæ¨¡åž‹ï¼Œå®ƒæ—¢å¯ä»¥å®žçŽ°çœŸå®žçš„å¹¶å‘ï¼Œåˆå¯ä»¥å‡å°‘ä¸€å¯¹ä¸€æ¨¡åž‹ä¸­çº¿ç¨‹åˆ‡æ¢çš„æ¶ˆè€—ã€‚ æˆ‘ä»¬å¯ä»¥ç»™çº¿ç¨‹è®¾ç½®ä¸åŒçš„ä¼˜å…ˆçº§æ¥æ”¹å˜å®ƒä»¬çš„å…ˆåŽæ‰§è¡Œé¡ºåºï¼Œé™¤äº†æˆ‘ä»¬æŒ‡å®šçš„æ–¹å¼ï¼Œç³»ç»Ÿä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹åŽ»æ›´æ”¹çº¿ç¨‹ä¼˜å…ˆçº§ï¼š I/Oå¯†é›†åž‹çº¿ç¨‹ä¼šæ¯”CPUå¯†é›†åž‹çº¿ç¨‹æ›´å®¹æ˜“è¢«ç³»ç»Ÿæé«˜ä¼˜å…ˆçº§ã€‚å› ä¸ºI/Oå¯†é›†åž‹çº¿ç¨‹ä¼šç»å¸¸è¿›å…¥waitingçŠ¶æ€ï¼Œè€Œè¿›å…¥waitingçŠ¶æ€è¯´æ˜Žå®ƒçš„ä»»åŠ¡èŠ±è´¹æ—¶é—´çŸ­ã€‚è€ŒCPUå¯†é›†åž‹çº¿ç¨‹åˆ™æ˜¯è€—è´¹å®Œæ—¶é—´ç‰‡ä¹‹åŽè¿›å…¥readyçŠ¶æ€ã€‚ å¯¹äºŽI/Oå¯†é›†åž‹çº¿ç¨‹æ¥è¯´ï¼Œå¦‚æžœç»™å®ƒåˆ†é…äº†è¾ƒä½Žä¼˜å…ˆçº§ã€‚è€ŒCPUå¯†é›†åž‹çº¿ç¨‹åˆ†é…äº†è¾ƒé«˜çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆI/Oå¯†é›†åž‹çº¿ç¨‹å¤„äºŽâ€œé¥¿æ­»â€çŠ¶æ€ã€‚æ‰€ä»¥ç³»ç»Ÿä¼šå°†é•¿æ—¶é—´æ²¡æœ‰è¿è¡Œçº¿ç¨‹çš„ä¼˜å…ˆçº§æé«˜ã€‚ ç¼–è¯‘å™¨ä¼˜åŒ–æ‰€å¸¦æ¥çš„é—®é¢˜ç¼–è¯‘å™¨ä¸ºäº†èƒ½å¤Ÿè®©CPUåœ¨èŽ·å–æ•°æ®æ›´å¿«é€Ÿï¼Œå®ƒä¼šæŠŠä¸€äº›éœ€è¦ç»å¸¸è®¿é—®çš„æ•°æ®è¯»å–åˆ°å¯„å­˜å™¨ä¸­ã€‚ä¸ºä»€ä¹ˆå¯„å­˜å™¨æ¯”å†…å­˜å¿«ï¼Ÿï¼Œæˆ‘çš„ç†è§£æ˜¯ç”±äºŽå¯„å­˜å™¨å­˜åœ¨äºŽCPUå†…ï¼Œå†…å­˜å’ŒCPUä¹‹é—´ç›¸éš”äº†ä¸€ä¸ªåŒ—æ¡¥èŠ¯ç‰‡ï¼Œè€Œå®ƒä»¬æ˜¯é€šè¿‡PCIæ€»çº¿æ¥è¿žæŽ¥çš„ï¼Œå°±è·ç¦»ä¸Šæ¥è¯´è¿™å¯èƒ½æ˜¯ä¸€ä¸ªåŽŸå› ï¼ˆæˆ‘çžŽæ‰¯æ·¡ï¼‰ã€‚å› ä¸ºè¿™ä¸ªä¼˜åŒ–ä¼šäº§ç”Ÿä¸€äº›å°é—®é¢˜ï¼Œçœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼š123456789101112NSThread thread1 = [NSThread detachNewThreadWithBlock:^&#123; NSLock *lock = [[NSLock alloc] init]; [lock lock]; i++; [lock unlock];&#125;];NSThread thread2 = [NSThread detachNewThreadWithBlock:^&#123; NSLock *lock = [[NSLock alloc] init]; [lock lock]; i++; [lock unlock];&#125;]; è¿™æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿæˆ‘åªèƒ½è¯´ä¸ä¸€å®šï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¶ç„¶äº‹ä»¶ã€‚ä¸‹é¢æˆ‘æ¥è¯´ä¸€ä¸‹æˆ‘ç†è§£çš„è¿™ä¸ªå¶ç„¶äº‹ä»¶æ˜¯æ€Žä¹ˆå‘ç”Ÿçš„ï¼Ÿ ã€thread1ã€‘è¯»å–içš„å€¼åˆ°çº¿ç¨‹1çš„å¯„å­˜å™¨é›†åˆR1ï¼ˆR1 = 0ï¼‰ï¼› ã€thread1ã€‘R1++ï¼ˆç”±äºŽä¹‹åŽå¯èƒ½è¿˜è¦è®¿é—®iï¼Œæ‰€ä»¥thread1æš‚æ—¶ä¸ä¼šæŠŠR1å†™å›žåˆ°iï¼‰ï¼› ã€thread2ã€‘è¯»å–içš„å€¼åˆ°çº¿ç¨‹2çš„å¯„å­˜å™¨é›†åˆR2ï¼ˆR2 = 0ï¼‰ï¼› ã€thread2ã€‘R2++ï¼ˆR1 = 1ï¼‰ï¼› ã€thread2ã€‘å°†R2å†™å›žiï¼› ã€thread1ã€‘è¿‡äº†å¾ˆä¹…ä¹‹åŽï¼Œå°†R1å†™å›žiï¼ˆi=1ï¼‰ï¼› å¾ˆæ˜Žæ˜¾è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æžœï¼Œè¿™å°±æ˜¯ç”±äºŽç¼–è¯‘å™¨çš„ä¼˜åŒ–æŠŠå€¼è¯»å–åˆ°äº†çº¿ç¨‹å“åº”çš„å¯„å­˜å™¨é›†åˆä¸­ï¼Œæ”¹å˜çš„æ ¹æœ¬ä¸æ˜¯åŒä¸€å—å„¿å†…å­˜ä¸Šçš„å€¼ã€‚æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨å‰é¢æåˆ°çš„violateå˜é‡ï¼Œä»¥æ­¤æ¥å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å°†è¯¥å˜é‡è¯»å–åˆ°å¯„å­˜å™¨ä¸­ï¼Œè€Œæ˜¯ç›´æŽ¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œã€‚ å¹¶å‘ä¸Žå¹¶è¡Œæ–‡ç« çš„æœ€åŽæˆ‘ä»¬å” å¨ä¸€ä¸‹å¹¶å‘è¿™ä¸ªè¯å„¿ï¼Œå…³äºŽå¹¶å‘å’Œå¹¶è¡ŒçŸ¥ä¹Žä¸Šæœ‰ä¸€ä¸ªå›žç­”è§£é‡Šçš„å¾ˆé€šä¿—æ˜“æ‡‚ã€‚æ‰€ä»¥é’ˆå¯¹Appleçš„å¹¶å‘ç¼–ç¨‹æŒ‡å—ï¼ŒæŒ‡çš„æ˜¯æœ‰èƒ½åŠ›åŒæ—¶åŽ»æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä½†å¹¶ä¸æ˜¯æŒ‡ä¸€å®šè¦åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚GCDå°±ä¸è¯´äº†ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯åœ¨ä½¿ç”¨å®ƒï¼ˆå› ä¸ºå®ƒåœ¨æŽ¥å£ä½¿ç”¨ä¸Šæ˜“ç”¨ï¼‰ã€‚é‡ç‚¹æ¥è¯´ä¸€ä¸‹NSOperationï¼Œå®ƒæ˜¯å³å¼ºå¤§åˆéš¾ç”¨ã€‚ åœ¨å¼€å§‹ä½¿ç”¨NSOperationä¹‹å‰ï¼Œæˆ‘ä»¬è‡ªå·±éœ€è¦æ¸…æ¥šâ€œæˆ‘ä»¬è¦å¹²ä»€ä¹ˆï¼ŸAppleæä¾›çš„NSOperationæ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿæˆ‘ä»¬è‡ªå®šä¹‰NSOperationå­ç±»æ˜¯åŸºäºŽå¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œï¼Ÿç­‰ç­‰â€ã€‚è¿™é‡Œæåˆ°çš„å¹¶è¡Œå’Œä¸²è¡Œå°±ä¸è§£é‡Šäº†ï¼Œå†è§£é‡Šå°±æ˜¯ä¸€ç¯‡ç§‘æ™®æ–‡äº†ã€‚NSHipsterä¸Šæåˆ°äº†å…³äºŽNSOperationï¼š NSOperationè¡¨ç¤ºäº†ä¸€ä¸ªç‹¬ç«‹çš„è®¡ç®—å•å…ƒã€‚ä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç»™äº†å®ƒçš„å­ç±»ä¸€ä¸ªååˆ†æœ‰ç”¨è€Œä¸”çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥å»ºç«‹çŠ¶æ€ã€ä¼˜å…ˆçº§ã€ä¾èµ–æ€§å’Œå–æ¶ˆç­‰çš„æ¨¡åž‹ã€‚ æ‰€ä»¥NSOperationå’ŒNSOpertaionQueueä¸ä»…ä»…åªæ˜¯ç”¨äºŽç½‘ç»œçš„æƒ…å†µï¼Œå½“ç„¶ä¸Žä¹‹å¯¹åº”çš„GCDåŒæ ·å¯ä»¥ç”¨äºŽå…¶ä»–äº‹ç‰©ã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥æŠŠNSOperationç”¨äºŽä¸€ä¸ªåŠ è½½åŠ¨ç”»ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[iOSä¸­Nativeçš„æ–¹å¼é›†æˆVuforiaã€å…¶æºç è§£è¯»ä»¥åŠè‡ªå®šä¹‰æ¨¡åž‹]]></title>
      <url>%2F2017%2F09%2F13%2Fios_nativa_vuforia%2F</url>
      <content type="text"><![CDATA[éšç€å‰æœ‰Appleåœ¨iOS11ä¸­æä¾›äº†ARKitï¼ŒåŽæœ‰GoogleæŽ¨å‡ºçš„ARCoreï¼Œæ˜¾ç„¶æŽ€èµ·äº†ä¸€è‚¡ARçƒ­æ½®ï¼ˆéƒ½æ˜¯ä¸€å †åºŸè¯ï¼Œè¯´ç™½äº†å°±æ˜¯å…¬å¸è¦æ±‚åšï¼‰ã€‚ ç”±äºŽVuforiaå·²ç»å­˜åœ¨è¾ƒé•¿æ—¶é—´äº†ï¼Œç›¸å¯¹äºŽEasyARæˆ–è€…ç™¾åº¦ARæ›´ä¸ºæˆç†Ÿä¸€ç‚¹å„¿ï¼Œæ‰€ä»¥å®ƒæˆäº†ç¬¬ä¸€ä¸ªæŠ€æœ¯é€‰æ‹©ã€‚EasyARå’Œç™¾åº¦çš„ARâ€”â€”DuMix ARåŽé¢å†ä¾æ¬¡åŽ»å­¦ä¹ ã€‚å¥½å§ï¼Œå…ˆå¼€å§‹æ¥å­¦ä¹ Vuforiaå§ï¼è¯¥æ–‡ç« åŒæ­¥å‘å¸ƒåœ¨æˆ‘çš„åšå®¢. é›†æˆæ­¥éª¤ç”±äºŽè¿™äº›æ­¥éª¤ç›¸å¯¹æ¥è¯´æ¯”è¾ƒåŸºç¡€ï¼Œæˆ‘å°±ç›´æŽ¥ç½—åˆ—å‡ºæ¥ã€‚ 1ã€å¼€å‘è€…å®˜ç½‘https://developer.vuforia.comï¼› 2ã€ä¸‹è½½ios-sdkå’Œios-sampleï¼Œå¹¶æŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¦æ±‚å°†ios-sampleæ”¾å…¥åˆ°ios-sdkçš„sampleæ–‡ä»¶å¤¹ä¸‹ 3ã€åœ¨vuforiaçš„å¼€å‘è€…å®˜ç½‘ä¸Šçš„License Managerå’ŒTarget Managerï¼Œæ·»åŠ License-keyå’Œdatabase 4ã€å°†ä¸Šä¸€æ­¥æ·»åŠ çš„License-keyï¼Œæ”¾åœ¨ios-sampleä¸­çš„ä»£ç æ–‡ä»¶SampleApplicationSession.mmä¸­çš„æ–¹æ³•Vuforia::setInitParameters(mVuforiaInitFlags,&quot;&quot;);ä¸­ã€‚å…·ä½“æ­¥éª¤è§å®˜ç½‘ã€‚ Vuforia::setInitParameters(mVuforiaInitFlags,"AT16FIX/////AAAAGVieZ/kg1UkghTnYAz5zXWs8+y5JjeF/NJRcjgVDoCSvsrSt+lWzFMcIVBbQ2YSFRF+6J0GceHoaz8NctXib3cndJEacXmR+1FyO5FhalO7sC4hE9d1/x72qTNDhkPs4rF04JulMYT876Grsnmg9C61oyaDVwBfSpzNZ7gx3NADkkV5q4NQs4ghZwVCdMhj6LVt1YTJcwiuULtDTEgpFZZeW/nC8yiC53hpUFOVxhH++ILx1T65jpY8yDn6ct++3mgVeVotg/5tWXYb5FYqBtJiwU/LJJxhJYqUWyy4pd9dHUJBQojuAE8FoW1DmjokrpDWgjOMMp3am4GjNT04hCg+o0Z3SByYx6VIqfSR9fsXw"); 5ã€å°†ç¬¬3æ­¥ä¸­Target Manageråˆ›å»ºçš„databaseï¼Œä¼ å…¥ç›¸å…³çš„å›¾ç‰‡æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥ä¸ä¼ ï¼Œè¿™æ­¥å¯é€‰ï¼›æ€Žæ ·ä½¿ç”¨è®¾å¤‡æ•°æ®ã€‚æˆ‘ä»¬åœ¨å®˜æ–¹Developeråˆ›å»ºï¼Œä¸‹è½½å¯¹åº”çš„Databaseï¼Œåœ¨æ·»åŠ å›¾ç‰‡æ—¶ï¼Œå¯¹åº”çš„æ˜Ÿæ˜Ÿæ•°è¶Šé«˜è¡¨æ˜Žè¯†åˆ«åº¦è¶Šé«˜è§£åŽ‹å¹¶å°†å…¶å¼•å…¥åˆ°å·¥ç¨‹ä¸­ï¼šè¿™ä¸€æ­¥å¯ä»¥ä¸åšï¼Œå› ä¸ºè¿™åªæ˜¯åœ¨ç»™åŽé¢æ‰“åŸºç¡€è€Œå·²ï¼Œå¦‚æžœåªæ˜¯è¿è¡Œdemoçš„è¯æ˜¯ä¸éœ€è¦åšè¿™ä¸€æ­¥çš„ã€‚å¦‚æžœåšäº†è¿™ä¸€æ­¥ï¼Œåœ¨æ‰«æä½ å¯¹åº”çš„å›¾ç‰‡çš„æ—¶å€™æ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæžœçš„ï¼Œå…·ä½“çš„æ“ä½œåŽé¢ã€‚ 6ã€ç¼–è¯‘è¿è¡Œï¼Œç”±äºŽéœ€è¦ä½¿ç”¨åˆ°ä¼ æ„Ÿå™¨ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨çœŸæœºæ¥è¿è¡Œã€‚å…³äºŽçœŸæœºè¿è¡Œçš„ç›¸å…³äº‹é¡¹æŸ¥çœ‹apple developer æºç é˜…è¯»é¡ºåº æºç è¯´æ˜Žï¼šVoforia SDKç‰ˆæœ¬ï¼švuforia-sdk-ios-6-5-19iOS Samplesç‰ˆæœ¬ï¼švuforia-samples-core-ios-6-5-20 å¦‚æžœä¸æƒ³çœ‹æºç ç›¸å…³å¯ç›´æŽ¥è·³è¿‡è¿™éƒ¨åˆ†ï¼Œç›´æŽ¥è·Ÿç€â€œæ”¶å°¾â€åšè‡ªå®šä¹‰çš„trackerå’Œæ¨¡åž‹ï¼ˆæ›¿æ¢TeapotèŒ¶å£¶æ¨¡åž‹ä¸ºè‡ªå·±çš„ï¼‰ ä¸ºä½•è¦é˜…è¯»æºç ï¼Ÿå› ä¸ºåœ¨Voforiaçš„å®˜æ–¹æ–‡æ¡£ä¸­æˆ‘æ²¡æœ‰æ‰¾åˆ°æˆ‘è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡é˜…è¯»æºç ï¼Œæ¥æ‰¾åˆ°æ€Žæ ·æ‰èƒ½åŽ»ä¿®æ”¹è´´åœ¨ç›®æ ‡å›¾åƒä¸­è™šæ‹Ÿæ¨¡åž‹ã€‚ä»¥sampleä¸­ImageTargetsViewControllerä¸ºä¾‹æ¥è§£è¯»ï¼é¦–å…ˆæŸ¥çœ‹ImageTargetsViewController.hæ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆä¸çœ‹æˆå‘˜å˜é‡ã€‚å…ˆæ¥çœ‹å±žæ€§ å±žæ€§ å±žæ€§ç±»åž‹ åˆæ­¥ä½œç”¨ eaglView ImageTargetsEAGLView* åˆæ­¥è®¤å®šä¸ºä¸€ä¸ªå±•ç¤ºè§†å›¾ tapGestureRecognizer UITapGestureRecognizer* ä¸€ä¸ªç‚¹å‡»æ‰‹åŠ¿ vapp SampleApplicationSession* åˆæ­¥è®¤å®šä¸ºä¸€ä¸ªä¼šè¯å±‚ï¼ˆç±»ä¼¼äºŽISOç½‘ç»œä¸ƒå±‚æ¨¡åž‹ä¸­ï¼Œåœ¨TCPå¯ä»¥å½’äºŽåº”ç”¨å±‚ï¼Œä¹Ÿå°±æ˜¯è¯´æƒ³å·æ‡’å¯ä»¥ç›´æŽ¥å°†å…¶ä»£ç æ”¾å…¥æŽ§åˆ¶å™¨ä¸­ã€‚ä¸ªäººç†è§£ï¼‰ showingMenu BOOL ä¸€ä¸ªflag ä»Žä¸Šè¡¨ä¸­å‡ºçŽ°çš„å±žæ€§ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æžä¸€ä¸‹å±žæ€§eaglViewå’Œvappã€‚ SampleApplicationSessionç±»åœ¨ImageTargetsViewControlleræŽ§åˆ¶å™¨ç±»ä¸­ï¼Œå’Œä¸‹é¢ä¼šè®²åˆ°çš„ImageTargetsEAGLViewéƒ½æœ‰SampleApplicationSessionç±»åž‹çš„å±žæ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¿…è¦å…ˆæ¥çœ‹çœ‹è¯¥ç±»ã€‚åŒæ ·çš„å…ˆçœ‹å¤´æ–‡ä»¶ï¼Œå› ä¸ºå¤´æ–‡ä»¶èƒ½å¤Ÿè®©æˆ‘ä»¬å¯¹äºŽè¯¥ç±»æœ‰å¤§ä½“çš„è®¤è¯†ï¼Œè€Œä¸æ‹˜äºŽç±»å…·ä½“çš„å®žçŽ°ç»†èŠ‚ã€‚ ç²—ç•¥æ¥çœ‹ï¼Œæä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼›ä¸€ä¸ªåˆå§‹åŒ–ARçš„æ–¹æ³•ï¼›å››ä¸ªå¯¹ARçš„æ“ä½œæ–¹æ³•ï¼ˆå®ƒä»¬ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„é‡ç‚¹ï¼Œç­‰åˆ°éœ€è¦çš„æ—¶å€™å†æ¥ä»”ç»†é˜…è¯»ï¼‰ï¼›ä»¥åŠä¸€ä¸ªå¯¹Cameraçš„æ–¹æ³•ï¼š1234567- (id)initWithDelegate:(id&lt;SampleApplicationControl&gt;) delegate;- (void) initAR:(int) VuforiaInitFlags orientation:(UIInterfaceOrientation) ARViewOrientation;- (bool) startAR:(Vuforia::CameraDevice::CAMERA_DIRECTION) camera error:(NSError **)error;- (bool) pauseAR:(NSError **)error;- (bool) resumeAR:(NSError **)error;- (bool) stopAR:(NSError **)error;- (bool) stopCamera:(NSError **)error; ä¸Šè¿°çš„initARæ–¹æ³•æ˜¯é€šè¿‡å¼‚æ­¥å®žçŽ°çš„ï¼Œå½“å…¶ARåˆå§‹åŒ–å®Œæˆä¹‹åŽä¼šè°ƒç”¨æ–¹æ³•ä¸‹é¢ä¼šæåˆ°çš„ä»£ç†æ–¹æ³•onInitARDoneã€‚é¡ºè—¤æ‘¸ç“œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¯¥ä»£ç†ï¼Œé‚£ä¹ˆè¯¥ä»£ç†æ‰€éœ€è¦å¤„ç†çš„äº‹åŠ¡æœ‰å“ªäº›å‘¢ï¼Ÿè¿™é‡Œå…ˆå°†SampleApplicationControlçš„æ‰€æœ‰æ–¹æ³•å…ˆåˆ—å‡ºæ¥ï¼š123456789101112@required- (void) onInitARDone:(NSError *)error;- (bool) doInitTrackers;- (bool) doLoadTrackersData;- (bool) doStartTrackers;- (bool) doStopTrackers;- (bool) doUnloadTrackersData;- (bool) doDeinitTrackers;- (void)configureVideoBackgroundWithViewWidth:(float)viewWidth andHeight:(float)viewHeight;@optional- (void) onVuforiaUpdate: (Vuforia::State *) state; è¯¥ä»£ç†æ–¹æ³•ä¸­å¤§å¤šæ˜¯æ¶‰åŠåˆ°çš„æ˜¯trackerã€‚é€šè¿‡ä»Žåˆå§‹åŒ–æ–¹æ³•å¼€å§‹æŸ¥çœ‹æ–¹æ³•è°ƒç”¨ï¼Œå¾—å‡ºäº†ä¸€ä¸ªç¨‹åºæ‰§è¡Œæµç¨‹å›¾ï¼Œæˆ‘ä»¬ä¸»åŠ¨è°ƒç”¨initARæ–¹æ³•ï¼Œå…¶ç»“æžœä¼šç”±å›žè°ƒæ–¹æ³•onInitARDoneååº”ç»™å¼€å‘è€…ã€‚å¼€å‘è€…å¯ä»¥ç”¨é€šè¿‡è°ƒç”¨doInitTrackersæ¥æŽ§åˆ¶æ˜¯å¦éœ€è¦åŽ»åŠ è½½trackeræ•°æ®ï¼Œå¦‚æžœå¯ä»¥åŠ è½½æ•°æ®åˆ™é€šè¿‡è°ƒç”¨å›žè°ƒæ–¹æ³•doLoadTrackersDataæ¥èŽ·å–æ•°æ®ã€‚å…³äºŽè¯¥ç±»ä¸­å…¶ä»–å‡ ä¸ªæ–¹æ³•startAR , pauseAR, resumeAR, stopARç”±è°ƒç”¨äººå‘˜ä¸»åŠ¨è°ƒç”¨ï¼Œè°ƒç”¨è¿™äº›æ–¹æ³•ä¼šè§¦å‘å¯¹åº”çš„æ–¹æ³•å›žè°ƒã€‚çŽ°åœ¨æˆ‘ä»¬éœ€è¦æŠŠç›®å…‰è½¬å‘ImageTargetsEAGLViewç±»ï¼Œå¹¶åŽ»å…·ä½“çš„çœ‹ä¸€ä¸‹é‡Œé¢çš„ç›¸å…³ç»†èŠ‚ã€‚ SampleAppRendererç±»è¿™ä¸ªç±»ä¸»è¦æ˜¯åšæ¸²æŸ“ç›¸å…³çš„å·¥ä½œï¼Œå…¶æºç å¤§å¤šæ•°ä¸ºOpenGLã€‚æ‰€ä»¥å¯¹äºŽè¯¥ç±»æˆ‘åªåšå…·ä½“çš„ä½œç”¨åˆ†æžï¼Œè€Œä¸åŽ»è§£é‡Šå…·ä½“çš„æºä»£ç ï¼ˆå› ä¸ºæˆ‘ä¹Ÿä¸æ‡‚ï¼‰ï¼Œå¦‚æœ‰éœ€è¦çš„è¯ï¼Œè‡ªè¡Œæ·±ç©¶å§ï¼Œå“ˆå“ˆå“ˆðŸ˜„ã€‚è¿™é‡Œå…ˆå°†å„ä¸ªæ–¹æ³•çš„ä½œç”¨ç½—åˆ—å‡ºæ¥ï¼š æ–¹æ³•å æ–¹æ³•ä½œç”¨ initWithSampleAppRendererControl ç±»åˆå§‹åŒ–æ–¹æ³• initRendering æ¸²æŸ“ç›¸å…³çš„åˆå§‹åŒ– setNearPlane:farPlane: é…ç½®æŠ•å½±çŸ©é˜µæ•°æ® renderFrameVuforia ç”±Vuforiaè°ƒç”¨ï¼Œæ¸²æŸ“æ•°æ®å¸§åˆ°å±å¹• renderVideoBackground åŽå°æ¸²æŸ“è§†é¢‘ configureVideoBackgroundWithViewWidth:andHeight: è§†é¢‘ç›¸å…³çš„é…ç½® updateRenderingPrimitives æ›´æ–°æ¸²æŸ“æ•°æ® ä¸‹é¢å…·ä½“åˆ†æžï¼šè€è§„çŸ©ï¼ŒåŒæ ·å…ˆçœ‹å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬æ ¹æ®å¤´æ–‡ä»¶æš´éœ²å‡ºæ¥çš„æ–¹æ³•ä¸€å±‚ä¸€å±‚å¾€é‡Œå‰¥ã€‚è¯¥ç±»å­˜åœ¨ä¸€ä¸ªåè®®SampleAppRendererControlï¼Œå’Œä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•initWithSampleAppRendererControlã€‚ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªéµå®ˆSampleAppRendererControlåè®®çš„ç±»å®žä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥å†³å®šVR/ARçš„æ¨¡å¼ï¼Œä»¥åŠä¸‰ä¸ªç”¨äºŽå†³å®šæŠ•å½±çŸ©é˜µçš„å‚æ•°ã€‚é™¤äº†åœ¨åˆå§‹åŒ–æ–¹æ³•è®¾ç½®æŠ•å½±çŸ©é˜µçš„å‚æ•°ï¼Œè¯¥ç±»æä¾›äº†ä¸€ä¸ªpublicæ–¹æ³•setNearPlane:farPlane:ã€‚è¿›å…¥åˆ°.mmæ–‡ä»¶ä¸­æŸ¥çœ‹è¯¥åˆå§‹åŒ–æ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œåªæ˜¯å¯¹ç±»å†…éƒ¨ç§æœ‰å±žæ€§è¿›è¡Œç›¸å…³çš„èµ‹å€¼æ“ä½œä»¥åŠå¯¹ç¡¬ä»¶è®¾å¤‡è¿›è¡Œç›¸å…³çš„è®¾ç½®å§ã€‚ çŽ°åœ¨æ¥çœ‹çœ‹æ–¹æ³•initRenderingï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢ä¸»è¦æ˜¯åšäº†ä¸€äº›OpenGLESçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“é‡Œé¢åšäº†ä¸€äº›å’Œå…·ä½“ä¸šåŠ¡é€»è¾‘æ— å…³çš„ä¸œè¥¿å°±è¡Œäº†ã€‚ æŽ¥ä¸‹æ¥çœ‹renderFrameVuforiaçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæºä»£ç ä¸­è¯´çš„å¾ˆæ¸…æ¥šï¼šä½¿ç”¨OpenGLç»˜åˆ¶å½“å‰å¸§ï¼Œå½“éœ€è¦å°†å½“å‰å¸§æ¸²æŸ“åˆ°å±å¹•ä¸Šæ—¶ï¼ŒVuforiaä¼šå®šæœŸçš„åœ¨åŽå°çº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•ã€‚åŒæ ·å’Œä¸šåŠ¡é€»è¾‘æ— å…³ï¼Œæºç ä¸ç»†çœ‹ã€‚åŒæ ·æ–¹æ³•renderVideoBackgroundä¹Ÿæ˜¯ä½¿ç”¨OpenGLæ¥åšï¼Œæˆ‘ä»¬åªéœ€è¦ä»Žè¯¥æ–¹æ³•çš„åå­—å¾—çŸ¥å…¶ç”¨é€”ï¼ˆåŽå°æ¸²æŸ“è§†é¢‘ï¼‰å³å¯ã€‚ configureVideoBackgroundWithViewWidth:andHeight:æ–¹æ³•ä»Žåå­—å°±å¯ä»¥çŸ¥é“å…¶ä½œç”¨ã€‚updateRenderingPrimitivesæ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šå½“å±å¹•å°ºå¯¸å‘ç”Ÿæ”¹å˜æˆ–è€…æ˜¯è®¾å¤‡æœå‘æ”¹å˜ä¹‹åŽï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ¥æ›´æ–°æ¸²æŸ“åŽŸå§‹æ•°æ®ã€‚ æœ€åŽéœ€è¦ä»‹ç»ä¸€ä¸‹è¯¥ç±»å¾ˆé‡è¦çš„çš„ä¸€ä¸ªåè®®æ–¹æ³•ï¼šrenderFrameWithStateï¼Œè¯¥æ–¹æ³•è¢«ç”¨äºŽèŽ·å–æ¸²æŸ“ç›¸å…³çš„æ•°æ®ã€‚é€šè¿‡å¯¹.mmæ–‡ä»¶å¯çŸ¥ï¼Œæ¯æ¸²æŸ“ä¸€æ¬¡éƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•ä¸€æ¬¡ã€‚ ImageTargetsEAGLViewç±»è¯¥ç±»çš„å¤´æ–‡ä»¶æ‰€æš´éœ²å‡ºæ¥çš„åˆå§‹åŒ–æ–¹æ³•- (id)initWithFrame:(CGRect)frame appSession:(SampleApplicationSession *) appï¼Œæˆ‘ä»¬ä»¥è¯¥æ–¹æ³•å…¥æ‰‹æ¥åˆ†æžã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå½“å‰è§†å›¾çš„å¤§å°è®¾ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå‰é¢æˆ‘ä»¬è®²åˆ°è¿‡çš„ä¸€ä¸ªç±»å®žä¾‹ã€‚å¤´æ–‡ä»¶ä¸­ä½™ä¸‹çš„æ–¹æ³•è¿˜æœ‰ï¼š123456- (void)finishOpenGLESCommands;- (void)freeOpenGLESResources;- (void) setOffTargetTrackingMode:(BOOL) enabled;- (void) configureVideoBackgroundWithViewWidth:(float)viewWidth andHeight:(float)viewHeight;- (void) updateRenderingPrimitives; æ–¹æ³•finishOpenGLESCommands , freeOpenGLESResourcesåˆ†åˆ«å¯¹åº”ç€ç»“æŸOpenGLå’Œé‡Šæ”¾OpenGLçš„èµ„æºã€‚configureVideoBackgroundWithViewWidth:andHeight: , updateRenderingPrimitiveså’Œç±»SampleAppRendererå…¬å¼€çš„æ–¹æ³•åä¸€æ ·ï¼Œè¿™é‡Œæˆ‘çŒœæµ‹å®ƒä»¬ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚setOffTargetTrackingMode:æ–¹æ³•ä½œç”¨ç›®å‰è¿˜ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œéœ€è¦åŽ».mmæ–‡ä»¶ä¸­è¯¦æŸ¥ã€‚ çŽ°åœ¨è¿›å…¥å®žçŽ°æ–‡ä»¶ä¸­ï¼Œæºç ä¸­æåˆ°äº†å…³äºŽOpenGLçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚iOSä¸Šçš„OpenGL ESæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œåœ¨ç¨‹åºä¸­Vuforiaä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹ï¼ˆOpenGL ä¸Šä¸‹æ–‡ï¼‰å®‰å…¨ï¼š aã€åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºOpenGL ESä¸Šä¸‹æ–‡ã€‚ bã€Vuforiaç›¸æœºå¼€å§‹æ—¶ï¼Œå°†å…¶ä½äºŽæˆ‘ä»¬è‡ªå·±EAGLViewè§†å›¾ä¸Šï¼Œå¹¶å¼€å¯rendererçº¿ç¨‹ã€‚ cã€Vuforiaä¼šåœ¨rendererçº¿ç¨‹ä¸Šï¼Œå®šæœŸè°ƒç”¨æˆ‘ä»¬çš„renderFrameVuforiaï¼ˆSampleAppRendererç±»æåˆ°ï¼‰æ–¹æ³•ã€‚å½“ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥æ–¹æ³•çš„æ—¶å€™ï¼ŒdefaultFramebufferå¹¶ä¸å­˜åœ¨ï¼Œè°ƒç”¨createFramebufferæ–¹æ³•æ¥åˆ›å»ºå®ƒã€‚createFramebufferç”±ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œè€Œä¸Žæ­¤åŒæ—¶rendererçº¿ç¨‹ä¼šè¢«é˜»å¡žã€‚å› æ­¤ç¡®ä¿OpenGL ESä¸Šä¸‹æ–‡ä¸ä¼šè¢«å¹¶è¡Œä½¿ç”¨ åœ¨initWithFrame:appSession:çš„å®žçŽ°æ–¹æ³•ä¸­ä¼šè¿›è¡Œsessionï¼ŒOpenGLçš„contextå’ŒRendererçš„èµ‹å€¼ï¼Œåˆå§‹åŒ–å’Œç»‘å®šå·¥ä½œã€‚è€Œæ–¹æ³•configureVideoBackgroundWithViewWidth:andHeight: , updateRenderingPrimitivesåœ¨å…¶å®žçŽ°æ–¹æ³•ä¸­çš„ç¡®åªæ˜¯ç®€å•çš„è°ƒç”¨äº†ä¸€ä¸‹SampleAppRenderer ç±»çš„å®žä¾‹æ–¹æ³•ã€‚ çŽ°åœ¨ä¸»è¦æ¥çœ‹çœ‹æ–¹æ³•setOffTargetTrackingMode :ï¼Œå®ƒçš„å®žçŽ°å¾ˆç®€å•åªæ˜¯å¯¹å…¶ç§æœ‰æˆå‘˜å˜é‡NOã€‚ä½†æ˜¯å´åœ¨åè®®æ–¹æ³•renderFrameWithStateä¸­å¤§é‡çš„ä½¿ç”¨ã€‚è¯¥æ–¹æ³•å¤§éƒ¨åˆ†æ˜¯OpenGLç›¸å…³çš„å·¥ä½œï¼Œæˆ‘æ²¡æœ‰æ·±ç©¶ä¸‹åŽ»ï¼Œåªæ•´ç†å‡ºæ¥ä¸€ä¸ªå·¥ä½œæµç¨‹å›¾ï¼šç›®å‰æ¥çœ‹ImageTargetsEAGLViewç±»çš„ä¸»è¦ä½œç”¨åœ¨äºŽä¿è¯OpenGLåœ¨iOSä¸­è¾¾åˆ°çº¿ç¨‹å®‰å…¨ï¼Œåˆ›å»ºbufferå’Œå¯¹bufferçš„ç®¡ç†ï¼Œæä¾›äº†å¯¹OpenGLçš„æŽ§åˆ¶ï¼Œè€Œå®žé™…çš„æ¸²æŸ“åˆ™ç”±SampleAppRendereræ¥å®žçŽ°ã€‚ ImageTargetsViewControllerç±»çŽ°åœ¨å°†ç›®å…‰å›žåˆ°ImageTargetsViewControllerç±»ä¸Šé¢æ¥ã€‚ç”±äºŽæ˜¯ä¸€ä¸ªæŽ§åˆ¶å™¨ç±»ï¼Œæ‰€ä»¥æˆ‘ç›´æŽ¥ä»Ž.mmæ–‡ä»¶ä¸­ç€æ‰‹ã€‚æ ¹æ®ViewControllerçš„åŠ è½½é¡ºåºæ¥çœ‹å…·ä½“çš„é€»è¾‘ï¼Œé¦–å…ˆæŸ¥æ‰¾loadViewæ–¹æ³•ï¼Œå¦‚æžœæ²¡æœ‰åˆ™æŸ¥æ‰¾viewDidLoadã€‚æºç ä¸­ï¼ŒloadViewæ–¹æ³•ä¸»è¦åˆ›å»ºäº†vappï¼ŒeaglViewä»¥åŠå¯¹vappåˆå§‹åŒ–äº†ARç›¸å…³çš„äº‹åŠ¡ï¼ˆå…¶ä»–è§†å›¾å’Œæ‰‹åŠ¿ç­‰å…ˆå¿½ç•¥ï¼Œåªå…³å¿ƒå±žæ€§vapp,eaglViewç›¸å…³çš„é€»è¾‘ï¼‰ï¼Œå°†ViewControllerçš„Viewè®¾ç½®ä¸ºeaglViewã€‚ åœ¨loadViewä¸­å°†vappçš„ä»£ç†è®¾ç½®ä¸ºæŽ§åˆ¶å™¨è‡ªèº«ï¼Œæ­¤æ—¶é€šè¿‡ä¸Šé¢ä»‹ç» SampleApplicationSessionæ—¶å¯¹åº”çš„ç¨‹åºæ‰§è¡Œæµç¨‹ï¼Œå°†ç›®å…‰æ”¾åœ¨å¯¹åº”çš„éƒ¨åˆ†åè®®æ–¹æ³•ä¸Šé¢ã€‚123456@protocol SampleApplicationControl- (void) onInitARDone:(NSError *)error;- (bool) doInitTrackers;- (bool) doLoadTrackersData;- (bool) doStartTrackers;@end ä»Žå›¾-1å¯ä»¥çœ‹å‡ºæ˜¯ç”±doInitTrackersçš„è¿”å›žå€¼æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åŽ»åŠ è½½trackeræ•°æ®(doLoadTrachersData)ï¼Œæœ€åŽåœ¨onInitARDoneæ–¹æ³•æµç¨‹ç»“æŸã€‚é€šè¿‡è¿™ä¸ªå°±ç¡®å®šäº†æˆ‘ä»¬çš„æºç æŸ¥çœ‹é¡ºåºï¼š1/// doInitTrackers --&gt; doLoadTrackersData --&gt; onInitARDone é‚£ä¹ˆåœ¨ImageTargetsViewControllerç±»ä¸­ï¼Œå…¶æµç¨‹å›¾å¦‚ä¸‹ï¼šè‡ªæ­¤æˆ‘ä»¬çš„æºç é˜…è¯»å°±å‘Šä¸€æ®µè½ï¼Œæœ€åŽæˆ‘ä»¬å°†è¦åŽ»å®žçŽ°å¼€å§‹æåˆ°çš„ç›®çš„ï¼ æ”¶å°¾è¯»åˆ°è¿™é‡Œï¼Œè‡ªå®šä¹‰çš„æ•°æ®é›†çš„åˆ‡å…¥ç‚¹åœ¨æ–¹æ³•doLoadTrackersDataæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”è¦doInitTrackersæ–¹æ³•è¿”å›žYESã€‚å¦‚æžœæ²¡æœ‰æ‰§è¡Œâ€œå®‰è£…æ­¥éª¤â€ä¸­çš„ç¬¬5æ­¥çš„è¯ï¼ŒçŽ°åœ¨å¯ä»¥åŽ»åšäº†ï¼åšå®Œä¹‹åŽæ·»åŠ å¦‚ä¸‹ä»£ç åˆ°å·¥ç¨‹ä¸­ï¼š12345678///ImageTargetsViewController.mm -&gt; doLoadTrackersDatadataSetCustom = [self loadObjectTrackerDataSet:@&quot;WillDB_Device.xml&quot;];/// è¿™ä¸ªdatasetä¸ºä½ è‡ªå·±çš„åå­—if (dataSetCustom == NULL) &#123; return NO;&#125;if (! [self activateDataSet:dataSetCustom]) &#123; return NO;&#125; è¿è¡Œç¨‹åºï¼Œæ‰«æå¯¹åº”çš„å›¾ç‰‡å‘çŽ°æ˜¯èƒ½å¤ŸæˆåŠŸæ‰«æå¯¹åº”çš„å›¾ç‰‡çš„ã€‚ä½†æ˜¯ç³»ç»Ÿçš„å›¾ç‰‡èƒ½å‡ºæ¥ä¸€ä¸ªâ€œèŒ¶å£¶â€ï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„å›¾ç‰‡ä¸Šé¢ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘¢ï¼Ÿåœ¨è¿™é‡Œæˆ‘ä¸æƒ³åˆåŽ»ä½¿ç”¨è¿™ä¸ªçƒ¦äººçš„â€œèŒ¶å£¶â€OpenGLæ¨¡åž‹äº†ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ä¸€ä¸ªçš®å¡ä¸˜çš„åŽŸåž‹ï¼ˆåœ¨æ–‡æœ«æˆ‘ä¼šå°†æ”¹é€ è¿‡çš„demoä¼ åˆ°Githubå¯ä»¥åŽ»é‚£é‡Œä¸‹è½½è¿™ä¸ªåŽŸåž‹ï¼‰ã€‚ æ¨¡åž‹objåˆ°openglæ•°æ®çš„è½¬æ¢å°±ç›®å‰æˆ‘çŸ¥é“çš„æ¥è¯´ï¼Œåœ¨Xcodeä¸­æ— æ³•ä½¿ç”¨.objçš„æ¨¡åž‹æ•°æ®çš„ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªå·¥å…·obj2openglï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•è§è¿™é‡Œï¼Œæˆ‘è¿˜æ˜¯å¤§ä½“æ¥è¯´ä¸€ä¸‹ä½¿ç”¨æ­¥éª¤ï¼šå°†ä¸‹è½½å¥½çš„æ–‡ä»¶æ”¾åˆ°ç‰¹å®šçš„æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åŽæŠŠå¯¹åº”çš„objæ–‡ä»¶å’Œå®ƒæ”¾åœ¨ä¸€èµ·ï¼Œä½¿ç”¨ç»ˆç«¯è¿›å…¥obj2opengl.plæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä¹‹åŽï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š1./obj2opengl.pl yourobjfilename æˆåŠŸåŽï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œè¿™å°±æ˜¯é€šè¿‡objæ–‡ä»¶ç”Ÿæˆçš„çº¹ç†åæ ‡ä»£ç ï¼Œåœ¨è¯¥å¤´æ–‡ä»¶ä¸­æœ‰3ä¸ªæ•°ç»„ï¼Œè¿™ä¸‰ä¸ªæ•°ç»„åˆ†åˆ«å¯¹åº”ç€xxxVerts [], xxxNormals [], xxxTexCoords []ï¼Œå’Œä¸€ä¸ªxxxxNumVertsï¼ˆxxxä¸ºä½ çš„objæ–‡ä»¶åå­—ï¼‰ï¼Œå…·ä½“ä½¿ç”¨è¯´æ˜Žã€‚ æ¨¡åž‹æ›¿æ¢é€šè¿‡å‰é¢çš„æºç é˜…è¯»ï¼Œæˆ‘ä»¬çŸ¥é“ImageTargetsViewControllerç±»æ˜¯ç”¨æ¥åŠ è½½trackeræ•°æ®çš„ï¼ŒSampleAppRendererç±»æ˜¯åšæ¸²æŸ“ç›¸å…³çš„æ•°æ®ï¼ŒSampleApplicationSessionç±»æ˜¯ä½¿ç”¨trackeræ•°æ®å¹¶æŽ§åˆ¶ARï¼Œæœ€åŽåªå‰©ä¸‹ä¸€ä¸ªImageTargetsEAGLViewç±»ã€‚åœ¨è¯¥ç±»ä¸­ä¼šåšå¦‚ä¸‹æ“ä½œï¼š 1ã€åœ¨textureFilenamesæ•°ç»„ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„çº¹ç†ã€‚è¿™ä¸ªè‡ªå·±é€‰æ‹©ä¸€ä¸ªçº¹ç†å›¾ç‰‡ï¼Œæˆ‘æ˜¯éšä¾¿é€‰çš„ï¼Œæ‰€ä»¥çœ‹èµ·æ¥ä¼šå¾ˆä¸‘ã€‚ 2ã€åœ¨ImageTargetsEAGLViewç±»çš„å¤´æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªç§æœ‰æˆå‘˜å˜é‡pikachuModelã€‚ç”¨å®ƒæ¥ä»£æ›¿ä¾‹å­ä¸­çš„buildingModelã€‚å¹¶åœ¨SampleApplication3DModel.hæ–‡ä»¶ä¸­æ·»åŠ æ–¹æ³•pikachu_ReWriteï¼Œå¹¶åœ¨SampleApplication3DModel.mæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 12345678- (void)pikachu_ReWrite&#123;#if kUse3DModel == 1 _numVertices = XY_PikachuMNumVerts; _vertices = XY_PikachuMVerts; _normals = XY_PikachuMNormals; _texCoords = XY_PikachuMTexCoords;#endif&#125; 3ã€åœ¨ImageTargetsEAGLView.mmçš„æ–¹æ³•loadBuildingsModelä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 12pikachuModel = [[SampleApplication3DModel alloc] init];[pikachuModel pikachu_ReWrite]; 4ã€å°†ImageTargetsEAGLView.mmæ–‡ä»¶ä¸­æ‰€æœ‰çš„buildingModelæ›¿æ¢ä¸ºpikachuModelï¼Œæœ€åŽè°ƒèŠ‚ä¸€ä¸‹å˜é‡kObjectScaleOffTargetTrackingçš„å€¼ï¼Œè¿™ä¸ªå€¼è°ƒèŠ‚ç”±è‡ªå·±å†³å®šã€‚ ä¸Šè¿°çš„ä¿®æ”¹çµæ„Ÿå¤§å¤šæ˜¯æ¥è‡ªå¤´æ–‡ä»¶Teapot.hï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨obj2openglæ—¶ç”Ÿæˆçš„æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰Teapot.hä¸­teapotIndiceså¯¹åº”çš„æ•°ç»„ã€‚ç›¸åå¤šäº†ä¸€ä¸ªæ— ç¬¦å·çš„æ•´å½¢å˜é‡xxxNumVertsï¼Œæ‰€ä»¥é™¤äº†ä¸Šè¯‰çš„æ–¹æ³•ä»¥å¤–è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œå…·ä½“çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š123456/// ImageTargetsEAGLView.mm -&gt; renderFrameWithStateæ–¹æ³•ä¸­glVertexPointer(3, GL_FLOAT, 0, XY_PikachuMVerts);glNormalPointer(GL_FLOAT, 0, XY_PikachuMNormals);glTexCoordPointer(2, GL_FLOAT, 0, XY_PikachuMTexCoords);glDrawArrays(GL_TRIANGLES, 0, XY_PikachuMNumVerts); åœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶å…¶ï¼ˆç”¨obj2openglç”Ÿæˆçš„å¤´æ–‡ä»¶çš„æ•°ç»„ä¸­çš„ï¼‰æ•°å€¼æ¯”ä¾‹æ˜¯éœ€è¦ä¿®æ”¹çš„ï¼Œè€Œä¸”è¿˜éœ€è¦å¯¹æ¨¡åž‹è¿›è¡Œç¿»è½¬ã€‚è¿™ä¸ªæ–¹æ³•å…·ä½“è§How do I replace the Teapotå’ŒReplace the teapot modelã€‚åœ¨ä¿®æ”¹æºç æ—¶ä¸»è¦å°±æ˜¯åœ¨ä¿®æ”¹æ–¹æ³•renderFrameWithStateï¼Œå®ƒåœ¨ä»‹ç»ImageTargetsEAGLViewç±»æ—¶åœ¨æ–‡ä»¶çš„æœ€å¼€å¤´å°±æœ‰æåˆ°ï¼Œå®ƒæ˜¯åœ¨æ¯æ•æ‰åˆ°ä¸€æ¬¡trackerä¹‹åŽå°±ä¼šè¿è¡Œä¸€æ¬¡ã€‚åˆ°è¿™é‡Œä¸€ä¸ªå¾ˆåŸºæœ¬çš„Vuforiaé›†æˆï¼Œæºç çš„è§£è¯»ä»¥åŠè‡ªå®šä¹‰trackerå’Œæ¨¡åž‹å°±ç®—å®Œæˆäº†ï¼Œæœ€åŽé™„ä¸ŠDemoåœ°å€ã€‚ ç›¸å…³é“¾æŽ¥ obj2opengl obj2opengl Github OpenGL Transformation How do I replace the Teapot]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[OCä¸ŽCçš„äº¤äº’åŠå…¶å†…å­˜ç®¡ç†]]></title>
      <url>%2F2017%2F08%2F01%2Foc_bridge_c_memory%2F</url>
      <content type="text"><![CDATA[é¦–å…ˆæˆ‘ä»¬ä»Žæœ€åŸºæœ¬çš„Cä¸­ä¸‰ç§é“¾æŽ¥å±žæ€§ï¼Œåˆ†åˆ«æ˜¯ï¼šå¤–éƒ¨(external)ã€å†…éƒ¨(internal)ã€æ— (none)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é”®å­—externã€staticæ¥ä¿®æ”¹å˜é‡çš„é“¾æŽ¥å±žæ€§ã€‚ externå…³é”®å°†ä¸€ä¸ªå˜é‡å£°æ˜Žä¸ºå¤–éƒ¨çš„é“¾æŽ¥å±žæ€§ä¹‹åŽï¼Œä¾¿å¯ä»¥åŽ»è®¿é—®å…¶ä»–æ–‡ä»¶ä¸­åŒåè¯¥å˜é‡ã€‚staticå…³é”®å­—åœ¨ç”¨äºŽä»£ç å—å¤–éƒ¨çš„å˜é‡æ—¶æ˜¯å°†å…¶è®¾ç½®ä¸ºå†…éƒ¨é“¾æŽ¥å±žæ€§ï¼Œå¦‚æžœæ˜¯åœ¨ä»£ç å—å†…éƒ¨åˆ™å°†è¯¥å˜é‡å£°æ˜Žä¸ºé™æ€å˜é‡ã€‚ ç„¶åŽå†æ¥çœ‹çœ‹Cä¸­å˜é‡çš„å­˜å‚¨ç±»åž‹ã€‚å­˜å‚¨ç±»åž‹å†³å®šäº†å˜é‡çš„åˆ›å»ºã€é”€æ¯æ—¶æœºã€‚å­˜å‚¨å˜é‡çš„ä½ç½®ä¸€å…±ä¸‰ä¸ªåœ°æ–¹ï¼šæ™®é€šå†…å­˜ã€è¿è¡Œæ—¶å †æ ˆã€ç¡¬ä»¶å¯„å­˜å™¨ã€‚ç»“åˆCä¸­çš„ä¸‰ç§é“¾æŽ¥å±žæ€§ï¼Œå…·ä½“å¯ä»¥åˆ†ä¸ºï¼š æ ˆåŒºï¼šä»£ç å—ä¸­çš„å˜é‡åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ºè‡ªåŠ¨å˜é‡ï¼ˆç”±é«˜åœ°å€å‘ä½Žåœ°å€ç”Ÿé•¿ï¼‰ å †åŒºï¼šç”±mallocã€reallocã€callocç­‰å‡½æ•°åŠ¨æ€ç”Ÿæˆçš„å˜é‡ã€‚è¿™äº›å˜é‡æˆ‘ä»¬åªèƒ½è®¿é—®å…¶åœ°å€ï¼Œè€Œä¸”å½“æˆ‘ä»¬ä¸å†ä½¿ç”¨ä¹‹åŽéœ€è¦æ”¶åˆ°åŽ»freeæŽ‰ï¼ˆç”±ä½Žåœ°å€å‘é«˜åœ°å€ç”Ÿé•¿ï¼‰ã€‚ å…¨å±€åŒºï¼é™æ€åŒºï¼šä»£ç å—ä¹‹å¤–å£°æ˜Žçš„å˜é‡æ€»æ˜¯å­˜å‚¨äºŽé™æ€å†…å­˜ä¸­ï¼ˆé»˜è®¤çš„é“¾æŽ¥å±žæ€§ä¸ºexternalï¼‰ã€‚æœªåˆå§‹åŒ–çš„å˜é‡æ”¾åœ¨ä¸€èµ·ï¼Œå·²ç»åˆå§‹åŒ–çš„ç´§æŒ¨åœ°æ”¾ç€ã€‚ç”±äºŽå‡½æ•°å®žå‚æ€»æ˜¯åœ¨å †æ ˆä¸­è¿›è¡Œä¼ é€’ï¼Œæ‰€ä»¥å‡½æ•°çš„å½¢å‚ä¸èƒ½è®¾ç½®ä¸ºstaticã€‚ å¸¸é‡åŒºï¼šå¸¸é‡å­—ç¬¦ä¸² ä»£ç åŒº åœ¨ä»£ç å—å†…éƒ¨å£°æ˜Žçš„å˜é‡çš„ç¼ºçœå­˜å‚¨ç±»åž‹æ˜¯è‡ªåŠ¨çš„ï¼Œå³å®ƒå­˜å‚¨äºŽå †æ ˆä¸­ï¼Œç§°ä¸ºè‡ªåŠ¨å˜é‡ã€‚å¦‚æžœä»£ç å—è¢«å¤šæ¬¡æ‰§è¡Œï¼Œé‚£ä¹ˆè‡ªåŠ¨å˜é‡å°†ä¼šé‡å¤åˆ›å»ºï¼Œæ¯ä¸€æ¬¡åˆ›å»ºæ—¶ï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­çš„ä½ç½®å¯èƒ½ä¼šä¸åŒã€‚ è‡³äºŽä¸Šé¢æåˆ°çš„å¯„å­˜å™¨ä¸­çš„å˜é‡ï¼Œå› ä¸ºCPUå¯¹äºŽå¯„å­˜å™¨çš„è¯»å–é€Ÿåº¦éžå¸¸å¿«ï¼Œé€šå¸¸ç¼–è¯‘å™¨ä¼šå°†ä½¿ç”¨é¢‘çŽ‡å¾ˆé«˜çš„å˜é‡å°†å…¶ç§»åˆ°å¯„å­˜å™¨ä¸­ã€‚å¦‚æžœå¯„å­˜å™¨å˜é‡åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹æ—¶å‡ºçŽ°äº†é—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ˜¾å¼å°†è¯¥å˜é‡å£°æ˜Žä¸ºvolatileï¼Œè®©ç¼–è¯‘å™¨ä¸å¯¹è¯¥å˜é‡è¿›è¡Œä¼˜åŒ–ã€‚ 12345678910111213141516171819/** å…¨å±€é™æ€åŒº */int a = 10; /// externalextern int b;/// externalstatic int c;/// internalint d(int e)&#123;/// å‡½æ•°d é»˜è®¤ä¸ºexternal int f = 15;/// auto æ ˆåŒº static int g = 20;/// é™æ€å˜é‡ é™æ€åŒº return 0;&#125;static int h(int i)&#123;/// å‡½æ•°h ä¿®æ”¹ä¸ºstaticï¼Œinternal register int j;/// å¯„å­˜å™¨ç±»åž‹ï¼Œä½†æ˜¯ä¸ä¸€å®šèµ·ä½œç”¨ int *k = malloc(sizeof(int));/// å †åŒº free(k); const int m = 25;/// å¸¸é‡åŒº return 1;&#125; Cä¸­å„ä¸ªç±»åž‹å˜é‡çš„å†…å­˜ç®¡ç†Cè¯­è¨€ä¸­çš„å†…å­˜ç®¡ç†ä¸Žé“¾æŽ¥å±žæ€§å’Œæ‰€åœ¨å†…å­˜åŒºåŸŸéƒ½æœ‰ç›´æŽ¥å…³ç³»ã€‚æ ˆåŒºçš„è‡ªåŠ¨å˜é‡ä¼šåœ¨å…¶ä½œç”¨åŸŸä¹‹åŽè‡ªåŠ¨è¿›è¡Œé”€æ¯ï¼›å †åŒºçš„ä¸­ç”±ç”¨æˆ·åŠ¨æ€çš„åˆ›å»ºçš„å†…å­˜ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨freeå‡½æ•°æ¥é‡Šæ”¾ï¼ˆå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼‰ï¼› å…¨å±€åŒºï¼é™æ€åŒºä¸­çš„å˜é‡ç”±ç³»ç»Ÿåˆ›å»ºå’Œé”€æ¯ï¼Œå®ƒä»¬åœ¨ç¨‹åºå¼€å§‹è¿è¡Œä¹‹å‰å°±åˆ›å»ºå¥½ï¼Œé™æ€åŒºçš„å˜é‡åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸èƒ½åŽ»ä¿®æ”¹ï¼› å¸¸é‡åŒºç¨‹åºç»“æŸåŽç”±ç³»ç»Ÿé‡Šæ”¾ã€‚ å…³äºŽå †çš„ä¸€ç‚¹å„¿è¯´æ˜Žï¼šå¦‚æžœæˆ‘ä»¬åœ¨ä½¿ç”¨mallocå’Œfreeæ—¶æ˜¯æ— åºçš„è¯ï¼Œæœ€ç»ˆä¼šäº§ç”Ÿå †ç¢Žç‰‡ã€‚è€Œä¸”è¢«åˆ†é…çš„å†…å­˜æ˜¯ç»è¿‡å¯¹é½çš„ï¼Œä¸€èˆ¬ä¸º2çš„ä¹˜æ–¹ã€‚ å †çš„æœ«ç«¯ç”±ä¸€ä¸ªç§°ä¸ºbreakçš„æŒ‡é’ˆæ¥æ ‡è¯†ï¼Œå½“å †ç®¡ç†å™¨éœ€è¦æ›´å¤šå†…å­˜æ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨brkå’Œsbrkæ¥ç§»åŠ¨breakæŒ‡é’ˆã€‚ OCä¸ŽCçš„äº¤äº’(__bridge) å½“ocåœ¨å’Œcç›¸å…³çš„å‡½æ•°ï¼ˆCoreFoundataionã€Runtimeï¼‰è¿›è¡Œäº¤äº’æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†OCçš„ç±»åž‹ä¼ é€’åˆ°Cä¸­ï¼Œä¹Ÿéœ€è¦å°†Cä¸­çš„æ•°æ®è¿”å›žç»™OCä½¿ç”¨ã€‚è¿™å…¶ä¸­å°±éœ€è¦ä½¿ç”¨å®ƒä»¬ç±»åž‹ä¹‹é—´çš„è½¬æ¢ã€‚åœ¨idç±»åž‹æˆ–è€…å¯¹è±¡å˜é‡èµ‹å€¼ç»™void *æˆ–è€…é€†å‘èµ‹å€¼æ—¶éƒ½éœ€è¦è¿›è¡Œç‰¹å®šçš„è½¬æ¢ï¼Œå•çº¯çš„èµ‹å€¼æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ __bridge ã€‚ 123NSObject *obj = [[NSObject alloc] init];void *p_obj = (__bridge void *)(obj);NSObject * r_obj = (__bridge NSObject *)(p_obj); ç›¸å¯¹äºŽ__bridgeï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨``bridge_retainedä¿®é¥°ç¬¦ï¼Œå®ƒå³å¯ä»¥è¿›è¡Œè½¬æ¢ï¼Œä¹Ÿèƒ½æŒæœ‰è¢«è½¬æ¢çš„å¯¹è±¡__ï¼ˆä¸Šä¾‹ä¸­çš„obj ``ï¼‰ï¼Œå› æ­¤è¯¥å¯¹è±¡ä¸ä¼šè¢«åºŸå¼ƒã€‚å…¶è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š 1__bridge_retained &lt;#CF type#&gt;)&lt;#expression#&gt; bridgeä¸­è¿˜æœ‰ä¸ª``bridge_transfer ï¼Œå®ƒçš„ä½œç”¨å’Œ__bridge_retainedç›¸åï¼Œè¢«è½¬æ¢çš„å˜é‡ï¼ˆä¸Šä¾‹ä¸­çš„p_obj ï¼‰æ‰€æŒæœ‰çš„å¯¹è±¡ï¼ˆä¸Šä¾‹ä¸­çš„obj ï¼‰ä¼šåœ¨r_obj ``è¢«èµ‹å€¼ä¹‹åŽé‡Šæ”¾æŽ‰ï¼Œå…¶è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š 1__bridge_transfer &lt;#Objective-C type#&gt;)&lt;#expression#&gt; æŠŠä¸Šè¯‰ä¾‹å­è¿›è¡Œä¿®æ”¹ï¼š 123NSObject *obj = [[NSObject alloc] init];void *p_obj = (__bridge_retained void *)(obj);NSObject * r_obj = (__bridge_transfer NSObject *)(p_obj); å½“æˆ‘ä»¬åœ¨Cè¯­è¨€çš„ç»“æž„ä¸­ï¼Œéœ€è¦ä½¿ç”¨OCçš„ç±»åž‹ä½œä¸ºç»“æž„æˆå‘˜ï¼Œé™¤äº†å°†OCçš„ç±»åž‹è½¬æ¢ä¸ºvoid *ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨__unsafe_unretainedä¿®é¥°ç¬¦ï¼ˆè¿™ä¸ªä¿®é¥°ç¬¦ä¼šåœ¨åŽé¢ä»‹ç»ï¼‰ã€‚ 12345678910/// åœ¨Cä¸­ä½¿ç”¨OCçš„å¯¹è±¡æ–¹å¼typedef struct rls_temp_ctx&#123; NSObject __unsafe_unretained *obj; void *target;&#125; rls_temp_context;/// åœ¨Cä¸­ä¼ å…¥OCå¯¹è±¡rls_temp_context tmp_ctxs = &#123; .obj = [NSObject new], .target = (__bridge void *)(self)&#125;; ä½†æ˜¯åœ¨ä½¿ç”¨objæ—¶ï¼Œç”±äºŽ__unsafe_unretainedå­˜åœ¨æ‚¬æµ®æŒ‡é’ˆçš„é—®é¢˜ï¼Œå¿…é¡»è¦åˆ¤æ–­è¯¥å€¼æ˜¯å¦å­˜åœ¨ã€‚ OCå†…å­˜ç®¡ç†å‰é¢çœ‹äº†Cçš„å†…å­˜ç®¡ç†ï¼Œè¿˜çœ‹äº†Cå’ŒOCçš„äº¤äº’ï¼Œæœ€åŽå°±æ¥çœ‹çœ‹åœ¨OCä¸­å†…å­˜ç®¡ç†åº”è¯¥æ³¨æ„çš„äº‹é¡¹ã€‚ çŽ°åœ¨æˆ‘ä»¬è®¨è®ºOCçš„å†…å­˜ç®¡ç†æ˜¯åŸºäºŽARCçš„ï¼Œå…¶ä¸­å¯¹è±¡å˜é‡çš„åˆ›å»ºå’Œé‡Šæ”¾é—®é¢˜å’ŒCçš„å†…å­˜ç®¡ç†æœ‰ç‚¹å„¿ç›¸ä¼¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ç³»ç»Ÿä¼šå¸®æˆ‘ä»¬è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œæˆ‘ä»¬åªéœ€è¦æ˜Žç¡®è‡ªå·±æ‰€å£°æ˜Žçš„å¯¹è±¡æˆ–è€…å˜é‡å­˜åœ¨äºŽä»€ä¹ˆåŒºåŸŸï¼ˆä¸Šé¢æåˆ°çš„å†…å­˜åŒºåŸŸï¼‰ï¼Œç»™å®ƒä»¬æ·»åŠ åˆé€‚çš„ä¿®é¥°ç¬¦ç­‰ç­‰ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯¹äºŽæ ˆåŒºã€å †åŒºã€å…¨å±€é™æ€åŒºçš„å˜é‡å¯¹è±¡å’ŒCæ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç±»æ¯”æ¥åˆ†æžOCä¸­å¯¹è±¡æˆ–è€…å˜é‡çš„åˆ›å»ºå’Œé‡Šæ”¾æ—¶æœºã€‚ARCä¸­æ ˆåŒºç”¨autoreleasepoolç®¡ç†çš„å˜é‡å’ŒCä¸­çš„è‡ªåŠ¨å˜é‡çš„å†…å­˜ç®¡ç†æ—¶æœºå¾ˆç›¸ä¼¼ã€‚ åœ¨OCä¸­ä½¿ç”¨åŸºäºŽCçš„å‡½æ•°æ—¶ï¼Œé€šè¿‡mallocç­‰å‡½æ•°å£°æ˜Žçš„å˜é‡ï¼Œéƒ½éœ€è¦æˆ‘ä»¬æ˜Žç¡®åœ°è°ƒç”¨freeå‡½æ•°è¿›è¡Œé‡Šæ”¾ï¼æŠ‘æˆ–åœ¨ä½¿ç”¨CoreFondationã€Runtimeæ—¶ï¼ŒåŸºæœ¬ä¸Šå¦‚æžœé‡åˆ°äº†åŒ…å«æœ‰Copyï¼Œ Createç­‰å…³é”®å­—å‡½æ•°ï¼Œåœ¨ä½¿ç”¨å®Œæˆä¹‹åŽéƒ½éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ã€‚2017-09-13æ›´æ–°ï¼šå½“æˆ‘ä»¬ä½¿ç”¨Runtimeæ—¶ï¼Œè¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¢«åˆ›å»ºçš„å¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯¹åº”çš„releaseæ–¹æ³•åˆæ˜¯MRCæ—¶ä»£çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æ¥è§£å†³ï¼š1234567/// åˆ›å»ºå¯¹è±¡id obj = ((id(*)(id,SEL))objc_msgSend)(((id(*)(id,SEL))objc_msgSend)([self class],@selector(alloc)),@selector(init));........./// é‡Šæ”¾å¯¹è±¡((id(*)(id,SEL))objc_msgSend)(obj,NSSelectorFromString(@&quot;release&quot;)); å†…å­˜ç®¡ç†å…³é”®å­—ä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹ï¼Œåœ¨Objective-Cçš„ARCä¸­æ‰€æ¶‰åŠåˆ°çš„å…³é”®å­—ã€‚ 1ã€__strongä¸ºé»˜è®¤å€¼ï¼Œåœ¨å£°æ˜Žæˆå‘˜å˜é‡å’Œæ–¹æ³•å‚æ•°æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼ 1__strong id obj_var = [[NSObject alloc] init]; ä½œç”¨ï¼šé»˜è®¤çš„è¡Œä¸ºã€‚ 2ã€__weakæ˜¯ä¸ä¼šæŒæœ‰å¯¹è±¡å®žä¾‹ï¼Œ__weakä¿®é¥°ç¬¦å¯ä»¥é¿å…å¾ªçŽ¯å¼•ç”¨ 1234567__weak id obj2 = nil;&#123; __strong id obj_var = [[NSObject alloc] init];/// è‡ªå·±ç”Ÿæˆå¯¹è±¡å¹¶æŒæœ‰ obj2 = obj_var;/// obj2æŒæœ‰å¯¹è±¡çš„å¼±å¼•ç”¨ NSLog(@&quot;__weak %@&quot;,obj2);/// æ­¤æ—¶ç”±äºŽåœ¨obj_varå˜é‡å¯ç”¨åŸŸä¸­ï¼Œobj2æ­¤æ—¶æœ‰å€¼&#125;NSLog(@&quot;__weak %@&quot;,obj2);/// ç”±äºŽä¸åœ¨obj_varä½œç”¨åŸŸä¹‹å¤–ï¼Œobj_varè¢«é‡Šæ”¾ã€‚è€Œä¸”obj2æ˜¯å¼±å¼•ç”¨äºŽobj_varçš„ï¼Œæ‰€ä»¥æ­¤æ—¶obj2å€¼ä¸ºç©º ä½œç”¨ï¼šé¿å…å¾ªçŽ¯å¼•ç”¨ï¼Œä¸æŒæœ‰å¯¹è±¡å®žä¾‹ 3ã€__unsafe_unretainedä¿®é¥°ç¬¦çš„å˜é‡ä¸å±žäºŽç¼–è¯‘å™¨çš„å†…å­˜ç®¡ç†å¯¹è±¡ã€‚å®ƒå’Œ__weakç±»ä¼¼ï¼Œä¸ä¼šæŒæœ‰å¯¹è±¡å®žä¾‹ï¼› 12345678__unsafe_unretained id obj1 = nil;&#123;/// åœ¨obj_varä½œç”¨åŸŸå†…ï¼Œ__unsafe_unretainedå’Œ__weakæ˜¯ä¸€æ ·çš„ __strong id obj_var = [[NSObject alloc] init]; obj1 = obj_var; NSLog(@&quot;__unsafe_unretained %@&quot;,obj1);&#125;NSLog(@&quot;__unsafe_unretained %@&quot;,obj1);/// æ­¤æ—¶å˜é‡å·²ç»è¢«é—å¼ƒï¼Œæˆä¸ºæ‚¬æµ®æŒ‡é’ˆ åœ¨ä½¿ç”¨__unsafe_unretainedä¿®é¥°ç¬¦æ—¶ï¼Œèµ‹å€¼ç»™strongä¿®é¥°ç¬¦çš„å˜é‡æ—¶ï¼Œéœ€è¦æ£€æŸ¥è¢«èµ‹å€¼çš„å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼ˆä¹Ÿå°±æ˜¯è¢«unsafe_unretainedä¿®é¥°çš„å˜é‡ï¼‰ ä½œç”¨ï¼šåœ¨iOS4ä¹‹å‰__weakçš„æ›¿ä»£å“ï¼Œä½†æ˜¯åœ¨å°†å…¶èµ‹å€¼ç»™å…¶ä»–æ—¶ï¼Œæœ€å¥½åšéžç©ºåˆ¤æ–­ 4ã€__autoreleasingä¿®é¥°ç¬¦çš„å˜é‡æ›¿ä»£è°ƒç”¨MRCæ—¶ä»£çš„autoreleaseæ–¹æ³•ï¼Œè¯¥å¯¹è±¡ä¼šè¢«æ³¨å†Œåˆ°autoreleasepoolä¸­ã€‚ä»¥ä¸‹æ˜¯__autoreleasingä¿®é¥°ç¬¦çš„ä½¿ç”¨åœºæ™¯ï¼š 1ï¼‰ã€åœ¨ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥æ–¹æ³•åæ˜¯å¦æ˜¯ä»¥alloc/new/copy/mutablcopyå¼€å§‹ï¼ˆè‡ªå·±ç”Ÿæˆè‡ªç”±æŒæœ‰ï¼‰ã€‚å¦‚æžœä¸æ˜¯è‡ªå·±ç”Ÿæˆçš„åˆ™è‡ªåŠ¨å°†è¿”å›žå€¼æ³¨å†Œåˆ°autoreleasepoolä¸­ã€‚2ï¼‰ã€å¯¹è±¡ä½œä¸ºè¿”å›žå€¼æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†å…¶æ³¨å†Œåˆ°autoreleasingä¸­ã€‚3ï¼‰ã€åœ¨ä½¿ç”¨weakä¿®é¥°ç¬¦çš„å˜é‡æ—¶å°±å¿…å®šè¦ä½¿ç”¨æ³¨å†Œåˆ°autoreleasepoolä¸­çš„å¯¹è±¡ã€‚4ï¼‰ã€idçš„æŒ‡é’ˆæˆ–è€…å¯¹è±¡çš„æŒ‡é’ˆ(NSObject /NSError )åœ¨æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šæ—¶ä¼šè¢«é™„åŠ ä¸Š__autoreleasingä¿®é¥°ç¬¦__ã€‚ 12NSError *error = nil;BOOL result = [self performOperationWithError:&amp;error]; æœ€åŽè¿˜æ˜¯åŽ»çœ‹çœ‹è¿™å¥—é¢˜ï¼Œå®ƒçš„è§£é‡Šå¯¹äºŽç†è§£å†…å­˜çš„é‡Šæ”¾å¾ˆæœ‰ç›Šå¤„ã€‚å¯¹äºŽè¿™å¥—é¢˜æˆ‘å·²ç»æŽ¨èäº†å‡ æ¬¡äº†ï¼Œå“ˆå“ˆå“ˆã€‚ ç›¸å…³å¼•ç”¨ ARC]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ä»Žå¤´è®¤è¯†GCDâ€”â€”ç›¸å…³å‡½æ•°çš„ä½¿ç”¨]]></title>
      <url>%2F2017%2F07%2F29%2Fgcd_func%2F</url>
      <content type="text"><![CDATA[åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹GCDæœ‰äº†åŸºæœ¬çš„è®¤çŸ¥ï¼ŒçŸ¥é“å…¶ä¸­ä¸€äº›ç®€å•çš„ç±»åž‹ï¼Œå’Œä¸€äº›ç®€å•å‡½æ•°ã€‚è¿™æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­å­¦ä¹ GCDä¸­æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨è¾ƒå¤šçš„å‡½æ•°ï¼ŒåŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚åœ¨æœ¬ç¯‡ä¼šä»‹ç»dispatch_afterã€dispatch_applyã€dispatch_group_tã€dispatch_semaphore_tå’Œdispatch_barrierç­‰ç›¸å…³å‡½æ•°ã€‚ dispatch_afterï¼dispatch_time_tæˆ‘å…ˆæ¥è¯´è¯´dispatch_afterï¼Œä»ŽæŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå±žäºŽä»»åŠ¡æäº¤çš„ä¸€ç§æ–¹å¼ã€‚åœ¨åˆšåˆšæŽ¥è§¦iOSå¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä¸€ç›´åœ¨æƒ³â€œ å¯¹äºŽdispatch_afterå®ƒæ˜¯åŒæ­¥æäº¤ä»£ç å—è¿˜æ˜¯å¼‚æ­¥æäº¤çš„ä»£ç å—çš„å‘¢ï¼Ÿ â€ã€‚åŽæ¥çœ‹åˆ°Appleçš„æ–‡æ¡£ä¸­è¯´åˆ°â€This function waits until the specified time and then asynchronously adds block to the specified queueâ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„å»¶è¿Ÿæ‰§è¡Œï¼Œå¹¶ä¸æ˜¯é©¬ä¸Šå°±å°†ä»£ç å—å°±æäº¤åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯ç­‰åˆ°æŒ‡å®šçš„æ—¶é—´é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æå…¶æäº¤åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­åŽ»ã€‚å› æ­¤ä»Žè¿™æ®µè¯ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºå®ƒä»…ä»…æ˜¯dispatch_asyncçš„ä¸€ç§ã€‚è¯¥å‡½æ•°çš„å£°æ˜Žå¦‚ä¸‹ï¼š 1void dispatch_after(dispatch_time_t when, dispatch_queue_t queue, dispatch_block_t block); åˆ°è¿™é‡Œå°±éœ€è¦æ¥ç³»ç»Ÿåœ°è¯´ä¸€è¯´dispatch_afterå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªdispatch_time_tç±»åž‹çš„å˜é‡ã€‚dispatch_time_tå®žé™…æ˜¯uint64_tç±»åž‹ã€‚ç³»ç»Ÿä¸ºè¯¥ç±»åž‹å®šä¹‰äº†ä¸¤ä¸ªç‰¹æ®Šå€¼ï¼Œåˆ†åˆ«æ˜¯DISPATCH_TIME_NOWã€DISPATCH_TIME_FOREVERï¼Œå…¶ä¸­DISPATCH_TIME_NOWè¡¨ç¤ºå€¼ä¸º0ï¼Œè€ŒDISPATCH_TIME_FOREVERè¡¨ç¤ºä¸ºæ— ç©·å¤§ï¼ˆinfinityï¼‰ã€‚é™¤äº†è¿™ä¸¤ä¸ªç‰¹æ®Šå€¼ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°dispatch_time()æ¥åˆ›å»ºç›¸å¯¹äºŽé»˜è®¤æ—¶é’Ÿçš„æ—¶é—´ï¼›æˆ–è€…ä½¿ç”¨dispatch_walltime()å‡½æ•°èŽ·å–ç»å¯¹æ—¶é—´ã€‚å¯¹äºŽdispatch_time()å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æˆ‘ä»¬ä¼ å…¥DISPATCH_TIME_NOWæˆ–è€…DISPATCH_TIME_FOREVERå€¼ã€‚ dispatch_time()å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æŽ¥å—çš„æ˜¯ åŸºäºŽçº³ç§’çº§åˆ«çš„æ•°å€¼ ã€‚ è¿™æ—¶å€™å°±éœ€è¦å°†å…·ä½“çš„æ•°å­—ä¹˜ä»¥ä¸€ä¸ªå¸¸æ•°ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­åˆ—å‡ºäº†ç›¸å…³çš„å¸¸æ•°ã€‚ å¸¸æ•° æ„ä¹‰ å…·ä½“æ•°å€¼ NSEC_PER_SEC è¡¨ç¤ºä¸€ç§’èƒ½è½¬æ¢æˆå¤šå°‘çº³ç§’ 1000000000ull USEC_PER_SEC è¡¨ç¤ºä¸€ç§’èƒ½è½¬æ¢æˆå¤šå°‘å¾®ç§’ 1000000ull NSEC_PER_USEC è¡¨ç¤ºä¸€å¾®ç§’è½¬æ¢æˆå¤šå°‘çº³ç§’ 1000ull 12345/// ä½¿ç”¨ç›¸å¯¹æ—¶é—´ï¼Œç›¸å¯¹äºŽçŽ°åœ¨å»¶è¿Ÿäº”ç§’dispatch_time_t time_t = dispatch_time(DISPATCH_TIME_NOW, 5 * NSEC_PER_SEC);dispatch_after(time_t, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;Run&quot;);&#125;); å¦‚æžœæˆ‘ä»¬æƒ³è¦è¯¥ä»£ç å—å»¶è¿Ÿåˆ°æŸä¸€æŒ‡å®šæ—¶åˆ»åŽ»æ‰§è¡Œï¼Œæˆ‘ä»¬åªéœ€è¦åŽ»ä¿®æ”¹dispatch_afterä¸­çš„dispatch_time_tç±»åž‹ä¸­å€¼ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°dispatch_walltimeæ¥èŽ·å–ç»å¯¹çš„æ—¶é—´æˆ³å€¼ã€‚dispatch_walltime()å‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯struct timespecç±»åž‹çš„ä¸€ä¸ªå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»“æž„ï¼š 12345_STRUCT_TIMESPEC&#123; __darwin_time_t tv_sec; long tv_nsec;&#125;; åˆ†åˆ«ä¸ºç§’å’Œçº³ç§’ã€‚timespecæ˜¯åŸºäºŽçº³ç§’çº§åˆ«çš„æ•°å€¼ï¼Œå…³äºŽdispatch_walltimeå…·ä½“æ˜¯æ–¹å¼ä¹‹ä¸€å¦‚ä¸‹ï¼š 123456789/// å»¶è¿Ÿåˆ°æŸä¸€ç»å¯¹æ—¶åˆ»æ‰§è¡Œstruct timespec __tp;double sec, n_sec;n_sec = modf(1500794750.797543543, &amp;sec);__tp.tv_sec = sec;__tp.tv_nsec = n_sec;dispatch_after(dispatch_walltime(&amp;__tp, 0), dispatch_get_main_queue(), ^&#123; ...&#125;); ä¸Šè¯‰ä»£ç è¦ç­‰åˆ°æ—¶é—´æˆ³ä¸º1500794750æ—¶æ‰ä¼šå°†ä»£ç å—æäº¤åˆ°æŒ‡å®šçš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚ dispatch_applydispatch_applyæ˜¯dispatch_syncå‡½æ•°é…åˆä¸åŒçš„çš„dispatch_queue_té˜Ÿåˆ—ï¼Œæ¥å¾ªçŽ¯æ‰§è¡Œä»»åŠ¡ã€‚ å¦‚æžœåœ¨dispatch_applyå‡½æ•°ä¸­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ï¼Œé‚£ä¹ˆblockä¸­çš„ä»»åŠ¡å°±å¯ä»¥è¢«å¹¶å‘çš„è°ƒç”¨ï¼ç›¸å¯¹äºŽä¸€èˆ¬çš„forå¾ªçŽ¯æ¥è¯´è¦é«˜æ•ˆè®¸å¤šã€‚ 12345dispatch_queue_t apply_queue = dispatch_queue_create(&quot;com.example.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_apply(5, apply_queue, ^(size_t index) &#123; NSLog(@&quot;%zd&quot;,index);&#125;);NSLog(@&quot;End&quot;); ç»“æžœå¦‚ä¸‹0, 2, 3, 1, 4, Endã€‚ä½†æ˜¯æˆ‘ä»¬å°†ä¸Šé¢çš„å¹¶å‘é˜Ÿåˆ—æ”¹æˆä¸²è¡Œé˜Ÿåˆ—ä¹‹åŽï¼š 12345dispatch_queue_t apply_queue = dispatch_queue_create(&quot;com.example.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_SERIAL, QOS_CLASS_USER_INITIATED, 0));dispatch_apply(5, apply_queue, ^(size_t index) &#123; NSLog(@&quot;%zd&quot;,index);&#125;);NSLog(@&quot;End&quot;); è¿”å›žçš„ç»“æžœ0, 1, 2, 3, 4, Endå’Œæ­£å¸¸çš„forå¾ªçŽ¯æ²¡æœ‰ä»€ä¹ˆå·®è·ã€‚ä½†æ˜¯ä¸ç®¡æ˜¯åœ¨å¹¶å‘çš„é˜Ÿåˆ—è¿˜æ˜¯åœ¨ä¸²è¡Œçš„é˜Ÿåˆ—ä¸­ï¼ŒEndæ€»æ˜¯æœ€åŽæ‰æ‰“å°çš„ã€‚ dispatch_group_tç›¸å…³å‡½æ•°ä½¿ç”¨dispatch_groupå¯ä»¥æŠŠè®¸å¤šæ“ä½œè¿›è¡Œåˆå¹¶ã€‚åœ¨å°†å¤šä¸ªä»»åŠ¡blockæäº¤ä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥åœ¨dispatch_groupä¸­èŽ·å–åˆ°è¿™äº›æ“ä½œå…¨éƒ¨å®Œæˆçš„æ—¶é—´ï¼ˆä¸ç®¡æ˜¯ä¸²è¡Œæ‰§è¡Œè¿˜æ˜¯å¹¶è¡Œæ‰§è¡Œï¼‰ã€‚çŽ°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªåœºæ™¯ï¼šç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å°†å¤šä¸ªæœ¬åœ°èµ„æºä¼ é€’ç»™æœåŠ¡å™¨ã€‚æˆ‘ä»¬ç”¨dispatch_groupç›¸å…³çš„æŠ€æœ¯æ¥å®žçŽ°è¿™ä¸ªéœ€æ±‚ã€‚åˆ›å»ºä¸€ä¸ªdispatch_group_tç±»åž‹çš„å˜é‡å®žçŽ°éžå¸¸ç®€å•ï¼Œä¸åƒå…¶ä»–GCDå‡½æ•°éœ€è¦ä¸€äº›å…¶ä»–çš„å‚æ•°ï¼š 1dispatch_group_t upload_group = dispatch_group_create(); å½“åˆ›å»ºå¥½äº†dispatch_groupä¹‹åŽï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›ä»»åŠ¡è¿›è¡Œæäº¤ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ä¸Šä¸€èŠ‚çš„dispatch_applyæ¥å°†å¤šä¸ªä»»åŠ¡æ”¾åœ¨å¹¶å‘çš„é˜Ÿåˆ—ä¸­ï¼š 1234567dispatch_queue_t upload_queue = dispatch_queue_create(&quot;com.example.upload.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_apply(5, dispatch_get_global_queue(QOS_CLASS_UTILITY, 0), ^(size_t index) &#123; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), upload_queue, ^&#123; /// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ NSLog(@&quot;Upload %zd&quot;,index); &#125;);&#125;); åœ¨å¤§éƒ¨åˆ†çš„åº”ç”¨ä¸­çš„ä¸Šä¼ è¯·æ±‚ï¼Œéƒ½æœ‰ä¸€ä¸ªä¸Šä¼ å®Œæˆçš„æ ‡å¿—ã€‚ç¬¬äºŒæ­¥ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªåœºæ™¯ä¸­æˆ‘ä»¬å¦‚ä½•çŸ¥é“æ‰€æœ‰å›¾ç‰‡å·²ç»ä¸Šä¼ æˆåŠŸå‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨åŒæ­¥çš„æ–¹å¼ï¼Œç”¨æˆ·çš„äº¤äº’ä¸èµ·ä½œç”¨ï¼Œé™é™åœ°ç­‰å¾…ä¸Šä¼ å®Œæˆï¼š 1234567891011dispatch_group_t upload_group = dispatch_group_create();dispatch_queue_t upload_queue = dispatch_queue_create(&quot;com.example.upload.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_apply(5, dispatch_get_global_queue(QOS_CLASS_UTILITY, 0), ^(size_t index) &#123; dispatch_group_enter(upload_group); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), upload_queue, ^&#123;/// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ NSLog(@&quot;Upload %zd&quot;,index); dispatch_group_leave(upload_group); &#125;);&#125;);dispatch_group_wait(upload_group, DISPATCH_TIME_FOREVER);NSLog(@&quot;Upload Complete&quot;); dispatch_groupçš„ç®¡ç†æ˜¯åŸºäºŽè®¡æ•°æ¥åšçš„ã€‚dispatch_group_enterä¼šå¢žåŠ è¯¥Groupå†…éƒ¨çš„ä»»åŠ¡è®¡æ•°ï¼Œdispatch_group_leaveä¼šå‡å°‘è¯¥Groupä¸­æœªå®Œæˆçš„è®¡æ•°ï¼Œå®ƒä»¬ä¸¤ä¸ªå‡½æ•°å¿…é¡»é…å¯¹ä½¿ç”¨ã€‚dispatch_group_waitå‡½æ•°å’Œæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ä¸­è®²åˆ°çš„dispatch_block_waitå‡½æ•°åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡dispatch_group_waitæ˜¯é’ˆå¯¹å¤šä¸ªblockçš„åŒæ­¥æ–¹æ³•ï¼Œå®ƒä¼šç­‰åˆ°Groupä¸­æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åŽæ‰ä¼šåŽ»ç»§ç»­æ‰§è¡ŒåŽé¢çš„å†…å®¹ã€‚ æ—¢ç„¶ä¸Šé¢æåˆ°äº†dispatch_group_waitå‡½æ•°å¯¹åº”dispatch_block_waitå‡½æ•°ï¼Œé‚£ä¹ˆå¾ˆæ˜Žæ˜¾åº”è¯¥å­˜åœ¨dispatch_block_notifyå‡½æ•°å¯¹åº”çš„Groupå‡½æ•°ã€‚æˆ‘ä»¬å°†ä¸Šé¢çš„å‡½æ•°è¿›è¡Œç¨åŠ æ”¹åŠ¨ï¼Œå°†åŒæ­¥çš„æ–¹å¼æ”¹ä¸ºå¼‚æ­¥çš„æ–¹å¼ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåšå…¶ä»–çš„æ“ä½œï¼š 123456789101112dispatch_group_t upload_group = dispatch_group_create();dispatch_queue_t upload_queue = dispatch_queue_create(&quot;com.example.upload.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_apply(5, dispatch_get_global_queue(QOS_CLASS_UTILITY, 0), ^(size_t index) &#123; dispatch_group_enter(upload_group); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), upload_queue, ^&#123;/// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ NSLog(@&quot;Upload %zd&quot;,index); dispatch_group_leave(upload_group); &#125;);&#125;);dispatch_group_notify(upload_group, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;Upload Complete&quot;);&#125;); å…¶å®žç›¸å¯¹äºŽä½¿ç”¨ç¹ççš„dispatch_group_enterã€dispatch_group_leaveï¼ŒAppleç»™æˆ‘ä»¬æä¾›äº†æ›´ä¸ºç®€å•çš„å‡½æ•°dispatch_group_asyncã€‚æˆ‘è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨ä¸€å¼€å§‹å°±èƒ½è®©æˆ‘ä»¬æ¸…æ¥šï¼Œåœ¨Groupå†…éƒ¨æ˜¯ä»€ä¹ˆåœ¨å†³å®šç€dispatch_group_wait ã€dispatch_group_notifyçš„è§¦å‘æ—¶æœºï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯¹ä¸Šé¢çš„ä¾‹å­è¿›è¡Œç¨åŠ ä¿®æ”¹ï¼š 12345678910dispatch_group_t upload_group = dispatch_group_create();dispatch_queue_t upload_queue = dispatch_queue_create(&quot;com.example.upload.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_apply(5, dispatch_get_global_queue(QOS_CLASS_UTILITY, 0), ^(size_t index) &#123; dispatch_group_async(upload_group, upload_queue, ^&#123; NSLog(@&quot;Upload %zd&quot;,index); &#125;);&#125;);dispatch_group_notify(upload_group, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;Upload Complete&quot;);&#125;); å¾ˆæ˜Žæ˜¾å¯¹äºŽä½¿ç”¨dispatch_group_asyncç»™æˆ‘ä»¬å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œåœ¨çµæ´»æ€§ä¸Šä¹Ÿå°±å‡ºçŽ°ç¼ºå¤±ï¼Œå†è€…å°±æ˜¯åœ¨ç”¨GroupåšåŒæ­¥çš„æ—¶å€™ä½¿ç”¨dispatch_group_enterã€dispatch_group_leaveæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼ dispatch_semaphore_tç›¸å…³å‡½æ•°åœ¨ç³»ç»Ÿä¸­ï¼Œç»™äºˆæ¯ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ªä¿¡å·é‡ï¼Œä»£è¡¨æ¯ä¸ªè¿›ç¨‹ç›®å‰çš„çŠ¶æ€ï¼Œæœªå¾—åˆ°æŽ§åˆ¶æƒçš„è¿›ç¨‹ä¼šåœ¨ç‰¹å®šåœ°æ–¹è¢«å¼ºè¿«åœä¸‹æ¥ï¼Œç­‰å¾…å¯ä»¥ç»§ç»­è¿›è¡Œçš„ä¿¡å·åˆ°æ¥ï¼ˆæ¥è‡ªç»´åŸºç™¾ç§‘ï¼‰ã€‚é€šä¿—ä¸€ç‚¹å„¿è®²å°±æ˜¯è¯´åœ¨è¿›ç¨‹å†…éƒ¨æœ‰ä¸€åŽŸå­é€’å¢žå’Œé€’å‡çš„è®¡æ•°å™¨ï¼ˆä¹Ÿå°±æ˜¯è¯¥æ•°æ®å˜é‡å…·æœ‰åŽŸå­æ€§ï¼‰ã€‚å¦‚æžœè§¦å‘äº†æŸä¸ªæ“ä½œä½¿å¾—ä¿¡å·é‡å°äºŽç­‰äºŽ0ï¼Œé‚£ä¹ˆè¯¥æ“ä½œå°†ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°å…¶ä¿¡å·é‡å¤§äºŽ0ã€‚ä¸Šé¢æåˆ°è¿‡ï¼Œä¿¡å·é‡æ˜¯åŸºäºŽè¿›ç¨‹çš„ã€‚æ‰€ä»¥ï¼š ä¿¡å·é‡ä¸ä¾èµ–äºŽä»»ä½•é˜Ÿåˆ—ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸­ä½¿ç”¨ã€‚ åœ¨GCDä¸­ï¼Œå‡½æ•°dispatch_semaphore_signalå¢žåŠ ä¿¡å·é‡è®¡æ•°ï¼Œå¦‚æžœä¹‹å‰ä¿¡å·é‡è®¡æ•°å°äºŽç­‰äºŽ0ï¼Œè¯¥å‡½æ•°ä¼šå”¤é†’å½“å‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹ã€‚ç›¸åï¼Œå‡½æ•°dispatch_semaphore_waitä¼šå‡å°‘ä¿¡å·é‡è®¡æ•°ï¼Œå¦‚æžœå½“è¯¥ä¿¡å·é‡è®¡æ•°å°äºŽæˆ–è€…ç­‰äºŽ0ä¹‹åŽï¼Œä¼šé˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–æ“ä½œæ¥å¢žåŠ ä¿¡å·é‡è®¡æ•°ã€‚ 123456789101112131415161718192021- (NSArray *)downloadSync&#123; NSMutableArray *contents = [NSMutableArray array]; dispatch_semaphore_t semaphore = dispatch_semaphore_create(0); dispatch_group_t upload_group = dispatch_group_create(); dispatch_queue_t upload_queue = dispatch_queue_create(&quot;com.example.download.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0)); dispatch_apply(5, dispatch_get_global_queue(QOS_CLASS_UTILITY, 0), ^(size_t index) &#123; dispatch_group_enter(upload_group); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), upload_queue, ^&#123; NSString *cts = [NSString stringWithFormat:@&quot;%zd&quot;,index]; NSLog(@&quot;~ %@ ~&quot;,cts); [contents addObject:cts]; dispatch_group_leave(upload_group); &#125;); &#125;); dispatch_group_notify(upload_group, dispatch_get_main_queue(), ^&#123; dispatch_semaphore_signal(semaphore); &#125;); dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); return contents;&#125; æˆ‘ä»¬çŽ°åœ¨æ¥çœ‹çœ‹ä¸Šé¢è¿™ä¸ªæ–¹æ³•å¯ä»¥æ­£å¸¸çš„è¿”å›žå—ï¼Ÿé™¤äº†dispatch_semaphore_tç›¸å…³çš„ä»£ç ï¼Œæˆ‘éƒ½æ˜¯ç›´æŽ¥ä»Žä¸Šé¢æ‹·è´ä¸‹æ¥ï¼Œæ²¡æœ‰åšä»»ä½•ä¿®æ”¹ã€‚å½“æˆ‘è·‘èµ·æ¥ä¹‹åŽï¼Œå§‹ç»ˆæ–¹æ³•downloadSyncä¸ä¼šè¿”å›žï¼Œè¿™é‡Œå¾ˆæ˜Žæ˜¾çš„æ˜¯é€ æˆäº†æ­»é”çš„é—®é¢˜ï¼ç”±äºŽdispatch_semaphore_waitå‡½æ•°ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ï¼ˆå®ƒæ­¤æ—¶æ˜¯å¤„äºŽä¸»çº¿ç¨‹ä¸­ï¼‰ï¼Œdispatch_group_notifyå‡½æ•°çš„ä»»åŠ¡çº¿ç¨‹å³ä¸ºä¸»çº¿ç¨‹å¯¹åº”çš„ä¸»ä»»åŠ¡é˜Ÿåˆ—ã€‚dispatch_semaphore_waitéœ€è¦ç­‰åˆ°å‡½æ•°dispatch_semaphore_signalæ¥å¢žåŠ ä¿¡å·é‡è®¡æ•°ä¹‹åŽæ‰ä¼šç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹ï¼Œè€Œdispatch_group_notifyåˆè¦åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆç”±äºŽä¸»çº¿ç¨‹è¢«é˜»å¡žï¼‰ä¹‹åŽæ‰èƒ½åŽ»è°ƒç”¨dispatch_semaphore_signalå‡½æ•°ï¼Œå› æ­¤å°±é€ æˆäº†æ­»é”ï¼Œç¨‹åºæ°¸è¿œä¸ä¼šç»§ç»­æ‰§è¡Œï¼ã€‚è§£å†³åŠžæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†dispatch_semaphore_signalæ”¾åœ¨ä¸€ä¸ªå¹¶è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ä¸­è¿›è¡Œï¼š 123dispatch_group_notify(upload_group, dispatch_get_global_queue(QOS_CLASS_USER_INITIATED, 0), ^&#123; dispatch_semaphore_signal(semaphore);&#125;); ä¸Šé¢ä½¿ç”¨ä¿¡å·é‡çš„ç›¸å…³å‡½æ•°ï¼Œå®žçŽ°äº†å¼‚æ­¥è½¬åŒæ­¥çš„éœ€æ±‚ã€‚ dispatch_barrierdispatch_barrierçš„ä½œç”¨æ˜¯åœ¨å¹¶å‘é˜Ÿåˆ—ä¸­å®žçŽ°åŒæ­¥æ“ä½œã€‚åœ¨å¹¶å‘é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡çš„æäº¤é¡ºåºä¼šå½±å“åˆ°æ‰§è¡Œé¡ºåºï¼Œå½“å¼‚æ­¥æäº¤çš„ä»»åŠ¡åœ¨dispatch_barrierä¹‹åŽï¼Œè¯¥ä»»åŠ¡éœ€è¦ç­‰åˆ°dispatch_barrieræäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åŽæ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚æŠŠä¸Šé¢çš„è¯ç”¨ä¸‹é¢çš„å›¾é€šä¿—çš„æ¥è§£é‡Šä¸€ä¸‹ï¼š ç”¨ä¸‹é¢çš„ä¼ªä»£ç æ¥å®žçŽ°ä¸€ä¸‹ä¸Šå›¾ä¸­çš„ç›¸å…³ä»»åŠ¡ï¼š 12345dispatch_async(task_queue, task_1);dispatch_async(task_queue, task_2);dispatch_async(task_queue, task_3);dispatch_barrier_async(task_queue, task_4);dispatch_async(task_queue, task_5); å‡½æ•°dispatch_barrier_asyncä¸­blockå‚æ•°ï¼Œä¼šè¢«ç›®æ ‡é˜Ÿåˆ—å¤åˆ¶å¹¶æŒæœ‰ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆæ—¶è¢«é‡Šæ”¾ã€‚å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°ï¼š ç›®æ ‡é˜Ÿåˆ—å¿…é¡»æ˜¯ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºçš„å¹¶å‘é˜Ÿåˆ—ï¼Œå¦‚æžœä¼ å…¥çš„æ˜¯ä¸²è¡Œé˜Ÿåˆ—æˆ–è€…æ˜¯å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±å’Œdispatch_asyncç±»ä¼¼ã€‚ dispatch_barrier_syncåœ¨åšåŒæ­¥æ“ä½œæ—¶å’Œdispatch_barrier_asyncæ•ˆæžœç±»ä¼¼ï¼Œä½†æ˜¯å®ƒå¿…é¡»å¾—ç­‰åˆ°blockä»»åŠ¡å®Œæˆä¹‹åŽæ‰ä¼šè¿”å›žï¼è€Œä¸”dispatch_barrier_syncå‡½æ•°çš„ç›®æ ‡çº¿ç¨‹ä¸ä¼šå¤åˆ¶å’ŒæŒæœ‰blockã€‚ dispatch_onceåœ¨è¿™ç¯‡æ–‡ç« çš„æœ€åŽä»¥dispatch_onceæ¥åšä¸€ä¸ªç»“å°¾ï¼Œå¯¹äºŽdispatch_onceæˆ‘ä»¬iOSå¼€å‘è€…ç”¨çš„å¤ªå¤šäº†ã€‚è¯¥å‡½æ•°åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹åŒæ ·ä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œå¦‚æžœæ˜¯åœ¨å¤šçº¿ç¨‹ä¸­è¿›è¡Œè°ƒç”¨ï¼Œå®ƒä¼šåŒæ­¥åœ°ç­‰å¾…blockä»»åŠ¡æ‰§è¡Œå®Œæˆï¼å®˜æ–¹æ–‡æ¡£ä¸­æå‡ºï¼šå¯¹äºŽdispatch_onceå‡½æ•°çš„ ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å­˜å‚¨åœ¨å…¨å±€åŒºæˆ–è€…é™æ€åŒºçš„å˜é‡ 1234static dispatch_once_t predicate;dispatch_once(&amp;predicate, ^&#123; ... &#125;); å…³äºŽdispatch_onceæ›´å¤šçš„æ–‡ç« è§dispatch_onceï¼Œä»¥åŠå¯¹åº”çš„æºç once.cã€‚ç¬¬ä¸‰ç¯‡æ–‡ç« ä¼šåœ¨åŽé¢æ”¾å‡ºæ¥ï¼Œæˆ‘å‡†å¤‡å†™å…³äºŽdispatch_sourceå’Œdispatch_dataä»¥åŠdispatch_ioç­‰ç›¸å…³çŸ¥è¯†ã€‚ ç›¸å…³é“¾æŽ¥æ ¹æ®æ–‡ä¸­å‡ºçŽ°é¡ºåº Apple Dispatch Github Dispatch Time Multiplier Constants Elapsed Time ä¿¡å·é‡]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ä»Žå¤´è®¤è¯†GCDâ€”â€”æ´¾å‘é˜Ÿåˆ—åŸºç¡€]]></title>
      <url>%2F2017%2F07%2F29%2Fgcd_basic%2F</url>
      <content type="text"><![CDATA[æœ¬æ–‡åŒ…æ‹¬äº†ä»Žæœ€åŸºç¡€çš„èŽ·å–ä»»åŠ¡é˜Ÿåˆ—å¼€å§‹ï¼Œé…ç½®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåˆ›å»ºä»»åŠ¡ï¼Œæäº¤ä»»åŠ¡ä¸€æ­¥ä¸€æ­¥åœ°æ¥å¤ä¹ GCDä¸­æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ã€‚ï¼ˆå»ºè®®åœ¨PCç«¯æµè§ˆï¼‰ åŒ…æ‹¬ä½¿ç”¨è¾ƒå°‘çš„dispatch_qos_class_t ã€dispatch_block_tç­‰ç­‰çŸ¥è¯†ç‚¹ã€‚ GCDä»»åŠ¡é˜Ÿåˆ—èƒ½å¤Ÿè®©å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºŽåŒæ­¥æˆ–è€…å¼‚æ­¥ä»»åŠ¡taskï¼Œè€Œä¸ç”¨æŠŠé‡ç‚¹æ”¾åœ¨åˆ›å»ºçº¿ç¨‹å’Œå…·ä½“åŒæ­¥å’ŒåŠ é”ç­‰ç›¸å…³æ“ä½œã€‚ä½†æ˜¯å¦‚æžœæˆ‘ä»¬æƒ³å¼‚æ­¥åšæ›´åŠ çµæ´»çš„ä»»åŠ¡çš„è¯ï¼ˆæ¯”å¦‚åŽå°ä»»åŠ¡ä¹‹ç±»çš„ï¼‰ï¼Œé‚£é€‰æ‹©çº¿ç¨‹è‚¯å®šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚æ¯•ç«Ÿæ“ä½œç®€å•å¸¦æ¥å°±æ˜¯çµæ´»æ€§çš„ç¡®å®žå˜›ï¼é¦–å…ˆå…ˆæ¥çœ‹çœ‹æ´¾å‘é˜Ÿåˆ—ã€‚ å½“ç”¨æˆ·å‘æŸä¸€çº¿ç¨‹æäº¤ä¸€ä¸ªtaskæ—¶ï¼Œ_dispatch_queue_t_ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ä»¥ç”¨æˆ·æœŸæœ›çš„æ–¹å¼æ¥ç®¡ç†è¿™äº›taskã€‚ ç®¡ç†çš„ä»»åŠ¡çš„æ–¹å¼æœ‰ä¸¤ç§ç±»åž‹ï¼Œåˆ†åˆ«æ˜¯ä¸²è¡Œé˜Ÿåˆ—(DISPATCH_QUEUE_SERIAL)å’Œå¹¶è¡Œé˜Ÿåˆ—(DISPATCH_QUEUE_CONCURRENT)ï¼Œå®ƒä»¬ä¸¤ä¸ªæ˜¯ç”±å®å®šä¹‰çš„ã€‚ ä¸€ã€èŽ·å–ä»»åŠ¡é˜Ÿåˆ—çŽ°åœ¨é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬æ—¢ç„¶çŸ¥é“æœ‰è¿™ä¹ˆä¸€ä¸ªç±»åž‹äº†ï¼Œé‚£æˆ‘ä»¬æ€»è¦æœ‰æ–¹å¼æ¥å¾—åˆ°å®ƒå•Šæ˜¯å§ã€‚å°±ç›®å‰è€Œè¨€ï¼ŒAppleç»™æˆ‘ä»¬æä¾›èŽ·å–è¯¥ç±»åž‹å˜é‡çš„æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š dispatch_get_main_queueï¼šç¨‹åºä¸»çº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼ˆDISPATCH_QUEUE_SERIALï¼‰ã€‚åœ¨ç¨‹åºmain()å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºã€‚åœ¨å®˜æ–¹æ–‡æ¡£ä¸­è¿˜æåˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸»åŠ¨åŽ»æ‰§è¡Œè¢«æ·»åŠ åˆ°main_queueçš„ä»»åŠ¡taskï¼ˆä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨æ¥è°ƒç”¨æ·»åŠ åˆ°ä¸»çº¿ç¨‹é˜Ÿåˆ—çš„blockï¼‰ã€‚ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯ï¼šdispatch_main()ã€UIApplicationMain ã€CFRunLoopRun()ï¼Œé€‰ç”¨å…¶ä¸­ä¸€ä¸ªã€‚æˆ‘å°è¯•äº†ä¸€ä¸‹ä½¿ç”¨dispatch_main()ä¼šå¯¼è‡´ç¨‹åºä¸­æ–­ã€‚ dispatch_get_global_queueï¼šç”±ç³»ç»Ÿå®šä¹‰å¹¶ç®¡ç†çš„ä¸€ä¸ªå…¨å±€å¹¶è¡Œé˜Ÿåˆ—ã€‚åœ¨èŽ·å–æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä»»åŠ¡é˜Ÿåˆ—çš„ç³»ç»Ÿç­‰çº§ï¼ˆDISPATCH_QUEUE_PRIORITY_HIGHã€DISPATCH_QUEUE_PRIORITY_DEFAULTã€DISPATCH_QUEUE_PRIORITY_LOWã€DISPATCH_QUEUE_PRIORITY_BACKGROUNDï¼‰ã€‚ 1dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); ä½†æ˜¯åœ¨iOS8ä»¥åŽï¼Œä½¿ç”¨æžšä¸¾qos_class_tçš„å€¼ï¼Œæä¾›äº†ç»†ç²’åº¦æ›´é«˜çš„å…¨å±€ä»»åŠ¡é˜Ÿåˆ—ï¼Œå…³äºŽQOSåœ¨åŽé¢ç»Ÿä¸€æ¢³ç†ä¸€ä¸‹ã€‚ 1dispatch_get_global_queue(QOS_CLASS_UTILITY, 0); è¯¥å‡½æ•°çš„è¿”å›žå€¼ä¸Šä½¿ç”¨dispatch_resumeã€dispatch_suspendæ— æ•ˆï¼Œ dispatch_queue_createï¼šé™¤äº†ä¸Šè¯‰ç³»ç»Ÿæä¾›çš„ä¸¤ç§ç±»åž‹çš„ä»»åŠ¡é˜Ÿåˆ—ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±åŽ»åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºä¸²è¡Œï¼ˆDISPATCH_QUEUE_SERIALï¼‰å’Œå¹¶è¡Œï¼ˆDISPATCH_QUEUE_CONCURRENTï¼‰ä¸¤ç§ç±»åž‹çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå˜ç§DISPATCH_QUEUE_SERIAL_INACTIVE, DISPATCH_QUEUE_CONCURRENT_INACTIVEã€‚å®ƒä»¬åŒæ ·ä¼šæœ‰æ¶‰åŠåˆ°QOSçš„åˆ›å»ºæ–¹æ³•ï¼ŒåŽé¢ä¸€èµ·è®°å½•ä¸€ä¸‹ 1dispatch_queue_create(&quot;com.example.gcd&quot;, DISPATCH_QUEUE_CONCURRENT); ä¸Šè¯‰ä¸‰ç§å°±æ˜¯èŽ·å¾—ä»»åŠ¡é˜Ÿåˆ—æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è®¾ç½®dispatch_ge_global_queueçš„ç¬¬äºŒä¸ªå‚æ•°æ—¶ä¸€èˆ¬è®¾ç½®ä¸º0ã€‚ä¸Šé¢è¿™ä¸‰ç§æ–¹å¼æ˜¯æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä½¿ç”¨å¹¶å‘ç¼–ç¨‹æ—¶é€šè¿‡GCDçš„æ–¹å¼æ¥èŽ·å–ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹æ³•ã€‚åœ¨å¤§éƒ¨åˆ†æ—¶é—´ä½¿ç”¨å¹¶è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œglobal_queueèƒ½å¤ŸåŸºæœ¬æ»¡è¶³éœ€æ±‚ï¼›å¯¹äºŽæˆ‘æ¥è¯´åˆ›å»ºçº¿ç¨‹çš„åœºæ™¯ï¼Œä¸»è¦æ˜¯å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸²è¡Œçš„ä»»åŠ¡ï¼Œä½†æ˜¯åˆä¸æƒ³åœ¨ä¸»çº¿ç¨‹åŽ»æ‰§è¡Œæ—¶ä½¿ç”¨ã€‚æ—¢ç„¶æˆ‘åœ¨ä¸Šé¢æåˆ°äº†QOSï¼Œä¸‹é¢æˆ‘ä»¬å°±ç³»ç»Ÿçš„æ¥è®¤è¯†ä¸€ä¸‹QOSã€‚ äºŒã€é€šè¿‡QOSé…ç½®é˜Ÿåˆ— ç”±äºŽåœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå­˜åœ¨å„ç§å„æ ·çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·ç•Œé¢åˆ·æ–°ï¼Œç½‘ç»œè¯·æ±‚ï¼Œèµ„æºä¸‹è½½ï¼Œç¼“å­˜å­˜å–ä¹‹ç±»çš„ã€‚ä¸ºäº†èƒ½å¤Ÿä¿è¯ç¨‹åºçš„é«˜æ•ˆå“åº”ï¼Œéœ€è¦å¯¹ä¸åŒçš„ä»»åŠ¡å¯¹èµ„æºçš„æ¶ˆè€—åšå‡ºä¸€äº›è°ƒæ•´ã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨QOSæ¥è§£å†³ä¸åŒä»»åŠ¡çš„èµ„æºåˆ†é…é—®é¢˜ï¼ŒQOSå¯ä»¥ç”¨äºŽdispatch_queue, NSOperation, NSOperationQueue, NSThread ,pthreadsä¸­ï¼Œè¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²ä¸€ä¸‹åœ¨dispatch_queueä¸­çš„ä½¿ç”¨åœºæ™¯ã€‚ åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿè¯´ï¼Œå…³äºŽQOSçš„åªèƒ½åœ¨iOS8ä»¥åŽä½¿ç”¨ QOS_CLASS æ‰§è¡Œæ—¶æœº ç›¸å…³ä½¿ç”¨åœºæ™¯ USER_INTERACTIVE å¿…é¡»æ˜¯è¦åŠæ—¶å¤„ç† ç­‰çº§æœ€é«˜ã€‚ä¸»è¦ç”¨æˆ·ç”¨æˆ·äº¤äº’ï¼Œæ¯”å¦‚ä¸»çº¿ç¨‹ä¸Šçš„åˆ·æ–°ç”¨æˆ·ç•Œé¢ç­‰ç­‰ã€‚ USER_INITIATED éœ€è¦å¾ˆå¿«å®Œæˆå·¥ä½œ å®ƒä¸»è¦ç”¨äºŽæ¯”å¦‚å·²ç»å¼€äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæ­¤æ—¶éœ€è¦ç«‹åˆ»æ‰§è¡Œçš„åœºæ™¯ã€‚æ„æ€å°±æ˜¯è¯´éœ€è¦çž¬é—´å®Œæˆçš„å·¥ä½œ âŒ DEFAULT â€”â€” è¿™ä¸ªæˆ‘ä»¬ä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œdispatch_get_global_queueå°±æ˜¯è¿™ä¸€ç­‰çº§ã€‚ UTILITY å¯èƒ½éœ€è¦ç›¸å½“é•¿ä¸€æ®µæ—¶é—´ ä¸éœ€è¦åŠæ—¶å“åº”ï¼Œæ¯”å¦‚ä¸‹è½½æ“ä½œä¹‹ç±»çš„ï¼Œä½†æ˜¯ç”¨æˆ·æ˜¯å¯ä»¥çœ‹è§è¿›åº¦ä¹‹ç±»çš„ BACKGROUND é•¿æ—¶é—´ç±»åž‹ä»»åŠ¡ å®Œå…¨æ˜¯åŽå°æ‰§è¡Œï¼Œç”¨æˆ·ä¸çŸ¥é“è¿›åº¦çš„ âŒ UNSPECIFIED â€”â€” å¼€å‘äººå‘˜æ²¡æœ‰æŒ‡å®šï¼Œç³»ç»Ÿæ ¹æ®æƒ…å†µè¿›è¡Œé€‰å®šQOSç­‰çº§ ä¸Šè¯‰QOSå¯¹åº”OCå‚æ•°å¦‚ä¸‹ï¼š QOS-Class å¯¹åº”OC USER_INTERACTIVE NSQualityOfServiceUserInteractive USER_INITIATED NSQualityOfServiceUserInitiated UTILITY NSQualityOfServiceUtility BACKGROUND NSQualityOfServiceBackground åœ¨dispatch_queueä¸­ï¼Œå¦‚æžœæˆ‘ä»¬æƒ³è¦æŒ‡å®šQOSçš„ç­‰çº§çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°dispatch_queue_attr_make_with_qos_classã€‚åœ¨åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—æ—¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 12dispatch_queue_attr_t attr_qos = dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INTERACTIVE, 0);dispatch_queue_t queue = dispatch_queue_create(&quot;com.example.gcd&quot;, attr_qos); å› ä¸º QOSå¯¹äºŽdispatch_queueæ¥è¯´æ˜¯æ— æ³•å˜æ›´çš„å±žæ€§ï¼Œä»¥è‡´äºŽæˆ‘ä»¬æ— æ³•åŽ»æ›´æ”¹å·²å­˜åœ¨ä»»åŠ¡é˜Ÿåˆ—çš„QOSå±žæ€§ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨dispatch_queue_get_qos_classå‡½æ•°æ¥èŽ·å–ä»»åŠ¡é˜Ÿåˆ—çš„QOSï¼š 123456dispatch_qos_class_t qos_class = dispatch_queue_get_qos_class(the_queue, 0);/// ä¸€èˆ¬ç”¨äºŽ æ ¹æ®å·²çŸ¥é˜Ÿåˆ—æ¥èŽ·å–åŒqosç­‰çº§çš„å…¨å±€ä»»åŠ¡é˜Ÿåˆ—dispatch_get_global_queue(dispatch_queue_get_qos_class(the_queue, nil), 0);/// æˆ–è€…æ˜¯ æ ¹æ®å·²çŸ¥çš„å…¨å±€ä»»åŠ¡é˜Ÿåˆ—æ¥åˆ›å»ºä¸Žå…¶qosç›¸ç­‰çš„ä»»åŠ¡é˜Ÿåˆ—dispatch_queue_t the_global = dispatch_get_global_queue(QOS_CLASS_UTILITY, 0);dispatch_queue_t the_queue = dispatch_queue_create(&quot;com.example.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, dispatch_queue_get_qos_class(the_global, 0), 0)); å½“æˆ‘ä»¬è¦èŽ·å–å…¨å±€é˜Ÿåˆ—æ—¶ï¼Œåœ¨æ­¤ä¹‹å‰å¯ä»¥ä½¿ç”¨DISPATCH_QUEUE_PRIORITY_HIGHã€DISPATCH_QUEUE_PRIORITY_DEFAULTã€DISPATCH_QUEUE_PRIORITY_LOWã€DISPATCH_QUEUE_PRIORITY_BACKGROUNDã€‚çŽ°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨QOSæ¥èŽ·å–ä¸€ä¸ªå…¨å±€çš„å¹¶å‘ä»»åŠ¡é˜Ÿåˆ—ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦æ¥äº†è§£ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å·®å¼‚å’Œå…±æ€§ï¼š ä»¥å‰ çŽ°åœ¨QOS Main Thread QOS_CLASS_USER_INTERACTIVE DISPATCH_QUEUE_PRIORITY_HIGH QOS_CLASS_USER_INITIATED DISPATCH_QUEUE_PRIORITY_DEFAULT QOS_CLASS_DEFAULT DISPATCH_QUEUE_PRIORITY_LOW QOS_CLASS_UTILITY DISPATCH_QUEUE_PRIORITY_BACKGROUND QOS_CLASS_BACKGROUND å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 1dispatch_get_global_queue(QOS_CLASS_USER_INTERACTIVE, 0); é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨dispatch_blockä¸­å¯¹æ¯ä¸€ä¸ªäººä»»åŠ¡å—æ¥è®¾ç½®Qosç­‰çº§ï¼Œè¿™é‡Œæˆ‘å…ˆå°†dispatch_blockæå‡ºæ¥ï¼ŒåŽé¢æˆ‘ä¼šå¯¹å…¶è¿›è¡Œè¾ƒä¸ºè¯¦ç»†çš„è§£é‡Šã€‚ 1234dispatch_block_t the_block = dispatch_block_create_with_qos_class(0, QOS_CLASS_UTILITY, -8, ^&#123; ...&#125;);dispatch_async(the_queue, the_block);///dispatch_sync, dispatch_afterç­‰ç­‰éœ€è¦ç”¨åˆ°dispatch_blockçš„åœ°æ–¹ ä¸‰ã€åˆ›å»ºä»»åŠ¡ å‰é¢ä¸¤ç‚¹è¯´äº†ä»»åŠ¡çš„æ‰§è¡Œåœ°ç‚¹å’Œæ€Žæ ·æ¥åˆ›å»ºå’Œé…ç½®ä»»åŠ¡çš„æ‰§è¡Œåœ°ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»å¾—çŸ¥é“ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿæ€Žä¹ˆåˆ›å»ºä»»åŠ¡ï¼Ÿåœ¨GCDä¸­ä½¿ç”¨blockæ¥ä½œä¸ºä»»åŠ¡æäº¤ç»™ç‰¹å®šçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¾‹å¦‚_dispatch_block_t_æˆ–è€…ç›´æŽ¥æ˜¯ä¸€ä¸ªç®€å•çš„blockã€‚å¯¹äºŽdispatch_block_tç±»åž‹çš„å˜é‡ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—è¦çŸ¥é“æ€Žä¹ˆåŽ»åˆ›å»ºå®ƒã€‚é¦–å…ˆæ ¹æ®æˆ‘ä»¬çš„å°è¯•ï¼ˆä¸‹é¢çš„ä¾‹å­å‡ºè‡ªAppleå®˜æ–¹ï¼‰ï¼Œå¯¹blockè¿›è¡Œç›´æŽ¥èµ‹å€¼ï¼š 123456789101112dispatch_block_t error_block;NSInteger x = 0;if (x) &#123; error_block = ^void(void)&#123; NSLog(@&quot;TRUE&quot;); &#125;;&#125;else&#123; error_block = ^void(void)&#123; NSLog(@&quot;FALSE&quot;); &#125;;&#125;error_block();/// unsafe å®˜ç½‘ä¸­è§£é‡Šåˆ°ï¼šâ€œ ç”±äºŽè¯¥dispatch_block_tå˜é‡æ˜¯åœ¨æ ˆå†…å­˜ä¸Šå£°æ˜Žçš„ï¼Œå¦‚æžœæ‰§è¡Œè¿‡è¯¥å˜é‡ä½œç”¨åŸŸä¹‹åŽå°±æœ‰å¯èƒ½å¯¼è‡´è¯¥å˜é‡è¢«é‡Šæ”¾ â€ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä¸å¾—ä¸æä¸€ä¸‹blockåœ¨MRCå’ŒARCä¸‹çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ç¯‡æµ‹è¯•ï¼Œåœ¨è¿™ç¯‡æµ‹è¯•ä¸­å¾ˆæ˜Žæ˜¾çš„ä¸€ä¸ªç‚¹ä¾¿æ˜¯ï¼šâ€œ MRCä¸­æœ‰NSStackBlockç±»åž‹ï¼ŒNSMallocBlockç±»åž‹ï¼ŒNSGlobalBlockç±»åž‹åŒæ—¶å­˜åœ¨ã€‚ä½†æ˜¯åœ¨ARCä¸­ä¸å†å­˜åœ¨NSStackBlockç±»åž‹ï¼Œè€Œæ˜¯ç›´æŽ¥å£°æ˜Žä¸ºNSMallocBlockç±»åž‹â€ ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ARCä¸­å°±ç®—æ˜¯åœ¨å‡½æ•°æ–¹æ³•ä¸­å£°æ˜Žçš„blockå˜é‡ä¹Ÿæ˜¯è¢«å£°æ˜Žä¸ºNSMallocBlockç±»åž‹ã€‚ NSMallocBlockç±»åž‹å°±ä¸å­˜åœ¨ä¸Šè¯‰å®˜ç½‘ä¸­æåˆ°çš„å˜é‡è¢«æå‰é‡Šæ”¾çš„é—®é¢˜ï¼Œè¿™ä¸€æ­¥æˆ‘å¹¶æ²¡æœ‰åŽ»å®žè·µï¼Œæ‰€ä»¥ä¸Šè¯‰ç»“è®ºæ˜¯å¦ä¸ºçœŸï¼Œæ—¢ç„¶å®˜æ–¹ä¸å»ºè®®è¿™ä¹ˆåšï¼Œé‚£ä¾¿æ”¾å¼ƒä½¿ç”¨è¯¥æ–¹æ³•ã€‚ä½¿ç”¨ä¸€ä¸‹ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºdispatch_block_tå˜é‡ï¼š dispatch_block_create dispatch_block_create_with_qos_class å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šè¯‰ä¸¤ç§æ–¹æ³•æ¥åˆ›å»ºdispatch_block_tå˜é‡æ—¶ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ªä¾¿æ˜¯dispatch_block_flags_tå‚æ•°ã€‚å®ƒæ˜¯ä¸€ä¸ªæžšä¸¾ç±»åž‹ï¼š æžšä¸¾ç±»åž‹ ä½œç”¨ DISPATCH_BLOCK_ASSIGN_CURRENT è¯´æ˜Žè¯¥å—ä¼šè¢«åˆ†é…åœ¨åˆ›å»ºè¯¥å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­ï¼ˆç›´æŽ¥æ‰§è¡Œè¯¥å—å¯¹è±¡æ—¶æŽ¨èä½¿ç”¨ï¼‰ DISPATCH_BLOCK_BARRIER ç±»ä¼¼äºŽåœ¨åšåŒæ­¥æ“ä½œæ—¶çš„barrier DISPATCH_BLOCK_DETACHED è¡¨æ˜Ždispatch_blockä¸Žå½“å‰çš„æ‰§è¡ŒçŽ¯å¢ƒå±žæ€§æ— å…³ DISPATCH_BLOCK_ENFORCE_QOS_CLASS å½“dispatch_blockæäº¤åˆ°é˜Ÿåˆ—æˆ–è€…ç›´æŽ¥æäº¤æ‰§è¡ŒåšåŒæ­¥æ“ä½œæ—¶ï¼Œè¯¥å€¼æ˜¯é»˜è®¤å€¼ DISPATCH_BLOCK_INHERIT_QOS_CLASS å¼‚æ­¥æ‰§è¡Œçš„é»˜è®¤å€¼ï¼Œä¼˜å…ˆçº§ä½ŽäºŽDISPATCH_BLOCK_ENFORCE_QOS_CLASSã€‚å¯ä»¥ç”¨è¯¥å€¼æ¥è¦†ç›–åŽŸæ¥QOSç±» DISPATCH_BLOCK_NO_QOS_CLASS è¡¨æ˜Ždispatch_blockä¸åˆ†é…QOSç±» æ¥åˆ›å»ºdispatch_blockå˜é‡ï¼š 12345678/// ç¬¬ä¸€ç§ä½¿ç”¨QOSçš„æ–¹å¼æ¥åˆ›å»ºdispatch_blockdispatch_block_t task_block = dispatch_block_create_with_qos_class(DISPATCH_BLOCK_INHERIT_QOS_CLASS, QOS_CLASS_USER_INITIATED, -8, ^&#123; NSLog(@&quot;RUN&quot;);&#125;);/// ç›´æŽ¥åˆ›å»ºdispatch_blockdispatch_block_create(DISPATCH_BLOCK_NO_QOS_CLASS, ^&#123; ...&#125;); å¯¹äºŽdispatch_block_create_with_qos_classæ–¹æ³•ä¸­relative_priorityçš„å‚æ•°çš„è§„åˆ™æ˜¯ï¼šrelative_priorityçš„å€¼éœ€è¦åœ¨0åˆ°QOS_MIN_RELATIVE_PRIORITYï¼ˆ-15ï¼‰ä¹‹é—´ã€‚ æˆ‘ä»¬åˆ›å»ºçš„blockä¼šè¢«æ‹·è´åˆ°å †ä¸Šï¼Œå¹¶ç”±dispatch_block_tç±»åž‹çš„å˜é‡æ‰€æŒæœ‰ã€‚åˆ›å»ºå®Œæˆä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æäº¤åˆ°å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ˆä¸‹ä¸€èŠ‚æåˆ°çš„dispatch_asyncç­‰ç­‰å‡½æ•°â€¦ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥åŽ»æ‰§è¡Œï¼ˆæ¯”å¦‚ï¼štask_block()ï¼‰ã€‚ æ—¢ç„¶å¯ä»¥ç›´æŽ¥åŽ»è¾“å…¥ä¸€ä¸ªblockå—ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦åŽ»ä½¿ç”¨dispatch_block_tï¼Ÿå­˜åœ¨å³æœ‰ä»·å€¼ï¼Œé‚£ä¹ˆæœ€æ˜Žæ˜¾çš„ä¼˜åŠ¿ä¾¿æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥å¯¹è¯¥ä»»åŠ¡å—æ‰§è¡Œå–æ¶ˆæ“ä½œï¼ä¾‹å¦‚ï¼š 12345dispatch_block_t task_block = dispatch_block_create_with_qos_class(DISPATCH_BLOCK_INHERIT_QOS_CLASS, QOS_CLASS_USER_INITIATED, -8, ^&#123; NSLog(@&quot;RUN&quot;);&#125;);dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), task_block);dispatch_block_cancel(task_block); ä½†æ˜¯å¦‚æžœdispatch_blockå·²ç»å¼€å§‹æ‰§è¡Œï¼Œä¾¿æ— æ³•å–æ¶ˆè¯¥ä»»åŠ¡çš„æ‰§è¡Œã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œä¸€ç‚¹å°å°çš„ä¿®æ”¹ï¼š 1234567891011dispatch_block_t task_block = dispatch_block_create_with_qos_class(DISPATCH_BLOCK_INHERIT_QOS_CLASS, QOS_CLASS_USER_INITIATED, -8, ^&#123; NSLog(@&quot;RUN&quot;);/// æˆåŠŸæ‰§è¡Œ /// æ¨¡æ‹Ÿä¸€ä¸ªé•¿æ—¶é—´çš„è€—æ—¶ä»»åŠ¡ [NSThread sleepForTimeInterval:3]; NSLog(@&quot;End&quot;);/// æˆåŠŸæ‰§è¡Œ&#125;);dispatch_async(dispatch_get_main_queue(), task_block);dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; /// ä¿è¯dispatch_block_tå·²ç»å¼€å§‹æ‰§è¡Œ dispatch_block_cancel(task_block);&#125;); åœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯æ— æ³•åŽ»å–æ¶ˆå·²ç»æ‰§è¡Œçš„å—ã€‚dispatch_block_testcancelå‡½æ•°çš„ä½œç”¨æ˜¯è®©æˆ‘ä»¬èƒ½å¤ŸçŸ¥é“å½“å‰ä»»åŠ¡å—æ˜¯å¦å·²ç»è¢«å–æ¶ˆã€‚ åœ¨è°ƒç”¨dispatch_block_cancelå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦ç¡®å®šå³å°†è¢«cancleçš„å—æ²¡æœ‰æ•èŽ·ä»»ä½•å…¶ä»–å¤–éƒ¨å˜é‡ï¼Œå¦‚æžœæŒæœ‰å°†ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹dispatch_block_wait å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»¥åŒæ­¥çš„æ–¹å¼æ‰§è¡Œå¹¶ç­‰å¾…ï¼Œå¾—ç­‰å¾…æŒ‡å®šçš„ä»»åŠ¡å—æ‰§è¡Œå®Œæˆä¹‹åŽï¼ŒæŠ‘æˆ–è€…æ˜¯è¶…æ—¶ä¹‹åŽç„¶åŽåŽ»æ‰§è¡Œå½“å‰çº¿ç¨‹çš„åŽç»­ä»»åŠ¡ã€‚å¦‚ä¸‹ï¼š 123456789dispatch_block_t task_block = dispatch_block_create_with_qos_class(DISPATCH_BLOCK_INHERIT_QOS_CLASS, QOS_CLASS_USER_INITIATED, -8, ^&#123; NSLog(@&quot;Start&quot;); [NSThread sleepForTimeInterval:3]; NSLog(@&quot;End&quot;);&#125;);dispatch_async(dispatch_get_main_queue(), task_block);NSLog(@&quot;Before Wait&quot;);dispatch_block_wait(task_block, DISPATCH_TIME_FOREVER);NSLog(@&quot;After Wait&quot;); æ­¤æ—¶è¿è¡Œå¹¶ä¸ä¼šå¾—åˆ°Startã€‚ç”±äºŽdispatch_block_waitå‡½æ•°æ˜¯ä½¿ç”¨çš„åŒæ­¥çš„æ–¹å¼ï¼Œåªè¦æ˜¯åœ¨è¯¥çº¿ç¨‹çš„æ‰§è¡Œæµä¸­ï¼Œå®ƒä¸ç®¡ä½ æ˜¯åŒæ­¥æäº¤è¿˜æ˜¯å¼‚æ­¥æäº¤ï¼ˆè¿™ä¸¤ç§æäº¤æ–¹å¼åœ¨ä¸‹é¢ä¸€èŠ‚é©¬ä¸Šä¼šè®²ï¼‰çš„æ–¹å¼ï¼Œdispatch_block_waitå‡½æ•°å¦‚æžœæ˜¯åœ¨è¢«æ‰§è¡Œçš„blockä¹‹å‰æ‰§è¡Œï¼ŒåŽç»­çš„ä»£ç éƒ½ä¼šè¢«æŒ‚èµ·ï¼Œå¹¶ä¸ä»…ä»…æ˜¯dispatch_block_waitå‡½æ•°åŽçš„ä»£ç ï¼Œä¹ŸåŒ…æ‹¬blockä¸­çš„ä»£ç ã€‚å› æ­¤ä¹Ÿå°±å¯¼è‡´äº†åœ¨åŒä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ˆéƒ½å¤„äºŽmain_queueä¸­ï¼‰çš„dispatch_block_tæ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚è§£å†³åŠžæ³•ä¹Ÿå¾ˆç®€å•ï¼Œç¬¬ä¸€ç§æˆ‘ä»¬å…ˆè®©blockæ‰§è¡Œèµ·æ¥ï¼›ç¬¬äºŒç§æˆ‘ä»¬è®©å®ƒä»¬å¤„åœ¨ä¸åŒé˜Ÿåˆ—ä¸­å³å¯ï¼š 12345678910dispatch_block_t task_block = dispatch_block_create_with_qos_class(DISPATCH_BLOCK_INHERIT_QOS_CLASS, QOS_CLASS_USER_INITIATED, -8, ^&#123; NSLog(@&quot;Start&quot;); [NSThread sleepForTimeInterval:3]; NSLog(@&quot;End&quot;);&#125;);dispatch_queue_t block_queue = dispatch_queue_create(&quot;com.example.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_async(block_queue, task_block);NSLog(@&quot;Before Wait&quot;);dispatch_block_wait(task_block, DISPATCH_TIME_FOREVER);NSLog(@&quot;After Wait&quot;); æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥åšç”±å¼‚æ­¥è½¬åŒæ­¥çš„éœ€æ±‚ï¼ˆåŽé¢è¿˜ä¼šä»‹ç»dispatch_semaphore_tï¼Œå®ƒåŒæ ·å¯ä»¥è¾¾åˆ°è¿™ä¸ªæ•ˆæžœï¼‰ã€‚ æœ€åŽæ¥çœ‹ä¸€ä¸‹å‡½æ•°_dispatch_block_notify_ï¼Œå®ƒçš„ä½œç”¨æ˜¯å½“æŒ‡å®šçš„dispatch_block_tå˜é‡æ‰§è¡Œå®Œäº†ä¹‹åŽï¼Œé€šçŸ¥åˆ°ç»™ç‰¹å®šçš„ä»»åŠ¡é˜Ÿåˆ—ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨block_queueä¸­åŽ»æ‰§è¡Œäº†æˆ‘ä»¬çš„ä»»åŠ¡å—ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦åœ¨å®ƒæ‰§è¡Œå®Œäº†ä»¥åŽåœ¨main_queueä¸­æ¥æ‰§è¡Œç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨main_queueä¸­æ›´æ–°UIç•Œé¢ä¹‹ç±»çš„ï¼š 12345678910dispatch_block_t task_block = dispatch_block_create_with_qos_class(DISPATCH_BLOCK_INHERIT_QOS_CLASS, QOS_CLASS_USER_INITIATED, -8, ^&#123; NSLog(@&quot;Start&quot;); [NSThread sleepForTimeInterval:3]; NSLog(@&quot;End&quot;);&#125;);dispatch_queue_t block_queue = dispatch_queue_create(&quot;com.example.gcd&quot;, dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0));dispatch_async(block_queue, task_block);dispatch_block_notify(task_block, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;Notify&quot;);&#125;); å››ã€å°†ä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ— åœ¨æ–‡ç« çš„æœ€åŽï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€Žæ ·æŠŠå·²ç»åˆ›å»ºå¥½çš„ä»»åŠ¡æäº¤åˆ°ç‰¹å®šçš„ä»»åŠ¡é˜Ÿåˆ—ä¸­åŽ»ï¼å¯¹äºŽæäº¤æ“ä½œä¸»è¦æ¶‰åŠåˆ°çš„å‡½æ•°æœ‰ï¼šdispatch_asyncã€dispatch_syncã€dispatch_block_performã€dispatch_group_asyncã€dispatch_barrier_asyncã€dispatch_barrier_syncã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­å…ˆè®²å‰é¢ä¸‰ä¸ªã€‚å†åŽé¢æ–‡ç« ä¸­è¯¦è§£dispatch_group_tã€dispatch_barrieræ—¶åœ¨è¿›è¡Œå¯¹åº”çš„å­¦ä¹ ã€‚ dispatch_asyncä½¿ç”¨å¼‚æ­¥åœ°æ–¹å¼åŽ»æäº¤ä»»åŠ¡å—ï¼Œä½•ä¸ºå¼‚æ­¥ï¼Ÿå¼‚æ­¥æ–¹æ³•è°ƒç”¨å®ƒé€šè¿‡ä½¿ç”¨ä¸€ç§ç«‹å³è¿”å›žçš„å¼‚æ­¥çš„å˜ä½“å¹¶æä¾›é¢å¤–çš„æ–¹æ³•æ¥æ”¯æŒæŽ¥å—å®Œæˆé€šçŸ¥ä»¥åŠå®Œæˆç­‰å¾…æ”¹è¿›é•¿æœŸè¿è¡Œçš„(åŒæ­¥)æ–¹æ³•ï¼ˆå‡ºè‡ªç»´åŸºç™¾ç§‘ï¼‰ã€‚dispatch_syncä½¿ç”¨åŒæ­¥çš„æ–¹å¼å–æäº¤ä»»åŠ¡å—ã€‚ä¸‹å›¾æ˜¯æ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£æ¥è§£é‡Šäº†ä¸€ä¸‹å¼‚æ­¥å’ŒåŒæ­¥çš„å·®å¼‚æ€§ã€‚ ä¸Šè¯‰å‡½æ•°åˆ†åˆ«æœ‰å¯¹åº”çš„ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯dispatch_async_fã€dispatch_sync_fã€‚å®ƒä»¬ä¸¤ä¸ªå’Œå‰é¢çš„åŒºåˆ«åœ¨äºŽï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¸ä½¿ç”¨blockçš„æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨Cå‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æ¥æ‰§è¡Œä»»åŠ¡ã€‚å®ƒä»¬ä¸­çš„contextæ˜¯ä»¥void *ç±»åž‹çš„å˜é‡ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å…·ä½“å‡½æ•°ã€‚ 123456789101112131415161718/// å¼‚æ­¥ä½¿ç”¨blockdispatch_async(queue, ^&#123; ...&#125;);/// åŒæ­¥ä½¿ç”¨blockdispatch_sync(queue, ^&#123; ...&#125;);/// å¼‚æ­¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆdispatch_async_f(dispatch_get_main_queue(), (__bridge void * _Nullable)(self), task_place);void task_place(void *data)&#123; ...&#125;/// åŒæ­¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆdispatch_sync_f(block_queue, (__bridge void * _Nullable)(self), task_place);void task_place(void *data)&#123; ...&#125; æœ€åŽæˆ‘ä»¬æ¥çœ‹çœ‹æœ¬åº”å±žäºŽdispatch_block_tä¸­åº”è¯¥è®²è§£çš„å‡½æ•°dispatch_block_performï¼Œä½†æ˜¯å®ƒä½œä¸ºä¸€ä¸ªæäº¤ä»»åŠ¡çš„å‡½æ•°ï¼Œæ”¾åœ¨è¿™é‡Œè®²æˆ‘è§‰å¾—è¦æ›´ä¸ºåˆé€‚ä¸€ç‚¹ã€‚å®ƒä¼šåˆ›å»ºä¸€ä¸ªdispatch_block_tå˜é‡ï¼Œå¹¶åœ¨è¯¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»¥åŒæ­¥çš„æ–¹å¼æ¥æ‰§è¡Œblockä¸­çš„å†…å®¹ã€‚ 12345dispatch_block_perform(DISPATCH_BLOCK_BARRIER, ^&#123; NSLog(@&quot;Start&quot;); [NSThread sleepForTimeInterval:3]; NSLog(@&quot;End&quot;);&#125;); ä¸Šé¢çš„ä»£ç ä»¥ä¸‹ä»£ç æ•ˆæžœä¸€æ ·ï¼ˆå–è‡ªAppleå®˜æ–¹æ–‡æ¡£ï¼‰: 123dispatch_block_t b = dispatch_block_create(flags, block);b();Block_release(b); ä½†æ˜¯dispatch_block_performæ–¹æ³•å¯ä»¥ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼æ¥è¿›è¡Œä»¥ä¸Šæ­¥éª¤ï¼Œè€Œä¸éœ€è¦åœ¨å¯¹è±¡åˆ†é…æ—¶å°†blockæ‹·è´åˆ°æŒ‡å®šå †ä¸­ã€‚ åˆ°è¿™é‡ŒæŠŠæœ€åŸºç¡€çš„éƒ¨åˆ†ç®—æ˜¯èµ°äº†ä¸€éï¼Œå¯ä»¥è¯´æ˜¯èµ°äº†æœ€å°çš„ä¸€æ­¥ï¼Œä½†æ˜¯æœ¬æ–‡çš„ç›®çš„æ˜¯åŠ›æ±‚ä»¥æ¸…æ™°åœ°è·¯çº¿æŠŠæ¯ä¸€æ­¥æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†æ·±æŒ–ä¸¥æŸ¥ã€‚åœ¨åŽç»­çš„æ–‡ç« ä¸­ä¼šç»§ç»­ä»‹ç»GCDä¸­çš„å…¶ä»–å‡½æ•°å’Œç›¸å…³çš„ä½¿ç”¨æ–¹æ³•ã€‚ ç›¸å…³é“¾æŽ¥ä»¥æ–‡ç« ä¸­å‡ºçŽ°é¡ºåºï¼š Prioritize Work with Quality of Service Classes Concurrency Programming Guide Objective-C Blocks Quiz Transitioning to ARC Release Notes å¼‚æ­¥è°ƒç”¨]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æœ€å¤§å †ï¼ˆåˆ›å»ºã€åˆ é™¤ã€æ’å…¥å’Œå †æŽ’åºï¼‰]]></title>
      <url>%2F2017%2F05%2F09%2Fdata_struct_max_heap%2F</url>
      <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯æœ€å¤§å †å’Œæœ€å°å †ï¼Ÿæœ€å¤§ï¼ˆå°ï¼‰å †æ˜¯æŒ‡åœ¨æ ‘ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªç»“ç‚¹è€Œä¸”è¯¥ç»“ç‚¹æœ‰å„¿å­ç»“ç‚¹ï¼Œè¯¥ç»“ç‚¹çš„dataåŸŸå€¼éƒ½ä¸å°äºŽï¼ˆå¤§äºŽï¼‰å…¶å„¿å­ç»“ç‚¹çš„dataåŸŸå€¼ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼ˆä¸æ˜¯æ»¡äºŒå‰æ ‘ï¼‰ã€‚ æ³¨æ„åŒºåˆ†é€‰æ‹©æ ‘ï¼Œå› ä¸º_é€‰æ‹©æ ‘ï¼ˆselection treeï¼‰_æ¦‚å¿µå’Œæœ€å°å †æœ‰äº›ç±»ä¼¼ï¼Œä»–ä»¬éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯_â€œæ ‘ä¸­çš„æ ¹ç»“ç‚¹éƒ½è¡¨ç¤ºæ ‘ä¸­çš„æœ€å°å…ƒç´ ç»“ç‚¹â€_ã€‚åŒç†æœ€å¤§å †çš„æ ¹ç»“ç‚¹æ˜¯æ ‘ä¸­å…ƒç´ æœ€å¤§çš„ã€‚é‚£ä¹ˆæ¥çœ‹å…·ä½“çš„çœ‹ä¸€ä¸‹å®ƒé•¿ä»€ä¹ˆæ ·ï¼Ÿï¼ˆæœ€å°å †è¿™é‡Œçœç•¥ï¼‰ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨å¤šä¸ªå­æ ‘ä¸­ï¼Œå¹¶ä¸æ˜¯è¯´å…¶ä¸­ä¸€ä¸ªå­æ ‘çš„çˆ¶ç»“ç‚¹ä¸€å®šå¤§äºŽå¦ä¸€ä¸ªå­æ ‘çš„å„¿å­ç»“ç‚¹ã€‚æœ€å¤§å †æ˜¯æ ‘ç»“æž„ï¼Œè€Œä¸”ä¸€å®šè¦æ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚ æœ€å¤§å †ADTé‚£ä¹ˆæˆ‘ä»¬åœ¨åšæœ€å¤§å †çš„æŠ½è±¡æ•°æ®ç±»åž‹ï¼ˆADTï¼‰æ—¶å°±éœ€è¦è€ƒè™‘ä¸‰ä¸ªæ“ä½œï¼šï¼ˆ1ï¼‰ã€åˆ›å»ºä¸€ä¸ªæœ€å¤§å †ï¼›ï¼ˆ2ï¼‰ã€æœ€å¤§å †çš„æ’å…¥æ“ä½œï¼›ï¼ˆ3ï¼‰ã€æœ€å¤§å †çš„åˆ é™¤æ“ä½œï¼›æœ€å¤§å †ADTå¦‚ä¸‹ï¼š 123456789struct Max_Heap &#123; object: ç”±å¤šä¸ªå…ƒç´ ç»„æˆçš„å®Œå…¨äºŒå‰æ ‘ï¼Œå…¶æ¯ä¸ªç»“ç‚¹éƒ½ä¸å°äºŽè¯¥ç»“ç‚¹çš„å­ç»“ç‚¹å…³é”®å­—å€¼ functions: å…¶ä¸­heapâˆˆMax_Heap,n,max_sizeâˆˆint,Elementä¸ºå †ä¸­çš„å…ƒç´ ç±»åž‹ï¼Œitemâˆˆ Element Max_Heap createHeap(max_size) := åˆ›å»ºä¸€ä¸ªæ€»å®¹é‡ä¸å¤§äºŽmax_sizeçš„ç©ºå † void max_heap_insert(heap, item ,n) := æ’å…¥ä¸€ä¸ªå…ƒç´ åˆ°heapä¸­ Element max_heap_delete(heap,n) := if(heapä¸ä¸ºç©º) &#123;return è¢«åˆ é™¤çš„å…ƒç´  &#125;else&#123;return NULL&#125;&#125;///å…¶ä¸­:=ç¬¦å·ç»„è¯»ä½œâ€œå®šä¹‰ä¸ºâ€ æœ€å¤§å †å†…å­˜è¡¨çŽ°å½¢å¼ æˆ‘ä»¬åªæ˜¯ç®€å•çš„å®šä¹‰äº†æœ€å¤§å †çš„ADTï¼Œä¸ºäº†èƒ½å¤Ÿç”¨ä»£ç å®žçŽ°å®ƒå°±å¿…é¡»è¦è€ƒè™‘æœ€å¤§å †çš„å†…å­˜è¡¨çŽ°å½¢å¼ã€‚ä»Žæœ€å¤§å †çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ä¸ç®¡æ˜¯å¯¹æœ€å¤§å †åšæ’å…¥è¿˜æ˜¯åˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¿è¯æ’å…¥æˆ–è€…åˆ é™¤å®Œæˆä¹‹åŽï¼Œè¯¥äºŒå‰æ ‘ä»ç„¶æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ã€‚åŸºäºŽæ­¤ï¼Œæˆ‘ä»¬å°±å¿…é¡»è¦åŽ»æ“ä½œæŸä¸€ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹ã€‚ ç¬¬ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨é“¾è¡¨çš„æ–¹å¼æ¥å®žçŽ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æŒ‡é’ˆæ¥æŒ‡å‘è¯¥ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ã€‚æ­¤æ—¶å°±åŒ…æ‹¬äº†å·¦å­ç»“ç‚¹æŒ‡é’ˆã€å³å­ç»“ç‚¹æŒ‡é’ˆå’Œçˆ¶ç»“ç‚¹æŒ‡é’ˆï¼Œé‚£ä¹ˆç©ºé“¾çš„æ•°ç›®æœ‰å¯èƒ½æ˜¯å¾ˆå¤§çš„ï¼Œæ¯”å¦‚å¶å­ç»“ç‚¹çš„å·¦å³å­ç»“ç‚¹æŒ‡é’ˆå’Œæ ¹ç»“ç‚¹çš„çˆ¶ç»“ç‚¹æŒ‡é’ˆï¼Œæ‰€ä»¥ä¸é€‰æ‹©è¿™ç§å®žçŽ°æ–¹å¼ï¼ˆå…³äºŽç”¨é“¾è¡¨å®žçŽ°ä¸€èˆ¬äºŒå‰æ ‘æ—¶å¤„ç†å·¦å³å­ç»“ç‚¹æŒ‡é’ˆçš„é—®é¢˜åœ¨çº¿ç´¢äºŒå‰æ ‘ä¸­æœ‰æåŠï¼‰ã€‚ ç¬¬äºŒç§æ–¹å¼ï¼Œä½¿ç”¨æ•°ç»„å®žçŽ°ï¼Œåœ¨äºŒå‰æ ‘è¿›è¡ŒéåŽ†çš„æ–¹æ³•åˆ†ä¸ºï¼šå…ˆåºéåŽ†ã€ä¸­åºéåŽ†ã€åŽåºéåŽ†å’Œå±‚åºéåŽ†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å±‚åºéåŽ†çš„æ–¹å¼å°†äºŒå‰æ ‘ç»“ç‚¹å­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œç”±äºŽæœ€å¤§å †æ˜¯å®Œå…¨äºŒå‰æ ‘ä¸ä¼šå­˜åœ¨æ•°ç»„çš„ç©ºé—´æµªè´¹ã€‚é‚£ä¹ˆæ¥çœ‹çœ‹å±‚åºéåŽ†æ˜¯æ€Žä¹ˆåšçš„ï¼Ÿå¯¹ä¸‹å›¾çš„æœ€å¤§å †è¿›è¡Œå±‚åºéåŽ†ï¼šä»Žè¿™é‡Œå¯ä»¥çœ‹å‡ºæœ€åŽå¾—åˆ°çš„é¡ºåºå’Œä¸Šé¢å›¾ä¸­æ‰€æ ‡çš„é¡ºåºæ˜¯ä¸€æ ·çš„ã€‚ é‚£ä¹ˆå¯¹äºŽæ•°ç»„æˆ‘ä»¬æ€Žä¹ˆæ“ä½œçˆ¶ç»“ç‚¹å’Œå·¦å³å­ç»“ç‚¹å‘¢ï¼Ÿå¯¹äºŽå®Œå…¨äºŒå‰æ ‘é‡‡ç”¨é¡ºåºå­˜å‚¨è¡¨ç¤ºï¼Œé‚£ä¹ˆå¯¹äºŽä»»æ„ä¸€ä¸ªä¸‹æ ‡ä¸ºi(1 â‰¤ i â‰¤ n)çš„ç»“ç‚¹ï¼šï¼ˆ1ï¼‰ã€çˆ¶ç»“ç‚¹ä¸ºï¼š_i / 2ï¼ˆi â‰  1ï¼‰_ï¼Œè‹¥i = 1ï¼Œåˆ™iæ˜¯æ ¹èŠ‚ç‚¹ã€‚ï¼ˆ2ï¼‰ã€å·¦å­ç»“ç‚¹ï¼š_2iï¼ˆ2i â‰¤ nï¼‰_ï¼Œ è‹¥ä¸æ»¡è¶³åˆ™æ— å·¦å­ç»“ç‚¹ã€‚ï¼ˆ3ï¼‰ã€å³å­ç»“ç‚¹ï¼š_2i + 1(2i + 1 â‰¤ n)_ï¼Œè‹¥ä¸æ»¡è¶³åˆ™æ— å³å­ç»“ç‚¹ã€‚ æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©_æ•°ç»„_ä½œä¸ºæœ€å¤§å †çš„å†…å­˜è¡¨çŽ°å½¢å¼ã€‚ åŸºæœ¬å®šä¹‰: 1234567#define MAX_ELEMENTS 20#define HEAP_FULL(n) (MAX_ELEMENTS - 1 == n)#define HEAP_EMPTY(n) (!n)typedef struct &#123; int key;&#125;element;element heap[MAX_ELEMENTS]; ä¸‹é¢æ¥çœ‹çœ‹æœ€å¤§å †çš„æ’å…¥ã€åˆ é™¤å’Œåˆ›å»ºè¿™ä¸‰ä¸ªæœ€åŸºæœ¬çš„æ“ä½œã€‚ æœ€å¤§å †çš„æ’å…¥æœ€å¤§å †çš„æ’å…¥æ“ä½œå¯ä»¥ç®€å•çœ‹æˆæ˜¯â€œç»“ç‚¹ä¸Šæµ®â€ã€‚å½“æˆ‘ä»¬åœ¨å‘æœ€å¤§å †ä¸­æ’å…¥ä¸€ä¸ªç»“ç‚¹æˆ‘ä»¬å¿…é¡»æ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„æ ‡å‡†ï¼Œé‚£ä¹ˆè¢«æ’å…¥ç»“ç‚¹çš„ä½ç½®çš„æ˜¯å›ºå®šçš„ã€‚è€Œä¸”è¦æ»¡è¶³çˆ¶ç»“ç‚¹å…³é”®å­—å€¼ä¸å°äºŽå­ç»“ç‚¹å…³é”®å­—å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åŽ»ç§»åŠ¨çˆ¶ç»“ç‚¹å’Œå­ç»“ç‚¹çš„ç›¸äº’ä½ç½®å…³ç³»ã€‚å…·ä½“çš„ä½ç½®å˜åŒ–ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢æˆ‘ç”»çš„ä¸€ä¸ªç®€å•çš„å›¾ã€‚ 12345678910void insert_max_heap(element item ,int *n)&#123; if(HEAP_FULL(*n))&#123; return; &#125; int i = ++(*n); for(;(i != 1) &amp;&amp; (item.key &gt; heap[i/2].key);i = i / 2)&#123;/// i â‰  1æ˜¯å› ä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶æ²¡æœ‰ä¿å­˜å †ç»“ç‚¹ heap[i] = heap[i/2];/// è¿™é‡Œå…¶å®žå’Œé€’å½’æ“ä½œç±»ä¼¼ï¼Œå°±æ˜¯åŽ»æ‰¾çˆ¶ç»“ç‚¹ &#125; heap[i] = item;&#125; ç”±äºŽå †æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œå­˜åœ¨nä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä»–çš„é«˜åº¦ä¸º:_log2(n+1)_ï¼Œè¿™å°±è¯´æ˜Žä»£ç ä¸­çš„forå¾ªçŽ¯ä¼šæ‰§è¡Œ_O(log2(n))_æ¬¡ã€‚å› æ­¤æ’å…¥å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š_O(log2(n))_ã€‚ æœ€å¤§å †çš„åˆ é™¤æœ€å¤§å †çš„åˆ é™¤æ“ä½œï¼Œæ€»æ˜¯ä»Žå †çš„æ ¹ç»“ç‚¹åˆ é™¤å…ƒç´ ã€‚åŒæ ·æ ¹å…ƒç´ è¢«åˆ é™¤ä¹‹åŽä¸ºäº†èƒ½å¤Ÿä¿è¯è¯¥æ ‘è¿˜æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œæˆ‘ä»¬éœ€è¦æ¥ç§»åŠ¨å®Œå…¨äºŒå‰æ ‘çš„æœ€åŽä¸€ä¸ªç»“ç‚¹ï¼Œè®©å…¶ç»§ç»­ç¬¦åˆå®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰ï¼Œä»Žè¿™é‡Œå¯ä»¥çœ‹ä½œæ˜¯_æœ€å¤§å †æœ€åŽä¸€ä¸ªç»“ç‚¹çš„ä¸‹æ²‰_æ“ä½œã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„æœ€å¤§å †ä¸­æ‰§è¡Œåˆ é™¤æ“ä½œï¼š 1234567è§£ç­”ï¼š1ï¼‰ã€å¯¹äºŽæœ€å¤§å †çš„åˆ é™¤ï¼Œæˆ‘ä»¬ä¸èƒ½è‡ªå·±è¿›è¡Œé€‰æ‹©åˆ é™¤æŸä¸€ä¸ªç»“ç‚¹ï¼Œæˆ‘ä»¬åªèƒ½åˆ é™¤å †çš„æ ¹ç»“ç‚¹ã€‚å› æ­¤åœ¨å›¾aä¸­ï¼Œæˆ‘ä»¬åˆ é™¤æ ¹ç»“ç‚¹20ï¼›2ï¼‰ã€å½“åˆ é™¤æ ¹ç»“ç‚¹20ä¹‹åŽæ˜Žæ˜¾ä¸æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œæ›´ç¡®åˆ‡åœ°è¯´è¢«åˆ†æˆäº†ä¸¤æ£µæ ‘ã€‚3ï¼‰ã€æˆ‘ä»¬éœ€è¦ç§»åŠ¨å­æ ‘çš„æŸä¸€ä¸ªç»“ç‚¹æ¥å……å½“è¯¥æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨(15,2,14,10,1)è¿™äº›ç»“ç‚¹ä¸­ç§»åŠ¨å“ªä¸€ä¸ªå‘¢ï¼Ÿæ˜¾ç„¶æ˜¯ç§»åŠ¨ç»“ç‚¹1ï¼Œå¦‚æžœç§»åŠ¨äº†å…¶ä»–ç»“ç‚¹ï¼ˆæ¯”å¦‚14ï¼Œ10ï¼‰å°±ä¸å†æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘äº†ã€‚4ï¼‰ã€æ­¤æ—¶åœ¨ç»“ç‚¹ï¼ˆ15ï¼Œ2ï¼‰ä¸­é€‰æ‹©è¾ƒå¤§çš„ä¸€ä¸ªå’Œ1åšæ¯”è¾ƒï¼Œå³15 &gt; 1çš„ï¼Œæ‰€ä»¥15ä¸Šæµ®åˆ°ä¹‹å‰çš„20çš„ç»“ç‚¹å¤„ã€‚5ï¼‰ã€åŒç¬¬4æ­¥ç±»ä¼¼ï¼Œæ‰¾å‡ºï¼ˆ14ï¼Œ10ï¼‰ä¹‹é—´è¾ƒå¤§çš„å’Œ1åšæ¯”è¾ƒï¼Œå³14&gt;1çš„ï¼Œæ‰€ä»¥14ä¸Šæµ®åˆ°åŽŸæ¥15æ‰€å¤„çš„ç»“ç‚¹ã€‚6ï¼‰ã€å› ä¸ºåŽŸæ¥14çš„ç»“ç‚¹æ˜¯å¶å­ç»“ç‚¹ï¼Œæ‰€ä»¥å°†1æ”¾åœ¨åŽŸæ¥14æ‰€å¤„çš„ç»“ç‚¹å¤„ã€‚ è¿™å›¾ä¸­æ˜¯ç”¨tempåˆ†åˆ«å’Œå›¾ä¸­çš„maxåšæ¯”è¾ƒï¼Œæ¥çœ‹tempæ˜¯å¦ä¼šä¸‹æ²‰ 12345678910111213141516171819element delete_max_heap(int *n)&#123; int parent, child; element temp, item; temp = heap[(*n)--]; item = heap[1]; parent = 1,child=2; for(;child &lt;= *n; child = child * 2)&#123; if( (child &lt; *n) &amp;&amp; heap[child].key &lt; heap[child+1].key)&#123;/// è¿™ä¸€æ­¥æ˜¯ä¸ºäº†çœ‹å½“å‰ç»“ç‚¹æ˜¯å·¦å­ç»“ç‚¹å¤§è¿˜æ˜¯å³å­ç»“ç‚¹å¤§ï¼Œç„¶åŽé€‰æ‹©è¾ƒå¤§çš„é‚£ä¸ªå­ç»“ç‚¹ child++; &#125; if(temp.key &gt;= heap[child].key)&#123; break; &#125; heap[parent] = heap[child];///è¿™å°±æ˜¯ä¸Šå›¾ä¸­ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ä¸­é»„è‰²éƒ¨åˆ†æ“ä½œ parent = child;/// è¿™å…¶å®žå°±æ˜¯ä¸€ä¸ªé€’å½’æ“ä½œï¼Œè®©parentæŒ‡å‘å½“å‰å­æ ‘çš„æ ¹ç»“ç‚¹ &#125; heap[parent] = temp; return item;&#125; åŒæœ€å¤§å †çš„æ’å…¥æ“ä½œç±»ä¼¼ï¼ŒåŒæ ·åŒ…å«nä¸ªå…ƒç´ çš„æœ€å¤§å †ï¼Œå…¶é«˜åº¦ä¸º:_log2(n+1)_ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºï¼š_O(log2(n))_ã€‚ æ€»ç»“ï¼šç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œåœ¨å·²ç»ç¡®å®šçš„æœ€å¤§å †ä¸­åšåˆ é™¤æ“ä½œï¼Œè¢«åˆ é™¤çš„å…ƒç´ æ˜¯å›ºå®šçš„ï¼Œéœ€è¦è¢«ç§»åŠ¨çš„ç»“ç‚¹ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œè¿™é‡Œæˆ‘è¯´çš„è¢«ç§»åŠ¨çš„å…ƒç´ æ˜¯æŒ‡æœ€åˆçš„ç§»åŠ¨ï¼Œå³æœ€å¤§å †çš„æœ€åŽä¸€ä¸ªå…ƒç´ ã€‚ç§»åŠ¨æ–¹å¼ä¸ºä»Žæœ€å¤§çš„ç»“ç‚¹å¼€å§‹æ¯”è¾ƒã€‚ æœ€å¤§å †çš„åˆ›å»ºä¸ºä»€ä¹ˆè¦æŠŠæœ€å¤§å †çš„åˆ›å»ºæ”¾åœ¨æœ€åŽæ¥è®²ï¼Ÿå› ä¸ºåœ¨å †çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚ä¼šåˆ†åˆ«ç”¨åˆ°æœ€å¤§å †çš„æ’å…¥å’Œæœ€å¤§å †çš„åˆ é™¤åŽŸç†ã€‚åˆ›å»ºæœ€å¤§å †æœ‰ä¸¤ç§æ–¹æ³•ï¼šï¼ˆ1ï¼‰ã€å…ˆåˆ›å»ºä¸€ä¸ªç©ºå †ï¼Œç„¶åŽæ ¹æ®å…ƒç´ ä¸€ä¸ªä¸€ä¸ªåŽ»æ’å…¥ç»“ç‚¹ã€‚ç”±äºŽæ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º_O(log2(n))_ï¼Œé‚£ä¹ˆnä¸ªå…ƒç´ æ’å…¥è¿›åŽ»ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º_O(n * log2(n))_ã€‚ï¼ˆ2ï¼‰ã€å°†è¿™nä¸ªå…ƒç´ å…ˆé¡ºåºæ”¾å…¥ä¸€ä¸ªäºŒå‰æ ‘ä¸­å½¢æˆä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œç„¶åŽæ¥è°ƒæ•´å„ä¸ªç»“ç‚¹çš„ä½ç½®æ¥æ»¡è¶³æœ€å¤§å †çš„ç‰¹æ€§ã€‚çŽ°åœ¨æˆ‘ä»¬å°±æ¥è¯•ä¸€è¯•ç¬¬äºŒç§æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæœ€å¤§å †ï¼šå‡å¦‚æˆ‘ä»¬æœ‰12ä¸ªå…ƒç´ åˆ†åˆ«ä¸ºï¼š 1&#123;79,66,43,83,30,87,38,55,91,72,49,9&#125; å°†ä¸Šè¯‰15ä¸ªæ•°å­—æ”¾å…¥ä¸€ä¸ªäºŒå‰æ ‘ä¸­ï¼Œç¡®åˆ‡åœ°è¯´æ˜¯æ”¾å…¥ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œå¦‚ä¸‹ï¼šä½†æ˜¯è¿™æ˜Žæ˜¾ä¸ç¬¦åˆæœ€å¤§å †çš„å®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©è¯¥å®Œå…¨äºŒå‰æ ‘è½¬æ¢æˆæœ€å¤§å †ï¼æ€Žä¹ˆè½¬æ¢æˆä¸€ä¸ªæœ€å¤§å †å‘¢ï¼Ÿ æœ€å¤§å †æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å…¶å„ä¸ªå­æ ‘éƒ½æ˜¯ä¸€ä¸ªæœ€å¤§å †ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»ŽæŠŠæœ€å°å­æ ‘è½¬æ¢æˆä¸€ä¸ªæœ€å¤§å †ï¼Œç„¶åŽä¾æ¬¡è½¬æ¢å®ƒçš„çˆ¶èŠ‚ç‚¹å¯¹åº”çš„å­æ ‘ï¼Œç›´åˆ°æœ€åŽçš„æ ¹èŠ‚ç‚¹æ‰€åœ¨çš„æ•´ä¸ªå®Œå…¨äºŒå‰æ ‘å˜æˆæœ€å¤§å †ã€‚é‚£ä¹ˆä»Žå“ªä¸€ä¸ªå­æ ‘å¼€å§‹è°ƒæ•´ï¼Ÿ æˆ‘ä»¬ä»Žè¯¥å®Œå…¨äºŒå‰æ ‘ä¸­çš„æœ€åŽä¸€ä¸ªéžå¶å­èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘è¿›è¡Œè°ƒæ•´ï¼Œç„¶åŽä¾æ¬¡åŽ»æ‰¾å€’æ•°ç¬¬äºŒä¸ªå€’æ•°ç¬¬ä¸‰ä¸ªéžå¶å­èŠ‚ç‚¹â€¦ å…·ä½“æ­¥éª¤åœ¨åšæœ€å¤§å †çš„åˆ›å»ºå…·ä½“æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°æœ€å¤§å †åˆ é™¤æ“ä½œä¸­ç»“ç‚¹ä½ç½®äº’æ¢çš„åŽŸç†ï¼Œ_å³å…³é”®å­—å€¼è¾ƒå°çš„ç»“ç‚¹ä¼šåšä¸‹æ²‰æ“ä½œ_ã€‚ 1ï¼‰ã€å°±å¦‚åŒä¸Šé¢æ‰€è¯´æ‰¾åˆ°äºŒå‰æ ‘ä¸­å€’æ•°ç¬¬ä¸€ä¸ªéžå¶å­ç»“ç‚¹87ï¼Œç„¶åŽçœ‹ä»¥è¯¥éžå¶å­ç»“ç‚¹ä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘ã€‚æŸ¥çœ‹è¯¥å­æ ‘æ˜¯å¦æ»¡è¶³æœ€å¤§å †è¦æ±‚ï¼Œå¾ˆæ˜Žæ˜¾ç›®å‰è¯¥å­æ ‘æ»¡è¶³æœ€å¤§å †ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç§»åŠ¨ç»“ç‚¹ã€‚_è¯¥å­æ ‘æœ€å¤§ç§»åŠ¨æ¬¡æ•°ä¸º1_ã€‚ 2ï¼‰ã€çŽ°åœ¨æ¥åˆ°ç»“ç‚¹30ï¼Œæ˜Žæ˜¾è¯¥å­æ ‘ä¸æ»¡è¶³æœ€å¤§å †ã€‚åœ¨è¯¥ç»“ç‚¹çš„å­ç»“ç‚¹è¾ƒå¤§çš„ä¸º72ï¼Œæ‰€ä»¥ç»“ç‚¹72å’Œç»“ç‚¹30è¿›è¡Œä½ç½®äº’æ¢ã€‚_è¯¥å­æ ‘æœ€å¤§ç§»åŠ¨æ¬¡æ•°ä¸º1_ã€‚ 3ï¼‰ã€åŒæ ·å¯¹ç»“ç‚¹83åšç±»ä¼¼çš„æ“ä½œã€‚_è¯¥å­æ ‘æœ€å¤§ç§»åŠ¨æ¬¡æ•°ä¸º1_ã€‚ 4ï¼‰ã€çŽ°åœ¨æ¥åˆ°ç»“ç‚¹43ï¼Œè¯¥ç»“ç‚¹çš„å­ç»“ç‚¹æœ‰{87,38,9}ï¼Œå¯¹è¯¥å­æ ‘åšåŒæ ·æ“ä½œã€‚ç”±äºŽç»“ç‚¹43å¯èƒ½æ˜¯å…¶å­æ ‘ç»“ç‚¹ä¸­æœ€å°çš„ï¼Œæ‰€ä»¥_è¯¥å­æ ‘æœ€å¤§ç§»åŠ¨æ¬¡æ•°ä¸º2_ã€‚ 5ï¼‰ã€ç»“ç‚¹66åŒæ ·æ“ä½œï¼Œ_è¯¥å­æ ‘æœ€å¤§ç§»åŠ¨æ¬¡æ•°ä¸º2_ã€‚ 6ï¼‰ã€æœ€åŽæ¥åˆ°æ ¹ç»“ç‚¹79ï¼Œè¯¥äºŒå‰æ ‘æœ€é«˜æ·±åº¦ä¸º4ï¼Œæ‰€ä»¥_è¯¥å­æ ‘æœ€å¤§ç§»åŠ¨æ¬¡æ•°ä¸º3_ã€‚ è‡ªæ­¤é€šè¿‡ä¸Šè¯‰æ­¥éª¤åˆ›å»ºçš„æœ€å¤§å †ä¸º: æ‰€ä»¥ä»Žä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œè¯¥äºŒå‰æ ‘æ€»çš„éœ€è¦ç§»åŠ¨ç»“ç‚¹æ¬¡æ•°æœ€å¤§ä¸ºï¼š10ã€‚ ä»£ç å®žçŽ°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455void create_max_heap(void)&#123; int total = (*heap).key; /// æ±‚å€’æ•°ç¬¬ä¸€ä¸ªéžå¶å­ç»“ç‚¹ int child = 2,parent = 1; for (int node = total/2;node &gt; 0; node--) &#123; parent = node; child = 2*node; int max_node = 2*parent+1; element temp = *(heap + parent); for(;child &lt;= max_node &amp;&amp; max_node &lt;= total; child = child * 2,max_node = 2*parent+1)&#123; if ((*(heap + child)).key &lt; (*(heap + child + 1)).key) &#123;/// å–å³å­ç»“ç‚¹ child++; &#125; if (temp.key &gt; (*(heap + child)).key) &#123; break; &#125; *(heap + parent) = *(heap + child); parent = child; &#125; *(heap + parent) = temp; &#125;&#125;/** * * @param heap æœ€å¤§å †ï¼› * @param items è¾“å…¥çš„æ•°æ®æº * @return 1æˆåŠŸï¼Œ0å¤±è´¥ */int create_binary_tree(element *heap,int items[MAX_ELEMENTS])&#123; int total; if (!items) &#123; return 0; &#125; element *temp = heap; heap++; for (total = 1; *items;total++,(heap)++,items = items + 1) &#123; element ele = &#123;*items&#125;; element temp_key = &#123;total&#125;; *temp = temp_key; *heap = ele; &#125; return 1;&#125;///å‡½æ•°è°ƒç”¨int items[MAX_ELEMENTS] = &#123;79,66,43,83,30,87,38,55,91,72,49,9&#125;;element *position = heap;create_binary_tree(position, items);for (int i = 0; (*(heap+i)).key &gt; 0; i++) &#123; printf(&quot;binary tree element is %d\n&quot;,(*(heap + i)).key);&#125;create_max_heap();for (int i = 0; (*(heap+i)).key &gt; 0; i++) &#123; printf(&quot;heap element is %d\n&quot;,(*(heap + i)).key);&#125; ä¸Šè¯‰ä»£ç åœ¨æˆ‘æœºå™¨ä¸Šèƒ½å¤ŸæˆåŠŸçš„æž„å»ºä¸€ä¸ªæœ€å¤§å †ã€‚ç”±äºŽè¯¥å®Œå…¨äºŒå‰æ ‘å­˜åœ¨nä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä»–çš„é«˜åº¦ä¸º:_log2(n+1)_ï¼Œè¿™å°±è¯´æ˜Žä»£ç ä¸­çš„forå¾ªçŽ¯ä¼šæ‰§è¡Œ_O(log2(n))_æ¬¡ã€‚å› æ­¤å…¶æ—¶é—´å¤æ‚åº¦ä¸ºï¼š_O(log2(n))_ã€‚ å †æŽ’åº å †æŽ’åºè¦æ¯”ç©ºé—´å¤æ‚åº¦ä¸º_O(n)_çš„å½’å¹¶æŽ’åºè¦æ…¢ä¸€äº›ï¼Œä½†æ˜¯è¦æ¯”ç©ºé—´å¤æ‚åº¦ä¸º_O(1)_çš„å½’å¹¶æŽ’åºè¦å¿«ï¼ é€šè¿‡ä¸Šé¢æœ€å¤§å †åˆ›å»ºä¸€èŠ‚ä¸­æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªæœ€å¤§å †ã€‚å‡ºäºŽè¯¥æœ€å¤§å †å¤ªå¤§ï¼Œæˆ‘å°†å…¶è¿›è¡Œç¼©å°ä»¥ä¾¿è¿›è¡Œç”»å›¾æ¼”ç¤ºã€‚æœ€å¤§å †çš„æŽ’åºè¿‡ç¨‹å…¶å®žæ˜¯å’Œæœ€å¤§å †çš„åˆ é™¤æ“ä½œç±»ä¼¼ï¼Œç”±äºŽæœ€å¤§å †çš„åˆ é™¤åªèƒ½åœ¨æ ¹ç»“ç‚¹è¿›è¡Œï¼Œå½“å°†æ ¹ç»“ç‚¹åˆ é™¤å®Œæˆä¹‹åŽï¼Œå°±æ˜¯å°†å‰©ä¸‹çš„ç»“ç‚¹è¿›è¡Œæ•´ç†è®©å…¶ç¬¦åˆæœ€å¤§å †çš„æ ‡å‡†ã€‚ 1ï¼‰ã€æŠŠæœ€å¤§å †æ ¹ç»“ç‚¹91â€œåˆ é™¤â€ï¼Œç¬¬ä¸€æ¬¡æŽ’åºå›¾ç¤ºï¼šè¿›è¿‡è¿™ä¸€æ¬¡æŽ’åºä¹‹åŽï¼Œ91å°±å¤„åœ¨æœ€ç»ˆçš„æ­£ç¡®ä½ç½®ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¯¹ä½™ä¸‹çš„æœ€å¤§å †è¿›è¡Œæ“ä½œï¼è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼š âš ï¸âš ï¸âš ï¸æ³¨æ„ï¼Œå…³äºŽå¯¹ä½™ä¸‹è¿›è¡Œæœ€å¤§å †æ“ä½œæ—¶ï¼šå¹¶ä¸éœ€è¦åƒåˆ›å»ºæœ€å¤§å †æ—¶ï¼Œä»Žå€’æ•°ç¬¬ä¸€ä¸ªéžå¶å­ç»“ç‚¹å¼€å§‹ã€‚å› ä¸ºåœ¨æˆ‘ä»¬åªæ˜¯å¯¹ç¬¬ä¸€ä¸ªå’Œæœ€åŽä¸€ä¸ªç»“ç‚¹è¿›è¡Œäº†äº¤æ¢ï¼Œæ‰€ä»¥_åªæœ‰æ ¹ç»“ç‚¹çš„é¡ºåºä¸æ»¡è¶³æœ€å¤§å †çš„çº¦æŸï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†å³å¯_ 2ï¼‰ã€ç»§ç»­å¯¹ç»“ç‚¹87è¿›è¡Œç›¸åŒçš„æ“ä½œï¼šåŒæ ·ï¼Œ87çš„ä½ç½®ç¡®å®šã€‚ 3ï¼‰ã€çŽ°åœ¨æˆ‘ä»¬æ¥ç¡®å®šç»“ç‚¹83çš„ä½ç½®ï¼š 4ï¼‰ã€ç»è¿‡ä¸Šè¯‰æ­¥éª¤å°±ä¸éš¾ç†è§£å †æŽ’åºçš„åŽŸç†æ‰€åœ¨ï¼Œæœ€åŽæŽ’åºç»“æžœå¦‚ä¸‹ï¼š ç»è¿‡ä¸Šè¯‰å¤šä¸ªæ­¥éª¤ä¹‹åŽï¼Œæœ€ç»ˆçš„æŽ’åºç»“æžœå¦‚ä¸‹ï¼š 1[38ã€43ã€72ã€79ã€83ã€87ã€91] å¾ˆæ˜Žæ˜¾è¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„ä»Žå°åˆ°å¤§çš„é¡ºåºã€‚ ç¼–ç å®žçŽ°è¿™é‡Œéœ€è¦å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼å› ä¸ºåœ¨æŽ’åºä¸­ï¼Œæˆ‘ä»¬çš„ç¬¬0ä¸ªå…ƒç´ æ˜¯ä¸ç”¨åŽ»æ”¾ä¸€ä¸ªå“¨å…µçš„ï¼Œæˆ‘ä»¬çš„å…ƒç´ ä»ŽåŽŸæ¥çš„ç¬¬ä¸€ä¸ªä½ç½®æ”¹ä¸ºä»Žç¬¬0ä¸ªä½ç½®å¼€å§‹æ”¾ç½®å…ƒç´ ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950void __swap(element *lhs,element *rhs)&#123; element temp = *lhs; *lhs = *rhs; *rhs = temp;&#125;int create_binarytree(element *heap, int items[MAX_SIZE], int n)&#123; if (n &lt;= 0) return 0; for (int i = 0; i &lt; n; i++,heap++) &#123; element value = &#123;items[i]&#125;; *heap = value; &#125; return 1;&#125;void adapt_maxheap(element *heap ,int node ,int n)&#123; int parent = node - 1 &lt; 0 ? 0 : node - 1; int child = 2 * parent + 1;/// å› ä¸ºæ²¡æœ‰å“¨å…µï¼Œæ‰€ä»¥åœ¨æ•°ç»„ä¸­çš„å…³ç³»ç”±åŽŸæ¥çš„ï¼šparent = 2 * child =&gt; parent = 2 * child + 1 int max_node = max_node = 2*parent+2 &lt; n - 1 ? 2*parent+2 : n - 1; element temp = *(heap + parent); for (;child &lt;= max_node; parent = child,child = child * 2 + 1,max_node = 2*parent+2 &lt; n - 1 ? 2*parent+2 : n - 1) &#123; if ((heap + child)-&gt;key &lt;= (heap + child + 1)-&gt;key &amp;&amp; child + 1 &lt; n) &#123; child++; &#125; if ((heap + child)-&gt;key &lt; temp.key) &#123; break; &#125; *(heap + parent) = *(heap + child); &#125; *(heap + parent) = temp;&#125;int create_maxheap(element *heap ,int n)&#123; for (int node = n/2; node &gt; 0; node--) &#123; adapt_maxheap(heap, node, n); &#125; return 1;&#125;void heap_sort(element *heap ,int n)&#123; ///åˆ›å»ºä¸€ä¸ªæœ€å¤§å † create_maxheap(heap, n); ///è¿›è¡ŒæŽ’åºè¿‡ç¨‹ int i = n - 1; while (i &gt;= 0) &#123; __swap(heap+0, heap + i);/// å°†ç¬¬ä¸€ä¸ªå’Œæœ€åŽä¸€ä¸ªè¿›è¡Œäº¤æ¢ adapt_maxheap(heap, 0, i--);///å°†æ€»çš„å…ƒç´ ä¸ªæ•°å‡ä¸€ï¼Œé€‚é…æˆæœ€å¤§å †ï¼Œè¿™é‡Œåªéœ€è¦å¯¹é¦–å…ƒç´ è¿›è¡Œæœ€å¤§å †çš„æ“ä½œ &#125;&#125; è°ƒç”¨ï¼š123456/// å †æŽ’åºint n = 7;int items[7] = &#123;87,79,38,83,72,43,91&#125;;element heap[7];create_binarytree(heap, items, n);heap_sort(heap, n); åœ¨å®žçŽ°å †æŽ’åºæ—¶æœ€éœ€è¦æ³¨æ„çš„å°±æ˜¯å½“æ²¡æœ‰å“¨å…µä¹‹åŽï¼Œçˆ¶ç»“ç‚¹å’Œå·¦å³å­©å­ç»“ç‚¹ä¹‹é—´çš„å…³ç³»å‘ç”Ÿäº†å˜åŒ–ï¼š12parent = 2 * child + 1;///å·¦å­©å­parent = 2 * child + 2;///å³å­©å­ å…³äºŽå¯¹æŽ’åºç›¸å…³çš„çŸ¥è¯†ç‚¹å·²ç»æ•´ç†å®Œäº†ã€‚å…¶æ—¶é—´å¤æ‚åº¦å’Œå½’å¹¶æŽ’åºçš„æ—¶é—´æ—¶é—´å¤æ‚åº¦æ˜¯ä¸€æ ·çš„ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ ˆï¼ˆStackï¼‰å’Œå †ï¼ˆHeapï¼‰]]></title>
      <url>%2F2017%2F03%2F21%2Fstack_heap_with_c%2F</url>
      <content type="text"><![CDATA[ç›®å‰æ¥è¯´æˆ‘ä»¬çŸ¥é“æ€Žä¹ˆåŽ»å£°æ˜Žä¸€ä¸ªåŸºç¡€ç±»åž‹çš„å˜é‡ï¼Œæ¯”å¦‚intï¼Œfloatï¼Œç­‰ç­‰ã€‚ä»¥åŠå¤æ‚æ•°æ®ç±»åž‹æ•°ç»„å’Œç»“æž„ï¼Œå£°æ˜Žå®ƒä»¬çš„æ—¶å€™Cä¼šæŠŠè¿™äº›å˜é‡æ”¾åœ¨æ ˆä¸Šã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªæ ˆï¼Œè€Œç¨‹åºé€šå¸¸åªæœ‰ä¸€ä¸ªå †ã€‚ æ ˆï¼ˆStackï¼‰ ä»€ä¹ˆæ˜¯æ ˆï¼Ÿå®ƒæ˜¯å†…å­˜ä¸­ä¸€å—ç‰¹æ®Šçš„åŒºåŸŸï¼Œç”¨äºŽä¿å­˜åœ¨å‡½æ•°ä¸­å£°æ˜Žçš„é›¶æ—¶å˜é‡ï¼ˆå…¶ä¸­ä¹ŸåŒ…æ‹¬main()å‡½æ•°ï¼‰ã€‚æ ˆæ˜¯LIFO(Last in First Out åŽè¿›å…ˆå‡º)çš„æ•°æ®ç»“æž„ï¼Œè¿›å‡ºæ“ä½œæ˜¯ç”±CPUæ¥ç®¡ç†å’Œä¼˜åŒ–çš„ã€‚æ¯å½“å‡½æ•°å£°æ˜Žäº†ä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡å°±ä¼šè¢«æŽ¨å…¥(Pushed)æ ˆä¸­ã€‚æ¯å½“å‡½æ•°é€€å‡ºæ—¶ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½ä¼šè¢«å‡½æ•°æŽ¨å‡ºæ ˆï¼Œå¹¶è¢«é‡Šæ”¾æŽ‰(Free)ã€‚ä¸€æ—¦å˜é‡è¢«é‡Šæ”¾ï¼Œè¯¥å†…å­˜åŒºåŸŸå°±å¯ä»¥è¢«å…¶ä»–æ ˆå˜é‡ä½¿ç”¨ã€‚ ä½¿ç”¨æ ˆçš„ä¼˜åŠ¿æ˜¯å®ƒä¼šä¸ºä½ ç®¡ç†å†…å­˜ï¼Œè€Œä¸éœ€è¦ä½ æ‰‹åŠ¨åŽ»åˆ†é…æˆ–è€…é‡Šæ”¾å†…å­˜ã€‚æ›´è¿›ä¸€æ­¥è¯´ï¼Œç”±äºŽCPUå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†æ ˆå†…å­˜ï¼Œæ‰€ä»¥ä»Žæ ˆä¸­è¯»å†™å˜é‡æ˜¯å¾ˆå¿«çš„ã€‚ ç†è§£æ ˆçš„å…³é”®æ˜¯éœ€è¦çŸ¥é“å‡½æ•°ä»€ä¹ˆæ—¶å€™é€€å‡ºï¼Œæ­¤æ—¶æ ˆä¸­æ‰€æœ‰çš„å˜é‡è¢«æŽ¨å‡ºï¼Œå› æ­¤æ ˆå˜é‡æ˜¯å±€éƒ¨çš„ï¼ˆä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ï¼‰ã€‚Cä¸­ç»å¸¸å‡ºçŽ°çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯ï¼Œåœ¨å‡½æ•°è¿”å›žä»¥åŽåŽ»è®¿é—®å‡½æ•°å†…éƒ¨ä¸­æ ˆå˜é‡ã€‚ å¦‚æžœä½¿ç”¨å¤ªå¤šçš„æ ˆç©ºé—´ä¼šå¯¼è‡´æº¢å‡ºï¼Œæ¯”å¦‚åœ¨ä½¿ç”¨é€’å½’çš„æ—¶å€™ï¼Œè¯¥å‡½æ•°ä½¿ç”¨äº†å¤ªå¤šçš„å±€éƒ¨å˜é‡åœ¨é€’å½’è¿‡ç¨‹ä¸­å°±æœ‰å¯èƒ½é€ æˆæ ˆæº¢å‡ºã€‚ æ€»ç»“ æ ˆæ˜¯LIFOæ•°æ®ç»“æž„ï¼› CPUç®¡ç†å†…å­˜ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åŽ»ç®¡ç†ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸ªåŽŸå› ä»Žæ ˆä¸­è¯»å†™å˜é‡å¾ˆå¿«çš„ï¼› æ ˆå˜é‡æ˜¯å±€éƒ¨çš„ï¼ˆä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ï¼‰ï¼› æ ˆçš„å®¹é‡ä¼šéšç€å‡½æ•°çš„Pushå’ŒPopå˜åŒ–ï¼› å †ï¼ˆHeapï¼‰ å †ä¹Ÿæ˜¯å†…å­˜ä¸­ä¸€å—ç‰¹å®šåŒºåŸŸï¼Œä½†æ˜¯CPUå¹¶ä¸ä¼šè‡ªåŠ¨ç®¡ç†ç›¸å…³çš„æ“ä½œï¼Œè€Œä¸”å®ƒçš„ç©ºé—´å¤§å°ä¼šæœ‰ä¸€å®šçš„æµ®åŠ¨ã€‚åœ¨å †ä¸Šåˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œåœ¨Cä¸­ä½¿ç”¨malloc()å’Œcalloc()å‡½æ•°ã€‚åœ¨ä¸éœ€è¦å †ä¸Šè¿™å—å†…å­˜ä¹‹åŽï¼Œéœ€è¦ä½¿ç”¨free()å‡½æ•°é‡Šæ”¾æŽ‰å®ƒã€‚å¦‚æžœä¸é‡Šæ”¾çš„è¯å°±ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œè¿™å—å†…å­˜å°±ä¼šè¢«é—²ç½®ã€‚ å’Œæ ˆä¸åŒä¹‹å¤„åœ¨äºŽï¼Œå †å†…å­˜æ•°æ®çš„è¯»å†™é€Ÿåº¦ä¼šæ¯”æ ˆæ…¢ã€‚ æ ˆï¼ˆStackï¼‰å’Œå †ï¼ˆHeapï¼‰çš„å·®å¼‚é…ç½®å †æ ˆå¤§å° å †çš„å¤§å°åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ†é…ï¼Œæ•°å€¼åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ åœ¨Cocoaä¸­æƒ³è¦ä¿®æ”¹çº¿ç¨‹çš„æ ˆå¤§å°çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨NSThreadçš„å®žä¾‹æ–¹æ³•setStackSize:ï¼Œå¦‚æžœä½¿ç”¨POSIXçº¿ç¨‹æŠ€æœ¯åˆ›å»ºçš„çº¿ç¨‹çš„è¯ï¼Œæƒ³è¦è®¾ç½®æ ˆå¤§å°çš„è¯ä½¿ç”¨pthread_attr_setstacksizeå‡½æ•°ã€‚ âš ï¸å¦‚æžœè¦è®¾ç½®æ ˆå¤§å°å°±å¿…é¡»è¦åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹å‰å®Œæˆã€‚ 123456789101112131415/// ç¬¬ä¸€ç§NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(backgroudMethod:) object:nil];[thread setStackSize:1024];[thread start];/// ç¬¬äºŒç§pthread_attr_t attr;pthread_t posix_tread_id;int returnVal;returnVal = pthread_attr_init(&amp;attr);returnVal = pthread_attr_setstacksize(&amp;attr, 1024);/// åœ¨åˆ›å»ºçº¿ç¨‹å‰è®¾ç½®å †æ ˆå¤§å°char *data;data = &quot;To ensure that a thread knows what work to do&quot;;int thread_error = pthread_create(&amp;posix_tread_id, &amp;attr, posix_thread_mainroutine, data); ç”Ÿå‘½å‘¨æœŸ æ ˆæ˜¯å’Œçº¿ç¨‹ç›¸å…³è”çš„ï¼Œæ„æ€å°±æ˜¯è¯´å½“çº¿ç¨‹é€€å‡ºæ—¶ï¼Œæ ˆè¢«å›žæ”¶ã€‚è€Œå †é€šå¸¸æ˜¯åœ¨å¯åŠ¨ç¨‹åºæ—¶åˆ†é…ï¼Œå½“ç¨‹åºé€€å‡ºä¹‹åŽè¢«å›žæ”¶ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ ˆä»€ä¹ˆæ—¶å€™ä½¿ç”¨å † éœ€è¦ç”³è¯·è¾ƒå¤§å†…å­˜ç©ºé—´ï¼ˆæ¯”å¦‚structï¼Œarrayä¹‹ç±»çš„ï¼‰ï¼Œè€Œä¸”éœ€è¦è¯¥å˜é‡å­˜åœ¨è¾ƒé•¿æ—¶é—´ï¼Œå°±æ˜¯å°†è¯¥å˜é‡æ”¾åœ¨å †ä¸­ï¼› å¦‚æžœéœ€è¦åŠ¨æ€ä¿®æ”¹structæˆ–è€…arrayçš„å¤§å°ï¼Œå°†è¯¥å˜é‡æ”¾åœ¨å †ä¸Šã€‚ä½¿ç”¨malloc()ï¼Œcalloc()ï¼Œrealloc()å’Œfree()ç­‰å‡½æ•°æ¥ç®¡ç†å†…å­˜ï¼› å¦‚æžœä½¿ç”¨ç›¸å¯¹è¾ƒå°çš„å˜é‡ï¼Œå¹¶ä¸”åªåœ¨å‡½æ•°ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œæ­¤æ—¶è¯¥å˜é‡å°±å­˜åœ¨äºŽæ ˆä¸Šã€‚è¿™æ ·åšä¼šæ›´å¿«è€Œä¸”æ›´ç®€å•ï¼›]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åŠ¨ç”»ä¸­å…³äºŽKVCå®˜æ–¹æ–‡æ¡£ç¿»è¯‘]]></title>
      <url>%2F2017%2F03%2F08%2Fanimation_kvc_translate%2F</url>
      <content type="text"><![CDATA[CoreAnimationè®©CAAnimationå’ŒCALayeréƒ½éµå®ˆNSKeyValueCodingåè®®ï¼Œå› æ­¤ä¸ºå®ƒä»¬å¢žåŠ äº†ä¸€äº›é»˜è®¤çš„keysï¼ˆå¯¹åº”çš„valueï¼‰ï¼Œæ·»åŠ çš„keyPathä¸­åŒ…å«äº†äº†CGPoint,CGRect,CGSizeå’ŒCATransform3Dç±»åž‹ã€‚ 1.é”®å€¼ç¼–ç å…¼å®¹çš„å®¹å™¨ç±»CAAnimationå’ŒCALayerç±»å°±æ˜¯ä½œä¸ºé”®å€¼ç¼–ç å…¼å®¹çš„å®¹å™¨ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä»»æ„çš„keysæ¥è®¾ç½®å¯¹åº”çš„valueï¼Œå³ä¾¿è¿™ä¸ªkeyä¸æ˜¯CALayerå…¬å¼€çš„å±žæ€§ï¼Œæ¯”å¦‚ï¼š1[theLayer setValue:[NSNumber numberWithInteger:50] forKey:@&quot;someKey&quot;]; åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡ä»»æ„å·²çŸ¥çš„keysæ¥æŸ¥æ‰¾å¯¹åº”çš„valuesï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç é€šè¿‡é¢„å…ˆè®¾ç½®å¥½çš„somekeyæ¥æ£€ç´¢valuesï¼š1someKeyValue=[theLayer valueForKey:@&quot;someKey&quot;]; 2.é»˜è®¤æ”¯æŒçš„valueCoreAnimationåœ¨é”®å€¼ç¼–ç æ—¶è§„å®šï¼šä¸€ä¸ªç±»å¯ä»¥ç»™æ²¡æœ‰valueçš„keyæä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚CAAnimationå’ŒCALayerç±»éƒ½æä¾›äº†ç±»æ–¹æ³•defaultValueForKeyã€‚ å¯¹äºŽä¸ºkeyæä¾›äº†é»˜è®¤valueçš„ç±»ï¼Œåœ¨åˆ›å»ºè¿™ä¸ªç±»çš„å­ç±»æ—¶å¿…é¡»è¦é‡å†™å®ƒçš„defaultValueForKeyæ–¹æ³•ã€‚ å½“ä½ åœ¨å®žçŽ°è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦æ£€æŸ¥keyçš„å‚æ•°åˆ—è¡¨ï¼Œå¹¶ä¸”è¿”å›žä¸€ä¸ªåˆé€‚çš„valueå€¼ï¼Œä¸‹é¢æä¾›äº†ä¸€ä¸ªä¾‹å­ï¼Œlayeræä¾›äº†defaultValueForKey:æ–¹æ³•ï¼Œä¸ºmaskToBoundså±žæ€§è®¾ç½®é»˜è®¤å€¼ï¼š12345+ (id)defaultValueForKey:(NSString *)key&#123; if ([key isEqualToString:@&quot;masksToBounds&quot;]) return [NSNumber numberWithBool:YES]; return [super defaultValueForKey:key];&#125; 3.å°è£…å½“ä¸€ä¸ªkeyçš„æ•°æ®æ˜¯ç”±ä¸€ä¸ªæ ‡é‡å€¼æˆ–è€…ä¸€ä¸ªCçš„æ•°æ®ç»“æž„æ—¶ï¼Œä½ å¿…é¡»è¦åœ¨å…¶è¢«åˆ†é…åˆ°layerä¹‹å‰å¯¹å…¶è¿›è¡Œå°è£…ã€‚åŒæ ·çš„ï¼Œå½“è¦è®¿é—®è¿™äº›Typeæ—¶ï¼Œä¹Ÿå¿…é¡»æ£€æŸ¥å¯¹è±¡ï¼Œç„¶åŽä½¿ç”¨åˆé€‚çš„æ–¹æ³•æ¥æ‰“å¼€åˆé€‚çš„å€¼ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†Objective-cå’Œcç±»åž‹å°è£… C type è¾“å…¥ CGPoint NSValue CGSize NSValue CGRect NSValue CATransform3D NSValue CGAffineTransform NSAffineTransform (OS X only) ä¸åŒç±»åž‹å°è£…çš„ç±» 4.ä¸ºKeyPathçš„æä¾›çš„ç»“æž„CAAnimationå’ŒCALayerç±»ä½¿ç”¨KeyPathæ¥è®¿é—®æŒ‡å®šçš„å­—æ®µï¼Œè¿™åŠŸèƒ½å¯ä»¥è®©ä½ åœ¨åšåŠ¨ç”»æ—¶ä¸ºç‰¹å®šçš„KeyPathæä¾›æ•°æ®ã€‚ä½¿ç”¨setValue:forKeyPathå’ŒvalueForKeyPath:æ–¹æ³•è®¾ç½®ï¼Œç„¶åŽç”¨valueForKeyPath:èŽ·å–ç›¸åº”çš„å€¼ã€‚ (1)ã€CATransform3D KeyPathsä½ å¯ä»¥ä½¿ç”¨æ›´å¼ºå¤§çš„KeyPathï¼ŒæŸ¥æ‰¾åŒ…å«äº†CATransform3Dç±»åž‹å±žæ€§çš„å€¼ã€‚åœ¨éœ€è¦æŒ‡å®šlayerçš„transformså®Œæ•´çš„KeyPathæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸‹è¡¨ä¸­æä¾›çš„æ•°æ®ï¼Œä½¿ç”¨transformå’ŒsublayerTransformçš„å€¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ¶å®šç»•ç€layerçš„zè½´æ—‹è½¬æ—¶ï¼Œæˆ‘å°±éœ€è¦æŒ‡å®šKeyPathä¸ºtransform.rotation.zã€‚ Field Key Path æè¿° rotation.x å›´ç»•Xè½´ï¼Œæ—‹è½¬å€¼ä¸ºå¼§åº¦ï¼ŒNSNumberç±»åž‹ rotation.y å›´ç»•yè½´ï¼Œæ—‹è½¬å€¼ä¸ºå¼§åº¦ï¼ŒNSNumberç±»åž‹ rotation.z å›´ç»•zè½´ï¼Œæ—‹è½¬å€¼ä¸ºå¼§åº¦ï¼ŒNSNumberç±»åž‹ rotation å›´ç»•zè½´ï¼Œæ—‹è½¬å€¼ä¸ºå¼§åº¦ï¼ŒNSNumberç±»åž‹ï¼Œå®ƒå’Œè®¾ç½®rotation.zä¸€æ · scale.x xè½´ç¼©æ”¾ï¼ŒNSNumberç±»åž‹ scale.y yè½´ç¼©æ”¾ï¼ŒNSNumberç±»åž‹ scale.z zè½´ç¼©æ”¾ï¼ŒNSNumberç±»åž‹ scale ä¸‰ä¸ªè½´ç¼©æ”¾çš„å¹³å‡å€¼ï¼ŒNSNumberç±»åž‹ translation.x xè½´ä½ç§»ï¼ŒNSNumberç±»åž‹ translation.y yè½´ä½ç§»ï¼ŒNSNumberç±»åž‹ translation.z zè½´ä½ç§»ï¼ŒNSNumberç±»åž‹ translation xï¼Œyä¸Šé¢ä½ç§»ï¼ŒNSSize å’ŒCGSize ä¸‹é¢å±•ç¤ºäº†æ€Žæ ·é€šè¿‡setValue:forKeyPathæ–¹æ³•æ¥ä¿®æ”¹ä¸€ä¸ªlayerï¼Œè¿™ä¸ªä¾‹å­è®¾ç½®äº†layeråœ¨xè½´ä¸Šä½ç§»äº†10ä¸ªåƒç´ ç‚¹ï¼Œæ¥æ˜¾ç¤ºlayeråœ¨xè½´ä¸Šçš„ç§»åŠ¨:1[myLayer setValue:[NSNumber numberWithFloat:10.0] forKeyPath:@&quot;transform.translation.x&quot;]; âš æ³¨æ„ï¼šé€šè¿‡keyPathæ¥è®¾ç½®valueå€¼çš„æ—¶å€™ä¸èƒ½åƒObjective-Cé‡Œé¢å¯¹å±žæ€§çš„èµ‹å€¼ï¼Œå¿…é¡»é…åˆKeyPathå­—ç¬¦ä¸²ä½¿ç”¨setValue:forKeyPathæ–¹æ³•æ¥è¿›è¡Œèµ‹å€¼ã€‚ (2)ã€CGPoint KeyPathå¦‚æžœå½“å‰ç»™çš„æ˜¯ä¸€ä¸ªCGPointç±»åž‹ï¼Œåˆ™å¯ä»¥æ ¹æ®ä¸‹è¡¨è¿›è¡Œè®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä¿®æ”¹layerçš„positionçš„xå€¼æ—¶ï¼Œå¯ä»¥åœ¨KeyPathä¸­å†™position.xã€‚ Structure Field æè¿° x xçš„åˆ†é‡ y yçš„åˆ†é‡ (3)ã€CGSize KeyPath Structure Field æè¿° width sizeçš„widthå€¼ height sizeçš„heightå€¼ (4)ã€CGRect KeyPathä¾‹å¦‚ï¼Œè¦æ›´æ”¹layerçš„boundså±žæ€§çš„widthå€¼ï¼Œå¯ä»¥å†™å…¥å…³é”®è·¯å¾„bounds.size.width Structure Field æè¿° origin åæ ‡ï¼Œç±»åž‹CGPoint origin.x åæ ‡çš„xå€¼ï¼Œç±»åž‹CGFloat origin.y åæ ‡çš„yå€¼ï¼Œç±»åž‹CGFloat size å¤§å°ï¼Œç±»åž‹CGSize size.width sizeçš„widthå€¼ size.height sizeçš„heightå€¼ ç»“è¯­ç¿»è¯‘è¿™ç¯‡æ–‡ç« çš„ç›®çš„å› ä¸ºæˆ‘åœ¨åšåŠ¨ç”»ä¸­éœ€è¦æ¯æ¬¡éƒ½å·®åˆ°å¯¹åº”çš„KeyPathï¼Œå¾ˆéº»çƒ¦ï¼Œç´¢æ€§æˆ‘å°±å°†å…¶ç¿»è¯‘å‡ºæ¥ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ç‰‡æ–‡ç« å¤§éƒ¨åˆ†ç¿»è¯‘ç®—æ˜¯å®Œæˆäº†ï¼Œçœ‹èµ·æ¥å¾ˆç²—ç³™ï¼Œèƒ½çœ‹æ‡‚å°±æœ€å¥½äº†ã€‚ åŽŸæ¥åœ°å€ï¼šKey-Value Coding Extensions]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Unicodeå’ŒUTF-8ã€UTF-16ä»¥åŠUTF-32]]></title>
      <url>%2F2017%2F03%2F02%2Funicode%2F</url>
      <content type="text"><![CDATA[å†™åœ¨å‰é¢å¦‚æžœä½ æ˜¯iOSå¼€å‘è€…ï¼Œå¹¶ä¸”åœ¨å¤„ç†NSStringå­—ç¬¦ä¸Šé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®åŽ»çœ‹çœ‹Objcä¸­å›½ä¸Šå…³äºŽ NSString ä¸Ž Unicodeã€‚ä¸Šé¢ä»‹ç»äº†ä¸€äº›å…³äºŽNSStringç›¸å…³çš„ä¸œè¥¿ï¼Œæ¯”å¦‚characterAtIndex:è¿”å›žçš„å¯èƒ½æ˜¯åŒ…å«ç»„åˆåºåˆ—ï¼ˆemojiæœ€ä¸ºå¸¸è§ï¼‰ç­‰ç­‰ã€‚ ç®€ä»‹Unicodeå¯¹ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†çš„æ–‡å­—ç³»ç»Ÿè¿›è¡Œäº†æ•´ç†ã€ç¼–ç ï¼Œä½¿å¾—ç”µè„‘å¯ä»¥ç”¨æ›´ä¸ºç®€å•çš„æ–¹å¼æ¥å‘ˆçŽ°å’Œå¤„ç†æ–‡å­—ã€‚è¿™æ˜¯ç»´åŸºç™¾ç§‘å¯¹Unicodeä¸‹çš„å®šä¹‰ã€‚Unicodeçš„å®žçŽ°æ–¹å¼åŒ…å«äº†UTF-8ã€UTF-16ï¼ˆå­—ç¬¦ç”¨ä¸¤ä¸ªå­—èŠ‚æˆ–è€…å››ä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰å’ŒUTF-32ï¼ˆç”¨å››ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼‰ï¼Œä¸‹é¢å¯¹é¢ä¸€ä¸€è¿›è¡Œä»‹ç»ã€‚ UTF-8UTF-8çš„æœ€æ˜Žæ˜¾çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒæ˜¯å˜é•¿çš„ï¼Œå®ƒå¯ä»¥ä½¿ç”¨1åˆ°4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œæ ¹æ®ä¸åŒçš„ç¬¦å·å˜åŒ–å­—èŠ‚é•¿åº¦ã€‚å…ˆæŠŠé˜®ä¸€å³°åœ¨ã€Šå­—ç¬¦ç¼–ç ç¬”è®°ï¼šASCIIï¼ŒUnicodeå’ŒUTF-8ã€‹ä¸­å¯¹UTF-8çš„ç¼–å†™è§„åˆ™çš„ä¸€ä¸ªæ€»ç»“æ”¾å‡ºæ¥ã€‚ ï¸ï¸ï¸UTF-8çš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼Œåªæœ‰äºŒæ¡ï¼š1ã€å¯¹äºŽå•å­—èŠ‚çš„ç¬¦å·ï¼Œå­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º0ï¼ŒåŽé¢7ä½ä¸ºè¿™ä¸ªç¬¦å·çš„unicodeç ã€‚å› æ­¤å¯¹äºŽè‹±è¯­å­—æ¯ï¼ŒUTF-8ç¼–ç å’ŒASCIIç æ˜¯ç›¸åŒçš„ã€‚2ã€å¯¹äºŽnå­—èŠ‚çš„ç¬¦å·ï¼ˆn&gt;1ï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰nä½éƒ½è®¾ä¸º1ï¼Œç¬¬n+1ä½è®¾ä¸º0ï¼ŒåŽé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º10ã€‚å‰©ä¸‹çš„æ²¡æœ‰æåŠçš„äºŒè¿›åˆ¶ä½ï¼Œå…¨éƒ¨ä¸ºè¿™ä¸ªç¬¦å·çš„unicodeç ã€‚ æˆ‘çš„è§£é‡Šï¼šç¬¬ä¸€ä¸ªå­—èŠ‚å‰é¢nä¸ºè®¾1æ˜¯ä¸ºäº†çŸ¥é“å½“å‰å­—ç¬¦å ç”¨å¤šå°‘å­—èŠ‚ï¼Œè€ŒåŽé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸º10ä¸‹é¢ä¼šé©¬ä¸Šè¿›è¡Œè§£é‡Šã€‚çŽ°åœ¨æˆ‘ä»¬æ¥å…·ä½“çš„åˆ†æžä¸€ä¸‹Unicodeçš„ä¸åŒèŒƒå›´ï¼šä¸‹é¢ä¸­å‰ä¸¤ä¸ªæè¿°æ˜¯å¦ä¸ºASCIIï¼ŒåŽä¸¤ä¸ªæè¿°å¤šå­—èŠ‚åºåˆ— U+0000åˆ°U+007Fï¼ˆASCIIï¼‰ä»ŽU+0000åˆ°U+007Fè¢«ç¼–ç ä¸º0x00~0x7Fçš„å•å­—èŠ‚ï¼Œè¿™æ˜¯ASCIIç çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¸€å…±128ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥Unicodeæ˜¯å®Œå…¨ç”¨æ¥å®¹çº³ASCIIçš„ã€‚å¯¹äºŽä¸Šé¢ç»“è®ºä¸­æåˆ°çš„åŽé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º10å› ä¸ºå¿…é¡»è¦å¤§äºŽ7Fæ‰å’ŒASCIIç åˆ†å¼€ã€‚ å¤§äºŽ U+007Fï¼ˆéž ASCIIï¼‰æ‰€æœ‰å¤§äºŽ U+007F çš„å­—ç¬¦è¢«ç¼–ç ä¸ºä¸€ä¸²å¤šå­—èŠ‚åºåˆ—ï¼Œè¿™æ ·å°±å¯ä»¥åŒºåˆ†ä¸€ä¸²å¤šå­—èŠ‚åºåˆ—æ˜¯å¤šå­—èŠ‚ç è¿˜æ˜¯ ASCII ç ã€‚ 0xFE å’Œ 0xFF ä¸ä¼šè¢«ç”¨äºŽ UTF-8 ç¼–ç ä¸­ã€‚ å¤šå­—èŠ‚åºåˆ—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨0xC0~0xFDä¸­ï¼Œå‰©ä½™å­—èŠ‚åœ¨0x80~0xBFå†…ã€‚è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªæ˜¯åœ¨0xC0~0xFDä¸­ï¼Œç†è§£è¿™é‡Œéœ€è¦å†å›žåŽ»çœ‹çœ‹ä¸Šé¢æ³¨æ„ä¸­æåˆ°çš„Unicodeç¼–ç è§„åˆ™ã€‚å› ä¸ºè¡¨ç¤ºçš„æ˜¯å¤šå­—èŠ‚å°±è¡¨æ˜Žnæ˜¯å¤§äºŽ1çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå­—èŠ‚æœ€å°çš„å€¼ä¸ºï¼š11000000å³C0ï¼ˆæ¯å››ä½è¡¨ç¤ºä¸€ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ç¼–ç¨‹çš„æ—¶å€™å–œæ¬¢ç”¨åå…­è¿›åˆ¶æ•°çš„åŽŸå› ï¼‰ï¼Œå¦‚æžœåœ¨æ²¡æœ‰é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¸Šé¢çš„ç»“è®ºæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºçš„æœ€å¤§çš„æ•°æ˜¯0xFEï¼ˆ11111110ï¼‰ï¼Œå°±æ˜¯å‰é¢7ä½è®¾ç½®1æœ€åŽä¸€ä½è®¾ç½®ä¸º0ï¼Œä½†æ˜¯ä¸Šé¢ä¸€æ¡ä¸­æåˆ°ä¸åŒ…å«FEï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æœ€å¤§å€¼ä¸º0xFD(11111101)ã€‚åŒç†å› ä¸ºåŽé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º10æ‰€ä»¥å¤šå­—èŠ‚é™¤äº†ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å…¶ä»–å­—èŠ‚æœ€å¤§å€¼ä¸º10111111(BF)ã€‚ æ€»ç»“UTF-8 ç¼–ç å­—ç¬¦æœ€é•¿å¯è¾¾å…­ä¸ªå­—èŠ‚ 1234567Unicode å­—ç¬¦: UTF-8 ç :U-00000000 - U-0000007F: 0xxxxxxx ///è¡¨ç¤ºASCIIU-00000080 - U-000007FF: 110xxxxx 10xxxxxx ///U-00000800 - U-0000FFFF: 1110xxxx 10xxxxxx 10xxxxxxU-00010000 - U-001FFFFF: 11110xxx 10xxxxxx 10xxxxxx 10xxxxxxU-00200000 - U-03FFFFFF: 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxxU-04000000 - U-7FFFFFFF: 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx ä¸¾ä¸ªä¾‹å­ï¼šæ±‰å­—â€œçŽ‹â€çš„Unicodeç ä¸ºU+73B8è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸º:0111 0011 1010 1000ï¼Œâ€73b8â€ä½äºŽä¸Šé¢çš„ç¬¬ä¸‰ç±»ï¼ŒæŠŠè½¬æ¢çš„16ä¸ªäºŒè¿›åˆ¶ä¾æ¬¡æ”¾å…¥ï¼ˆä¸€å®šæ˜¯ä¾æ¬¡æ”¾å…¥ä¸ç®¡ç©ºæ ¼çš„ï¼‰ä¸Šè¯‰çš„xä¸­ï¼š 123411100111 10001110 10101000/// åŒæ ·æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹é˜®ä¸€å³°ä¸¾ä¾‹çš„â€œä¸¥â€å­—/// 4E25 åŒæ ·å±žäºŽä¸Šè¯‰çš„ç¬¬ä¸‰ç±» ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶ =&gt; 0100 1110 0010 0101/// 11100100 10111000 10100101 å¾—åˆ°çš„ç»“æžœå’Œä»–æ–‡ç« ä¸­çš„ä¸€æ ·ã€‚ åˆ°è¿™é‡Œæˆ‘è‡ªå·±è§‰å¾—åº”è¯¥æ˜¯æŠŠUTF-8çš„ç¼–ç æ–¹å¼è¯´æ¸…æ¥šäº†ï¼Œæœ€åŽå†æ¥ä¸€ä¸ªç¼–ç çš„é¡ºåºï¼ˆå¾ˆé€‚åˆäºŽæˆ‘çš„æ–¹å¼ï¼‰ ç¼–ç çš„é¡ºåºå¯¹äºŽå•å­—èŠ‚ï¼šç›´æŽ¥å°†å…¶è½¬æ¢ä¸ºå…«ä½çš„äºŒè¿›åˆ¶å°±å¯ä»¥äº†ï¼›å¯¹äºŽå¤šå­—èŠ‚ï¼š1.æ‰¾åˆ°Unicodeç å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®2.æŸ¥çœ‹è¯¥Unicodeç åœ¨åˆ†ç±»ä¸­å±žäºŽç¬¬å‡ ç±»3.ä¸€æ¬¡å¡«å…¥äºŒè¿›åˆ¶ç  UTF-16UTF-16æ˜¯Unicodeå­—ç¬¦ç¼–ç äº”å±‚æ¬¡æ¨¡åž‹çš„ç¬¬ä¸‰å±‚ï¼šå­—ç¬¦ç¼–ç è¡¨ï¼ˆCharacter Encoding Formï¼Œä¹Ÿç§°ä¸ºâ€storage formatâ€ï¼‰çš„ä¸€ç§å®žçŽ°æ–¹å¼ã€‚å³æŠŠUnicodeå­—ç¬¦é›†çš„æŠ½è±¡ç ä½æ˜ å°„ä¸º16ä½é•¿çš„æ•´æ•°ï¼ˆå³ç å…ƒï¼‰çš„åºåˆ—ï¼Œç”¨äºŽæ•°æ®å­˜å‚¨æˆ–ä¼ é€’ã€‚è¿™é‡Œéœ€è¦è¯´æ˜Žä¸€ä¸‹åŸºæœ¬å¤šæ–‡ç§å¹³é¢-BMPå’Œè¾…åŠ©å¹³é¢-SMPï¼Œåœ¨ç»´åŸºç™¾ç§‘ä¸­æ¯ä¸€ä¸ªå¹³é¢ç›¸å…³çš„å›¾ç‰‡ä¸‹é¢éƒ½è¯´äº†â€æ¯ä¸ªå†™ç€æ•°å­—çš„æ ¼å­ä»£è¡¨256ä¸ªç ç‚¹â€ï¼Œå³00~FFã€‚ä¾‹å¦‚ï¼šä½äºŽBMPä¸­00æ ¼å­ä¸­çš„ä¸€ä¸ªç ç‚¹è¡¨ç¤ºä¸º:0x00E5ã€‚ä¸‹é¢åŒæ ·ç”¨ä¸€ä¸‹é˜®ä¸€å³°çš„è§„åˆ™æ€»ç»“ï¼š åŸºæœ¬å¹³é¢çš„å­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚ï¼Œè¾…åŠ©å¹³é¢çš„å­—ç¬¦å ç”¨4ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒUTF-16çš„ç¼–ç é•¿åº¦è¦ä¹ˆæ˜¯2ä¸ªå­—èŠ‚ï¼ˆU+0000åˆ°U+FFFFï¼‰ï¼Œè¦ä¹ˆæ˜¯4ä¸ªå­—èŠ‚ï¼ˆU+010000åˆ°U+10FFFFï¼‰ã€‚ ä¸ºäº†èƒ½å¤ŸåŒºåˆ†å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œè¿˜æ˜¯éœ€è¦è·Ÿå…¶ä»–ä¸¤ä¸ªå­—èŠ‚æ”¾åœ¨ä¸€èµ·è§£è¯»ã€‚åœ¨BMPä¸­ï¼Œä»ŽU+D800åˆ°U+DFFFä¹‹é—´BMPçš„åŒºæ®µæ˜¯æ°¸ä¹…ä¿ç•™ä¸æ˜ å°„åˆ°å­—ç¬¦ï¼ˆä»Žç»´åŸºç™¾ç§‘çš„å›¾ä¸­D8~DFä¹‹é—´è¡¨ç¤ºunallocated code pointsï¼‰ã€‚ UTF-16ç»“è®º(D800~DFFF)å…·ä½“æ¥è¯´ï¼Œè¾…åŠ©å¹³é¢çš„å­—ç¬¦ä½å…±æœ‰pow(2,20)ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹åº”è¿™äº›å­—ç¬¦è‡³å°‘éœ€è¦20ä¸ªäºŒè¿›åˆ¶ä½ã€‚UTF-16å°†è¿™20ä½æ‹†æˆä¸¤åŠï¼Œå‰10ä½æ˜ å°„åœ¨U+D800åˆ°U+DBFFï¼ˆç©ºé—´å¤§å°pow(2,10)ï¼‰ï¼Œç§°ä¸ºé«˜ä½ï¼ˆHï¼‰ï¼ŒåŽ10ä½æ˜ å°„åœ¨U+DC00åˆ°U+DFFFï¼ˆç©ºé—´å¤§å°pow(2,10)ï¼‰ï¼Œç§°ä¸ºä½Žä½ï¼ˆLï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œä¸€ä¸ªè¾…åŠ©å¹³é¢çš„å­—ç¬¦ï¼Œè¢«æ‹†æˆä¸¤ä¸ªåŸºæœ¬å¹³é¢çš„å­—ç¬¦è¡¨ç¤ºã€‚1HHHH HHHH HHLL LLLL LLLL ï¸æ³¨æ„-ç»“è®ºé«˜ä½ï¼šD800~DBFF;ä½Žä½ï¼šDC00~DFFF; æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªå­—èŠ‚ï¼Œå‘çŽ°å®ƒçš„ç ç‚¹åœ¨U+D800åˆ°U+DBFFä¹‹é—´ï¼Œå°±å¯ä»¥æ–­å®šï¼Œç´§è·Ÿåœ¨åŽé¢çš„ä¸¤ä¸ªå­—èŠ‚çš„ç ç‚¹ï¼Œåº”è¯¥åœ¨U+DC00åˆ°U+DFFFä¹‹é—´ï¼Œè¿™å››ä¸ªå­—èŠ‚å¿…é¡»æ”¾åœ¨ä¸€èµ·è§£è¯»ã€‚ï¼ˆè¿™é‡Œæˆ‘å°±ç›´æŽ¥å¼•ç”¨é˜®ä¸€å³°çš„è§£é‡Šï¼Œå› ä¸ºä»–è§£é‡Šå¾ˆé€šä¿—æ˜“æ‡‚ã€‚ï¼‰ è§£é‡Šä¸€ä¸‹è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯pow(2,20)ï¼Œåœ¨åŸºæœ¬å¹³é¢ä¹‹å¤–æœ‰16ä¸ªè¾…åŠ©å¹³é¢ï¼ˆå³pow(2,4)ï¼‰ï¼Œè€Œæ¯ä¸€ä¸ªè¾…åŠ©å¹³é¢pow(2,16)ä¸ªç ä½ï¼ˆè¾…åŠ©å¹³é¢å’ŒåŸºæœ¬å¹³é¢ä¸€æ ·ï¼Œæ¯ä¸ªç ä½é‡Œé¢éƒ½åŒ…å«äº†256ä¸ªç ç‚¹ï¼‰ã€‚123///è¾…åŠ©å¹³é¢å­—ç¬¦ï¼Œè½¬ç å…¬å¼ã€‚H = Math.floor((c-0x10000) / 0x400)+0xD800L = (c - 0x10000) % 0x400 + 0xDC00 Hä¸ºä¸Šæ–‡æåˆ°çš„é«˜ä½ï¼ŒLä½ä¸Šæ–‡æåˆ°çš„ä½Žä½ã€‚ä¸¾ä¾‹è¯´æ˜Žä¸€ä¸‹:1234567/// å¯¹äºŽå°äºŽ0xFFFFçš„å³åŸºæœ¬å¹³é¢çš„å­—ç¬¦ï¼Œä¸ºä¸¤ä¸ªå­—èŠ‚U+8D9E = 0x8D9E ///å¯¹åº”çš„äºŒè¿›åˆ¶æ ¼å¼ä¸º:10001101 10011110/// å¯¹å‡ºäºŽè¾…åŠ©å¹³é¢çš„å­—ç¬¦/// å¯¹äºŽU+1D306H = Math.floor((0x1D306-0x10000) / 0x400)+0xD800 = d834L = (0x1D306 - 0x10000) % 0x400 + 0xDC00 = df06 UTF-32å› ä¸ºUTF-32å¯¹æ¯ä¸ªå­—ç¬¦éƒ½ä½¿ç”¨4å­—èŠ‚ï¼Œå°±ç©ºé—´è€Œè¨€ï¼Œæ˜¯éžå¸¸æ²¡æœ‰æ•ˆçŽ‡çš„ã€‚ç‰¹åˆ«åœ°ï¼ŒéžåŸºæœ¬å¤šæ–‡ç§å¹³é¢çš„å­—ç¬¦åœ¨å¤§éƒ¨åˆ†æ–‡ä»¶ä¸­é€šå¸¸å¾ˆç½•è§ï¼Œä»¥è‡´äºŽå®ƒä»¬é€šå¸¸è¢«è®¤ä¸ºä¸å­˜åœ¨å ç”¨ç©ºé—´å¤§å°çš„è®¨è®ºï¼Œä½¿å¾—UTF-32é€šå¸¸ä¼šæ˜¯å…¶å®ƒç¼–ç çš„äºŒåˆ°å››å€ã€‚ ç»“è®ºæ‰€ä»¥å½“æˆ‘ä»¬åœ¨ä½¿ç”¨å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œé€šå¸¸ä½¿ç”¨lengthçš„æ—¶å€™ï¼Œè¦çœ‹ä»–çš„ç¼–ç æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦å°±ä»£è¡¨äº†ä¸€ä¸ªå­—èŠ‚æœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªå­—èŠ‚ã€å››ä¸ªå­—èŠ‚ç”šè‡³å¯èƒ½æœ€å¤šèƒ½åˆ°6ä¸ªå­—èŠ‚éƒ½æ˜¯æœ‰å¯èƒ½çš„ï¼Œè¿™åº”è¯¥å°±èƒ½ç†è§£Swiftä¸­å¯¹äºŽå­—ç¬¦ä¸²çš„å¤„ç†äº†ã€‚ å‚è€ƒæ–‡çŒ®Unicodeä»£ç å›¾è¡¨å­—ç¬¦ç¼–ç ç¬”è®°ï¼šASCIIï¼ŒUnicodeå’ŒUTF-8ä»€ä¹ˆæ˜¯UTF-8Unicodeä¸ŽJavaScriptè¯¦è§£Unicodeç¼–ç åŠå…¶å®žçŽ°ï¼šUTF-16ã€UTF-8ï¼Œand moreUTF-16UTF-32]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Swift3 Unsafe[Mutable]Pointer]]></title>
      <url>%2F2017%2F03%2F02%2Fswift3_pointer%2F</url>
      <content type="text"><![CDATA[è¿™ç¯‡æ–‡ç« æ°´å‡†ä¸é«˜ï¼Œå¯èƒ½å› ä¸ºæˆ‘è‡ªå·±èƒ½åŠ›æœ‰é™ï¼Œè‹±æ–‡æ°´å¹³ä¹Ÿå°±è¿™æ ·ï¼Œè‡ªå·±èƒ½çœ‹æ‡‚ï¼Œå¯èƒ½å­˜åœ¨è¯¯äººå­å¼Ÿçš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥å¦‚æžœæœ‰äººæœ‰æœºä¼šçœ‹åˆ°äº†è¿™è¾¹æ–‡ç« å°±å½“æ˜¯ä¸€ä¸ªå°ç™½çš„å…¥é—¨çº§çš„ç¬”è®°å§ï¼å¦‚æžœéœ€è¦æ›´æ·±å…¥çš„äº†è§£è¯·æŸ¥çœ‹æ–‡æœ«çš„å‚è€ƒé“¾æŽ¥ä¸ºäº†å°†æˆ‘çš„PhotoCutteré€‚é…Swfit3ä¸€çœ‹åˆ°ä¸€å¤§å †çš„Unsafe[Mutable]Pointerçš„é”™è¯¯å°±æ˜¯è„‘å£³ç–¼ï¼æœ€å¤´ç–¼çš„äº‹æ²¡æœ‰æ‰¾åˆ°è¿™æ–¹é¢çš„ä¸­æ–‡èµ„æ–™ï¼Œåªæœ‰è‡ªå·±æ¥å¼„äº†ï¼Œç„¶åŽè®°å½•ä¸€ä¸‹ï¼ŒçŽ°åœ¨é¡¹ç›®è¿˜æ˜¯ç”¨OCï¼Œä¸€å¤©ä¸å†™å°±ç”Ÿç–,æ€•ä»¥åŽæ¥è‡ªå·±åˆå¿˜è®°äº†ï¼Œç„¶åŽè‡ªå·±çºªå½•ä¸€ä¸‹å§â€¦ è¿™é‡Œæˆ‘å…ˆç²—ç•¥åœ°ä»‹ç»ï¼š1.æˆ‘çš„ç†è§£:UnsafeMutablePointerå…¶å®žå°±æ˜¯UnsafePointerçš„å¯ä»¥å˜åŒ–çš„ç±»åž‹ï¼Œä½†æ˜¯UnsafePointeråˆä¸å…è®¸ä½ åŽ»æ”¹å˜æŒ‡é’ˆå…ƒç´  2.Unsafe[Mutable]RawPointer:åœ¨swift3ä»¥å‰ä¸ºUnsafe[Mutable]Pointer&lt;Void&gt;,ä¹Ÿå°±æ˜¯cä¸­çš„void * 3.Unsafe[Mutable]BufferPointerè¡¨ç¤ºä¸€è¿žä¸²çš„æ•°ç»„æŒ‡é’ˆ withUnsafePointer/withUnsafeMutablePointeræ¯”å¦‚ä¸‹é¢æˆ‘ç”¨cçš„æ–¹å¼åˆ›å»ºå’Œé”€æ¯äº†ä¸€ä¸ªintåž‹çš„æŒ‡é’ˆa: int \*a = malloc(sizeof(int)); \*a = 10; free(a) å‡è®¾åœ¨swiftä¸­`var a:Int = 10`,çŽ°åœ¨æˆ‘ä»¬çš„ç›®çš„æ˜¯æƒ³åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆa,æˆ‘ä»¬éœ€è¦å°†`a`è½¬æˆ`*a`ï¼Œæˆ‘ä»¬éœ€è¦æ€Žä¹ˆåšå‘¢ï¼Ÿè¿™é‡Œå¯ä»¥ç”¨åˆ°`withUnsafePointer/withUnsafeMutablePointer` è¿™ä¸¤ä¸ªå‡½æ•°ä¼šä»¥swiftç±»åž‹å’Œä¸€ä¸ªblockä¸ºå‚æ•°ï¼Œè€Œè¿™ä¸ªç›®çš„æŒ‡é’ˆå°±æ˜¯è¿™ä¸ªblockçš„å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ æƒ³å°†æŸä¸€ä¸ªswiftç±»åž‹çš„å‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªæŒ‡é’ˆresultï¼Œè¿™ä¸ªresultå°±æ˜¯ä½ æƒ³èŽ·å¾—çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢ä¸¤ä¸ªä¾‹å­ä¸­çš„ptrï¼Œå¸Œæœ›æˆ‘è¿™ä¸ªæè¿°æ²¡æœ‰æŠŠä½ ç»•æ™•ï¼ è¿™é‡Œæˆ‘ä¹Ÿä»¥swift.orgä¸Šé¢çš„socketä¾‹å­æ¥å†™å§! var addrin = sockaddr_in() åˆ›å»ºUnsafeMutablePointer withUnsafeMutablePointer(to: &addrin) { ptr in //ptr:UnsafeMutablePointer\ } åˆ›å»ºUnsafePointer withUnsafePointer(to: &addrin) { ptr in //ptr: UnsafePointer\ } withUnsafeBytes/withUnsafeMutableBytesé€šè¿‡withUnsafeBytes/withUnsafeMutableBytesèŽ·å¾—çš„bytesåªèƒ½åœ¨åœ¨å‡½æ•°closureé‡Œé¢è¿›è¡Œä½¿ç”¨ï¼Œè¿™ä¸ªå‡½æ•°åªç›¸å¯¹äºŽDataç±»åž‹æ¥èŽ·å–bytesä½¿ç”¨ï¼ func unsafebytes() { guard let data = ".".data(using: .ascii) else{ return } data.withUnsafeBytes { (byte:UnsafePointer) -> Void in print(byte) } } unsafebytes() withMemoryReboundæˆ‘ä»¬å¯ä»¥ä½¿ç”¨withMemoryReboundå‡½æ•°ï¼Œæ¥å°†ä¸€ä¸ªç±»åž‹çš„æŒ‡é’ˆè½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªç±»åž‹çš„æŒ‡é’ˆï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„ç‚¹ï¼Œåœ¨[UnsafeRawPointer Migration] (1)çš„ä»‹ç»ä¸­è¯´åˆ°:Conversion from UnsafePointer&lt;T&gt; to UnsafePointer&lt;U&gt; has been disallowedï¼Œæ‰€ä»¥åªèƒ½å°†UnsafePointer&lt;Int&gt;è½¬æ¢ä¸ºUnsafeMutablePointer&lt;UInt8&gt;. UnsafePointer -&gt; UnsafeMutablePointer var a = 10 withUnsafePointer(to: &a) { a_pt in a_pt.withMemoryRebound(to: UInt8.self, capacity: 1, { a_pt_uint8 in //a_pt_uint8:UnsafeMutablePointer }) } å…·ä½“çš„ä½¿ç”¨åœºæ™¯:åœ¨ä½¿ç”¨socketçš„æ—¶å€™éœ€è¦bindæˆ–è€…connectçš„æ—¶å€™è¿™ä¸ªå‡½æ•°çš„å…·ä½“ä½¿ç”¨åœºæ™¯åœ¨[UnsafeRawPointer Migration] (1)ä¸­ä¹Ÿæœ‰æåˆ°ã€‚sockaddr_in ï¼&gt; sockaddr var addrin = sockaddr_in() let sock = socket(PF_INET, SOCK_STREAM, 0) let result = withUnsafePointer(to: &addrin) { $0.withMemoryRebound(to: sockaddr.self, capacity: 1) { connect(sock, $0, socklen_t(MemoryLayout.stride)) } } assumingMemoryBoundå°†UnsafeRawPointerè½¬æ¢ä¸ºUnsafePointer&lt;T&gt;ç±»åž‹ï¼Œä¹Ÿå°±æ˜¯swift3ä¹‹å‰çš„UnsafePointer&lt;Void&gt;åˆ°UnsafePointer&lt;T&gt;ã€‚è¿™ä¸ªå’Œå‰é¢æåˆ°çš„å‡½æ•°withMemoryReboundçš„åŒºåˆ«å°±æ˜¯: assumingMemoryBoundå¯ä»¥çœ‹æˆæ˜¯withMemoryReboundçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå³:assumingMemoryBoundä¸ºUnsafePointer&lt;Void&gt;åˆ°UnsafePointer&lt;T&gt;ï¼ŒwithMemoryReboundä¸ºUnsafePointer&lt;U&gt;åˆ°UnsafeMutablePointer&lt;T&gt; ä»£ç ç¤ºä¾‹: let strPtr = UnsafeMutablePointer\.allocate(capacity: 1) let rawPtr = UnsafeRawPointer(strPtr) let intPtr = rawPtr.assumingMemoryBound(to: Int.self) bindMemoryç»‘å®šä¸€ä¸ªç±»åž‹\åˆ°å·²ç»è¢«åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œè¿”å›žä¸€ä¸ªç»‘å®šåœ¨selfå†…å­˜ä¸ŠUnsafePointer&lt;T&gt;çš„æŒ‡é’ˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯ç”¨äºŽUnsafe[Mutable]RawPointerã€‚ /// - Precondition: The memory is uninitialized. /// - Postcondition: The memory is bound to 'T' starting at `self` continuing /// through `self` + `count` * `MemoryLayout.stride` /// - Warning: Binding memory to a type is potentially undefined if the /// memory is ever accessed as an unrelated type. æ“ä½œ å†…å­˜çŠ¶æ€ ç±»åž‹ rawptr = allocate() uninitialized None tptr = rawptr.bindMemory(T) uninitialized bound to T tptr.initialize() initialized bound to T ä»Žä¸Šé¢çš„è¡¨æ ¼ç»“åˆæ–‡æ¡£é‡Œé¢å¯¹äºŽbindMemoryçš„è¯´æ˜Žæ¥çœ‹ï¼Œæˆ‘å¯¹äºŽbindMemoryçš„ç†è§£å°±æ˜¯ï¼Œä½¿ç”¨å‡½æ•°ä¹‹å‰è¿™å—å†…å­˜ç©ºé—´æ˜¯æ²¡æœ‰è¢«åˆå§‹åŒ–çš„ï¼Œä½¿ç”¨bindMemoryçš„ç›®çš„æ˜¯å°†Tç»‘å®šåˆ°selfåŽé¢self + count MemoryLayout&lt;T&gt;.strideé•¿åº¦çš„çš„è¿™å—å†…å­˜ç©ºé—´ä¸Šæ¥ã€‚ä½†æ˜¯ç»‘å®šä¸Šæ¥å¹¶ä¸ä»£è¡¨åˆå§‹åŒ–äº†ï¼Œæ­¤æ—¶è¿™ä¸ªå†…å­˜ç©ºé—´ä»ç„¶æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥æœ€åŽéœ€è¦è°ƒç”¨å‡½æ•°initializeçš„å‡½æ•°æ¥åˆå§‹åŒ–!ç”¨è¿™ä¸ªå‡½æ•°åŒæ ·å¯ä»¥æŠŠ`void `çš„Cç±»åž‹è½¬æ¢ä¸ºSwiftçš„ç±»åž‹ã€‚å…³äºŽCustom memory allocationè¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨å¯èƒ½ä¼šæœ‰é—®é¢˜â€¦å…ˆä¸Šä¸€æ®µæˆ‘è‡ªå·±ç†è§£çš„ä»£ç å§ let a = 100 let a_rawptr = UnsafeMutableRawPointer.allocate(bytes: MemoryLayout\.size, alignedTo: MemoryLayout\.alignment) let bind_rawptr = a_rawptr.bindMemory(to: Int.self, capacity: MemoryLayout\.stride) bind_rawptr.initialize(to: a) unsafeBitCastè¿”å›žä¸€ä¸ªç¿»è¯‘æˆæŸä¸€ç‰¹å®šç±»åž‹çš„å€¼ï¼,è¿™ä¸ªä¼šç ´åSwiftçš„ç±»åž‹ç³»ç»Ÿï¼ ç‰¹åˆ«æ³¨æ„ï¸:ä¸åˆ°ä¸‡ä¸å¾—å·²ä¸è¦ä½¿ç”¨è¿™ä¸ªå‡½æ•° å®žæˆ˜PhotoCutterä¸ºäº†é€‚é…Swift3ï¼Œè¿™å…¶ä¸­å¤§éƒ¨åˆ†å’ŒæŒ‡é’ˆç›¸å…³çš„ä¸œè¥¿éœ€è¦é€‚é…ï¼Œæˆ‘å¼€å§‹çœ‹åˆ°è¿™äº›ä¹Ÿæ˜¯æ‡µé€¼çš„ï¼Œæ ¹æœ¬ä¸æ‡‚æ€Žä¹ˆæ”¹ï¼Œåªæœ‰è‡ªå·±åŽ»æ…¢æ…¢å­¦ã€‚æˆ‘çš„æ–¹æ³•å¯èƒ½å¾ˆå·®ï¼Œå°±ç›®å‰è€Œè¨€æ˜¯é€‚é…äº†ï¼Œä¸‹é¢è´´ä¸Šæˆ‘çš„ä¿®æ”¹çš„ä»£ç å§! Swift2.x options = CFDictionaryCreate(kCFAllocatorDefault, UnsafeMutablePointer(UnsafePointer(keys)), UnsafeMutablePointer(UnsafePointer(values)), 2, &kcKeysBack, &kcValuesBack) Swift3.0 fileprivate func buffer(to type:T.Type, source:[T]) -> UnsafeMutablePointer{ var buffer = UnsafeMutablePointer.allocate(capacity: source.count) for idx in 0..]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åˆ›å»ºä¸€ä¸ªæ›´è½»çš„ViewController]]></title>
      <url>%2F2017%2F03%2F02%2Flight_viewcontroller%2F</url>
      <content type="text"><![CDATA[çŽ°åœ¨çš„é¡¹ç›®è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œä¸€ä¸ªæŽ§åˆ¶å™¨çš„ä»£ç é‡è¶Šæ¥è¶Šå¤šï¼Œä¸šåŠ¡æœ€ç¹é‡çš„ä¸€ä¸ªæŽ§åˆ¶å™¨ä»£ç é‡å·²ç»è¾¾åˆ°äº†1000å¤šè¡Œï¼è¿™å°±å¯¼è‡´ç»™æŽ§åˆ¶å™¨ç˜¦èº«æ˜¯ä¸€å®šè¦åšçš„ã€‚è¯´å®žè¯è¿™ç§çš„æ˜¯å¾ˆä¸å¥½ç»„ç»‡è¯­è¨€çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æŒ‰ç…§æƒ¯ä¾‹è¿˜æ˜¯åœ¨è¿™é‡Œæ¥è®°å½•ä¸€ä¸‹è‡ªå·±æƒ³æ³•ç»åŽ†å’Œç»“æžœã€‚ æ³¨æ„:æ–‡ä¸­ä¼šåŒæ—¶å‡ºçŽ°Swiftä»£ç å’Œobjcä»£ç ï¼Œå‡ºçŽ°è¿™ä¸ªçš„åŽŸå› æ˜¯ä¸ºäº†æ¼”ç¤ºé’ˆå¯¹ä½¿ç”¨AFè¿›è¡Œç½‘ç»œè¯·æ±‚å’Œæ•°æ®å¤„ç†ï¼Œå°±ç”¨äº†å…¶ä»–å·¥ç¨‹çš„ä»£ç æ¥è¿›è¡Œæ¼”ç¤ºã€‚æ ·ä¾‹å·¥ç¨‹æ˜¯ç”¨Swiftå†™çš„æ²¡æœ‰é›†æˆAFåº“ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯Swiftçš„ä»£ç åŒæ ·é€‚ç”¨äºŽobjcï¼Œè¿™é‡Œå¤§å¤šçš„ç®¡ç†ç±»éƒ½æ˜¯ç»§æ‰¿è‡ªNSObjectï¼Œå¸Œæœ›è§è°…å§ã€‚ ç›®æ ‡çŽ°åœ¨æˆ‘ä»¬çš„ç›®çš„æ˜¯æ¥åˆ†ç¦»ä¸€ä¸ªç™»å½•é¡µé¢çš„Controllerã€‚æˆ‘å…ˆæŠŠè¿™ä¸ªç•Œé¢çš„æ•ˆæžœå›¾æ”¾å‡ºæ¥ åˆ†æžè¿™ä¸ªé¡µé¢æ¯”è¾ƒç®€å•ï¼Œä¸€ä¸ªç®€å•çš„è¾“å…¥ç”¨æˆ·åç§°å’Œå¯†ç ï¼Œç„¶åŽç™»å½•ç»™å‡ºæ­£ç¡®è¿˜æ˜¯é”™è¯¯çš„ç»“æžœï¼è¿™é‡Œéœ€è¦ç®€å•å¤„ç†ä¸€ä¸‹ç”¨æˆ·åå¯†ç çš„è¾“å…¥æƒ…å†µæ¥ç»å¯¹æŒ‰é’®çš„é¢œè‰²çš„äº¤äº’æƒ…å†µã€‚æˆ‘å°†ä¸€ä¸ªä¸šåŠ¡åœºæ™¯è¿›è¡Œåˆ’åˆ†å¯ä»¥åˆ†ä¸ºä»¥ä¸‹5ä¸ªï¼š 1.æŽ§åˆ¶å™¨ â€”â€”â€”-Controller2.è§†å›¾ â€”â€”â€”â€”-ViewOperator3.ç½‘ç»œè¯·æ±‚â€”â€”-Request4.æ•°æ®å¤„ç†â€”â€”-DataManager5.åè®®ä»£ç†â€”â€”-Delegate èŒè´£åˆ’åˆ†1.æŽ§åˆ¶å™¨(Controller)æŽ§åˆ¶å™¨çš„èŒè´£éœ€è¦ç»Ÿè°ƒè§†å›¾(ViewOperator),ç½‘ç»œè¯·æ±‚(Request),æ•°æ®å¤„ç†(DataManager),ä»£ç†åè®®(Delegate)ä»¥åŠä¸åŒæŽ§åˆ¶å™¨ä¹‹é—´çš„è”ç³»ã€‚ 2.è§†å›¾(ViewOperator)ViewOperatorçš„ä½œç”¨æ˜¯å°†æŽ§åˆ¶å™¨é‡Œé¢ä¸Žè§†å›¾ç›¸å…³çš„æ“ä½œå‰¥ç¦»å‡ºæ¥ã€‚åŒæ—¶ä¹ŸåŒ…æ‹¬äº†æŒ‰é’®çš„ç‚¹å‡»ã€‚ 3.åè®®ä»£ç†(Delegate)å‰¥ç¦»å‡ºcontrollerä¸­çš„delegateçš„å›žè°ƒï¼Œæ¯”å¦‚ç™»å½•ç•Œé¢UITextFieldçš„ç›¸å…³ä»£ç†æ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯TableViewçš„delegateå’ŒdataSourceçš„åˆ†ç¦»ã€‚ 4.ç½‘ç»œè¯·æ±‚(Request)åˆ†ç¦»æŽ§åˆ¶å™¨ä¸­çš„ç½‘ç»œè¯·æ±‚éƒ¨åˆ†ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªåŒ…å«äº†tableViewçš„ç•Œé¢ï¼Œæ•°æ®åŠ è½½ï¼Œä¸‹æ‹‰åˆ·æ–°ï¼Œä¸Šæ‹‰åŠ è½½çš„ç›¸å…³æ–¹æ³•. 5.æ•°æ®å¤„ç†(DataManager)åœ¨ç½‘ç»œè¯·æ±‚å®Œæˆçš„å›žè°ƒï¼Œå›žè°ƒå›žæ¥çš„æ•°æ®æ˜¯ä¸éœ€è¦æ”¾åœ¨ç½‘ç»œè¯·æ±‚é‡Œé¢åŽ»åšçš„ï¼Œæ‰€ä»¥å°†ç½‘ç»œè¯·æ±‚æ•°æ®å›žè°ƒæ”¾åœ¨DataManagerä¸­æ¥ã€‚æ•°æ®å¤„ç†å®Œæˆæ˜¯éœ€è¦ç»™Controllerä¸€ä¸ªæ•°æ®å›žè°ƒçš„ã€‚ ç¬¬ä¸€æ­¥æ¥åˆ†ç¦»Controllerä¸­çš„è§†å›¾é€šå¸¸è§†å›¾ç›¸å…³çš„æ“ä½œå¦‚æžœéƒ½æ”¾åœ¨Controllerä¼šäº§ç”Ÿå¾ˆå¤šè¡Œçš„ä»£ç çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°†æŽ§åˆ¶å™¨å’Œè§†å›¾ç›¸å…³æ“ä½œåˆ†ç¦»å‡ºæ¥ã€‚åœ¨ä½¿ç”¨StoryBoardæ¥åˆ›å»ºä¸€ä¸ªViewControlleræ—¶ï¼Œéœ€è¦åœ¨æŽ§åˆ¶å™¨ä¸­æ‹–ä¸€äº›button,label,textfieldç­‰ç­‰æŽ§ä»¶ï¼Œè¿™äº›æŽ§ä»¶çš„å®šåˆ¶ä»¥åŠäº¤äº’ç­‰ç­‰éƒ½è¦æ‹–å‡ºä»£ç è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘å¯ä»¥ç»™å½“å‰æŽ§åˆ¶å™¨çš„Sceneæ·»åŠ ä¸€ä¸ªobject ç„¶åŽè‡ªå®šä¹‰ä¸ªLoginViewOperatoræ¥ç»§æ‰¿è‡ªNSObjectï¼Œå°†è¿™ä¸ªobjectçš„CustomClassæ”¹ä¸ºLoginViewOperatorã€‚æ­¤æ—¶ä½ å¯ä»¥å°†ä¸Šè¯‰çš„æŽ§ä»¶éƒ½æ‹–åˆ°è¿™ä¸ªclassé‡Œé¢ï¼Œæ¯”å¦‚: public class LoginViewOperator:NSObject{ @IBOutlet var fields: [UITextField]! @IBOutlet weak var login_btn: UIButton! @IBOutlet weak var indicator: UIActivityIndicatorView! @IBAction func login(_ sender: UIButton) { } } åŒæ—¶æˆ‘ä¹Ÿå¯ä»¥ç›´æŽ¥å°†LoginViewOperatoræ‹–åˆ°Controllerä¸­ï¼Œæ¥è®©Controlleræ¥ç®¡ç†LoginViewOperator `ã€‚ class LoginViewController { @IBOutlet var view_operator: LoginViewOperator! } å¦‚æžœæœ‰è‡ªå®šä¹‰è§†å›¾çš„è¯ï¼Œè‡ªå®šä¹‰è§†å›¾çš„ç›¸å…³æ“ä½œå¯ä»¥æ”¾åœ¨è¿™ä¸ªç±»ä¸­åŽ»åšï¼Œæˆ–è€…å¯ä»¥ç»™è¿™ä¸ªè§†å›¾æ·»åŠ ä¸€ä¸ªhelper(CustomViewHelper)é€šè¿‡ä»–æ¥åšè‡ªå®šä¹‰è§†å›¾çš„ç›¸å…³æ“ä½œ ç¬¬äºŒæ­¥æ¥åˆ†ç¦»Controllerä¸­çš„ä»£ç†åè®®åŠ å…¥åœ¨ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ä¸­æœ‰ä¸€ä¸ªtableViewï¼Œæˆ–è€…textfieldï¼Œæˆ–è€…å…¶ä»–çš„ç³»ç»Ÿçš„æŽ§ä»¶ç­‰ç­‰ï¼Œå’Œä»–ä»¬æ‰“äº¤é“è‚¯å®šéœ€è¦å›žè°ƒçš„ï¼ŒæŠŠè¿™äº›æ”¾åœ¨æŽ§åˆ¶å™¨ä¸­ä¹Ÿæ˜¯å¾ˆå ä½ç½®çš„ï¼Œå¿…é¡»å°†ä»–ä»¬åˆ†ç¦»å‡ºæ¥ã€‚åœ¨å½“å‰åœºæ™¯ä¸»è¦æ˜¯UITextFieldDelegateçš„åˆ†ç¦»ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿è‡ªNSObject,å¹¶è®©ä»–éµå®ˆUITextFieldDelegateã€‚ public class EDLoginTextFieldDelegate:NSObject{ public var textdidChange:((UITextField)->Void)? } extension EDLoginTextFieldDelegate:UITextFieldDelegate{ public func textFieldDidChange(_ textField: UITextField){ textdidChange?(textField) } public func textFieldShouldReturn(_ textField: UITextField) -> Bool { return true } public func textField(_ textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -> Bool { return true } } ä¸Šé¢æ–¹æ³•ä¸­textFieldDidChangeæ˜¯é€šè¿‡åœ¨LoginViewOperatorä¸­çš„UITextFieldæ·»åŠ çš„target-actionçš„ï¼Œè¿™ä¸ªä¼šåœ¨æŽ¥ä¸‹æ¥è®²åˆ°ã€‚æ­¤æ—¶åœ¨LoginViewOperatoræ–°å»ºä¸€ä¸ªå˜é‡delegate: lazy var delegate:EDLoginTextFieldDelegate = EDLoginTextFieldDelegate().then{ //text did change $0.textdidChange = {[unowned self] in //åœ¨è¿™é‡Œå¤„ç†å½“textfieldåœ¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§†å›¾éœ€è¦åšå‡ºçš„æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢gifä¸­é€šè¿‡åˆ¤æ–­è¾“å…¥æ¡†ä¸­æ˜¯å¦æœ‰å€¼æ¥æ”¹å˜buttonçš„alphaå’Œenableçš„æ“ä½œ } //text did end //text did begin } åŒæ—¶å°†delegateèµ‹å€¼ç»™UITextFieldçš„delegateï¼Œä¿®æ”¹ä¸Šé¢outletå‡ºæ¥çš„fieldså˜é‡ï¼š @IBOutlet var fields: [UITextField]!{ didSet{ fields.forEach{ $0.delegate = delegate //ç»™æ¯ä¸€ä¸ªfieldéƒ½æ·»åŠ ä¸€ä¸ªtarget-actionï¼Œè¿™ä¸ªactionä¸è¦å†™åœ¨`LoginViewOperator`ä¸­ï¼Œå› ä¸ºè¿™ä¸ªå®žé™…ä¸Šå’Œdelegateæ˜¯ç±»ä¼¼çš„ï¼Œä¸æ˜¯ä¸€ä¸ªè§†å›¾æ“ä½œï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç»•äº†ä¸€åœˆåœ¨delegateçš„textdidChangeè¿›è¡Œäº†å›žè°ƒã€‚ $0.addTarget(delegate, action: #selector(delegate.textFieldDidChange(_:)), for: .editingChanged) } if let username = User.mine.name{ fields.first?.text = username } } } ä¸Šé¢å°±æ˜¯æˆ‘åœ¨åˆ†ç¦»ä¸€ä¸ªUITextFieldDelegateæ‰€åšçš„æ“ä½œã€‚åœ¨è¿™é‡Œçœ‹æ¥é¢å¤–æ·»åŠ çš„è¿™ä¸ªdelegateå¯èƒ½å¤šæ­¤ä¸€ä¸¾ï¼Œå› ä¸ºæ“ä½œç›¸å¯¹æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯å¦‚æžœæ˜¯åœ¨tableViewä¸­çš„è¯ï¼Œä½ éœ€è¦åœ¨numberOfSections,numberOfRowsInSection,cellForRowAtä»¥åŠwillDisplayCellä¸­éœ€è¦å†™ä¸€å¤§å †çš„é€»è¾‘ï¼Œåœ¨è¿™é‡Œå°±ä¼šä½“çŽ°å‡ºåè®®ä»£ç†çš„åˆ†ç¦»å¸¦æ¥çš„å¥½å¤„ã€‚ åœ¨è¿™é‡Œå»ºè®®ï¼šå¦‚æžœåœ¨ä½¿ç”¨æ•°æ®å›žè°ƒçš„æ—¶å€™å¯ä»¥ä½¿ç”¨delegateè€Œä¸æ˜¯blockï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ”¾åœ¨controllerä¸­çš„blockä»£ç åˆ†ç¦»åˆ°CustomDelegateä¸­æ¥ï¼ŒåŽé¢åœ¨åˆ†ç¦»æ•°æ®å¤„ç†éƒ¨åˆ†ä¼šç”¨åˆ°delgateã€‚ ç¬¬ä¸‰æ­¥æ¥åˆ†ç¦»Controllerä¸­çš„ç½‘ç»œè¯·æ±‚è¿™ä¸€æ­¥æˆ‘ç”¨objcçš„ä»£ç æ¥è¿›è¡Œè®²è§£ï¼Œå› ä¸ºåœ¨æ ·ä¾‹å·¥ç¨‹æ˜¯æ²¡æœ‰æ¶‰åŠåˆ°ç½‘ç»œè¯·æ±‚çš„ï¼Œæ‰€ä»¥æˆ‘å°†æˆ‘ä»¬å…¬å¸é¡¹ç›®çš„ä¸­çš„ç½‘ç»œè¯·æ±‚éƒ¨åˆ†çš„åˆ†ç¦»ä»£ç è´´å‡ºæ¥ã€‚åŒæ ·æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»DailyProhRequstæ¥ç»§æ‰¿äºŽNSObjectï¼Œè¯¥ç±»åˆ†ç¦»æŽ§åˆ¶å™¨çš„ç½‘ç»œè¯·æ±‚ã€‚ @interface DailyProhRequst : NSObject @end å¹¶ä¸ºDaulyProhRequstæ·»åŠ ä¸‰ä¸ªæ–¹æ³•: ä¸‹æ‹‰åŠ è½½ + (NSInteger)headerRefresh:(NSDictionary *)para currentPage:(NSInteger)page dataOperator:(DailyProhDataOperator *)operators; ä¸Šæ‹‰åˆ·æ–°çš„ç½‘ç»œæ“ä½œ + (NSInteger)footerRefresh:(NSDictionary *)para currentPage:(NSInteger)page dataOperator:(DailyProhDataOperator *)operators; ç®€å•çš„æ•°æ®åŠ è½½ + (NSInteger)reloadData:(NSDictionary *)para currentPage:(NSInteger)page dataOperator:(DailyProhDataOperator *)operators;å¦‚æžœéœ€è¦ä¸Šæ‹‰åŠ è½½ä¸‹æ‹‰åˆ·æ–°æ•°æ®è¯·æ±‚ä¹‹ç±»çš„ï¼Œå¯ä»¥ç›´æŽ¥è°ƒç”¨ä¸Šé¢ä¸Šä¸ªæ–¹æ³•ä¸­çš„ä¸€ä¸ªï¼Œåœ¨ä¸Šé¢æ–¹æ³•ä¸­è¿˜æåˆ°äº†dataOperatorï¼Œå®ƒæ˜¯ç”¨æ¥æ•´ç†æ•°æ®çš„ï¼Œè¿™éƒ¨åˆ†æ”¾åˆ°åŽé¢æ¥è®²ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•åªè¿›è¡Œç½‘ç»œå¹¶æŠŠæ•°æ®ä¼ ç»™dataOperatorï¼Œrequestå¯¹controlleræ˜¯æ²¡æœ‰å›žè°ƒçš„ï¼åœ¨ä¸Šé¢çš„åˆ†ç¦»è§†å›¾éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç™»å½•æŒ‰é’®çš„@IBActionæ”¾åœ¨äº†LoginViewOperatorä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªæŒ‰é’®äº‹ä»¶å›žè°ƒç»™æŽ§åˆ¶å™¨ã€‚å…¶å®žä¸¥è°¨æ¥è®²ï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰å¿…è¦å°†æŒ‰é’®çš„IBActionæ”¾åœ¨è§†å›¾ä¸­æ¥çš„ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„å¤±è¯¯ã€‚æ‰€ä»¥åœ¨æŽ§åˆ¶å™¨ä¸­ç‚¹å‡»æŒ‰é’®è¿›è¡Œä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æ“ä½œå°±æ˜¯[DailyProhRequst headerRefresh:@{} currentPage:weakSelf.currentPage dataOperator:weakSelf.dataOperator]ï¼Œç½‘ç»œè¯·æ±‚çš„åˆ†ç¦»ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ã€‚ ç¬¬å››æ­¥åˆ›å»ºæ•°æ®æ“ä½œç±»æ¥ç®¡ç†æ•°æ®åŒä¸Šé¢ä¸€æ ·é€‚ç”¨objcçš„ä»£ç è¿›è¡Œè®²è§£ã€‚è¿™é‡Œæ•°æ®å¯ä»¥åˆ†ä¸ºç½‘ç»œè¯·æ±‚è¿”å›žçš„æ•°æ®å’ŒæŠ½å–æœ¬åœ°dbçš„æ•°æ®ï¼Œæˆ‘ä¸»è¦è®²ä¸€ä¸‹é€šè¿‡ç½‘ç»œèŽ·å–æ•°æ®è¿›è¡Œæ•°æ®å¤„ç†çš„æ•°æ®ç®¡ç†ç±»ã€‚é¦–å…ˆæˆ‘ä»¬åŒæ ·éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥ç»§æ‰¿è‡ªNSObjectï¼Œå¹¶æ·»åŠ ä¸€ä¸ªæ–¹æ³•ä»ŽRequstä¸­èŽ·å–åŽŸå§‹çš„ç½‘ç»œæ•°æ®: @interface DailyProhDataOperator : NSObject @end åŒæ—¶æˆ‘ä»¬ç»™DailyProhDataOperatorç±»æ·»åŠ ä¸€ä¸ªèŽ·å–æ•°æ®çš„æ–¹æ³•- (void)fetchData:(id)responseobject requstFailed:(NSError *)error;è€Œä¸”æˆ‘ä»¬çš„ç›®çš„æ˜¯å¿…é¡»è¦å°†å¤„ç†å¥½çš„æ•°æ®ï¼ˆå¯èƒ½æ˜¯ä½ è‡ªå·±å®šä¸€ä¸ªæ•°æ®æ¨¡åž‹ï¼‰è¿”å›žç»™Controlleræ¥æ›´æ–°Viewï¼ˆç”±ViewOperatoræ¥æ›´æ–°æ“ä½œï¼‰,æ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªdelegateï¼š @protocol DailyProhDataOperatorHandler @end å¹¶ç»™åè®®æ·»åŠ ä¸¤ä¸ªå›žè°ƒæ–¹æ³•- (void)dataOperatorSuccess:(DailyProhDataModel *)dataSource;- (void)dataOperatorFailed:(NSError *)error;ç„¶åŽç»™DailyProhDataOperatorç±»æ·»åŠ ä¸€ä¸ªä»£ç†å±žæ€§@property (weak ) id&lt;DailyProhDataOperatorHandler&gt; handler;å¹¶åœ¨ç½‘ç»œè¯·æ±‚åˆ†ç¦»ä¸­çš„æ–¹æ³•ä¸­è¿›è¡Œä¿®æ”¹: +(NSInteger)reloadData:(NSDictionary *)para currentPage:(NSInteger)page dataOperator:(DailyProhDataOperator *)operators{ //åœ¨ç½‘ç»œè¯·æ±‚æˆ–è€…å¤±è´¥çš„å›žè°ƒä¸­æ·»åŠ æ•°æ®å¤„ç†ç±»çš„å…¥å£ //[operators fetchData:responseObject requstFailed:nil]; return 0; } åœ¨DataOperatorä¸­è¿›è¡Œæ•°æ®å¤„ç†å®Œæˆçš„å›žè°ƒ[self.handler dataOperatorSuccess:data];è¿™ä¸ªdelegateå¯ä»¥é€šè¿‡ä¸Šé¢å·²ç»è®²è¿‡çš„åè®®ä»£ç†åˆ†ç¦»æ”¾åœ¨CustomDelegateçš„ç±»ä¸­ï¼Œç”±CustomDelegateå’ŒViewOperatorè¿›è¡Œé€šä¿¡æ¥è¾¾åˆ°æ ¹æ®æ•°æ®æ¥ä¿®æ”¹è§†å›¾çš„æ•ˆæžœã€‚ ç»“æžœè™½ç„¶åœ¨æ ·ä¾‹å·¥ç¨‹ä¸­æ²¡æœ‰ç½‘ç»œè¯·æ±‚çš„éƒ¨åˆ†ï¼Œä½†æ˜¯å®žé™…ä¸Šç½‘ç»œè¯·æ±‚åœ¨æŽ§åˆ¶å™¨ä¸­æ‰€å çš„ä»£ç å°±ä»…ä»…ä¸€ä¸ªè·³è½¬ç›¸å…³çš„é€»è¾‘çš„ä»£ç è€Œå·²ï¼Œæ‰€ä»¥ç»è¿‡ä¸Šè¯‰çš„æ–¹å¼å¯¹controllerè¿›è¡Œç˜¦èº«ä¹‹åŽï¼Œä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½çš„ç™»å½•ç•Œé¢ä»£ç é‡ä¸ºï¼š å›¾ä¸­çš„requestæ˜¯æˆ‘æ¨¡æ‹Ÿçš„ä¸€ä¸ªå‡çš„ç½‘ç»œè¯·æ±‚ã€‚ æ€»ç»“é€šè¿‡ä¸Šè¯‰çš„æ–¹å¼å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šå°†æŽ§åˆ¶å™¨ä»£ç è¿›è¡Œç¼©å‡ï¼Œè€Œä¸”æŒ‡è´£åˆ’åˆ†ä¹Ÿå¾ˆæ˜Žç¡®ã€‚æœ€åŽæ¥è¯´ä¸€ä¸‹ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼š Controller &lt;-&gt; ViewOperatoré€šè¿‡ViewOperatorä¿®æ”¹è§†å›¾ï¼ŒControllerç›¸å…³äº¤äº’ä¹‹åŽé€šè¿‡ViewOperatoræ¥è¿›è¡Œç•Œé¢æ›´è¡Œ Controller &lt;-&gt; Delegateç”±delegateæ¥åˆ†æ‹…Controllerä¸­çš„ç›¸å…³ä»£ç†åè®®çš„å·¥ä½œï¼ŒåŒ…æ‹¬ä»Ždelegateæ‹¿å–æ•°æ®ç­‰ç­‰ï¼Œ Controller &lt;-&gt; Requstç”±Controlleræ¥å‘èµ·Requst Requst &lt;-&gt; DataOperatorDataOperatorä»ŽRequestèŽ·å–æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ•´ç† Delegate &lt;-&gt; DataOperatorDataOperatoræŠŠæ•´ç†å¥½çš„æ•°æ®è¿”å›žç»™Delegate Delegate &lt;-&gt; ViewOperatorDelegateæŠŠæ•°æ®ä¼ ç»™ViewOperatorä¹‹åŽï¼Œç”±ViewOperatoræ›´æ–°è§†å›¾ è¿™ä¸ªåªæ˜¯ç½—åˆ—å‡ºäº†åœ¨å½“å‰ä¸šåŠ¡é€»è¾‘ä¸‹é¢ä»–ä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼Œåªæ˜¯ä¸ºäº†æ¢³ç†ä¸€ä¸‹æ€è·¯ï¼Œåœ¨ä¸åŒçš„é€»è¾‘ä¸‹æœ‰ä¸åŒçš„ç»„åˆï¼Œä½†æ˜¯ä¸€ä¸ªä¸šåŠ¡åœºæ™¯åœ¨ä»£ç å®žçŽ°å±‚é¢å¯ä»¥å¤§ä½“åˆ†æˆäº”ç§æˆ–è€…æ›´å¤šçš„ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[BLUEPILLåœ¨é¡¹ç›®ä¸­çš„å®žè·µ]]></title>
      <url>%2F2017%2F03%2F02%2Fbluepill%2F</url>
      <content type="text"><![CDATA[Bluepillå€ŸåŠ©äºŽCoreSimulatorè§£å†³ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜ã€‚ä½¿ç”¨CoreSimulatorå®žçŽ°äº†å°†Bluepillä»ŽXcodeæ¨¡æ‹Ÿå™¨ä¸­éš”ç¦»å‡ºæ¥ï¼Œå¹¶ä½¿Bluepillå¯å¹¶è¡Œä½¿ç”¨å¤šç§æ¨¡æ‹Ÿå™¨è¿è¡Œæµ‹è¯•ã€‚è¿™é‡ŒXcodeæ¨¡æ‹Ÿå™¨æ˜¯ä¸€ç§éšæ¯æ¬¡Xcodeçš„æ›´æ–°è€Œä¸æ–­è¿›åŒ–çš„é»‘ç›’ã€‚ï¼ˆæ¥è‡ªInfoQä»‹ç»bluepillæ—¶çš„ä¸€æ®µè¯ï¼‰ åœ¨bluepillçš„Releaseå¯ä»¥ä¸‹è½½åˆ°çš„åŽ‹ç¼©åŒ…è§£åŽ‹ï¼Œç„¶åŽåœ¨ç»ˆç«¯ä¸­æ•²å…¥å‘½ä»¤: ./bluepill -a ./Sample.app -s ./SampleAppTestScheme.xcscheme -o ./output/ å¾ˆç®€å•ï¼Œå¯¹äºŽè¿™æœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œæˆ‘ä»¬åªéœ€è¦æœ‰.appå’Œ.xcschemeè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œç„¶åŽå°†ä¸Šé¢ä¸‹è½½ä¸‹æ¥çš„åŽ‹ç¼©åŒ…è§£åŽ‹ä¹‹åŽçš„ä¸¤ä¸ªæ–‡ä»¶æ”¾åœ¨æ°å½“çš„ä½ç½®ï¼Œåº”è¯¥å°±å¯ä»¥äº†ã€‚å¦‚æžœçœŸçš„æ˜¯è¿™æ ·ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„ä»·å€¼äº†ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­å°†è¦åšä¸‹é¢è¿™å‡ ä»¶äº‹ï¼š Xcodeå·¥ç¨‹é¡¹ç›®ç»“æž„ä½“ç³»ï¼› å¦‚ä½•èŽ·å–ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæ–‡ä»¶å¹¶ä½¿ç”¨ä¸Šé¢è¿™ä¸ªæœ€ç®€å•å‘½ä»¤è·‘èµ·æ¥ï¼ˆæ˜¯å¦åŒ…å«äº†Testï¼Œå¦‚æžœæ²¡æœ‰éœ€è¦æ·»åŠ Testï¼‰ï¼› Xcodeä¸­Testçš„åŸºæœ¬æ“ä½œï¼› ç›¸å…³å‚æ•°è¯´æ˜Žï¼› å½“å‰çŽ¯å¢ƒ:macOS Sierra ç‰ˆæœ¬ 10.12.3Xcode Version 8.2.1åœ¨æˆ‘ä½¿ç”¨bluepillæ—¶ï¼Œå®ƒåªèƒ½åœ¨iOS 10.2çŽ¯å¢ƒä¸‹è¿è¡Œï¼ŒæŸ¥çœ‹Xcodeæ”¯æŒçš„æ¨¡æ‹Ÿå™¨ç‰ˆæœ¬:xcrun simctl list runtimes å®žè·µå‰éœ€è¦çŸ¥é“çš„æ¦‚å¿µä¸‹é¢ä»‹ç»çš„è¿™å‡ ä¸ªæ¦‚å¿µåœ¨Apple Developeréƒ½å¯ä»¥æ‰¾åˆ°ï¼Œæˆ‘ä»…ä»…æŠŠæˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰ç”¨çš„ä¿¡æ¯ç½—åˆ—å‡ºæ¥ä¸€ä¸‹ã€‚æ›´å¤šå…³äºŽè®¾ç½®å’Œä½¿ç”¨æ–¹é¢æˆ‘åœ¨æ–‡æœ«åˆ—å‡ºæ¥äº†ï¼Œå¯ä»¥è‡ªå·±æŸ¥çœ‹ï¼ Xcode Project projectåŒ…å«äº†éœ€è¦æž„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰çš„æ–‡ä»¶ï¼Œèµ„æºå’Œç›¸å…³ä¿¡æ¯ï¼Œè€Œworkspaceæ˜¯èƒ½å¤ŸåŒ…å«å¤šä¸ªprojectçš„ã€‚ æ³¨æ„ä¸€ä¸ªprojectæ˜¯å¯ä»¥åŒ…å«å¤šä¸ªtargetsçš„ï¼ æ¯ä¸ªprojectéƒ½å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤çš„build settingsã€‚å› ä¸ºæ¯ä¸ªprojectåŒ…å«äº†å¤šä¸ªtargetsï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªtargetsè®¾ç½®ä¸åŒçš„build settingsï¼ˆåœ¨æ–‡æ¡£ä¸­ç‰¹åˆ«è¯´æ˜Žäº†æ¯ä¸ªtargetsçš„build settingsæ˜¯é‡å†™äº†å…¶æ‰€å±žçš„projectçš„build settingsï¼‰ã€‚ Xcode WorkspaceWorkspaceæ˜¯å¯ä»¥åŒ…å«ä»»æ„ä¸ªproject çš„ï¼Œä½†æ˜¯ä¸€ä¸ªprojectåˆå¯ä»¥å±žäºŽå¤šä¸ªWorkSpaceã€‚å¯¹äºŽå¤„äºŽåŒä¸€ä¸ªWorkspaceçš„ä¸åŒprojectï¼Œç”±äºŽworkspaceä¸­æ‰€æœ‰projectçš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯ä½äºŽåŒä¸€ä¸ªæ–‡ä»¶ç›®å½•ä¸­ï¼Œå› æ­¤å¹¶ä¸éœ€è¦æ‹·è´å®ƒä»¬åˆ°æ¯ä¸€ä¸ªprojectæ–‡ä»¶å¤¹ä¸­ã€‚å¯¹äºŽWorkspaceçš„è¿™ä¸ªå…±åŒç›®å½•ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥è‡ªå·±æŒ‡å®šä¸€ä¸ªæž„å»ºç›®å½•ï¼ˆbuild directoryï¼‰çš„ï¼Œä½†æ˜¯å¦‚æžœæŒ‡å®šäº†æž„å»ºç›®å½•åœ¨build projectæ—¶ï¼Œè¿™ä¸ªprojectæ‰€åœ¨çš„æ‰€æœ‰workspaceçš„æž„å»ºç›®å½•éƒ½å°†è¦†ç›–è¿™ä¸ªæŒ‡å®šçš„æž„å»ºç›®å½•ï¼ targettargetæŒ‡å®šäº†è¦æž„å»ºçš„ç›®æ ‡ï¼Œåœ¨bluepillä¸­ä¼šåŒ…å«samepleAppã€samepleApp_Testç­‰targetsã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹targetçš„build settingå’Œbuild phasesï¼Œtargetä¼šç»§æ‰¿projectçš„build settingï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ºtargetæŒ‡å®šä¸åŒçš„build settingsæ¥è¦†ç›–projectçš„build settingã€‚ schemeschemeæ˜¯éœ€è¦è¢«buildçš„targetçš„é›†åˆã€‚å¯ä»¥åœ¨Xcodeä¸­é€‰æ‹©ä¸åŒçš„schemeæ¥æŒ‡å®šå½“å‰éœ€è¦buildçš„target(åœ¨Xcodeä¸­åŒæ—¶åªèƒ½é€‰æ‹©ä¸€ä¸ªscheme)ã€‚ å®žè·µå¼€è’é˜¶æ®µåœ¨å¼€è’é˜¶æ®µæ˜¯æ²¡æœ‰ä½¿ç”¨WorkSpaceçš„ï¼Œä¸€åˆ‡çš„åŸºç¡€éƒ½æ˜¯åœ¨Projectä¸Šã€‚ 1.åˆ›å»ºä¸€ä¸ªä¸åŒ…å«Testå’ŒUITestçš„ç©ºé¡¹ç›® åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥ä¿å­˜å·¥ç¨‹é¡¹ç›®å’Œä¸‹è½½çš„blupillè§£åŽ‹å‡ºæ¥çš„ä¸¤ä¸ªæ–‡ä»¶ï¼šbluepillå’Œbpï¼› å­¦è¿‡Cè¯­è¨€çš„éƒ½çŸ¥é“ï¼Œåœ¨ä½¿ç”¨cc xxx.cæ–‡ä»¶ä¹‹åŽä¼šç”Ÿæˆä¸€ä¸ª.oæ–‡ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨cc xxx.c -o selfpillæ¥é‡å‘½åè¿™ä¸ª-oæ–‡ä»¶ï¼Œä½¿ç”¨selfpillæ–‡ä»¶çš„å‘½ä»¤æ˜¯ï¼š./selfpillï¼ˆå› ä¸ºcçš„mainçš„å‚æ•°å°±æ˜¯æŽ¥æ”¶çš„ç»ˆç«¯å‘½ä»¤ï¼‰ï¼Œæ‰€ä»¥æˆ‘çŒœæµ‹è¿™å…¶å®žcçš„ä¸€ä¸ª-oæ–‡ä»¶ï¼Œä¸ºäº†ä½¿ç”¨è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°±éœ€è¦å°†ä¸Šè¿°æåˆ°çš„bluepillå’Œbpå’Œå·¥ç¨‹é¡¹ç›®æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ è¿™ä¸€æ­¥ä¸­æˆ‘ä»¬åˆ›å»ºä¸åŒ…å«Testå’ŒUITestçš„ç©ºé¡¹ç›®å³ä¸è¦å‹¾é€‰é‚£ä¸¤ä¸ªå’Œtestç›¸å…³çš„Checkboxï¼Œä½ è‚¯å®šä¼šç–‘é—®ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œå½“æˆ‘åœ¨çœ‹BLUEPILLçš„READMEçš„æ—¶å€™ç‰¹åˆ«æŒ‡å‡ºå¦‚æžœæ˜¯ä½¿ç”¨ç»ˆç«¯è¿›è¡Œbuild(ä½¿ç”¨xcodebuildï¼ŒåŽé¢æˆ‘ä¼šæŠŠè¿™ä¸€æ­¥æ”¾åœ¨è„šæœ¬ä¸­)çš„è¯éœ€è¦ä½¿ç”¨build-for-testingï¼Œæˆ‘çŒœæµ‹åº”è¯¥å’Œtestæ˜¯æœ‰å…³çš„ã€‚æ‰€ä»¥æˆ‘å…ˆæµ‹è¯•ä¸€ä¸‹æ²¡æœ‰testçš„æƒ…å†µæ˜¯å¦ä¼šå‡ºé”™ï¼Œå¦‚æžœå‡ºé”™ï¼Œé”™è¯¯æ˜¯ä»€ä¹ˆï¼Ÿ 2.ç¼–è¯‘è¿™ä¸ªç©ºé¡¹ç›® é¡¹ç›®åˆ›å»ºå¥½ä¹‹åŽç¼–è¯‘ä¸€ä¸‹ä¹‹åŽç¬¬ä¸€ç›®çš„å°±æ˜¯åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸Šæ–‡æåˆ°çš„å‘½ä»¤ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªç–‘é—®ï¼š-açš„å‚æ•°.appçš„è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ-sçš„.xcschemeçš„è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ.appå°±æ˜¯å‰é¢æˆ‘ä»¬é€šè¿‡ç¼–è¯‘ä¸€æ¬¡èŽ·å¾—çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹çš„åœ°å€æ˜¯/Users/xxxx/Library/Developer/Xcode/DerivedData/åœ¨ DerivedDataæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°åˆšåˆšåˆ›å»ºçš„é¡¹ç›®å¹¶ç‚¹å‡»è¿›åŽ»ï¼Œ.appæ–‡ä»¶å¤¹å°±åœ¨Build/Products/Debug-iphonesimulator/ï¼Œå¦‚æžœä½ åœ¨åˆ›å»ºå¥½ä¹‹åŽæ²¡æœ‰ç¼–è¯‘Productså°±æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ï¼›è€Œ.xcschemeåœ¨å·¥ç¨‹é¡¹ç›®æ‰€åœ¨æ–‡ä»¶å¤¹/bluepill_sameple.xcodeproj/xcuserdata/xxx.xcuserdatad/xcschemes/bluepill_sameple.xcschemeè·¯å¾„ä¸­æåˆ°çš„xxxæ˜¯ä½ åœ¨åˆ›å»ºé¡¹ç›®æ—¶çš„ç”¨æˆ·åã€‚å¥½äº†ï¼ŒçŽ°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ•°æ®å‘½ä»¤: ./bluepill -a /Users/xxx/Library/Developer/Xcode/DerivedData/bluepill_sameple-hdwawthuaefpnyecnudlxrpzozyq/Build/Products/Debug-iphonesimulator/bluepill_sameple.app -s /Users/xxx/Desktop/bluepill_new_build/bluepill_sameple/bluepill_sameple.xcodeproj/xcuserdata/xxx.xcuserdatad/xcschemes/bluepill_sameple.xcscheme -o outputæ•²å›žè½¦ä¹‹åŽæˆ‘è¿™é‡Œå‡ºçŽ°å¦‚ä¸‹æŠ¥é”™ï¼š ERROR: There is no 'Plugins' folder inside your app bundle at: /Users/Wil/Library/Developer/Xcode/DerivedData/bluepill_sameple-hdwawthuaefpnyecnudlxrpzozyq/Build/Products/Debug-iphonesimulator/bluepill_sameple.app Perhaps you forgot to 'build-for-testing'? (Cmd + Shift + U) in Xcode. Also, if you are using XCUITest, check https://github.com/linkedin/bluepill/issues/16 å‡ºçŽ°è¿™ä¸ªé—®é¢˜çš„åŽŸå› æ˜¯åœ¨.appæ–‡ä»¶å¤¹ä¸‹é¢æ²¡æœ‰Pluginsæ–‡ä»¶å¤¹ã€‚å°±ç®—æ˜¯æŒ‰ç…§æç¤ºè¯´ä½¿ç”¨Cmd + Shift + Uæˆ–è€…ä½¿ç”¨xcodebuild build-for-testingä»ç„¶æ˜¯è¡Œä¸é€šçš„ã€‚èµ°åˆ°è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤æ¡è·¯ï¼Œå¯ä»¥åˆ é™¤å½“å‰å·¥ç¨‹é‡æ–°å»ºä¸€ä¸ªåŒ…å«äº†Testå’ŒUITestçš„é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥åœ¨çŽ°æœ‰çš„Projectä¸­æ·»åŠ Testå’ŒUITestçš„Targetsã€‚æˆ‘é€‰æ‹©ç¬¬äºŒæ¡ï¼Œå› ä¸ºåœ¨æˆ‘å®žé™…é¡¹ç›®åœ¨è¿™ä¹‹å‰ä¹Ÿæ˜¯æ²¡æœ‰åŒ…å«ç›¸å…³Testçš„ã€‚ 3.åœ¨åŒ…å«Testçš„Projectä¸­å®žè·µ çŽ°åœ¨æˆ‘ä»¬éœ€è¦åœ¨æ—¢æœ‰Projectä¸­æ·»åŠ ä¸€ä¸ªTargetsï¼ŒFile/New/Target.../iOS Unit Testing Bundleåˆ›å»ºå¹¶åœ¨Scheme Menuä¸­é€‰æ‹©New Schemeé€‰ä¸­åˆšåˆšæˆ‘ä»¬æ·»åŠ çš„Targetsã€‚ç¼–è¯‘ä¸€ä¸‹ï¼ˆè¿™é‡Œå¯ä»¥ä½¿ç”¨Cmd + Shift + Uæˆ–è€…é€‰æ‹©Testçš„schemeå¹¶buildï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨build-for-testingå‘½ä»¤: xcodebuild build-for-testing -project bluepill_sameple/bluepill_sameple.xcodeproj/ -scheme bluepill_sameple -sdk iphonesimulator10.2 -derivedDataPath build/è¿›å…¥.appæ–‡ä»¶å¤¹ä¸‹æŸ¥çœ‹æ˜¯å¦å·²ç»æœ‰äº†PlugInsæ–‡ä»¶å¤¹ï¼Œå¦‚æžœå­˜åœ¨è¯¥æ–‡ä»¶å¤¹åˆ™ç»§ç»­æ‰§è¡Œä¸Šä¸€æ¬¡å‡ºé”™çš„é‚£ä¸ªå‘½ä»¤ï¼Œè¿è¡ŒæˆåŠŸï¼Œåˆ°è¿™é‡Œå·²ç»èƒ½å¤Ÿä½¿ç”¨æœ€åŸºç¡€çš„å‘½ä»¤ã€‚ å‰é¢æåˆ°å¯ä»¥é€‰æ‹©Testçš„schemeå¹¶buildï¼Œå¯èƒ½ä¼šå‡ºçŽ°ä¸€ç‚¹é—®é¢˜:The scheme &#39;bluepill_samepleTests&#39; is not configured for Runningã€‚å› ä¸ºæ·»åŠ äº†è¿™ä¸ªTestçš„Targetä¹‹åŽéœ€è¦ç¼–è¾‘ä¸€ä¸‹å¯¹åº”çš„Schemeä½¿å®ƒèƒ½å¤Ÿè¿›è¡ŒRunningæ“ä½œï¼å…·ä½“çš„æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š è®¾ç½®ä¹‹åŽCmd + BæˆåŠŸè¿è¡Œï¼ å®Œå–„é˜¶æ®µåŸºæœ¬å‚æ•°è§£é‡Šå’Œä½¿ç”¨ -a/-s/-o:è¿™æ˜¯ä¸‰ä¸ªæœ€åŸºæœ¬çš„å‚æ•°ï¼Œåœ¨å‰é¢ä½¿ç”¨çš„æ—¶å€™åº”è¯¥çŸ¥é“å¦‚ä½•ä½¿ç”¨ï¼Œè¿™é‡Œä¸å†è¿›è¡Œè§£é‡Šï¼ -c:è¯»å–ä¸€ä¸ªè‡ªå®šä¹‰çš„config.jsonæ–‡ä»¶ä½œä¸ºbluepillçš„è¿è¡Œå‚æ•°ï¼Œä¾‹å¦‚:./bluepill -c config.json -l :èŽ·å–åœ¨å½“å‰projectä¸­å­˜åœ¨çš„testcaseï¼Œå®ƒçš„æ‰“å°ç»“æžœæ˜¯å­˜åœ¨äºŽ.../bluepill_sameple.app/PlugInsæ–‡ä»¶å¤¹ä¸‹é¢ï¼çŽ°åœ¨æˆ‘ä¸ºäº†æ¼”ç¤ºå¤šå»ºç«‹äº†ä¸€ä¸ªTest Target(æ·»åŠ Scheme)ç„¶åŽç¼–è¯‘ï¼š./bluepill -a /Users/ç”¨æˆ·å/Library/Developer/Xcode/DerivedData/bluepill_sameple-hdwawthuaefpnyecnudlxrpzozyq/Build/Products/Debug-iphonesimulator/bluepill_sameple.app -s /Users/ç”¨æˆ·å/Desktop/bluepill_new_build/bluepill_sameple/bluepill_sameple.xcodeproj/xcuserdata/Wil.xcuserdatad/xcschemes/bluepill_sameple.xcscheme -læ‰“å°ç»“æžœ: bluepill_samepleTests.xctest bluepill_samepleTests_target.xctestæ–‡ä»¶å¤¹: -x/-i:-xåœ¨è¿è¡Œbluepillçš„æ—¶å€™ä¸åŒ…å«æŸä¸€ä¸ªtestcaseï¼Œ-iå’Œ-xç›¸åï¼Œå®ƒåˆ™æ˜¯è¦åŒ…å«æŸä¸€ä¸ªtestcaseï¼Œ-xçš„ä¼˜å…ˆçº§æ˜¯å¤§äºŽ-içš„ã€‚ ./bluepill -a xxxx.app -s xxxx.xcscheme -x bluepill_samepleTests.xctest -r 'iOS 10.2'; ./bluepill -a xxxx.app -s xxxx.xcscheme -i bluepill_samepleTests.xctest -r 'iOS 10.2'; å…¶ä¸­å…³äºŽ-xå’Œ-içš„å‚æ•°å¯ä½¿ç”¨-lå‘½ä»¤æ¥èŽ·å–ï¼ -d/-n:ä½¿ç”¨å‘½ä»¤ï¼šxcrun simctl list devicesæ¥èŽ·å–å½“å‰å¯ç”¨çš„æ¨¡æ‹Ÿå™¨è®¾å¤‡ï¼Œåœ¨å¾—åˆ°è¿™äº›è®¾å¤‡ä¹‹åŽå¯ä»¥ä½¿ç”¨-dæ¥æŒ‡å®šéœ€è¦å¯åŠ¨çš„è®¾å¤‡ï¼å…¶ä¸­-nå¯ä»¥æŒ‡å®šåŒæ—¶è¿è¡Œçš„æ¨¡æ‹Ÿå™¨æ•°é‡ã€‚æ¯”å¦‚ï¼š ./bluepill -a xxxx.app -s xxxx.xcscheme -r 'iOS 10.2' -d 'iPhone 5s'; å…¶ä¸­å‘½ä»¤å‰é¢æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå…ˆçœç•¥ï¼å¯¹äºŽçœŸæœºï¼šåœ¨bluepillçš„Issueé¡µé¢æŒ‡å‡ºblupillä¸æ”¯æŒçœŸæœºï¼ ç›®å‰å¯¹äºŽbluepillçš„å®žè·µå…ˆåˆ°è¿™é‡Œï¼ŒåŽç»­è¿˜ä¼šç»§ç»­æ›´æ–°é‡åˆ°çš„ç›¸å…³é—®é¢˜ï¼ ç›¸å…³é“¾æŽ¥: Configuring Your Xcode Project Xcode Build Settings Reference]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[HTTPæŒä¹…è¿žæŽ¥]]></title>
      <url>%2F2017%2F02%2F27%2Fhttp_keep_alive%2F</url>
      <content type="text"><![CDATA[HTTP/1.1å…è®¸httpè®¾å¤‡åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åŽå°†TCPè¿žæŽ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ï¼Œä»¥ä¾¿ä¸ºæœªæ¥çš„httpè¯·æ±‚é‡ç”¨çŽ°å­˜çš„è¿žæŽ¥ã€‚åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åŽä»ç„¶ä¿æŒæ‰“å¼€çŠ¶æ€çš„TCPè¿žæŽ¥è¢«ç§°ä¸ºæŒä¹…è¿žæŽ¥ã€‚æŒä¹…è¿žæŽ¥ä¼šåœ¨ä¸åŒäº‹åŠ¡ä¹‹é—´ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨å†³å®šå°†å…¶å…³é—­ã€‚å·²ç»æ‰“å¼€çš„è¿žæŽ¥å¯ä»¥é¿å…æ…¢å¯åŠ¨çš„æ‹¥å µé€‚åº”é˜¶æ®µã€‚ä»¥ä¾¿æ›´å¿«çš„è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ æŒä¹…ä»¥åŠå¹¶è¡Œè¿žæŽ¥å¹¶è¡Œè¿žæŽ¥çš„ç¼ºç‚¹: æ¯ä¸ªäº‹åŠ¡æ‰“å¼€ï¼å…³é—­ä¸€ä¸ªæ–°çš„è¿žæŽ¥ï¼Œä¼šè€—è´¹æ—¶é—´å’Œå®½å¸¦çš„ï¼› ç”±äºŽTCPæ…¢å¯åŠ¨ï¼Œæ¯æ¡æ–°è¿žæŽ¥çš„æ€§èƒ½éƒ½ä¼šæœ‰é™ä½Žï¼› å¯æ‰“å¼€çš„å¹¶è¡Œè¿žæŽ¥æ•°é‡å®žé™…ä¸Šæ˜¯æœ‰é™çš„ã€‚ æŒä¹…è¿žæŽ¥é™ä½Žäº†æ—¶å»¶å’Œå»ºç«‹è¿žæŽ¥çš„å¼€é”€ï¼Œä½†æ˜¯æŒä¹…è¿žæŽ¥æ—¶å¯èƒ½ä¼šç´¯ç§¯å‡ºå¤§é‡çš„ç©ºé—²è¿žæŽ¥ã€‚æ‰€ä»¥éœ€è¦é…åˆä½¿ç”¨æŒä¹…è¿žæŽ¥å’Œå¹¶è¡Œè¿žæŽ¥ã€‚ HTTP/1.0+ keep-aliveè¿žæŽ¥å®¢æˆ·ç«¯å®žçŽ°äº†HTTP/1.0 keep-aliveè¿žæŽ¥çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åŒ…å«Connection: Keep-Aliveé¦–éƒ¨è¯·æ±‚å°†ä¸€æ¡è¿žæŽ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ æœåŠ¡ç«¯å¦‚æžœæœåŠ¡å™¨æ„¿æ„ä¸ºä¸‹ä¸€æ¡è¯·æ±‚å°†è¿žæŽ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ï¼Œå°±åœ¨é€šç”¨é¦–éƒ¨ä¸­åŒ…å«ç›¸åŒçš„å†…å®¹ã€‚å¦‚æžœæ²¡æœ‰åŒ…å«Connection: Keep-Aliveé¦–éƒ¨ï¼Œå®¢æˆ·ç«¯å°±è®¤ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒkeep-aliveï¼Œä¼šåœ¨å‘å›žå“åº”æŠ¥æ–‡ä¹‹åŽå…³é—­è¿žæŽ¥ã€‚ âš ï¸æ³¨æ„keep-aliveé¦–éƒ¨åªæ˜¯è¯·æ±‚å°†è¿žæŽ¥ä¿æŒåœ¨æ´»è·ƒçŠ¶æ€ã€‚åœ¨å‘å‡ºkeep-aliveè¯·æ±‚ä¹‹åŽï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­ç©ºé—²çš„keep-aliveè¿žæŽ¥ï¼Œå¹¶å¯ä»¥é™åˆ¶keep-aliveè¿žæŽ¥æ‰€å¤„ç†äº‹åŠ¡çš„æ•°é‡ã€‚ é€šç”¨é¦–éƒ¨Keep-Aliveé€‰é¡¹ å‚æ•°timeoutæ˜¯åœ¨Keep-Aliveå“åº”é¦–éƒ¨å‘é€çš„ã€‚å®ƒä¼°è®¡äº†æœåŠ¡å™¨å¸Œæœ›å°†è¿žæŽ¥ä¿æŒåœ¨æ´»è·ƒçŠ¶æ€çš„æ—¶é—´ã€‚ å‚æ•°maxæ˜¯åœ¨Keep-Aliveå“åº”é¦–éƒ¨å‘é€çš„ã€‚å®ƒä¼°è®¡äº†æœåŠ¡å™¨è¿˜å¸Œæœ›ä¸ºå¤šå°‘ä¸ªäº‹åŠ¡æŠ±æŒæ­¤è¿žæŽ¥çš„æ´»è·ƒçŠ¶æ€ã€‚ Keep-Aliveé¦–éƒ¨è¿˜å¯æ”¯æŒä»»æ„æœªç»å¤„ç†çš„å±žæ€§ã€‚è¯­æ³•ä¸ºï¼šname [=value] Keep-Aliveé¦–éƒ¨åªæœ‰åœ¨æä¾›äº†Connection:Keep-Aliveæ—¶æ‰èƒ½ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š12Connection:Keep-AliveKeep-Alive:max=5, timeout=120 Keep-Aliveè¿žæŽ¥çš„é™åˆ¶å’Œè§„åˆ™ åœ¨HTTP1.0ä¸­ï¼Œkeep-aliveå¹¶ä¸æ˜¯é»˜è®¤ä½¿ç”¨çš„ã€‚å®¢æˆ·ç«¯å¿…é¡»å‘é€ä¸€ä¸ªConnection:Keep-Aliveè¯·æ±‚é¦–éƒ¨æ¥æ¿€æ´»keep-aliveè¿žæŽ¥ï¼› ä»£ç†æˆ–ç½‘å…³å¿…é¡»å°†æŠ¥æ–‡è½¬å‘æˆ–å°†å…¶é«˜é€Ÿç¼“å­˜ä¹‹å‰ï¼Œåˆ é™¤åœ¨Connectioné¦–éƒ¨ä¸­å‘½åçš„æ‰€æœ‰é¦–éƒ¨å­—æ®µä»¥åŠConnectioné¦–éƒ¨è‡ªèº«ã€‚ ä¸åº”è¯¥ä¸Žæ— æ³•ç¡®å®šæ˜¯å¦æ”¯æŒConnectioné¦–éƒ¨ä»£ç†æœåŠ¡å™¨å»ºç«‹keep-aliveè¿žæŽ¥ï¼Œä»¥é˜²æ­¢å‡ºçŽ°å“‘ä»£ç†ã€‚ HTTP/1.1 æŒä¹…è¿žæŽ¥(Persistent Connection)HTTP/1.1 æŒä¹…è¿žæŽ¥åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ¿€æ´»çš„ï¼Œè¦åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åŽå°†è¿žæŽ¥å…³é—­ï¼ŒHTTP/1.1åº”ç”¨ç¨‹åºå¿…é¡»å‘æŠ¥æ–‡ä¸­æ˜¾ç¤ºçš„æ·»åŠ ä¸€ä¸ªConnection:closeé¦–éƒ¨ã€‚ä¸ç„¶HTTP/1.1 è¿žæŽ¥å°±ä»ç„¶ç»´æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ âš ï¸ä¸å‘é€Connection:closeå¹¶ä¸æ„å‘³ç€æœåŠ¡å™¨æ‰¿è¯ºæ°¸è¿œå°†è¿žæŽ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ æŒä¹…è¿žæŽ¥çš„é™åˆ¶å’Œè§„åˆ™ å‘é€äº†Connection:closeè¯·æ±‚é¦–éƒ¨ä¹‹åŽï¼Œå®¢æˆ·ç«¯å°±æ— æ³•åœ¨é‚£æ¡è¿žæŽ¥ä¸Šå‘é€æ›´å¤šçš„è¯·æ±‚äº†ã€‚ å¦‚æžœå®¢æˆ·ç«¯ä¸æƒ³å†è¿žæŽ¥ä¸Šå‘é€å…¶ä»–è¯·æ±‚ï¼Œå°±åº”è¯¥åœ¨æœ€åŽä¸€æ¡è¯·æ±‚ä¸­å‘é€ä¸€ä¸ªConnection:closeè¯·æ±‚é¦–éƒ¨ã€‚ åªæœ‰å½“è¿žæŽ¥ä¸Šæ‰€æœ‰æŠ¥æ–‡çš„å®žä½“ä¸»ä½“éƒ¨åˆ†çš„é•¿åº¦å’Œé¦–éƒ¨å­—æ®µContent Lengthä¸€æ ·ï¼ˆæˆ–è€…ç”¨åˆ†å—ä¼ è¾“ç¼–ç æ–¹å¼ï¼‰ï¼Œè¿™æ ·è¿žæŽ¥æ‰èƒ½æŒä¹…ä¿æŒ HTTP1.1çš„ä»£ç†æœåŠ¡å™¨ä¸åº”è¯¥ä¸ŽHTTP1.0å®¢æˆ·ç«¯å»ºç«‹æŒä¹…è¿žæŽ¥ã€‚ HTTP1.1è®¾å¤‡å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­è¿žæŽ¥ï¼Œå°½ç®¡æ˜¯å‡ºäºŽä¼ è¾“æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­å…³é—­è¿žæŽ¥ã€‚ ç®¡é“åŒ–è¿žæŽ¥HTTP1.1å…è®¸åœ¨æŒä¹…è¿žæŽ¥ä¸Šå¯é€‰çš„ä½¿ç”¨è¯·æ±‚ç®¡é“ã€‚è¿™æ˜¯åœ¨keep-aliveè¿žæŽ¥ä¸Šçš„è¿›ä¸€æ­¥æ€§èƒ½ä¼˜åŒ–ã€‚åœ¨å“åº”åˆ°è¾¾å‰ï¼Œå¯ä»¥å°†å¤šæ¡è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·åšå¯ä»¥é™ä½Žç½‘ç»œçš„çŽ¯å›žæ—¶é—´ï¼Œæé«˜æ€§èƒ½ã€‚ ç®¡é“åŒ–è¿žæŽ¥çš„å‡ ä¸ªé™åˆ¶ å¦‚æžœhttpå®¢æˆ·ç«¯æ— æ³•ç¡®è®¤è¿žæŽ¥æ˜¯æŒä¹…çš„ï¼Œå°±ä¸åº”è¯¥ä½¿ç”¨ç®¡é“ï¼› å¿…é¡»æŒ‰ç…§ä¸Žè¯·æ±‚ç›¸åŒçš„é¡ºåºå›žé€httpå“åº”ã€‚ httpå®¢æˆ·ç«¯å¿…é¡»åšå¥½è¿žæŽ¥ä¼šåœ¨ä»»æ„æ—¶åˆ»å…³é—­çš„å‡†å¤‡ï¼Œè¿˜è¦å‡†å¤‡å¥½é‡å‘æ‰€æœ‰æœªå®Œæˆçš„ç®¡é“åŒ–è¯·æ±‚ã€‚ httpå®¢æˆ·ç«¯ä¸åº”è¯¥ç”¨ç®¡é“åŒ–çš„æ–¹å¼å‘é€ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„è¯·æ±‚(æ¯”å¦‚POST)ã€‚ å…³é—­è¿žæŽ¥åœ¨è¿žæŽ¥ç®¡ç†ä¸­éœ€è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™å…³é—­è¿žæŽ¥ä»¥åŠå¦‚ä½•åŽ»å…³é—­è¿žæŽ¥ã€‚ â€œä»»æ„â€æŽ¥è§¦è¿žæŽ¥æ‰€æœ‰çš„HTTPå®¢æˆ·ç«¯ã€æœåŠ¡å™¨æˆ–è€…ä»£ç†éƒ½å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­ä¸€æ¡TCPä¼ è¾“è¿žæŽ¥ã€‚é€šå¸¸ä¼šåœ¨ä¸€æ¡æŠ¥æ–‡ç»“æŸæ—¶å…³é—­è¿žæŽ¥ã€‚ ä½†æ˜¯ï¼ŒæœåŠ¡å™¨æ°¸è¿œéƒ½æ— æ³•ç¡®å®šåœ¨å®ƒå…³é—­â€œç©ºé—²â€è¿žæŽ¥é‚£æ—¶å€™ï¼Œåœ¨å®¢æˆ·ç«¯æœ‰æ²¡æœ‰æ•°æ®è¦å‘é€ã€‚å¦‚æžœå‡ºçŽ°è¿™ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯å°±ä¼šåœ¨å†™å…¥åŠæˆªè¯·æ±‚æŠ¥æ–‡æ—¶å‘çŽ°å‡ºçŽ°è¿žæŽ¥é”™è¯¯çš„è¯·æ±‚ã€‚ Content-LengthåŠæˆªå°¾æ“ä½œæ¯æ¡HTTPå“åº”éƒ½åº”è¯¥æœ‰ç²¾ç¡®çš„Content-Lengthé¦–éƒ¨ï¼Œç”¨ä»¥æè¿°å“åº”ä¸»é¢˜çš„å°ºå¯¸ã€‚å®¢æˆ·ç«¯æˆ–è€…ä»£ç†å—åˆ°ä¸€æ¡éšè¿žæŽ¥å…³é—­è€Œç»“æŸçš„httpå“åº”ï¼Œä¸”å®žé™…ä¼ è¾“çš„å®žä½“é•¿åº¦ä¸ŽContent-Lengthå¹¶ä¸åŒ¹é…ï¼ŒæŽ¥æ”¶ç«¯å°±åº”è¯¥è´¨ç–‘é•¿åº¦çš„æ­£ç¡®æ€§ã€‚å¦‚æžœæŽ¥æ”¶ç«¯æ˜¯ç¼“å­˜ä»£ç†ï¼ŒæŽ¥æ”¶ç«¯å°±ä¸åº”è¯¥ç¼“å­˜è¿™æ¡å“åº”ã€‚ä»£ç†åº”è¯¥å°†æœ‰é—®é¢˜çš„æŠ¥æ–‡åŽŸå°ä¸åŠ¨åœ°è½¬å‘å‡ºåŽ»ï¼Œè€Œä¸åº”è¯¥è¯•å›¾åŽ»â€œæ ¡æ­£â€Content-Lengthã€‚ è¿žæŽ¥å…³é—­å®¹é™ï¼Œé‡è¯•ä»¥åŠå¹‚ç­‰æ€§å¦‚æžœå®¢æˆ·ç«¯æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¼ è¾“è¿žæŽ¥å…³é—­äº†ï¼Œé‚£ä¹ˆé™¤éžäº‹åŠ¡å¤„ç†ä¼šå¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ï¼Œå¦åˆ™å®¢æˆ·ç«¯å°±åº”è¯¥é‡æ–°æ‰“å¼€è¿žæŽ¥ï¼Œå¹¶é‡è¯•ã€‚ å¹‚ç­‰å¦‚æžœä¸€ä¸ªäº‹åŠ¡ï¼Œä¸ç®¡æ˜¯æ‰§è¡Œä¸€æ¬¡è¿˜æ˜¯å¤šæ¬¡ï¼Œå¾—åˆ°çš„ç»“æžœéƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡å°±æ˜¯å¹‚ç­‰çš„ã€‚ GETã€HEADã€PUTã€DELETEã€TRACEå’ŒOPTIONSæ–¹æ³•éƒ½æ˜¯çš„ã€‚ å®¢æˆ·ç«¯ä¸åº”è¯¥ç”¨ç®¡é“åŒ–çš„æ–¹å¼ä¼ é€éžå¹‚ç­‰è¯·æ±‚(å°±æ˜¯è¯´æ¯”å¦‚POSTè¯·æ±‚ä¸åº”è¯¥ä½¿ç”¨ç®¡é“åŒ–æ–¹å¼)ã€‚ æ­£å¸¸å…³é—­è¿žæŽ¥TCPè¿žæŽ¥éƒ½æ˜¯åŒå‘çš„ã€‚tcpè¿žæŽ¥çš„æ¯ä¸€ç«¯éƒ½æœ‰ä¸€ä¸ªè¾“å…¥é˜Ÿåˆ—å’Œä¸€ä¸ªè¾“å‡ºé˜Ÿåˆ—ï¼Œç”¨äºŽæ•°æ®çš„è¯»æˆ–å†™ã€‚ å®Œå…¨å…³é—­å’ŒåŠå…³é—­åº”ç”¨ç¨‹åºå¯ä»¥å…³é—­tcpè¾“å…¥å’Œè¾“å‡ºä¿¡é“ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œæˆ–è€…å°†ä¸¤è€…éƒ½å…³é—­äº†ã€‚ å¥—æŽ¥å­—è°ƒç”¨close()ä¼šå°†tcpè¿žæŽ¥çš„è¾“å…¥å’Œè¾“å‡ºä¿¡é“éƒ½å…³é—­ï¼Œè¿™å°±æ˜¯å®Œå…¨å…³é—­ã€‚ç”¨shutdown()å•ç‹¬å…³é—­è¾“å…¥æˆ–è€…è¾“å‡ºä¿¡é“ï¼Œè¢«ç§°ä¸ºåŠå…³é—­ã€‚ TCPå…³é—­åŠé‡ç½®é”™è¯¯æ€»ä¹‹ï¼Œå…³é—­è¿žæŽ¥çš„è¾“å‡ºä¿¡é“æ€»æ˜¯å¾ˆå®‰å…¨çš„ã€‚è¿žæŽ¥å¦ä¸€ç«¯çš„å¯¹ç­‰å®žä½“ä¼šåœ¨å…¶ç¼“å†²åŒºä¸­è¯»å‡ºæ‰€æœ‰æ•°æ®ä¹‹åŽæ”¶åˆ°ä¸€æ¡é€šçŸ¥ï¼Œè¯´æ˜Žæµç»“æŸäº†ã€‚å…³é—­è¿žæŽ¥çš„è¾“å…¥ä¿¡é“æ¯”è¾ƒå±é™©ï¼Œé™¤éžä½ çŸ¥é“å¦ä¸€ç«¯ä¸æ‰“ç®—å†å‘é€å…¶ä»–æ•°æ®ã€‚å¦‚æžœå¦ä¸€ç«¯å‘ä½ å·²å…³é—­çš„è¾“å…¥ä¿¡é“å‘é€æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘å¦ä¸€ç«¯çš„æœºå™¨å›žé€ä¸€æ¡TCPâ€œè¿žæŽ¥è¢«å¯¹ç«¯é‡ç½®â€ã€‚ å¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿéƒ½ä¼šå°†è¿™ç§æƒ…å†µä½œä¸ºä¸¥é‡é”™è¯¯æ¥å¤„ç†ï¼Œåˆ é™¤å¯¹ç«¯è¿˜æœªè¯»åŽ»çš„æ‰€æœ‰ç¼“å­˜æ•°æ®ã€‚ä½†æ˜¯è¿™æ ·åšå¯¹äºŽç®¡é“åŒ–æ¥è¯´ç®€ç›´å°±æ˜¯å™©æ¢¦ï¼Œå› ä¸º:æ¯”å¦‚ä½ å·²ç»åœ¨ä¸€æ¡æŒä¹…è¿žæŽ¥ä¸Šå‘é€äº†10æ¡ç®¡é“å¼è¯·æ±‚ï¼Œå“åº”å·²ç»æ”¶åˆ°äº†ï¼Œæ­£åœ¨æ“ä½œç³»ç»Ÿçš„ç¼“å­˜åŒºä¸­å­˜ç€ã€‚ä½†æ˜¯ä½ å‘é€äº†ç¬¬11æ¡è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨è®¤ä¸ºä½ ä½¿ç”¨è¿™æ¡è¿žæŽ¥çš„æ—¶é—´å¤ªé•¿ï¼Œå†³å®šå°†å…¶å…³é—­ï¼Œè¿™ä¸ªé‡ç½®ä¿¡æ¯ä¼šæ¸…ç©ºä½ çš„ç¼“å†²åŒºã€‚ æ­£å¸¸å…³é—­å®žçŽ°æ­£å¸¸å…³é—­çš„åº”ç”¨ç¨‹åºé¦–å…ˆåº”è¯¥å…³é—­å®ƒä»¬çš„è¾“å‡ºä¿¡é“ï¼Œç„¶åŽç­‰å¾…å¦ä¸€ç«¯çš„å¯¹ç­‰å®žä½“å…³é—­å®ƒçš„è¾“å‡ºä¿¡é“ã€‚å½“ä¸¤ç«¯éƒ½å‘Šè¯‰å¯¹æ–¹å®ƒä»¬ä¸ä¼šå†å‘é€ä»»ä½•æ•°æ®ä¹‹åŽï¼Œè¿žæŽ¥å°±ä¼šè¢«å®Œå…¨å…³é—­ï¼Œè€Œä¸ä¼šæœ‰é‡ç½®é£Žé™©ã€‚å¦‚æžœåœ¨ä¸€å®šçš„æ—¶é—´åŒºé—´å†…å¯¹ç«¯æ²¡æœ‰å…³é—­è¾“å…¥ä¿¡é“ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¼ºåˆ¶å…³é—­è¿žæŽ¥ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ã€ŠCå’ŒæŒ‡é’ˆNoteã€‹ä¹‹æ•°ç»„å’ŒæŒ‡é’ˆ]]></title>
      <url>%2F2017%2F02%2F22%2Fc_and_pointer_note_case4%2F</url>
      <content type="text"><![CDATA[è®°å½•æŒ‡é’ˆå’Œæ•°ç»„ç›´æŽ¥çš„å…³ç³»!å½“å‰Cè¯­è¨€çŽ¯å¢ƒ: Apple LLVM version 8.0.0 (clang-800.0.38) Target: x86_64-apple-darwin15.6.0 Thread model: posix InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin ä¸€ç»´æ•°ç»„æ•°ç»„åæ•°ç»„åçš„å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡ï¼Œä¹Ÿæ˜¯æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ã€‚ æ³¨æ„âš ï¸æ•°ç»„å…·æœ‰ç¡®å®šçš„æ•°é‡çš„å…ƒç´ ï¼Œè€ŒæŒ‡é’ˆåªæ˜¯ä¸€ä¸ªæ ‡é‡å€¼ï¼Œ_åªæœ‰æ•°ç»„ååœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºä»–å‚æ•°ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡(æ„æ€å°±æ˜¯ä½ ä¸èƒ½ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆçš„å€¼)_ã€‚ æŒ‡é’ˆå¸¸é‡æ‰€æŒ‡å‘çš„æ˜¯å†…å­˜ä¸­æ•°ç»„çš„èµ·å§‹ä½ç½®ï¼Œå¦‚æžœä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆå¸¸é‡ï¼Œå”¯ä¸€å¯è¡Œçš„æ“ä½œå°±æ˜¯æŠŠæ•´ä¸ªæ•°ç»„ç§»åŠ¨åˆ°å†…å­˜çš„å…¶ä»–ä½ç½®ï¼Œä½†æ˜¯åœ¨ç¨‹åºå®Œæˆé“¾æŽ¥ä¹‹åŽï¼Œå†…å­˜ä¸­æ•°ç»„çš„ä½ç½®æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œåœ¨æƒ³ç§»åŠ¨æ•°ç»„å°±æ™šäº†ã€‚ æ•°ç»„åä¸ä½œä¸ºæŒ‡é’ˆå¸¸é‡æ¥è¡¨ç¤ºçš„ä¸¤ç§åœºæ™¯ æ³¨æ„ï¼šè¿™é‡Œè¯´çš„æ˜¯ä¸ä½œä¸ºæŒ‡é’ˆå¸¸é‡ã€‚ 1.æ•°ç»„åä½œä¸ºsizeofæ“ä½œç¬¦ï¼šsizeofè¿”å›žæ•´ä¸ªæ•°ç»„æ‰€å ç”¨çš„å­—èŠ‚ï¼Œè€Œä¸æ˜¯æ¯ä¸ªå…ƒç´ æ‰€å ç”¨çš„å­—èŠ‚ï¼Œä¹Ÿä¸æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆçš„é•¿åº¦ã€‚ 2.æ•°ç»„åç”¨äºŽå•ç›®æ“ä½œç¬¦&amp;æ—¶ï¼šè¿”å›žä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆå¸¸é‡çš„æŒ‡é’ˆã€‚ int a[10]; int *c; c = &a[0];c = a;//è¿™é‡Œèµ‹å€¼çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„æ‹·è´ã€‚ ä¸‹æ ‡å¼•ç”¨å’ŒæŒ‡é’ˆ(é—´æŽ¥å–å€¼æ“ä½œ)array[3]ï¼Œ*(array + 3)å‡ºäº†ä¼˜å…ˆçº§ä¹‹å¤–ï¼Œä¸‹æ ‡å¼•ç”¨å’Œé—´æŽ¥è®¿é—®å®Œå…¨ç›¸åŒã€‚ int array[10]; int *ap = array + 2; 1.ap:è¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆåœ°å€ï¼Œæ‰€ä»¥è¯¥è¡¨è¾¾å¼å’Œ&amp;array[2]æˆ–è€…array+2ç›¸åŒã€‚ 2.*ap:é—´æŽ¥è®¿é—®ï¼Œä¸Žarray[2]å’Œ*(array + 2)ç›¸åŒã€‚ 3.ap[6]:Cçš„ä¸‹æ ‡å¼•ç”¨å’Œé—´æŽ¥è®¿é—®è¡¨è¾¾å¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ap[6]å’Œ*(ap + 6)ç›¸åŒï¼Œä¸Žarray[8]å’Œ*(array + 8)ç›¸åŒã€‚ 4.ap + 6:apä¸ºä¸€ä¸ªæŒ‡é’ˆåœ°å€ï¼Œåœ°å€å‘åŽåç§»6ï¼Œåˆ™ap + 6å’Œ&amp;array[8]ï¼Œarray + 8ç›¸åŒã€‚ 5.*(ap + 6):ä¸Šé¢è¯´è¿‡ap+6ä¸ºä¸€ä¸ªåœ°å€ï¼Œç”±æ­¤å¯ä»¥å¾—å‡º*(ap+6)ä¸ºé—´æŽ¥æ±‚å¾—åœ°å€å¯¹åº”çš„å€¼ï¼Œå®ƒå’Œarray[8]å’Œ*(array+8)ç›¸åŒï¼Œå…¶å®žå®ƒå’Œ2&gt;.ç±»ä¼¼ã€‚ â€”&gt;6.ap[-1]:ä½¿ç”¨-1çš„åç§»é‡ä½¿å¾—é“å®ƒå‰ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯array[1]æˆ–è€…*(array + 2 - 1)ã€‚ ä¸Šé¢è¯´è¿™ä¹ˆå¤šï¼Œå…¶å®žåªè¦æŠ“ä½ï¼šå½“å‰è¡¨ç¤ºçš„åœ°å€ï¼Œå…ƒç´ è¿˜æ˜¯é—´æŽ¥èŽ·å–æ“ä½œå°±å¯ä»¥äº†ã€‚ æ³¨æ„âš ï¸:ä¸Šé¢æåˆ°çš„â€œCçš„ä¸‹æ ‡å¼•ç”¨å’Œé—´æŽ¥è®¿é—®è¡¨è¾¾å¼æ˜¯ä¸€æ ·çš„â€ã€‚ æ€è€ƒé¢˜:2[array]ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¸­çš„arrayæ˜¯ä¸Šæ–‡ä¸­çš„arrayã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡çŽ¯å¢ƒä¸­ï¼Œ2[array]è¡¨è¾¾çš„æ„æ€æ˜¯ä»€ä¹ˆï¼š è§£ç­”:å› ä¸ºå‰é¢æˆ‘ä¸€ç›´åœ¨å¼ºè°ƒï¼Œä¸‹æ ‡å¼•ç”¨å’Œé—´æŽ¥è¡¨è¾¾å¼æ±‚å€¼æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥: ç¬¬ä¸€æ­¥ï¼šæˆ‘ä»¬å¯ä»¥æŠŠ2[array]æ”¹å†™æˆ*(2 + array) ç¬¬äºŒæ­¥:ç”±äºŽåŠ æ³•è¿ç®—ç¬¦çš„ä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¯ä»¥äº¤æ¢ä½ç½®çš„ï¼Œæ‰€ä»¥æŠŠä¸Šé¢çš„è¡¨è¾¾å¼æ”¹å†™ä¸º:*(array + 2);ä¹Ÿå°±æ˜¯è¯´2[array]å…¶å®žå’Œarray[2]æ˜¯ç›¸ç­‰çš„ã€‚ å…³äºŽæŒ‡é’ˆé—´æŽ¥æ“ä½œç¬¦å’Œä¸‹æ ‡æ“ä½œçš„æ¯”è¾ƒ ç›¸å¯¹äºŽæŒ‡é’ˆçš„é—´æŽ¥è®¿é—®å’Œä¸‹æ ‡æ“ä½œï¼Œåœ¨å¯è¯»æ€§æ–¹é¢ä¸‹æ ‡çš„æ–¹å¼æ›´å¥½ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ•ˆçŽ‡ä¸Šé¢_ä¸‹æ ‡ä¸ä¼šæ¯”æŒ‡é’ˆæ›´æœ‰æ•ˆçŽ‡ï¼Œä½†æ˜¯æŒ‡é’ˆæœ‰æ—¶å€™æ¯”ä¸‹æ ‡æ•ˆçŽ‡æ›´é«˜_ã€‚ å…·ä½“çš„æ•ˆçŽ‡æ¯”è¾ƒä¸º: 1.å½“ä½ æ ¹æ®æŸä¸ªå›ºå®šæ•°ç›®çš„å¢žé‡åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ç§»åŠ¨æ—¶ï¼Œä½¿ç”¨æŒ‡é’ˆå˜é‡å°†æ¯”ä½¿ç”¨ä¸‹æ ‡äº§ç”Ÿæ•ˆçŽ‡æ›´é«˜çš„ä»£ç ã€‚ 2.å£°æ˜Žä¸ºå¯„å­˜å™¨å˜é‡çš„æŒ‡é’ˆé€šå¸¸æ¯”ç”¨äºŽé™æ€å†…å­˜å’Œå †æ ˆä¸­çš„æŒ‡é’ˆæ•ˆçŽ‡æ›´é«˜ã€‚å…³äºŽå¦‚ä½•å°†å˜é‡å£°æ˜Žä¸ºå¯„å­˜å™¨å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨registerå…³é”®å­—æ¥å£°æ˜Žï¼Œæ¯”å¦‚:register int *p1;ï¼Œregisterï¼šè¿™ä¸ªå…³é”®å­—è¯·æ±‚ç¼–è¯‘å™¨å°½å¯èƒ½çš„å°†å˜é‡å­˜åœ¨CPU å†…éƒ¨å¯„å­˜å™¨ä¸­è€Œä¸æ˜¯é€šè¿‡å†…å­˜å¯»å€è®¿é—®ä»¥æé«˜æ•ˆçŽ‡ã€‚register å˜é‡å¿…é¡»æ˜¯ä¸€ä¸ªå•ä¸ªçš„å€¼ï¼Œå¹¶ä¸”å…¶é•¿åº¦åº”å°äºŽæˆ–ç­‰äºŽæ•´åž‹çš„é•¿åº¦ã€‚è€Œä¸”register å˜é‡å¯èƒ½ä¸å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨å–å€è¿ç®—ç¬¦â€œ&amp;â€æ¥èŽ·å–register å˜é‡çš„åœ°å€ã€‚ 3.åƒ&amp;array[2]æˆ–è€…array+2è¿™ç§åœ¨è¿è¡Œæ—¶æ±‚å€¼çš„å¸¸é‡è¡¨è¾¾å¼ä»£ä»·å¾ˆé«˜ã€‚ æ•°ç»„çš„åˆå§‹åŒ–æ•°ç»„çš„åˆå§‹åŒ–éœ€è¦ä¸€ç³»åˆ—çš„å€¼ï¼Œä¾‹å¦‚ï¼š int array[5] = {1,2,3,4,5};//å¦‚æžœåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆå§‹åŒ–çš„ä¸ªæ•°æ¯”æ•°ç»„çš„å¤§å°å°çš„è¯ï¼Œç©ºä½™çš„å…ƒç´ å°†ä¼šè¢«èµ‹å€¼ä¸º0ã€‚ int array[] = {1,2,3,4,5};//å¦‚æžœåœ¨å£°æ˜Žä¸­æ²¡æœ‰ç»™å‡ºæ•°ç»„çš„é•¿åº¦ï¼Œç¼–è¯‘å™¨ä¼šæŠŠæ•°ç»„çš„é•¿åº¦è®¾ç½®ä¸ºåˆšå¥½èƒ½å¤Ÿå®¹æ˜“æ‰€æœ‰åˆå§‹å€¼çš„é•¿åº¦ã€‚ å¯¹äºŽé™æ€æ•°ç»„ï¼šå­˜å‚¨äºŽé™æ€å†…å­˜çš„æ•°ç»„åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå½“ç¨‹åºæ‰§è¡Œæ—¶ï¼Œé™æ€æ•°ç»„å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚å¦‚æžœæ•°ç»„æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œæ•°ç»„å…ƒç´ çš„åˆå§‹å€¼å°†ä¼šè‡ªåŠ¨è®¾ç½®ä¸º0ã€‚å¯¹äºŽè‡ªåŠ¨å˜é‡ï¼šç”±äºŽè‡ªåŠ¨å˜é‡ä½äºŽè¿è¡Œæ—¶å †æ ˆï¼Œæ‰€ä»¥è‡ªåŠ¨å˜é‡åœ¨ç¼ºçœçš„æƒ…å†µä¸‹æ˜¯æœªè¢«åˆå§‹åŒ–çš„ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦æ€è€ƒçš„æ˜¯ï¼šå½“æ•°ç»„çš„åˆå§‹åŒ–åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œç¨‹åºåœ¨æ¯æ¬¡è¿›å…¥è¯¥å‡½æ•°çš„æ—¶å€™ï¼Œæ˜¯å¦å€¼å¾—æ¯æ¬¡éƒ½å¯¹è¯¥æ•°ç»„é‡æ–°è¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚æžœä¸éœ€è¦çš„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¯¥æ•°ç»„å£°æ˜Žä¸ºstaticã€‚ æŒ‡å®šåˆå§‹åŒ–å™¨(c99)åªåˆå§‹åŒ–æ•°ç»„ä¸­çš„æŒ‡å®šå…ƒç´ ï¼Œæ–¹æ³•æ˜¯ï¼šåœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­ä½¿ç”¨å¸¦æ–¹æ‹¬å·çš„ä¸‹æ ‡æŒ‡æ˜Žå¾…åˆå§‹åŒ–çš„å…ƒç´ ã€‚1int array[5] = &#123;[5] = 23&#125;;//æŠŠarray[5]åˆå§‹åŒ–ä¸º23 å¤šç»´æ•°ç»„å¦‚int xy[3][2]æ•°ç»„ç»´æ•°ä¸æ­¢ä¸€ä¸ªçš„ç§°ä¸ºå¤šç»´æ•°ç»„ã€‚æ•°ç»„xy[3][2]åœ¨å†…å­˜ä¸­çš„å­˜å‚¨é¡ºåºä¸º: (0,0) (0,1) (1,0) (1,1) (2,0) (2,1)//å¤šç»´æ•°ç»„ä¸­çš„å…ƒç´ å­˜å‚¨é¡ºåºæŒ‰ç…§æœ€å³è¾¹çš„ä¸‹æ ‡çŽ‡å…ˆå˜åŒ–çš„åŽŸåˆ™ï¼Œç§°ä¸º__è¡Œä¸»åº__ã€‚å…³äºŽæ˜¯æŠŠç¬¬ä¸€ä¸ªä¸‹æ ‡(ä¸Šé¢å®šä¹‰çš„æ•°ç»„xyä¸­çš„3)è§£é‡Šä¸ºè¡Œè¿˜æ˜¯è§£é‡Šä¸ºåˆ—ï¼Œéƒ½å¯ä»¥çš„ï¼Œåªè¦ä½ åœ¨ä½¿ç”¨è¿™ä¸ªæ•°ç»„çš„æ—¶å€™ä½¿ç”¨åŒä¸€ç§å°±å¯ä»¥ã€‚å¦‚æžœä½ æŠŠç¬¬ä¸€ä¸ªä¸‹æ ‡è§£é‡Šä¸ºè¡Œç¬¬äºŒä¸ªä¸‹æ ‡è§£é‡Šä¸ºåˆ—ï¼Œé‚£ä¹ˆå½“ä½ æŒ‰ç…§å­˜å‚¨é¡ºåºé€ä¸ªè®¿é—®æ•°ç»„å…ƒç´ æ—¶ï¼Œæ‰€èŽ·å¾—çš„å…ƒç´ æ˜¯æŒ‰è¡ŒæŽ’åˆ—çš„ï¼Œç›¸ååˆ™æ˜¯æŒ‰åˆ—æŽ’åˆ—çš„ã€‚ æ•°ç»„åå’Œä¸‹æ ‡int xy[3][2]ï¼Œæ•°ç»„åxyæ˜¯ä¸€ä¸ªæŒ‡å‘åŒ…æ¶µ2ä¸ªæ•´åž‹å…ƒç´ çš„æ•°ç»„çš„æŒ‡é’ˆï¼ˆæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•°ç»„çš„ä¸‹æ ‡å’ŒæŒ‡é’ˆä¹‹é—´çš„å…³ç³»: 1.xy:åœ¨ä¸‰ä¸ªåŒ…å«ä¸¤ä¸ªæ•´åž‹å…ƒç´ çš„æ•°ç»„ä¸­ï¼Œxyä¸ºæŒ‡å‘ç¬¬ä¸€ä¸ªå­æ•°ç»„ã€‚ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯æŒ‡é’ˆï¼Œè¯´æ˜Žäº†æŒ‡å‘ï¼‰ 2.xy + 1:åœ¨ä¸‰ä¸ªåŒ…å«ä¸¤ä¸ªæ•´åž‹å…ƒç´ çš„æ•°ç»„ä¸­ï¼Œxyä¸ºæŒ‡å‘ç¬¬äºŒä¸ªå­æ•°ç»„ï¼Œ+1æ˜¯æ ¹æ®åŒ…å«2ä¸ªæ•´åž‹å…ƒç´ çš„æ•°ç»„é•¿åº¦è¿›è¡Œè°ƒæ•´çš„ï¼Œæ‰€ä»¥æ˜¯æŒ‡å‘ç¬¬äºŒä¸ªå­æ•°ç»„ã€‚ï¼ˆæ³¨æ„ï¼šåŒä¸Šï¼Œè¿™æ˜¯æŒ‡é’ˆï¼Œè¯´æ˜Žäº†æŒ‡å‘ï¼‰ 3.*(xy + 1):èŽ·å–æŒ‡å‘ç¬¬äºŒä¸ªå­æ•°ç»„çš„æŒ‡é’ˆï¼Œé€šè¿‡é—´æŽ¥æ“ä½œç¬¦å¾—åˆ°è¿™ä¸ªå­æ•°ç»„ï¼Œæˆ–è€…å¯ä»¥æŠŠè¯¥è¡¨è¾¾å¼å†™ä¸ºxy[1]ï¼ˆå³è¡¨ç¤ºçš„æ˜¯ç¬¬äºŒä¸ªå­æ•°ç»„ï¼‰ã€‚ 4.*(xy + 1) ï¼‹ 1ï¼šåœ¨ç¬¬ä¸‰ç‚¹ä¸­æˆ‘ä»¬å–å¾—äº†ç¬¬äºŒä¸ªå­æ•°ç»„ï¼Œè®°å¾—æˆ‘ä»¬åœ¨ä¸Šé¢è®²ä¸€ç»´æ•°ç»„çš„æ—¶å€™ï¼ŒèŽ·å–æ•°ç»„ç¬¬nä¸ªå…ƒç´ çš„åœ°å€çš„åŠžæ³•æ˜¯:array + næˆ–è€…&amp;array[n]ï¼Œåœ¨å’Œ*(xy + 1) ï¼‹ 1è¿›è¡Œå¯¹æ¯”ä¹‹åŽä¸éš¾å‘çŽ°ï¼Œå…¶è¡¨è¾¾çš„æ„æ€å°±æ˜¯èŽ·å–ç¬¬äºŒä¸ªå­æ•°ç»„ä¸­ç¬¬2ä¸ªå…ƒç´ ï¼ˆå› ä¸ºæ•°ç»„ä¸‹æ ‡æ˜¯ä»Ž0å¼€å§‹ï¼‰çš„åœ°å€æˆ–è€…å¯ä»¥æŠŠè¯¥è¡¨è¾¾å¼å†™ä¸ºxy[1] ï¼‹ 1ï¼ˆæ³¨æ„ï¼šåŒä¸Šï¼Œè¿™æ˜¯æŒ‡é’ˆï¼Œæ˜¯ä¸€ä¸ªåœ°å€ï¼‰ 5.*(*(xy + 1) + 1)ï¼šç”±é—´æŽ¥æ“ä½œç¬¦ï¼ŒèŽ·å¾—ç¬¬4ç‚¹ä¸­çš„æŒ‡é’ˆæŒ‡å‘çš„å…·ä½“å…ƒç´ ã€‚åŒä¸Šæˆ‘ä»¬å¯ä»¥å†™ä¸º:*(xy[1] + 1)ï¼Œè¿›ä¸€æ­¥æ”¹å†™xy[1][1]; æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ int vector[10]; int matrix[3][4]; int \*vp = vector; int (\*mp)[10] = matrix;//ä¸‹æ ‡å¼•ç”¨çš„ä¼˜å…ˆçº§æ˜¯é«˜äºŽé—´æŽ¥å¼•ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é—´æŽ¥å¼•ç”¨è¿™é‡Œæ‰‹åŠ¨åŠ ä¸Šæ‹¬å·æ‰è¡Œ æ‰€ä»¥mpæ˜¯ä¸€ä¸ªæŒ‡å‘æ•´åž‹æ•°ç»„çš„æŒ‡é’ˆï¼Œvpæ˜¯æŒ‡å‘æ•´åž‹å˜é‡çš„æŒ‡é’ˆã€‚ è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼šä¸€å®šä¸è¦æŠŠæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆå’ŒæŒ‡é’ˆæ•°ç»„æµ“æ··äº†ï¼Œé‚£ä¸ªç¡®ä¿ç®—æœ¯ä¼˜å…ˆçº§çš„æ‹¬å·æ˜¯å¾ˆé‡è¦çš„ï¼Œint (*mp)[10]ä»£è¡¨çš„æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œè€Œint *mp[10]è¡¨ç¤ºçš„æ˜¯æŒ‡é’ˆæ•°ç»„ã€‚ å½“æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°çš„æ—¶å€™ï¼Œå¤šç»´æ•°ç»„å’Œä¸€ç»´æ•°ç»„ç›¸åŒï¼Œéƒ½æ˜¯ç”¨æŒ‡é’ˆä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚ ä¸€ç»´æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°çš„å‡½æ•°å£°æ˜Žå½¢å¼å®žå‚ï¼šint vectors[10];å‡½æ•°å£°æ˜Ž:void vector(int *vec);æˆ–è€…void vector (int vet[]) å¤šç»´æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°çš„å‡½æ•°å£°æ˜Žå½¢å¼å®žå‚ï¼šint matrixs[3][10];å‡½æ•°å£°æ˜Ž:void matrix(int (*mat)[10]);æˆ–è€…void matrix(int mat[][10]);void matrix(int mat[][10]);è¿™é‡Œçš„å…³é”®åœ¨äºŽç¼–è¯‘å™¨å¿…é¡»çŸ¥é“ç¬¬äºŒä¸ªåŠä»¥åŽå„ç»´çš„é•¿åº¦æ‰èƒ½å¯¹å„ä¸‹æ ‡è¿›è¡Œæ±‚å€¼ï¼Œå› æ­¤åœ¨åŽŸåž‹ä¸­å¿…é¡»å£°æ˜Žè¿™ä¸ªç»´çš„é•¿åº¦ å…³äºŽå¤šç»´æ•°ç»„åˆå§‹åŒ– ç¬¬ä¸€ç§æ–¹å¼:int xy[3][2] = {1,2,3,4,5,6};è¿™ç§å°±æ˜¯åœ¨å£°æ˜Žå˜é‡çš„æ—¶å€™å°±åœ¨åŽé¢è·Ÿç€ä¸€é•¿ä¸²çš„åˆå§‹æ•°æ®ã€‚ ç¬¬äºŒç§æ–¹å¼: int xy[3][2]; xy[0][0] = 1; xy[0][1] = 2; ... xy[2][0] = 5 xy[2][1] = 6;è¿™å’Œç¬¬ä¸€ç§çš„å·®åˆ«å°±åœ¨äºŽï¼Œè¿™ä¸€ç§æ˜¯å¯¹æ•°ç»„å…ƒç´ ä¸€ä¸ªä¸€ä¸ªçš„åŽ»èµ‹å€¼ï¼Œè¿™ç§å­˜å‚¨é¡ºåºæ˜¯ä»¥æœ€å³è¾¹ä¸‹æ ‡çŽ‡å…ˆå˜åŒ–çš„ï¼ˆå‰é¢æ³¨é‡Šæåˆ°çš„è¡Œä¸»åºï¼‰ã€‚ ç¬¬ä¸‰ç§æ–¹å¼:å› ä¸ºå¤šç»´æ•°ç»„å¯ä»¥çœ‹æˆæ˜¯æ¯ä¸ªå…ƒç´ ç”±ä¸€ä¸ªå­æ•°ç»„ç»„æˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸€ä¸ªå­æ•°ç»„ä¸ºä¸€ä¸ªä¸ªä½“æ¥åˆå§‹åŒ–ã€‚ int xy[3][2] = { {1,2}, {3,4}, {5,6} }; è¿™æ ·çœ‹èµ·æ¥å’Œç¬¬ä¸€ç§çš„æ–¹å¼æ˜¯æœ‰ç‚¹ç±»ä¼¼çš„ã€‚ æ€»ç»“ 1 .æ•°ç»„å˜é‡æ˜¯constæŒ‡é’ˆï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½è¢«èµ‹å€¼çš„ï¼› 2.å¦‚æžœæŒ‡é’ˆæŒ‡å‘çš„ä¸æ˜¯ä¸€ç‰‡è¿žç»­çš„ç©ºé—´ï¼Œé‚£ä¹ˆå¯¹åœ°å€è¿›è¡ŒåŠ æ“ä½œï¼ˆæˆ–è€…å‡æ“ä½œï¼‰æ˜¯æ²¡æœ‰æ„ä¹‰ï¼›]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ã€ŠCå’ŒæŒ‡é’ˆNoteã€‹ä¹‹æŒ‡é’ˆ]]></title>
      <url>%2F2017%2F02%2F22%2Fc_and_pointer_note_case3%2F</url>
      <content type="text"><![CDATA[æŒ‡é’ˆã€‚å½“å‰Cè¯­è¨€çŽ¯å¢ƒ: Apple LLVM version 8.0.0 (clang-800.0.38) Target: x86_64-apple-darwin15.6.0 Thread model: posix InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin ç²—ç•¥çš„æ€»ç»“ä¸€ä¸‹çŸ¥è¯†ç‚¹ 1.å˜é‡æ ‡è¯†ç¬¦ä¸Žå†…å­˜ä½ç½®ä¹‹é—´çš„å…³è”å¹¶ä¸æ˜¯ç¡¬ä»¶æä¾›çš„ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬æä¾›çš„ï¼Œç¡¬ä»¶ä»ç„¶é€šè¿‡åœ°å€è®¿é—®å†…å­˜ä½ç½®ã€‚ 2.æ•°ç»„ä¸­çš„å…ƒç´ å­˜å‚¨äºŽè¿žç»­çš„å†…å­˜åœ°å€ä¸­ã€‚ 3.NULLæŒ‡é’ˆä½œä¸ºä¸€ä¸ªä¸æŒ‡å‘ä»»ä½•ä¸œè¥¿çš„ç‰¹æ®ŠæŒ‡é’ˆã€‚åœ¨å¯¹æŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨æ“ä½œä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿å®ƒä¸æ˜¯NULLæŒ‡é’ˆ(å› ä¸ºå¯¹ä¸€ä¸ªNULLæŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨æ˜¯éžæ³•æ“ä½œ)ã€‚ 4.æŒ‡é’ˆçš„æŒ‡é’ˆä¸­ï¼Œæ“ä½œç¬¦å…·æœ‰ä»Žå³å‘å·¦çš„ç»“åˆæ€§ï¼Œæ‰€ä»¥è¿™ä¸ªè¡¨è¾¾å¼ç›¸å½“äºŽ`(*c)`ï¼Œæ‰€ä»¥å¯ä»¥ä»Žé‡Œå‘å¤–æ±‚å€¼ã€‚å¯¹äºŽå¦‚ä¸‹ä»£ç ä¸­:int a = 10; int *b = &a; int **c = &b; è¡¨è¾¾å¼ ç›¸å½“çš„è¡¨è¾¾å¼ a 10 b &amp;a *b 12,a c &amp;b *c &amp;a,b **c 12,a,*b æ³¨æ„âš ï¸åœ¨æŒ‡é’ˆæ²¡æœ‰è¢«åˆå§‹åŒ–ä¹‹å‰ï¼Œä¸€å®šä¸è¦å¯¹è¿™ä¸ªæŒ‡é’ˆå˜é‡ä½¿ç”¨é—´æŽ¥æ“ä½œç¬¦ã€‚ ä¹ é¢˜ç»ƒä¹ çºªå½• 1.å­—ç¬¦ä¸²æŸ¥æ‰¾ç›¸å…³ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­æ‰¾å‡ºç¬¬ä¸€ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ã€‚è§£ç­”: char *find_char(char const *source,char const *chars){ if (source == NULL || chars == NULL) { return NULL; } char const *f_p = chars; do { do { if (*source == *chars) { char *result = (char *)source; char *cp; *cp = *result; return cp; } } while (*chars++ != '\0'); chars = f_p; } while (*source++ != '\0'); return NULL; }]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ã€ŠCå’ŒæŒ‡é’ˆNoteã€‹ä¹‹æ“ä½œç¬¦å’Œè¡¨è¾¾å¼]]></title>
      <url>%2F2017%2F02%2F22%2Fc_and_pointer_note_case2%2F</url>
      <content type="text"><![CDATA[è¿™ç¯‡ä¸»è¦è®°å½•æ“ä½œç¬¦å’Œè¡¨è¾¾å¼ç›¸å…³çš„åªæ˜¯ï¼å½“å‰Cè¯­è¨€çŽ¯å¢ƒ:1234Apple LLVM version 8.0.0 (clang-800.0.38)Target: x86_64-apple-darwin15.6.0Thread model: posixInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin ç§»ä½æ“ä½œç¬¦å·¦ç§»æ“ä½œç¬¦&lt;&lt;,å³ç§»æ“ä½œç¬¦&gt;&gt;;è€Œä¸”ä½ç§»çš„æ“ä½œæ•°å¿…é¡»æ˜¯æ•´æ•°ç±»åž‹ã€‚å…¶ä¸­å³ç§»æ“ä½œç¬¦å­˜åœ¨ä¸¤ç§æƒ…å†µï¼šç®—æœ¯ç§»ä½å’Œé€»è¾‘ç§»ä½ï¼›è¿™é‡Œä¸»è¦æ¥è¯´ä¸€è¯´ç®—æœ¯ç§»ä½ã€‚ é€»è¾‘ç§»ä½å·¦è¾¹ç§»å…¥çš„ä½ç”¨0å¡«å…… ç®—æœ¯ç§»ä½ç®—æœ¯ç§»ä½ä¹Ÿå°±æ˜¯è¯´ä¼šè€ƒè™‘åˆ°ç¬¦å·ä½ï¼Œå³å·¦è¾¹ç§»å…¥çš„ä½ç”±åŽŸå€¼çš„ç¬¦å·ä½å†³å®šï¼Œå¦‚æžœç¬¦å·ä½ä¸º1åˆ™ç§»å…¥çš„ä½ä¸º1ï¼Œç¬¦å·ä½ä¸º0åˆ™ç§»å…¥çš„ä½ä¸º0ï¼›å¯¹äºŽç§»ä½æ“ä½œï¼Œè¿˜å¿…é¡»çŸ¥é“æ•°å­—åœ¨è®¡ç®—æœºä¸­æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œè€Œä¸”è´Ÿæ•°çš„è¡¨ç¤ºå½¢å¼è¿˜ç¨æœ‰ä¸åŒã€‚ è´Ÿæ•°åœ¨è®¡ç®—æœºä¸­çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ å‡è®¾åœ¨å½“å‰è®¡ç®—æœºä¸­ï¼Œintåž‹å 8ä½ã€‚æ¯”å¦‚è¦çŸ¥é“æ•°å­—-10åœ¨è®¡ç®—æœºçš„è¡¨çŽ°å½¢å¼ï¼Œç¬¬ä¸€æ­¥ï¼šæ•°å­—10çš„äºŒè¿›åˆ¶å€¼ä¸º00001010ï¼Œç¬¬äºŒæ­¥ç”¨100000000æ¥å‡åŽ»00001010ã€‚å¾—åˆ°çš„å°±æ˜¯-10åœ¨äºŒè¿›åˆ¶ä¸­çš„è¡¨çŽ°å½¢å¼ä¸º:11110110ã€‚æ›´å¤šå…³äºŽè´Ÿæ•°è¡¥ç çš„ä»‹ç»é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—ï¼ï¼å…³äºŽ2çš„è¡¥ç  è¿™é‡Œæˆ‘ä¸¾ä¾‹è¯´æ˜Žä¸€ä¸‹ç§»ä½æ“ä½œ: int uint = 10; //00001010 int sint = -10;//11110110 printf("%d\n",uint >> 2);//00000010 printf("%d\n",sint >> 2);//11111101 åœ¨å½“å‰çŽ¯å¢ƒä¸‹ï¼š Apple LLVM version 8.0.0 (clang-800.0.38) Target: x86_64-apple-darwin15.6.0 Thread model: posix InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin æ‰“å°çš„ç»“æžœåˆ†åˆ«ä¸º2å’Œ-3,æ‰€ä»¥ä»Žè¿™é‡Œçœ‹å‡ºæ¥ç¼–è¯‘å™¨å¯¹äºŽå·¦ç§»æ“ä½œæ˜¯ç®—æœ¯ç§»ä½ã€‚ ++å’Œâ€”æ“ä½œç¬¦å¯¹äºŽè¿™ä¸¤ä¸ªæ“ä½œç¬¦çš„è®¡ç®—å°±å¾ˆç®€å•äº†ï¼Œè¿˜æ˜¯æ¥ä¸¾ä¾‹è¯´æ˜Žä¸€ä¸‹: int a,b,c,d; a = b = 10; c = ++a; d = b++; ä½†æ˜¯éœ€è¦æ¥ç†è§£è¿™å…¶ä¸­çš„åŽŸç†: ++å’Œâ€”æ“ä½œç¬¦åŽŸç†æŠ½è±¡çš„è¯´ï¼Œå‰ç¼€å’ŒåŽç¼€å½¢å¼çš„å¢žå€¼æ“ä½œç¬¦éƒ½å¤åˆ¶ä¸€ä»½å˜é‡å€¼çš„æ‹·è´ï¼Œè¿™äº›æ“ä½œç¬¦çš„ç»“æžœä¸æ˜¯è¢«ä»–ä»¬æ‰€ä¿®æ”¹çš„å˜é‡ï¼Œè€Œæ˜¯å˜é‡å€¼çš„æ‹·è´ã€‚ é€—å·æ“ä½œç¬¦é€—å·æ“ä½œç¬¦å°†å¤šä¸ªè¡¨è¾¾å¼åˆ†éš”å¼€ï¼Œè¿™äº›è¡¨è¾¾å¼ä»Žå·¦å‘å³é€ä¸ªè¿›è¡Œæ±‚å€¼ï¼Œ__æ•´ä¸ªé€—å·è¡¨è¾¾å¼çš„å€¼å°±æ˜¯æœ€åŽé‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ int (^f1)(int) = ^(int value){ return value + 1; }; int (^f2)(int) = ^(int value){ return value + 2; }; int (^f3)(int,int) = ^(int a,int b){ return a + b; }; int x,a,b,c; x = 0; //ä»Žè¿™é‡Œå¼€å§‹ a = f1(x); b = f2(x + a); for (c = f3(a,b); c < 10; c = f3(a,b)) { printf("while statements c is:%d\n",c); a = f1(++x); b = f2(x + a); } //åˆ°è¿™é‡Œç»“æŸï¼Œè¿™å…¶ä¸­çš„ä»£ç å°†ä¼šè¢«ä¿®æ”¹ ä¸Šé¢ä¸ºåŽŸå§‹çš„ä»£ç ç‰‡æ®µï¼ŒçŽ°åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨é€—å·æ“ä½œç¬¦æ¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ï¼ŒåŒæ—¶æˆ‘é€‰æ‹©ç”¨whileå¾ªçŽ¯æ¥ä»£æ›¿forå¾ªçŽ¯ã€‚ while (a = f1(x),b = f2(x + a),c = f3(a,b),++x,c < 10) { printf("while statements c is:%d\n",c); } çŽ°åœ¨ï¼Œå¾ªçŽ¯ä¸­ç”¨äºŽèŽ·å¾—ä¸‹ä¸€ä¸ªå€¼çš„è¯­å¥åªéœ€è¦å‡ºçŽ°ä¸€æ¬¡ï¼Œé€—å·æ“ä½œç¬¦ä½¿æºç æ›´æ˜“äºŽç»´æŠ¤ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ã€ŠCå’ŒæŒ‡é’ˆNoteã€‹ä¹‹åŸºç¡€]]></title>
      <url>%2F2017%2F02%2F20%2Fc_and_pointer_note_base%2F</url>
      <content type="text"><![CDATA[Cå­˜åœ¨ä¸¤ç§ä¸åŒçš„çŽ¯å¢ƒï¼šç¿»è¯‘çŽ¯å¢ƒå’Œæ‰§è¡ŒçŽ¯å¢ƒ;ç¿»è¯‘çŽ¯å¢ƒæ˜¯å°†æºä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤ï¼Œè€Œæ‰§è¡ŒçŽ¯å¢ƒç”¨äºŽå®žé™…æ‰§è¡Œä»£ç ã€‚ ç¿»è¯‘å…¶ä¸­ç¿»è¯‘é˜¶æ®µä¸»è¦åŒ…æ‹¬äº†ç¼–è¯‘å’Œé“¾æŽ¥ä¸¤éƒ¨åˆ†ã€‚ __ ç¼–è¯‘å°†æºä»£ç è½¬æ¢ä¸ºç›®æ ‡ä»£ç çš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…å«äº†é¢„å¤„ç†ï¼ˆé¢„å¤„ç†ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚defineæ›¿æ¢ä¸ºå®žé™…å€¼ï¼‰å’Œè§£æžï¼ˆåˆ¤æ–­æºä»£ç çš„æ„æ€ï¼‰ï¼Œåœ¨æœ€åŽç”Ÿæˆç›®æ ‡ä»£ç ï¼ˆæœºå™¨æŒ‡ä»¤çš„åˆæ­¥å½¢å¼ï¼‰ã€‚ é“¾æŽ¥é“¾æŽ¥å™¨ä¼šæŠŠå„ä¸ªç›®æ ‡æ–‡ä»¶æ†ç»‘èµ·æ¥å½¢æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¼•å…¥cå‡½æ•°åº“ã€‚ æ‰§è¡Œç¨‹åºè½½å…¥åˆ°å†…å­˜ä¸­ï¼Œå¹¶åˆå§‹åŒ–åœ¨å †æ ˆä¸­æ²¡æœ‰åˆå§‹åŒ–çš„å˜é‡ã€‚ __ è¿è¡Œæ—¶å †æ ˆç”¨æˆ·ä¿å­˜å‡½æ•°çš„å±€éƒ¨å˜é‡å’Œè¿”å›žå€¼ã€‚ é™æ€å†…å­˜å­˜å‚¨åœ¨é™æ€å†…å­˜ä¸­çš„å˜é‡å°†ä¼šåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ä¸€ç›´ä¿ç•™ï¼ ç¨‹åºçš„ç»ˆæ­¢å¯ä»¥æ˜¯mainå‡½æ•°å®Œæˆè¿”å›žï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸»åŠ¨æ‰§è¡Œäº†exitã€‚ ä¸€ä¸ªæŠ€å·§å¦‚æžœåœ¨ä½¿ç”¨æ³¨é‡Šçš„æ—¶å€™/**/åµŒå¥—äº†å¤šå±‚ä¼šå¯¼è‡´æ³¨é‡Šå¤±æ•ˆï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨æœ€å¤–å±‚æ·»åŠ :123#if 0//ä¸­é—´ä¸ºä»£ç #endif è€Œä¸”åœ¨ä½¿ç”¨æ³¨é‡Šçš„æ—¶å€™å¹¶ä¸ä¼šæŠŠæ³¨é‡ŠæŽ‰çš„éƒ¨åˆ†ä»Žæºä»£ç ä¸­åˆ é™¤ï¼Œåªæ˜¯ä¸åŽ»æ‰§è¡Œè€Œå·²ï¼Œä½¿ç”¨if endifçš„è¯æ˜¯åœ¨é€»è¾‘ä¸Šåˆ é™¤äº†è¿™ä¸€æ®µä»£ç çš„ã€‚è¿™åœ¨åŽé¢çš„é¢„å¤„ç†å™¨é‚£ä¸€èŠ‚ä¼šè®²æ›´å¤šã€‚]]></content>
    </entry>

    
  
  
</search>
