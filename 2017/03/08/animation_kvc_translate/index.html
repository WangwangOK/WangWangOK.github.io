<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 动画中关于KVC官方文档翻译 · 凌云壮志幾多愁</title><meta name="description" content="动画中关于KVC官方文档翻译 - 王望"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/uploads/avatar/heart.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="凌云壮志幾多愁"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/uploads/avatar/pencil.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/wwloading" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/wangwangok" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://legacy.gitbook.com/@wangwangok" target="_blank" class="nav-list-link">GITBOOK</a></li><li class="nav-list-item"><a href="http://www.jianshu.com/u/11188e5bb304" target="_blank" class="nav-list-link">JIANSHU</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">动画中关于KVC官方文档翻译</h1><div class="post-info">Mar 8, 2017</div><div class="post-content"><p>CoreAnimation让CAAnimation和CALayer都遵守NSKeyValueCoding协议，因此为它们增加了一些默认的keys（对应的value），添加的keyPath中包含了了CGPoint,CGRect,CGSize和CATransform3D类型。<br><a id="more"></a> </p>
<h2 id="1-键值编码兼容的容器类"><a href="#1-键值编码兼容的容器类" class="headerlink" title="1.键值编码兼容的容器类"></a>1.键值编码兼容的容器类</h2><p>CAAnimation和CALayer类就是作为键值编码兼容的容器类，我们可以根据任意的keys来设置对应的value，即便这个key不是CALayer公开的属性，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[theLayer setValue:[NSNumber numberWithInteger:50] forKey:@&quot;someKey&quot;];</div></pre></td></tr></table></figure></p>
<p>同样也可以通过任意已知的keys来查找对应的values，可以使用下面的代码通过预先设置好的somekey来检索values：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">someKeyValue=[theLayer valueForKey:@&quot;someKey&quot;];</div></pre></td></tr></table></figure></p>
<h2 id="2-默认支持的value"><a href="#2-默认支持的value" class="headerlink" title="2.默认支持的value"></a>2.默认支持的value</h2><p>CoreAnimation在键值编码时规定：一个类可以给没有value的key提供一个默认值。CAAnimation和CALayer类都提供了类方法<code>defaultValueForKey</code>。</p>
<blockquote>
<p>对于为key提供了默认value的类，在创建这个类的子类时必须要重写它的<code>defaultValueForKey</code>方法。</p>
</blockquote>
<p>当你在实现这个方法的时候，需要检查key的参数列表，并且返回一个合适的value值，下面提供了一个例子，layer提供了<code>defaultValueForKey:</code>方法，为<code>maskToBounds</code>属性设置默认值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">+ (id)defaultValueForKey:(NSString *)key&#123;</div><div class="line">   if ([key isEqualToString:@&quot;masksToBounds&quot;])</div><div class="line">      return [NSNumber numberWithBool:YES];</div><div class="line">      return [super defaultValueForKey:key];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-封装"><a href="#3-封装" class="headerlink" title="3.封装"></a>3.封装</h2><p>当一个key的数据是由一个标量值或者一个C的数据结构时，<strong>你必须要在其被分配到layer之前对其进行封装</strong>。同样的，当要访问这些Type时，也必须检查对象，然后使用合适的方法来打开合适的值。下表显示了Objective-c和c类型封装</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>C type</th>
<th style="text-align:center">输入</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.apple.com/reference/coregraphics/cgpoint" target="_blank" rel="external">CGPoint</a></td>
<td style="text-align:center"><a href="https://developer.apple.com/reference/foundation/nsvalue" target="_blank" rel="external">NSValue</a></td>
</tr>
<tr>
<td><a href="https://developer.apple.com/reference/coregraphics/cgsize" target="_blank" rel="external">CGSize</a></td>
<td style="text-align:center">NSValue</td>
</tr>
<tr>
<td><a href="https://developer.apple.com/reference/coregraphics/cgrect" target="_blank" rel="external">CGRect</a></td>
<td style="text-align:center">NSValue</td>
</tr>
<tr>
<td><a href="https://developer.apple.com/reference/quartzcore/catransform3d" target="_blank" rel="external">CATransform3D</a></td>
<td style="text-align:center">NSValue</td>
</tr>
<tr>
<td><a href="https://developer.apple.com/reference/coregraphics/cgaffinetransform" target="_blank" rel="external">CGAffineTransform</a></td>
<td style="text-align:center"><a href="https://developer.apple.com/reference/foundation/nsaffinetransform" target="_blank" rel="external">NSAffineTransform</a> (OS X only)</td>
</tr>
</tbody>
</table>
</div>
<p>不同类型封装的类</p>
<h2 id="4-为KeyPath的提供的结构"><a href="#4-为KeyPath的提供的结构" class="headerlink" title="4.为KeyPath的提供的结构"></a>4.为KeyPath的提供的结构</h2><p>CAAnimation和CALayer类使用KeyPath来访问指定的字段，这功能可以让你在做动画时为特定的KeyPath提供数据。使用<code>setValue:forKeyPath和valueForKeyPath:</code>方法设置，然后用<code>valueForKeyPath:</code>获取相应的值。</p>
<h4 id="1-、CATransform3D-KeyPaths"><a href="#1-、CATransform3D-KeyPaths" class="headerlink" title="(1)、CATransform3D KeyPaths"></a>(1)、CATransform3D KeyPaths</h4><p>你可以使用更强大的KeyPath，查找包含了<code>CATransform3D</code>类型属性的值。在需要指定layer的<code>transforms</code>完整的KeyPath时，我们可以根据下表中提供的数据，使用<code>transform</code>和<code>sublayerTransform</code>的值。例如，我们需要制定绕着layer的z轴旋转时，我就需要指定KeyPath为<code>transform.rotation.z</code>。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Field Key Path</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>rotation.x</td>
<td style="text-align:center">围绕X轴，旋转值为弧度，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>rotation.y</td>
<td style="text-align:center">围绕y轴，旋转值为弧度，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>rotation.z</td>
<td style="text-align:center">围绕z轴，旋转值为弧度，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>rotation</td>
<td style="text-align:center">围绕z轴，旋转值为弧度，<code>NSNumber</code>类型，它和设置<code>rotation.z</code>一样</td>
</tr>
<tr>
<td>scale.x</td>
<td style="text-align:center">x轴缩放，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>scale.y</td>
<td style="text-align:center">y轴缩放，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>scale.z</td>
<td style="text-align:center">z轴缩放，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>scale</td>
<td style="text-align:center">三个轴缩放的平均值，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>translation.x</td>
<td style="text-align:center">x轴位移，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>translation.y</td>
<td style="text-align:center">y轴位移，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>translation.z</td>
<td style="text-align:center">z轴位移，<code>NSNumber</code>类型</td>
</tr>
<tr>
<td>translation</td>
<td style="text-align:center">x，y上面位移，<code>NSSize</code> 和<code>CGSize</code></td>
</tr>
</tbody>
</table>
</div>
<p>下面展示了怎样通过setValue:forKeyPath方法来修改一个layer，这个例子设置了layer在x轴上位移了10个像素点，来显示layer在x轴上的移动:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[myLayer setValue:[NSNumber numberWithFloat:10.0] forKeyPath:@&quot;transform.translation.x&quot;];</div></pre></td></tr></table></figure></p>
<blockquote>
<p>⚠注意：通过keyPath来设置value值的时候不能像Objective-C里面对属性的赋值，必须配合KeyPath字符串使用setValue:forKeyPath方法来进行赋值。</p>
</blockquote>
<h4 id="2-、CGPoint-KeyPath"><a href="#2-、CGPoint-KeyPath" class="headerlink" title="(2)、CGPoint KeyPath"></a>(2)、CGPoint KeyPath</h4><p>如果当前给的是一个<code>CGPoint</code>类型，则可以根据下表进行设置。例如，当我们想要修改layer的<code>position</code>的x值时，可以在KeyPath中写<code>position.x</code>。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Structure Field</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td style="text-align:center">x的分量</td>
</tr>
<tr>
<td>y</td>
<td style="text-align:center">y的分量</td>
</tr>
</tbody>
</table>
</div>
<h4 id="3-、CGSize-KeyPath"><a href="#3-、CGSize-KeyPath" class="headerlink" title="(3)、CGSize KeyPath"></a>(3)、CGSize KeyPath</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Structure Field</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>width</td>
<td style="text-align:center">size的width值</td>
</tr>
<tr>
<td>height</td>
<td style="text-align:center">size的height值</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-、CGRect-KeyPath"><a href="#4-、CGRect-KeyPath" class="headerlink" title="(4)、CGRect KeyPath"></a>(4)、CGRect KeyPath</h4><p>例如，要更改layer的<code>bounds</code>属性的width值，可以写入关键路径<code>bounds.size.width</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Structure Field</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>origin</td>
<td style="text-align:center">坐标，类型<code>CGPoint</code></td>
</tr>
<tr>
<td>origin.x</td>
<td style="text-align:center">坐标的x值，类型<code>CGFloat</code></td>
</tr>
<tr>
<td>origin.y</td>
<td style="text-align:center">坐标的y值，类型<code>CGFloat</code></td>
</tr>
<tr>
<td>size</td>
<td style="text-align:center">大小，类型<code>CGSize</code></td>
</tr>
<tr>
<td>size.width</td>
<td style="text-align:center">size的width值</td>
</tr>
<tr>
<td>size.height</td>
<td style="text-align:center">size的height值</td>
</tr>
</tbody>
</table>
</div>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>翻译这篇文章的目的因为我在做动画中需要每次都差到对应的KeyPath，很麻烦，索性我就将其翻译出来。<br>到目前为止，这片文章大部分翻译算是完成了，看起来很粗糙，能看懂就最好了。</p>
<p>原来地址：<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreAnimation_guide/Key-ValueCodingExtensions/Key-ValueCodingExtensions.html" target="_blank" rel="external">Key-Value Coding Extensions</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/03/21/stack_heap_with_c/" class="prev">PREV</a><a href="/2017/03/02/unicode/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2017/03/08/animation_kvc_translate/';
var disqus_title = '动画中关于KVC官方文档翻译';
var disqus_url = 'http://yoursite.com/2017/03/08/animation_kvc_translate/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>关注微博<a href="http://weibo.com/wwloading" target="_blank">@凌云壮志幾多愁</a>，让我们有更多的联系。</p><p>© 2016 - 2019 <a href="http://yoursite.com">王望</a>, Powered By <a href="https://hexo.io/" target="_blank">Hexo</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>